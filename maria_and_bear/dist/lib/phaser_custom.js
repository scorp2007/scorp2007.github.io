
!function(p){if("object"==typeof exports)module.exports=p();else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self);b.p2=p()}}(function(){return function b(g,k,f){function m(a,d){if(!k[a]){if(!g[a]){var c="function"==typeof require&&require;if(!d&&c)return c(a,!0);if(n)return n(a,!0);throw Error("Cannot find module '"+a+"'");}c=k[a]={exports:{}};g[a][0].call(c.exports,function(c){var d=g[a][1][c];return m(d?d:c)},c,c.exports,b,g,k,f)}return k[a].exports}
for(var n="function"==typeof require&&require,a=0;a<f.length;a++)m(f[a]);return m}({1:[function(b,g,k){function f(){}var m=b("./Scalar");g.exports=f;f.lineInt=function(b,a,c){var d=[0,0],e,h,l,q,f;e=b[1][1]-b[0][1];h=b[0][0]-b[1][0];b=e*b[0][0]+h*b[0][1];l=a[1][1]-a[0][1];q=a[0][0]-a[1][0];a=l*a[0][0]+q*a[0][1];f=e*q-l*h;m.eq(f,0,c||0)||(d[0]=(q*b-h*a)/f,d[1]=(e*a-l*b)/f);return d};f.segmentsIntersect=function(b,a,c,d){var e=a[0]-b[0];a=a[1]-b[1];var h=d[0]-c[0],l=d[1]-c[1];if(0==h*a-l*e)return!1;
d=(e*(c[1]-b[1])+a*(b[0]-c[0]))/(h*a-l*e);b=(h*(b[1]-c[1])+l*(c[0]-b[0]))/(l*e-h*a);return 0<=d&&1>=d&&0<=b&&1>=b}},{"./Scalar":4}],2:[function(b,g,k){function f(){}g.exports=f;f.area=function(a,c,d){return(c[0]-a[0])*(d[1]-a[1])-(d[0]-a[0])*(c[1]-a[1])};f.left=function(a,c,d){return 0<f.area(a,c,d)};f.leftOn=function(a,c,d){return 0<=f.area(a,c,d)};f.right=function(a,c,d){return 0>f.area(a,c,d)};f.rightOn=function(a,c,d){return 0>=f.area(a,c,d)};var m=[],n=[];f.collinear=function(a,c,d,b){return b?
(m[0]=c[0]-a[0],m[1]=c[1]-a[1],n[0]=d[0]-c[0],n[1]=d[1]-c[1],Math.acos((m[0]*n[0]+m[1]*n[1])/(Math.sqrt(m[0]*m[0]+m[1]*m[1])*Math.sqrt(n[0]*n[0]+n[1]*n[1])))<b):0==f.area(a,c,d)};f.sqdist=function(a,c){var d=c[0]-a[0],b=c[1]-a[1];return d*d+b*b}},{}],3:[function(b,g,k){function f(){this.vertices=[]}function m(a,d,b,e,f){var h=d[1]-a[1];d=a[0]-d[0];a=h*a[0]+d*a[1];var l=e[1]-b[1];e=b[0]-e[0];b=l*b[0]+e*b[1];var q=h*e-l*d;return c.eq(q,0,f||0)?[0,0]:[(e*a-d*b)/q,(h*b-l*a)/q]}var n=b("./Line"),a=b("./Point"),
c=b("./Scalar");g.exports=f;f.prototype.at=function(a){var c=this.vertices,d=c.length;return c[0>a?a%d+d:a%d]};f.prototype.first=function(){return this.vertices[0]};f.prototype.last=function(){return this.vertices[this.vertices.length-1]};f.prototype.clear=function(){this.vertices.length=0};f.prototype.append=function(a,c,d){if("undefined"==typeof c)throw Error("From is not given!");if("undefined"==typeof d)throw Error("To is not given!");if(d-1<c)throw Error("lol1");if(d>a.vertices.length)throw Error("lol2");
if(0>c)throw Error("lol3");for(;c<d;c++)this.vertices.push(a.vertices[c])};f.prototype.makeCCW=function(){for(var c=0,d=this.vertices,b=1;b<this.vertices.length;++b)if(d[b][1]<d[c][1]||d[b][1]==d[c][1]&&d[b][0]>d[c][0])c=b;a.left(this.at(c-1),this.at(c),this.at(c+1))||this.reverse()};f.prototype.reverse=function(){for(var a=[],c=0,d=this.vertices.length;c!==d;c++)a.push(this.vertices.pop());this.vertices=a};f.prototype.isReflex=function(c){return a.right(this.at(c-1),this.at(c),this.at(c+1))};var d=
[],e=[];f.prototype.canSee=function(c,b){var h,l;if(a.leftOn(this.at(c+1),this.at(c),this.at(b))&&a.rightOn(this.at(c-1),this.at(c),this.at(b)))return!1;l=a.sqdist(this.at(c),this.at(b));for(var f=0;f!==this.vertices.length;++f)if((f+1)%this.vertices.length!==c&&f!==c&&a.leftOn(this.at(c),this.at(b),this.at(f+1))&&a.rightOn(this.at(c),this.at(b),this.at(f))&&(d[0]=this.at(c),d[1]=this.at(b),e[0]=this.at(f),e[1]=this.at(f+1),h=n.lineInt(d,e),a.sqdist(this.at(c),h)<l))return!1;return!0};f.prototype.copy=
function(a,c,d){d=d||new f;d.clear();if(a<c)for(var b=a;b<=c;b++)d.vertices.push(this.vertices[b]);else{for(b=0;b<=c;b++)d.vertices.push(this.vertices[b]);for(b=a;b<this.vertices.length;b++)d.vertices.push(this.vertices[b])}return d};f.prototype.getCutEdges=function(){for(var a=[],c,d,b=new f,e=Number.MAX_VALUE,g=0;g<this.vertices.length;++g)if(this.isReflex(g))for(var n=0;n<this.vertices.length;++n)if(this.canSee(g,n)){c=this.copy(g,n,b).getCutEdges();d=this.copy(n,g,b).getCutEdges();for(var m=0;m<
d.length;m++)c.push(d[m]);c.length<e&&(a=c,e=c.length,a.push([this.at(g),this.at(n)]))}return a};f.prototype.decomp=function(){var a=this.getCutEdges();return 0<a.length?this.slice(a):[this]};f.prototype.slice=function(a){if(0==a.length)return[this];if(a instanceof Array&&a.length&&a[0]instanceof Array&&2==a[0].length&&a[0][0]instanceof Array){for(var c=[this],d=0;d<a.length;d++)for(var b=a[d],e=0;e<c.length;e++){var h=c[e].slice(b);if(h){c.splice(e,1);c.push(h[0],h[1]);break}}return c}b=a;d=this.vertices.indexOf(b[0]);
e=this.vertices.indexOf(b[1]);return-1!=d&&-1!=e?[this.copy(d,e),this.copy(e,d)]:!1};f.prototype.isSimple=function(){for(var a=this.vertices,c=0;c<a.length-1;c++)for(var d=0;d<c-1;d++)if(n.segmentsIntersect(a[c],a[c+1],a[d],a[d+1]))return!1;for(c=1;c<a.length-2;c++)if(n.segmentsIntersect(a[0],a[a.length-1],a[c],a[c+1]))return!1;return!0};f.prototype.quickDecomp=function(c,d,b,e,g,n){g=g||100;n=n||0;e=e||25;c="undefined"!=typeof c?c:[];d=d||[];b=b||[];var h=[0,0],l=[0,0],q=[0,0],t,v,r,k=0,E=0,C=0,
F=new f,I=new f,H=this.vertices;if(3>H.length)return c;n++;if(n>g)return console.warn("quickDecomp: max level ("+g+") reached."),c;for(var B=0;B<this.vertices.length;++B)if(this.isReflex(B)){d.push(this.vertices[B]);t=v=Number.MAX_VALUE;for(var G=0;G<this.vertices.length;++G)a.left(this.at(B-1),this.at(B),this.at(G))&&a.rightOn(this.at(B-1),this.at(B),this.at(G-1))&&(q=m(this.at(B-1),this.at(B),this.at(G),this.at(G-1)),a.right(this.at(B+1),this.at(B),q)&&(r=a.sqdist(this.vertices[B],q),r<v&&(v=r,
l=q,E=G))),a.left(this.at(B+1),this.at(B),this.at(G+1))&&a.rightOn(this.at(B+1),this.at(B),this.at(G))&&(q=m(this.at(B+1),this.at(B),this.at(G),this.at(G+1)),a.left(this.at(B-1),this.at(B),q)&&(r=a.sqdist(this.vertices[B],q),r<t&&(t=r,h=q,k=G)));if(E==(k+1)%this.vertices.length)q[0]=(l[0]+h[0])/2,q[1]=(l[1]+h[1])/2,b.push(q),B<k?(F.append(this,B,k+1),F.vertices.push(q),I.vertices.push(q),0!=E&&I.append(this,E,this.vertices.length),I.append(this,0,B+1)):(0!=B&&F.append(this,B,this.vertices.length),
F.append(this,0,k+1),F.vertices.push(q),I.vertices.push(q),I.append(this,E,B+1));else{E>k&&(k+=this.vertices.length);h=Number.MAX_VALUE;if(k<E)return c;for(G=E;G<=k;++G)a.leftOn(this.at(B-1),this.at(B),this.at(G))&&a.rightOn(this.at(B+1),this.at(B),this.at(G))&&(r=a.sqdist(this.at(B),this.at(G)),r<h&&(h=r,C=G%this.vertices.length));B<C?(F.append(this,B,C+1),0!=C&&I.append(this,C,H.length),I.append(this,0,B+1)):(0!=B&&F.append(this,B,H.length),F.append(this,0,C+1),I.append(this,C,B+1))}F.vertices.length<
I.vertices.length?(F.quickDecomp(c,d,b,e,g,n),I.quickDecomp(c,d,b,e,g,n)):(I.quickDecomp(c,d,b,e,g,n),F.quickDecomp(c,d,b,e,g,n));return c}c.push(this);return c};f.prototype.removeCollinearPoints=function(c){for(var d=0,b=this.vertices.length-1;3<this.vertices.length&&0<=b;--b)a.collinear(this.at(b-1),this.at(b),this.at(b+1),c)&&(this.vertices.splice(b%this.vertices.length,1),b--,d++);return d}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(b,g,k){function f(){}g.exports=f;f.eq=function(b,f,
a){return Math.abs(b-f)<(a||0)}},{}],5:[function(b,g,k){g.exports={Polygon:b("./Polygon"),Point:b("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(b,g,k){g.exports={name:"p2",version:"0.7.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},
licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],7:[function(b,g,k){function f(a){this.lowerBound=m.create();a&&a.lowerBound&&m.copy(this.lowerBound,a.lowerBound);this.upperBound=m.create();a&&a.upperBound&&m.copy(this.upperBound,a.upperBound)}var m=b("../math/vec2");
b("../utils/Utils");g.exports=f;var n=m.create();f.prototype.setFromPoints=function(a,c,d,b){var e=this.lowerBound,l=this.upperBound;"number"!==typeof d&&(d=0);0!==d?m.rotate(e,a[0],d):m.copy(e,a[0]);m.copy(l,e);for(var q=Math.cos(d),f=Math.sin(d),g=1;g<a.length;g++){var r=a[g];if(0!==d){var k=r[0],r=r[1];n[0]=q*k-f*r;n[1]=f*k+q*r;r=n}for(k=0;2>k;k++)r[k]>l[k]&&(l[k]=r[k]),r[k]<e[k]&&(e[k]=r[k])}c&&(m.add(this.lowerBound,this.lowerBound,c),m.add(this.upperBound,this.upperBound,c));b&&(this.lowerBound[0]-=
b,this.lowerBound[1]-=b,this.upperBound[0]+=b,this.upperBound[1]+=b)};f.prototype.copy=function(a){m.copy(this.lowerBound,a.lowerBound);m.copy(this.upperBound,a.upperBound)};f.prototype.extend=function(a){for(var c=2;c--;){var d=a.lowerBound[c];this.lowerBound[c]>d&&(this.lowerBound[c]=d);d=a.upperBound[c];this.upperBound[c]<d&&(this.upperBound[c]=d)}};f.prototype.overlaps=function(a){var c=this.lowerBound,d=this.upperBound,b=a.lowerBound;a=a.upperBound;return(b[0]<=d[0]&&d[0]<=a[0]||c[0]<=a[0]&&
a[0]<=d[0])&&(b[1]<=d[1]&&d[1]<=a[1]||c[1]<=a[1]&&a[1]<=d[1])};f.prototype.containsPoint=function(a){var c=this.lowerBound,d=this.upperBound;return c[0]<=a[0]&&a[0]<=d[0]&&c[1]<=a[1]&&a[1]<=d[1]};f.prototype.overlapsRay=function(a){var c=1/a.direction[0],d=1/a.direction[1],b=(this.lowerBound[0]-a.from[0])*c,c=(this.upperBound[0]-a.from[0])*c,h=(this.lowerBound[1]-a.from[1])*d,d=(this.upperBound[1]-a.from[1])*d;a=Math.max(Math.max(Math.min(b,c),Math.min(h,d)));b=Math.min(Math.min(Math.max(b,c),Math.max(h,
d)));return 0>b||a>b?-1:a}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(b,g,k){function f(a){this.type=a;this.result=[];this.world=null;this.boundingVolumeType=f.AABB}var m=b("../math/vec2"),n=b("../objects/Body");g.exports=f;f.AABB=1;f.BOUNDING_CIRCLE=2;f.prototype.setWorld=function(a){this.world=a};f.prototype.getCollisionPairs=function(a){};var a=m.create();f.boundingRadiusCheck=function(c,d){m.sub(a,c.position,d.position);var b=m.squaredLength(a),h=c.boundingRadius+d.boundingRadius;return b<=
h*h};f.aabbCheck=function(a,d){return a.getAABB().overlaps(d.getAABB())};f.prototype.boundingVolumeCheck=function(a,d){var c;switch(this.boundingVolumeType){case f.BOUNDING_CIRCLE:c=f.boundingRadiusCheck(a,d);break;case f.AABB:c=f.aabbCheck(a,d);break;default:throw Error("Bounding volume type not recognized: "+this.boundingVolumeType);}return c};f.canCollide=function(a,d){var c=n.KINEMATIC,b=n.STATIC;return a.type===b&&d.type===b||a.type===c&&d.type===b||a.type===b&&d.type===c||a.type===c&&d.type===
c||a.sleepState===n.SLEEPING&&d.sleepState===n.SLEEPING||a.sleepState===n.SLEEPING&&d.type===b||d.sleepState===n.SLEEPING&&a.type===b?!1:!0};f.NAIVE=1;f.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(b,g,k){function f(){m.call(this,m.NAIVE)}b("../shapes/Circle");b("../shapes/Plane");b("../shapes/Shape");b("../shapes/Particle");var m=b("../collision/Broadphase");b("../math/vec2");g.exports=f;f.prototype=new m;f.prototype.constructor=f;f.prototype.getCollisionPairs=function(b){b=b.bodies;
for(var a=this.result,c=a.length=0,d=b.length;c!==d;c++)for(var e=b[c],h=0;h<c;h++){var l=b[h];m.canCollide(e,l)&&this.boundingVolumeCheck(e,l)&&a.push(e,l)}return a};f.prototype.aabbQuery=function(b,a,c){c=c||[];b=b.bodies;for(var d=0;d<b.length;d++){var e=b[d];e.aabbNeedsUpdate&&e.updateAABB();e.aabb.overlaps(a)&&c.push(e)}return c}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(b,g,k){function f(){this.contactEquations=
[];this.frictionEquations=[];this.enabledEquations=this.enableFriction=!0;this.slipForce=10;this.frictionCoefficient=.3;this.surfaceVelocity=0;this.contactEquationPool=new h({size:32});this.frictionEquationPool=new l({size:64});this.restitution=0;this.stiffness=t.DEFAULT_STIFFNESS;this.relaxation=t.DEFAULT_RELAXATION;this.frictionStiffness=t.DEFAULT_STIFFNESS;this.frictionRelaxation=t.DEFAULT_RELAXATION;this.enableFrictionReduction=!0;this.collidingBodiesLastStep=new q;this.contactSkinSize=.01}function m(c,
d){a.set(c.vertices[0],.5*-d.length,-d.radius);a.set(c.vertices[1],.5*d.length,-d.radius);a.set(c.vertices[2],.5*d.length,d.radius);a.set(c.vertices[3],.5*-d.length,d.radius)}function n(b,e,h,l){var q=ya,f=za,t=Aa,g=Ba;e=e.vertices;for(var n=null,v=0;v!==e.length+1;v++){var r=e[(v+1)%e.length];a.rotate(q,e[v%e.length],l);a.rotate(f,r,l);d(q,q,h);d(f,f,h);c(t,q,b);c(g,f,b);r=a.crossLength(t,g);null===n&&(n=r);if(0>=r*n)return!1;n=r}return!0}var a=b("../math/vec2"),c=a.sub,d=a.add,e=a.dot;b("../utils/Utils");
var h=b("../utils/ContactEquationPool"),l=b("../utils/FrictionEquationPool"),q=b("../utils/TupleDictionary"),t=b("../equations/Equation");b("../equations/ContactEquation");b("../equations/FrictionEquation");k=b("../shapes/Circle");var v=b("../shapes/Convex"),r=b("../shapes/Shape");b("../objects/Body");var y=b("../shapes/Box");g.exports=f;var w=a.fromValues(0,1),u=a.fromValues(0,0),x=a.fromValues(0,0),z=a.fromValues(0,0),D=a.fromValues(0,0),A=a.fromValues(0,0),E=a.fromValues(0,0),C=a.fromValues(0,
0),F=a.fromValues(0,0),I=a.fromValues(0,0),H=a.fromValues(0,0),B=a.fromValues(0,0),G=a.fromValues(0,0),K=a.fromValues(0,0),J=a.fromValues(0,0),N=a.fromValues(0,0),S=a.fromValues(0,0),ba=a.fromValues(0,0),L=a.fromValues(0,0),O=[],X=a.create(),qa=a.create();f.prototype.bodiesOverlap=function(a,c){for(var d=0,b=a.shapes.length;d!==b;d++){var e=a.shapes[d];a.toWorldFrame(X,e.position);for(var h=0,l=c.shapes.length;h!==l;h++){var q=c.shapes[h];c.toWorldFrame(qa,q.position);if(this[e.type|q.type](a,e,X,
e.angle+a.angle,c,q,qa,q.angle+c.angle,!0))return!0}}return!1};f.prototype.collidedLastStep=function(a,c){return!!this.collidingBodiesLastStep.get(a.id|0,c.id|0)};f.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var a=this.contactEquations,c=a.length;c--;){var d=a[c];this.collidingBodiesLastStep.set(d.bodyA.id,d.bodyB.id,!0)}a=this.contactEquations;c=this.frictionEquations;for(d=0;d<a.length;d++)this.contactEquationPool.release(a[d]);for(d=0;d<c.length;d++)this.frictionEquationPool.release(c[d]);
this.contactEquations.length=this.frictionEquations.length=0};f.prototype.createContactEquation=function(a,c,d,b){var e=this.contactEquationPool.get();e.bodyA=a;e.bodyB=c;e.shapeA=d;e.shapeB=b;e.restitution=this.restitution;e.firstImpact=!this.collidedLastStep(a,c);e.stiffness=this.stiffness;e.relaxation=this.relaxation;e.needsUpdate=!0;e.enabled=this.enabledEquations;e.offset=this.contactSkinSize;return e};f.prototype.createFrictionEquation=function(a,c,d,b){var e=this.frictionEquationPool.get();
e.bodyA=a;e.bodyB=c;e.shapeA=d;e.shapeB=b;e.setSlipForce(this.slipForce);e.frictionCoefficient=this.frictionCoefficient;e.relativeVelocity=this.surfaceVelocity;e.enabled=this.enabledEquations;e.needsUpdate=!0;e.stiffness=this.frictionStiffness;e.relaxation=this.frictionRelaxation;e.contactEquations.length=0;return e};f.prototype.createFrictionFromContact=function(c){var d=this.createFrictionEquation(c.bodyA,c.bodyB,c.shapeA,c.shapeB);a.copy(d.contactPointA,c.contactPointA);a.copy(d.contactPointB,
c.contactPointB);a.rotate90cw(d.t,c.normalA);d.contactEquations.push(c);return d};f.prototype.createFrictionFromAverage=function(c){var d=this.contactEquations[this.contactEquations.length-1],b=this.createFrictionEquation(d.bodyA,d.bodyB,d.shapeA,d.shapeB),e=d.bodyA;a.set(b.contactPointA,0,0);a.set(b.contactPointB,0,0);a.set(b.t,0,0);for(var h=0;h!==c;h++)d=this.contactEquations[this.contactEquations.length-1-h],d.bodyA===e?(a.add(b.t,b.t,d.normalA),a.add(b.contactPointA,b.contactPointA,d.contactPointA),
a.add(b.contactPointB,b.contactPointB,d.contactPointB)):(a.sub(b.t,b.t,d.normalA),a.add(b.contactPointA,b.contactPointA,d.contactPointB),a.add(b.contactPointB,b.contactPointB,d.contactPointA)),b.contactEquations.push(d);c=1/c;a.scale(b.contactPointA,b.contactPointA,c);a.scale(b.contactPointB,b.contactPointB,c);a.normalize(b.t,b.t);a.rotate90cw(b.t,b.t);return b};f.prototype[r.LINE|r.CONVEX]=f.prototype.convexLine=function(a,c,d,b,e,h,l,q,f){return f?!1:0};f.prototype[r.LINE|r.BOX]=f.prototype.lineBox=
function(a,c,d,b,e,h,l,q,f){return f?!1:0};var ra=new y({width:1,height:1}),M=a.create();f.prototype[r.CAPSULE|r.CONVEX]=f.prototype[r.CAPSULE|r.BOX]=f.prototype.convexCapsule=function(c,d,b,e,h,l,q,f,t){a.set(M,l.length/2,0);a.rotate(M,M,f);a.add(M,M,q);var g=this.circleConvex(h,l,M,f,c,d,b,e,t,l.radius);a.set(M,-l.length/2,0);a.rotate(M,M,f);a.add(M,M,q);var n=this.circleConvex(h,l,M,f,c,d,b,e,t,l.radius);if(t&&(g||n))return!0;m(ra,l);return this.convexConvex(c,d,b,e,h,ra,q,f,t)+g+n};f.prototype[r.CAPSULE|
r.LINE]=f.prototype.lineCapsule=function(a,c,d,b,e,h,l,q,f){return f?!1:0};var ca=a.create(),da=a.create(),ka=new y({width:1,height:1});f.prototype[r.CAPSULE|r.CAPSULE]=f.prototype.capsuleCapsule=function(c,d,b,e,h,l,q,f,t){for(var g,n=0,v=0;2>v;v++){a.set(ca,(0===v?-1:1)*d.length/2,0);a.rotate(ca,ca,e);a.add(ca,ca,b);for(var r=0;2>r;r++){a.set(da,(0===r?-1:1)*l.length/2,0);a.rotate(da,da,f);a.add(da,da,q);this.enableFrictionReduction&&(g=this.enableFriction,this.enableFriction=!1);var k=this.circleCircle(c,
d,ca,e,h,l,da,f,t,d.radius,l.radius);this.enableFrictionReduction&&(this.enableFriction=g);if(t&&k)return!0;n+=k}}this.enableFrictionReduction&&(g=this.enableFriction,this.enableFriction=!1);m(ka,d);v=this.convexCapsule(c,ka,b,e,h,l,q,f,t);this.enableFrictionReduction&&(this.enableFriction=g);if(t&&v)return!0;n+=v;this.enableFrictionReduction&&(g=this.enableFriction,this.enableFriction=!1);m(ka,l);c=this.convexCapsule(h,ka,q,f,c,d,b,e,t);this.enableFrictionReduction&&(this.enableFriction=g);if(t&&
c)return!0;n+=c;this.enableFrictionReduction&&n&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(n));return n};f.prototype[r.LINE|r.LINE]=f.prototype.lineLine=function(a,c,d,b,e,h,l,q,f){return f?!1:0};f.prototype[r.PLANE|r.LINE]=f.prototype.planeLine=function(b,h,l,q,f,t,g,n,v){var r=0;a.set(u,-t.length/2,0);a.set(x,t.length/2,0);a.rotate(z,u,n);a.rotate(D,x,n);d(z,z,g);d(D,D,g);a.copy(u,z);a.copy(x,D);c(A,x,u);a.normalize(E,A);a.rotate90cw(I,E);a.rotate(F,w,q);O[0]=
u;O[1]=x;for(q=0;q<O.length;q++){n=O[q];c(C,n,l);var m=e(C,F);if(0>m){if(v)return!0;var k=this.createContactEquation(b,f,h,t);r++;a.copy(k.normalA,F);a.normalize(k.normalA,k.normalA);a.scale(C,F,m);c(k.contactPointA,n,C);c(k.contactPointA,k.contactPointA,b.position);c(k.contactPointB,n,g);d(k.contactPointB,k.contactPointB,g);c(k.contactPointB,k.contactPointB,f.position);this.contactEquations.push(k);this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(k))}}if(v)return!1;
this.enableFrictionReduction||r&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(r));return r};f.prototype[r.PARTICLE|r.CAPSULE]=f.prototype.particleCapsule=function(a,c,d,b,e,h,l,q,f){return this.circleLine(a,c,d,b,e,h,l,q,f,h.radius,0)};f.prototype[r.CIRCLE|r.LINE]=f.prototype.circleLine=function(b,h,l,q,f,t,g,n,v,r,m){r=r||0;m="undefined"!==typeof m?m:h.radius;a.set(F,-t.length/2,0);a.set(I,t.length/2,0);a.rotate(H,F,n);a.rotate(B,I,n);d(H,H,g);d(B,B,g);a.copy(F,
H);a.copy(I,B);c(E,I,F);a.normalize(C,E);a.rotate90cw(A,C);c(G,l,F);n=e(G,A);c(D,F,g);c(K,l,g);q=m+r;if(Math.abs(n)<q){a.scale(u,A,n);c(z,l,u);a.scale(x,A,e(A,K));a.normalize(x,x);a.scale(x,x,r);d(z,z,x);n=e(C,z);var k=e(C,F),y=e(C,I);if(n>k&&n<y){if(v)return!0;h=this.createContactEquation(b,f,h,t);a.scale(h.normalA,u,-1);a.normalize(h.normalA,h.normalA);a.scale(h.contactPointA,h.normalA,m);d(h.contactPointA,h.contactPointA,l);c(h.contactPointA,h.contactPointA,b.position);c(h.contactPointB,z,g);d(h.contactPointB,
h.contactPointB,g);c(h.contactPointB,h.contactPointB,f.position);this.contactEquations.push(h);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(h));return 1}}O[0]=F;O[1]=I;for(k=0;k<O.length;k++)if(n=O[k],c(G,n,l),a.squaredLength(G)<Math.pow(q,2)){if(v)return!0;h=this.createContactEquation(b,f,h,t);a.copy(h.normalA,G);a.normalize(h.normalA,h.normalA);a.scale(h.contactPointA,h.normalA,m);d(h.contactPointA,h.contactPointA,l);c(h.contactPointA,h.contactPointA,b.position);
c(h.contactPointB,n,g);a.scale(J,h.normalA,-r);d(h.contactPointB,h.contactPointB,J);d(h.contactPointB,h.contactPointB,g);c(h.contactPointB,h.contactPointB,f.position);this.contactEquations.push(h);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(h));return 1}return 0};f.prototype[r.CIRCLE|r.CAPSULE]=f.prototype.circleCapsule=function(a,c,d,b,e,h,l,q,f){return this.circleLine(a,c,d,b,e,h,l,q,f,h.radius)};f.prototype[r.CIRCLE|r.CONVEX]=f.prototype[r.CIRCLE|r.BOX]=f.prototype.circleConvex=
function(b,e,h,l,q,f,t,g,v,r){r="number"===typeof r?r:e.radius;l=!1;for(var m=Number.MAX_VALUE,k=f.vertices,y=0;y!==k.length+1;y++){var w=k[(y+1)%k.length];a.rotate(u,k[y%k.length],g);a.rotate(x,w,g);d(u,u,t);d(x,x,t);c(z,x,u);a.normalize(D,z);a.rotate90cw(A,D);a.scale(J,A,-e.radius);d(J,J,h);n(J,f,t,g)&&(a.sub(N,u,J),w=Math.abs(a.dot(N,A)),w<m&&(a.copy(S,J),m=w,a.scale(K,A,w),a.add(K,K,J),l=!0))}if(l){if(v)return!0;e=this.createContactEquation(b,q,e,f);a.sub(e.normalA,S,h);a.normalize(e.normalA,
e.normalA);a.scale(e.contactPointA,e.normalA,r);d(e.contactPointA,e.contactPointA,h);c(e.contactPointA,e.contactPointA,b.position);c(e.contactPointB,K,t);d(e.contactPointB,e.contactPointB,t);c(e.contactPointB,e.contactPointB,q.position);this.contactEquations.push(e);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(e));return 1}if(0<r)for(y=0;y<k.length;y++)if(a.rotate(B,k[y],g),d(B,B,t),c(H,B,h),a.squaredLength(H)<Math.pow(r,2)){if(v)return!0;e=this.createContactEquation(b,
q,e,f);a.copy(e.normalA,H);a.normalize(e.normalA,e.normalA);a.scale(e.contactPointA,e.normalA,r);d(e.contactPointA,e.contactPointA,h);c(e.contactPointA,e.contactPointA,b.position);c(e.contactPointB,B,t);d(e.contactPointB,e.contactPointB,t);c(e.contactPointB,e.contactPointB,q.position);this.contactEquations.push(e);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(e));return 1}return 0};var ya=a.create(),za=a.create(),Aa=a.create(),Ba=a.create();f.prototype[r.PARTICLE|
r.CONVEX]=f.prototype[r.PARTICLE|r.BOX]=f.prototype.particleConvex=function(b,h,l,q,f,t,g,v,r){q=Number.MAX_VALUE;var m=!1,k=t.vertices;if(!n(l,t,g,v))return 0;if(r)return!0;for(r=0;r!==k.length+1;r++){var y=k[(r+1)%k.length];a.rotate(u,k[r%k.length],v);a.rotate(x,y,v);d(u,u,g);d(x,x,g);c(z,x,u);a.normalize(D,z);a.rotate90cw(A,D);c(H,l,u);e(H,A);c(E,u,g);c(C,l,g);a.sub(ba,u,l);y=Math.abs(a.dot(ba,A));y<q&&(q=y,a.scale(K,A,y),a.add(K,K,l),a.copy(L,A),m=!0)}return m?(h=this.createContactEquation(b,
f,h,t),a.scale(h.normalA,L,-1),a.normalize(h.normalA,h.normalA),a.set(h.contactPointA,0,0),d(h.contactPointA,h.contactPointA,l),c(h.contactPointA,h.contactPointA,b.position),c(h.contactPointB,K,g),d(h.contactPointB,h.contactPointB,g),c(h.contactPointB,h.contactPointB,f.position),this.contactEquations.push(h),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(h)),1):0};f.prototype[r.CIRCLE]=f.prototype.circleCircle=function(b,e,h,l,q,f,t,g,n,v,r){v=v||e.radius;r=r||f.radius;
c(u,h,t);l=v+r;if(a.squaredLength(u)>Math.pow(l,2))return 0;if(n)return!0;e=this.createContactEquation(b,q,e,f);c(e.normalA,t,h);a.normalize(e.normalA,e.normalA);a.scale(e.contactPointA,e.normalA,v);a.scale(e.contactPointB,e.normalA,-r);d(e.contactPointA,e.contactPointA,h);c(e.contactPointA,e.contactPointA,b.position);d(e.contactPointB,e.contactPointB,t);c(e.contactPointB,e.contactPointB,q.position);this.contactEquations.push(e);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(e));
return 1};f.prototype[r.PLANE|r.CONVEX]=f.prototype[r.PLANE|r.BOX]=f.prototype.planeConvex=function(b,h,l,q,f,t,g,n,v){var r=0;a.rotate(x,w,q);for(q=0;q!==t.vertices.length;q++)if(a.rotate(u,t.vertices[q],n),d(u,u,g),c(z,u,l),0>=e(z,x)){if(v)return!0;r++;var m=this.createContactEquation(b,f,h,t);c(z,u,l);a.copy(m.normalA,x);var k=e(z,m.normalA);a.scale(z,m.normalA,k);c(m.contactPointB,u,f.position);c(m.contactPointA,u,z);c(m.contactPointA,m.contactPointA,b.position);this.contactEquations.push(m);
this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(m))}this.enableFrictionReduction&&this.enableFriction&&r&&this.frictionEquations.push(this.createFrictionFromAverage(r));return r};f.prototype[r.PARTICLE|r.PLANE]=f.prototype.particlePlane=function(d,b,h,l,q,f,t,g,n){g=g||0;c(u,h,t);a.rotate(x,w,g);l=e(u,x);if(0<l)return 0;if(n)return!0;b=this.createContactEquation(q,d,f,b);a.copy(b.normalA,x);a.scale(u,b.normalA,l);c(b.contactPointA,h,u);
c(b.contactPointA,b.contactPointA,q.position);c(b.contactPointB,h,d.position);this.contactEquations.push(b);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(b));return 1};f.prototype[r.CIRCLE|r.PARTICLE]=f.prototype.circleParticle=function(b,e,h,l,q,f,t,g,n){c(u,t,h);if(a.squaredLength(u)>Math.pow(e.radius,2))return 0;if(n)return!0;l=this.createContactEquation(b,q,e,f);a.copy(l.normalA,u);a.normalize(l.normalA,l.normalA);a.scale(l.contactPointA,l.normalA,e.radius);d(l.contactPointA,
l.contactPointA,h);c(l.contactPointA,l.contactPointA,b.position);c(l.contactPointB,t,q.position);this.contactEquations.push(l);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(l));return 1};var pa=new k({radius:1}),ea=a.create(),fa=a.create();a.create();f.prototype[r.PLANE|r.CAPSULE]=f.prototype.planeCapsule=function(c,b,e,h,l,q,f,t,g){a.set(ea,-q.length/2,0);a.rotate(ea,ea,t);d(ea,ea,f);a.set(fa,q.length/2,0);a.rotate(fa,fa,t);d(fa,fa,f);pa.radius=q.radius;var n;this.enableFrictionReduction&&
(n=this.enableFriction,this.enableFriction=!1);q=this.circlePlane(l,pa,ea,0,c,b,e,h,g);c=this.circlePlane(l,pa,fa,0,c,b,e,h,g);this.enableFrictionReduction&&(this.enableFriction=n);if(g)return q||c;g=q+c;this.enableFrictionReduction&&g&&this.frictionEquations.push(this.createFrictionFromAverage(g));return g};f.prototype[r.CIRCLE|r.PLANE]=f.prototype.circlePlane=function(b,h,l,q,f,t,g,n,v){q=n||0;c(u,l,g);a.rotate(x,w,q);q=e(x,u);if(q>h.radius)return 0;if(v)return!0;t=this.createContactEquation(f,
b,t,h);a.copy(t.normalA,x);a.scale(t.contactPointB,t.normalA,-h.radius);d(t.contactPointB,t.contactPointB,l);c(t.contactPointB,t.contactPointB,b.position);a.scale(z,t.normalA,q);c(t.contactPointA,u,z);d(t.contactPointA,t.contactPointA,g);c(t.contactPointA,t.contactPointA,f.position);this.contactEquations.push(t);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(t));return 1};f.prototype[r.CONVEX]=f.prototype[r.CONVEX|r.BOX]=f.prototype[r.BOX]=f.prototype.convexConvex=
function(b,h,l,q,t,g,n,v,r,m){var k=0;m="number"===typeof m?m:0;if(!f.findSeparatingAxis(h,l,q,g,n,v,u))return 0;c(F,n,l);0<e(u,F)&&a.scale(u,u,-1);var y=f.getClosestEdge(h,q,u,!0),w=f.getClosestEdge(g,v,u);if(-1===y||-1===w)return 0;for(var B=0;2>B;B++){var K=y,G=w,J=h,M=g,N=l,E=n,S=q,ba=v,X=b,O=t;if(0===B){var H;H=K;K=G;G=H;H=J;J=M;M=H;H=N;N=E;E=H;H=S;S=ba;ba=H;H=X;X=O;O=H}for(H=G;H<G+2;H++){a.rotate(x,M.vertices[(H+M.vertices.length)%M.vertices.length],ba);d(x,x,E);for(var L=0,aa=K-1;aa<K+2;aa++){var U=
J.vertices[(aa+J.vertices.length)%J.vertices.length],oa=J.vertices[(aa+1+J.vertices.length)%J.vertices.length];a.rotate(z,U,S);a.rotate(D,oa,S);d(z,z,N);d(D,D,N);c(A,D,z);a.rotate90cw(I,A);a.normalize(I,I);c(F,x,z);U=e(I,F);(aa===K&&U<=m||aa!==K&&0>=U)&&L++}if(3<=L){if(r)return!0;L=this.createContactEquation(X,O,J,M);k++;U=J.vertices[K%J.vertices.length];oa=J.vertices[(K+1)%J.vertices.length];a.rotate(z,U,S);a.rotate(D,oa,S);d(z,z,N);d(D,D,N);c(A,D,z);a.rotate90cw(L.normalA,A);a.normalize(L.normalA,
L.normalA);c(F,x,z);U=e(L.normalA,F);a.scale(C,L.normalA,U);c(L.contactPointA,x,N);c(L.contactPointA,L.contactPointA,C);d(L.contactPointA,L.contactPointA,N);c(L.contactPointA,L.contactPointA,X.position);c(L.contactPointB,x,E);d(L.contactPointB,L.contactPointB,E);c(L.contactPointB,L.contactPointB,O.position);this.contactEquations.push(L);this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(L))}}}this.enableFrictionReduction&&this.enableFriction&&
k&&this.frictionEquations.push(this.createFrictionFromAverage(k));return k};var ia=a.fromValues(0,0);f.projectConvexOntoAxis=function(c,d,b,h,l){var q=null,f=null,t;a.rotate(ia,h,-b);for(b=0;b<c.vertices.length;b++){t=c.vertices[b];t=e(t,ia);if(null===q||t>q)q=t;if(null===f||t<f)f=t}f>q&&(c=f,f=q,q=c);d=e(d,h);a.set(l,f+d,q+d)};var sa=a.fromValues(0,0),ta=a.fromValues(0,0),ua=a.fromValues(0,0),P=a.fromValues(0,0),V=a.fromValues(0,0),W=a.fromValues(0,0);f.findSeparatingAxis=function(d,b,e,h,l,q,t){var g=
null,n,v=!1;if(d instanceof y&&h instanceof y)for(var r=0;2!==r;r++){var m,k=e;1===r&&(k=q);for(var w=0;2!==w;w++){0===w?a.set(P,0,1):1===w&&a.set(P,1,0);0!==k&&a.rotate(P,P,k);f.projectConvexOntoAxis(d,b,e,P,V);f.projectConvexOntoAxis(h,l,q,P,W);n=V;var u=W;V[0]>W[0]&&(u=V,n=W);u=u[0]-n[1];n=0>=u;if(null===g||u>g)a.copy(t,P),g=u,v=n}}else for(r=0;2!==r;r++)for(m=d,k=e,1===r&&(m=h,k=q),w=0;w!==m.vertices.length;w++)if(a.rotate(ta,m.vertices[w],k),a.rotate(ua,m.vertices[(w+1)%m.vertices.length],k),
c(sa,ua,ta),a.rotate90cw(P,sa),a.normalize(P,P),f.projectConvexOntoAxis(d,b,e,P,V),f.projectConvexOntoAxis(h,l,q,P,W),n=V,u=W,V[0]>W[0]&&(u=V,n=W),u=u[0]-n[1],n=0>=u,null===g||u>g)a.copy(t,P),g=u,v=n;return v};var la=a.fromValues(0,0),va=a.fromValues(0,0),ma=a.fromValues(0,0);f.getClosestEdge=function(d,b,h,l){a.rotate(la,h,-b);l&&a.scale(la,la,-1);b=-1;h=d.vertices.length;l=-1;for(var q=0;q!==h;q++){c(va,d.vertices[(q+1)%h],d.vertices[q%h]);a.rotate90cw(ma,va);a.normalize(ma,ma);var f=e(ma,la);if(-1===
b||f>l)b=q%h,l=f}return b};var Y=a.create(),Z=a.create(),Q=a.create(),ja=a.create(),wa=a.create(),T=a.create(),xa=a.create();f.prototype[r.CIRCLE|r.HEIGHTFIELD]=f.prototype.circleHeightfield=function(b,e,h,l,q,f,t,g,n,v){l=f.heights;v=v||e.radius;g=f.elementWidth;var r=Math.floor((h[0]-v-t[0])/g),m=Math.ceil((h[0]+v-t[0])/g);0>r&&(r=0);m>=l.length&&(m=l.length-1);for(var k=l[r],y=l[m],w=r;w<m;w++)l[w]<y&&(y=l[w]),l[w]>k&&(k=l[w]);if(h[1]-v>k)return n?!1:0;for(w=r;w<m;w++)if(a.set(Q,w*g,l[w]),a.set(ja,
(w+1)*g,l[w+1]),a.add(Q,Q,t),a.add(ja,ja,t),a.sub(T,ja,Q),a.rotate(T,T,Math.PI/2),a.normalize(T,T),a.scale(Y,T,-v),a.add(Y,Y,h),a.sub(Z,Y,Q),k=a.dot(Z,T),Y[0]>=Q[0]&&Y[0]<ja[0]&&0>=k){if(n)return!0;a.scale(Z,T,-k);a.add(wa,Y,Z);a.copy(xa,T);y=this.createContactEquation(q,b,f,e);a.copy(y.normalA,xa);a.scale(y.contactPointB,y.normalA,-v);d(y.contactPointB,y.contactPointB,h);c(y.contactPointB,y.contactPointB,b.position);a.copy(y.contactPointA,wa);a.sub(y.contactPointA,y.contactPointA,q.position);this.contactEquations.push(y);
this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y))}k=!1;if(0<v)for(w=r;w<=m;w++)if(a.set(Q,w*g,l[w]),a.add(Q,Q,t),a.sub(Z,h,Q),a.squaredLength(Z)<Math.pow(v,2)){if(n)return!0;k=!0;y=this.createContactEquation(q,b,f,e);a.copy(y.normalA,Z);a.normalize(y.normalA,y.normalA);a.scale(y.contactPointB,y.normalA,-v);d(y.contactPointB,y.contactPointB,h);c(y.contactPointB,y.contactPointB,b.position);c(y.contactPointA,Q,t);d(y.contactPointA,y.contactPointA,t);c(y.contactPointA,
y.contactPointA,q.position);this.contactEquations.push(y);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y))}return k?1:0};var ga=a.create(),ha=a.create(),na=a.create(),R=new v({vertices:[a.create(),a.create(),a.create(),a.create()]});f.prototype[r.BOX|r.HEIGHTFIELD]=f.prototype[r.CONVEX|r.HEIGHTFIELD]=f.prototype.convexHeightfield=function(c,d,b,e,h,l,q,f,t){f=l.heights;l=l.elementWidth;var g=Math.floor((c.aabb.lowerBound[0]-q[0])/l),n=Math.ceil((c.aabb.upperBound[0]-
q[0])/l);0>g&&(g=0);n>=f.length&&(n=f.length-1);for(var v=f[g],r=f[n],m=g;m<n;m++)f[m]<r&&(r=f[m]),f[m]>v&&(v=f[m]);if(c.aabb.lowerBound[1]>v)return t?!1:0;v=0;for(m=g;m<n;m++)a.set(ga,m*l,f[m]),a.set(ha,(m+1)*l,f[m+1]),a.add(ga,ga,q),a.add(ha,ha,q),a.set(na,.5*(ha[0]+ga[0]),.5*(ha[1]+ga[1]-100)),a.sub(R.vertices[0],ha,na),a.sub(R.vertices[1],ga,na),a.copy(R.vertices[2],R.vertices[1]),a.copy(R.vertices[3],R.vertices[0]),R.vertices[2][1]-=100,R.vertices[3][1]-=100,v+=this.convexConvex(c,d,b,e,h,R,
na,0,t);return v}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(b,g,k){function f(a){a=a||{};this.from=a.from?m.fromValues(a.from[0],a.from[1]):m.create();this.to=a.to?m.fromValues(a.to[0],a.to[1]):
m.create();this.checkCollisionResponse=void 0!==a.checkCollisionResponse?a.checkCollisionResponse:!0;this.skipBackfaces=!!a.skipBackfaces;this.collisionMask=void 0!==a.collisionMask?a.collisionMask:-1;this.collisionGroup=void 0!==a.collisionGroup?a.collisionGroup:-1;this.mode=void 0!==a.mode?a.mode:f.ANY;this.callback=a.callback||function(a){};this.direction=m.create();this.length=1;this.update()}g.exports=f;var m=b("../math/vec2");b("../collision/RaycastResult");b("../shapes/Shape");b("../collision/AABB");
f.prototype.constructor=f;f.CLOSEST=1;f.ANY=2;f.ALL=4;f.prototype.update=function(){var a=this.direction;m.sub(a,this.to,this.from);this.length=m.length(a);m.normalize(a,a)};f.prototype.intersectBodies=function(a,c){for(var d=0,b=c.length;!a.shouldStop(this)&&d<b;d++){var e=c[d],f=e.getAABB();(0<=f.overlapsRay(this)||f.containsPoint(this.from))&&this.intersectBody(a,e)}};var n=m.create();f.prototype.intersectBody=function(a,c){var d=this.checkCollisionResponse;if(!d||c.collisionResponse)for(var b=
0,e=c.shapes.length;b<e;b++){var f=c.shapes[b];if((!d||f.collisionResponse)&&0!==(this.collisionGroup&f.collisionMask)&&0!==(f.collisionGroup&this.collisionMask)&&(m.rotate(n,f.position,c.angle),m.add(n,n,c.position),this.intersectShape(a,f,f.angle+c.angle,n,c),a.shouldStop(this)))break}};f.prototype.intersectShape=function(d,b,h,l,q){var e=this.from,f=this.direction;m.sub(a,l,e);var g=m.dot(a,f);m.scale(c,f,g);m.add(c,c,e);m.squaredDistance(l,c)>b.boundingRadius*b.boundingRadius||(this._currentBody=
q,this._currentShape=b,b.raycast(d,this,l,h),this._currentBody=this._currentShape=null)};f.prototype.getAABB=function(a){var c=this.to,d=this.from;m.set(a.lowerBound,Math.min(c[0],d[0]),Math.min(c[1],d[1]));m.set(a.upperBound,Math.max(c[0],d[0]),Math.max(c[1],d[1]))};m.create();f.prototype.reportIntersection=function(a,c,b,l){var d=this._currentShape,e=this._currentBody;if(!(this.skipBackfaces&&0<m.dot(b,this.direction)))switch(this.mode){case f.ALL:a.set(b,d,e,c,l);this.callback(a);break;case f.CLOSEST:(c<
a.fraction||!a.hasHit())&&a.set(b,d,e,c,l);break;case f.ANY:a.set(b,d,e,c,l)}};var a=m.create(),c=m.create()},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(b,g,k){function f(){this.normal=m.create();this.body=this.shape=null;this.fraction=this.faceIndex=-1;this.isStopped=!1}var m=b("../math/vec2"),n=b("../collision/Ray");g.exports=f;f.prototype.reset=function(){m.set(this.normal,0,0);this.body=this.shape=null;this.fraction=this.faceIndex=
-1;this.isStopped=!1};f.prototype.getHitDistance=function(a){return m.distance(a.from,a.to)*this.fraction};f.prototype.hasHit=function(){return-1!==this.fraction};f.prototype.getHitPoint=function(a,c){m.lerp(a,c.from,c.to,this.fraction)};f.prototype.stop=function(){this.isStopped=!0};f.prototype.shouldStop=function(a){return this.isStopped||-1!==this.fraction&&a.mode===n.ANY};f.prototype.set=function(a,c,d,b,h){m.copy(this.normal,a);this.shape=c;this.body=d;this.fraction=b;this.faceIndex=h}},{"../collision/Ray":11,
"../math/vec2":30}],13:[function(b,g,k){function f(){n.call(this,n.SAP);this.axisList=[];this.axisIndex=0;var a=this;this._addBodyHandler=function(c){a.axisList.push(c.body)};this._removeBodyHandler=function(c){c=a.axisList.indexOf(c.body);-1!==c&&a.axisList.splice(c,1)}}var m=b("../utils/Utils"),n=b("../collision/Broadphase");g.exports=f;f.prototype=new n;f.prototype.constructor=f;f.prototype.setWorld=function(a){this.axisList.length=0;m.appendArray(this.axisList,a.bodies);a.off("addBody",this._addBodyHandler).off("removeBody",
this._removeBodyHandler);a.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler);this.world=a};f.sortAxisList=function(a,c){c|=0;for(var d=1,b=a.length;d<b;d++){for(var h=a[d],l=d-1;0<=l&&!(a[l].aabb.lowerBound[c]<=h.aabb.lowerBound[c]);l--)a[l+1]=a[l];a[l+1]=h}return a};f.prototype.sortList=function(){f.sortAxisList(this.axisList,this.axisIndex)};f.prototype.getCollisionPairs=function(a){a=this.axisList;var c=this.result,d=this.axisIndex;c.length=0;for(var b=a.length;b--;){var h=
a[b];h.aabbNeedsUpdate&&h.updateAABB()}this.sortList();b=0;for(h=a.length|0;b!==h;b++)for(var l=a[b],q=b+1;q<h;q++){var f=a[q];if(!(f.aabb.lowerBound[d]<=l.aabb.upperBound[d]))break;n.canCollide(l,f)&&this.boundingVolumeCheck(l,f)&&c.push(l,f)}return c};f.prototype.aabbQuery=function(a,c,d){d=d||[];this.sortList();a=this.axisList;for(var b=0;b<a.length;b++){var h=a[b];h.aabbNeedsUpdate&&h.updateAABB();h.aabb.overlaps(c)&&d.push(h)}return d}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(b,
g,k){function f(b,a,c,d){this.type=c;d=m.defaults(d,{collideConnected:!0,wakeUpBodies:!0});this.equations=[];this.bodyA=b;this.bodyB=a;this.collideConnected=d.collideConnected;d.wakeUpBodies&&(b&&b.wakeUp(),a&&a.wakeUp())}g.exports=f;var m=b("../utils/Utils");f.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!");};f.DISTANCE=1;f.GEAR=2;f.LOCK=3;f.PRISMATIC=4;f.REVOLUTE=5;f.prototype.setStiffness=function(b){for(var a=this.equations,c=0;c!==a.length;c++){var d=
a[c];d.stiffness=b;d.needsUpdate=!0}};f.prototype.setRelaxation=function(b){for(var a=this.equations,c=0;c!==a.length;c++){var d=a[c];d.relaxation=b;d.needsUpdate=!0}}},{"../utils/Utils":57}],15:[function(b,g,k){function f(d,b,e){e=c.defaults(e,{localAnchorA:[0,0],localAnchorB:[0,0]});m.call(this,d,b,m.DISTANCE,e);this.localAnchorA=a.fromValues(e.localAnchorA[0],e.localAnchorA[1]);this.localAnchorB=a.fromValues(e.localAnchorB[0],e.localAnchorB[1]);var h=this.localAnchorA,l=this.localAnchorB;this.distance=
0;if("number"===typeof e.distance)this.distance=e.distance;else{var q=a.create(),f=a.create(),t=a.create();a.rotate(q,h,d.angle);a.rotate(f,l,b.angle);a.add(t,b.position,f);a.sub(t,t,q);a.sub(t,t,d.position);this.distance=a.length(t)}e="undefined"===typeof e.maxForce?Number.MAX_VALUE:e.maxForce;d=new n(d,b,-e,e);this.equations=[d];this.maxForce=e;var t=a.create(),g=a.create(),k=a.create(),D=this;d.computeGq=function(){var c=this.bodyA,d=this.bodyB,b=c.position,e=d.position;a.rotate(g,h,c.angle);a.rotate(k,
l,d.angle);a.add(t,e,k);a.sub(t,t,g);a.sub(t,t,b);return a.length(t)-D.distance};this.setMaxForce(e);this.upperLimitEnabled=!1;this.upperLimit=1;this.lowerLimitEnabled=!1;this.position=this.lowerLimit=0}var m=b("./Constraint"),n=b("../equations/Equation"),a=b("../math/vec2"),c=b("../utils/Utils");g.exports=f;f.prototype=new m;f.prototype.constructor=f;var d=a.create(),e=a.create(),h=a.create();f.prototype.update=function(){var c=this.bodyA,b=this.bodyB,f=c.position,g=b.position,n=this.equations[0],
m=this.equations[0].G;a.rotate(e,this.localAnchorA,c.angle);a.rotate(h,this.localAnchorB,b.angle);a.add(d,g,h);a.sub(d,d,e);a.sub(d,d,f);this.position=a.length(d);c=!1;this.upperLimitEnabled&&this.position>this.upperLimit&&(n.maxForce=0,n.minForce=-this.maxForce,this.distance=this.upperLimit,c=!0);this.lowerLimitEnabled&&this.position<this.lowerLimit&&(n.maxForce=this.maxForce,n.minForce=0,this.distance=this.lowerLimit,c=!0);!this.lowerLimitEnabled&&!this.upperLimitEnabled||c?(n.enabled=!0,a.normalize(d,
d),n=a.crossLength(e,d),c=a.crossLength(h,d),m[0]=-d[0],m[1]=-d[1],m[2]=-n,m[3]=d[0],m[4]=d[1],m[5]=c):n.enabled=!1};f.prototype.setMaxForce=function(a){var c=this.equations[0];c.minForce=-a;c.maxForce=a};f.prototype.getMaxForce=function(){return this.equations[0].maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(b,g,k){function f(a,c,d){d=d||{};m.call(this,a,c,m.GEAR,d);this.ratio=void 0!==d.ratio?d.ratio:1;this.angle=void 0!==d.angle?d.angle:
c.angle-this.ratio*a.angle;d.angle=this.angle;d.ratio=this.ratio;this.equations=[new n(a,c,d)];void 0!==d.maxTorque&&this.setMaxTorque(d.maxTorque)}var m=b("./Constraint");b("../equations/Equation");var n=b("../equations/AngleLockEquation");b("../math/vec2");g.exports=f;f.prototype=new m;f.prototype.constructor=f;f.prototype.update=function(){var a=this.equations[0];a.ratio!==this.ratio&&a.setRatio(this.ratio);a.angle=this.angle};f.prototype.setMaxTorque=function(a){this.equations[0].setMaxTorque(a)};
f.prototype.getMaxTorque=function(a){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(b,g,k){function f(c,d,b){b=b||{};m.call(this,c,d,m.LOCK,b);var e="undefined"===typeof b.maxForce?Number.MAX_VALUE:b.maxForce,h=new a(c,d,-e,e),l=new a(c,d,-e,e),q=new a(c,d,-e,e),f=n.create(),t=n.create(),g=this;h.computeGq=function(){n.rotate(f,g.localOffsetB,c.angle);n.sub(t,d.position,c.position);n.sub(t,t,f);
return t[0]};l.computeGq=function(){n.rotate(f,g.localOffsetB,c.angle);n.sub(t,d.position,c.position);n.sub(t,t,f);return t[1]};var v=n.create(),k=n.create();q.computeGq=function(){n.rotate(v,g.localOffsetB,d.angle-g.localAngleB);n.scale(v,v,-1);n.sub(t,c.position,d.position);n.add(t,t,v);n.rotate(k,v,-Math.PI/2);n.normalize(k,k);return n.dot(t,k)};this.localOffsetB=n.create();b.localOffsetB?n.copy(this.localOffsetB,b.localOffsetB):(n.sub(this.localOffsetB,d.position,c.position),n.rotate(this.localOffsetB,
this.localOffsetB,-c.angle));this.localAngleB=0;this.localAngleB="number"===typeof b.localAngleB?b.localAngleB:d.angle-c.angle;this.equations.push(h,l,q);this.setMaxForce(e)}var m=b("./Constraint"),n=b("../math/vec2"),a=b("../equations/Equation");g.exports=f;f.prototype=new m;f.prototype.constructor=f;f.prototype.setMaxForce=function(a){for(var c=this.equations,d=0;d<this.equations.length;d++)c[d].maxForce=a,c[d].minForce=-a};f.prototype.getMaxForce=function(){return this.equations[0].maxForce};var c=
n.create(),d=n.create(),e=n.create(),h=n.fromValues(1,0),l=n.fromValues(0,1);f.prototype.update=function(){var a=this.equations[0],b=this.equations[1],f=this.equations[2],g=this.bodyB;n.rotate(c,this.localOffsetB,this.bodyA.angle);n.rotate(d,this.localOffsetB,g.angle-this.localAngleB);n.scale(d,d,-1);n.rotate(e,d,Math.PI/2);n.normalize(e,e);a.G[0]=-1;a.G[1]=0;a.G[2]=-n.crossLength(c,h);a.G[3]=1;b.G[0]=0;b.G[1]=-1;b.G[2]=-n.crossLength(c,l);b.G[4]=1;f.G[0]=-e[0];f.G[1]=-e[1];f.G[3]=e[0];f.G[4]=e[1];
f.G[5]=n.crossLength(d,e)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(b,g,k){function f(b,e,h){h=h||{};m.call(this,b,e,m.PRISMATIC,h);var l=c.fromValues(0,0),q=c.fromValues(1,0),f=c.fromValues(0,0);h.localAnchorA&&c.copy(l,h.localAnchorA);h.localAxisA&&c.copy(q,h.localAxisA);h.localAnchorB&&c.copy(f,h.localAnchorB);this.localAnchorA=l;this.localAnchorB=f;this.localAxisA=q;var t=this.maxForce="undefined"!==typeof h.maxForce?h.maxForce:Number.MAX_VALUE,g=new a(b,
e,-t,t),v=new c.create,r=new c.create,k=new c.create,y=new c.create;g.computeGq=function(){return c.dot(k,y)};g.updateJacobian=function(){var a=this.G,d=b.position,h=e.position;c.rotate(v,l,b.angle);c.rotate(r,f,e.angle);c.add(k,h,r);c.sub(k,k,d);c.sub(k,k,v);c.rotate(y,q,b.angle+Math.PI/2);a[0]=-y[0];a[1]=-y[1];a[2]=-c.crossLength(v,y)+c.crossLength(y,k);a[3]=y[0];a[4]=y[1];a[5]=c.crossLength(r,y)};this.equations.push(g);h.disableRotationalLock||(g=new d(b,e,-t,t),this.equations.push(g));this.velocity=
this.position=0;this.lowerLimitEnabled="undefined"!==typeof h.lowerLimit?!0:!1;this.upperLimitEnabled="undefined"!==typeof h.upperLimit?!0:!1;this.lowerLimit="undefined"!==typeof h.lowerLimit?h.lowerLimit:0;this.upperLimit="undefined"!==typeof h.upperLimit?h.upperLimit:1;this.upperLimitEquation=new n(b,e);this.lowerLimitEquation=new n(b,e);this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0;this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=t;this.motorEquation=new a(b,
e);this.motorEnabled=!1;this.motorSpeed=0;var w=this;h=this.motorEquation;h.computeGq=function(){return 0};h.computeGW=function(){var a=this.bodyA,c=this.bodyB;return this.gmult(this.G,a.velocity,a.angularVelocity,c.velocity,c.angularVelocity)+w.motorSpeed}}var m=b("./Constraint"),n=b("../equations/ContactEquation"),a=b("../equations/Equation"),c=b("../math/vec2"),d=b("../equations/RotationalLockEquation");g.exports=f;f.prototype=new m;f.prototype.constructor=f;var e=c.create(),h=c.create(),l=c.create(),
q=c.create(),t=c.create(),v=c.create();f.prototype.update=function(){var a=this.equations,d=this.upperLimit,b=this.lowerLimit,f=this.upperLimitEquation,g=this.lowerLimitEquation,n=this.bodyA,m=this.bodyB,k=this.localAxisA,E=this.localAnchorA,C=this.localAnchorB;a[0].updateJacobian();c.rotate(e,k,n.angle);c.rotate(q,E,n.angle);c.add(h,q,n.position);c.rotate(t,C,m.angle);c.add(l,t,m.position);k=this.position=c.dot(l,e)-c.dot(h,e);this.motorEnabled&&(E=this.motorEquation.G,E[0]=e[0],E[1]=e[1],E[2]=c.crossLength(e,
t),E[3]=-e[0],E[4]=-e[1],E[5]=-c.crossLength(e,q));this.upperLimitEnabled&&k>d?(c.scale(f.normalA,e,-1),c.sub(f.contactPointA,h,n.position),c.sub(f.contactPointB,l,m.position),c.scale(v,e,d),c.add(f.contactPointA,f.contactPointA,v),-1===a.indexOf(f)&&a.push(f)):(d=a.indexOf(f),-1!==d&&a.splice(d,1));this.lowerLimitEnabled&&k<b?(c.scale(g.normalA,e,1),c.sub(g.contactPointA,h,n.position),c.sub(g.contactPointB,l,m.position),c.scale(v,e,b),c.sub(g.contactPointB,g.contactPointB,v),-1===a.indexOf(g)&&a.push(g)):
(d=a.indexOf(g),-1!==d&&a.splice(d,1))};f.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)};f.prototype.disableMotor=function(){if(this.motorEnabled){var a=this.equations.indexOf(this.motorEquation);this.equations.splice(a,1);this.motorEnabled=!1}};f.prototype.setLimits=function(a,c){"number"===typeof a?(this.lowerLimit=a,this.lowerLimitEnabled=!0):(this.lowerLimit=a,this.lowerLimitEnabled=!1);"number"===typeof c?(this.upperLimit=c,
this.upperLimitEnabled=!0):(this.upperLimit=c,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(b,g,k){function f(b,f,g){g=g||{};m.call(this,b,f,m.REVOLUTE,g);var v=this.maxForce="undefined"!==typeof g.maxForce?g.maxForce:Number.MAX_VALUE;this.pivotA=d.create();this.pivotB=d.create();g.worldPivot?(d.sub(this.pivotA,g.worldPivot,b.position),d.sub(this.pivotB,g.worldPivot,
f.position),d.rotate(this.pivotA,this.pivotA,-b.angle),d.rotate(this.pivotB,this.pivotB,-f.angle)):(d.copy(this.pivotA,g.localPivotA),d.copy(this.pivotB,g.localPivotB));var r=this.equations=[new n(b,f,-v,v),new n(b,f,-v,v)];g=r[0];var r=r[1],k=this;g.computeGq=function(){d.rotate(e,k.pivotA,b.angle);d.rotate(h,k.pivotB,f.angle);d.add(t,f.position,h);d.sub(t,t,b.position);d.sub(t,t,e);return d.dot(t,l)};r.computeGq=function(){d.rotate(e,k.pivotA,b.angle);d.rotate(h,k.pivotB,f.angle);d.add(t,f.position,
h);d.sub(t,t,b.position);d.sub(t,t,e);return d.dot(t,q)};r.minForce=g.minForce=-v;r.maxForce=g.maxForce=v;this.motorEquation=new a(b,f);this.motorEnabled=!1;this.angle=0;this.upperLimitEnabled=this.lowerLimitEnabled=!1;this.upperLimit=this.lowerLimit=0;this.upperLimitEquation=new c(b,f);this.lowerLimitEquation=new c(b,f);this.upperLimitEquation.minForce=0;this.lowerLimitEquation.maxForce=0}var m=b("./Constraint"),n=b("../equations/Equation"),a=b("../equations/RotationalVelocityEquation"),c=b("../equations/RotationalLockEquation"),
d=b("../math/vec2");g.exports=f;var e=d.create(),h=d.create(),l=d.fromValues(1,0),q=d.fromValues(0,1),t=d.create();f.prototype=new m;f.prototype.constructor=f;f.prototype.setLimits=function(a,c){"number"===typeof a?(this.lowerLimit=a,this.lowerLimitEnabled=!0):(this.lowerLimit=a,this.lowerLimitEnabled=!1);"number"===typeof c?(this.upperLimit=c,this.upperLimitEnabled=!0):(this.upperLimit=c,this.upperLimitEnabled=!1)};f.prototype.update=function(){var a=this.bodyA,c=this.bodyB,b=this.pivotA,f=this.pivotB,
t=this.equations,g=t[0],n=t[1],m=this.upperLimit,k=this.lowerLimit,E=this.upperLimitEquation,C=this.lowerLimitEquation,F=this.angle=c.angle-a.angle;this.upperLimitEnabled&&F>m?(E.angle=m,-1===t.indexOf(E)&&t.push(E)):(m=t.indexOf(E),-1!==m&&t.splice(m,1));this.lowerLimitEnabled&&F<k?(C.angle=k,-1===t.indexOf(C)&&t.push(C)):(m=t.indexOf(C),-1!==m&&t.splice(m,1));d.rotate(e,b,a.angle);d.rotate(h,f,c.angle);g.G[0]=-1;g.G[1]=0;g.G[2]=-d.crossLength(e,l);g.G[3]=1;g.G[4]=0;g.G[5]=d.crossLength(h,l);n.G[0]=
0;n.G[1]=-1;n.G[2]=-d.crossLength(e,q);n.G[3]=0;n.G[4]=1;n.G[5]=d.crossLength(h,q)};f.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)};f.prototype.disableMotor=function(){if(this.motorEnabled){var a=this.equations.indexOf(this.motorEquation);this.equations.splice(a,1);this.motorEnabled=!1}};f.prototype.motorIsEnabled=function(){return!!this.motorEnabled};f.prototype.setMotorSpeed=function(a){if(this.motorEnabled){var c=this.equations.indexOf(this.motorEquation);
this.equations[c].relativeVelocity=a}};f.prototype.getMotorSpeed=function(){return this.motorEnabled?this.motorEquation.relativeVelocity:!1}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(b,g,k){function f(b,a,c){c=c||{};m.call(this,b,a,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=c.angle||0;this.ratio="number"===typeof c.ratio?c.ratio:1;this.setRatio(this.ratio)}var m=b("./Equation");
b("../math/vec2");g.exports=f;f.prototype=new m;f.prototype.constructor=f;f.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle};f.prototype.setRatio=function(b){var a=this.G;a[2]=b;a[5]=-1;this.ratio=b};f.prototype.setMaxTorque=function(b){this.maxForce=b;this.minForce=-b}},{"../math/vec2":30,"./Equation":22}],21:[function(b,g,k){function f(a,c){m.call(this,a,c,0,Number.MAX_VALUE);this.contactPointA=n.create();this.penetrationVec=n.create();this.contactPointB=
n.create();this.normalA=n.create();this.restitution=0;this.firstImpact=!1;this.shapeB=this.shapeA=null}var m=b("./Equation"),n=b("../math/vec2");g.exports=f;f.prototype=new m;f.prototype.constructor=f;f.prototype.computeB=function(a,c,d){var b=this.contactPointA,h=this.contactPointB,l=this.bodyA.position,q=this.bodyB.position,f=this.penetrationVec,g=this.normalA,r=this.G,m=n.crossLength(b,g),k=n.crossLength(h,g);r[0]=-g[0];r[1]=-g[1];r[2]=-m;r[3]=g[0];r[4]=g[1];r[5]=k;n.add(f,q,h);n.sub(f,f,l);n.sub(f,
f,b);this.firstImpact&&0!==this.restitution?(h=0,b=1/c*(1+this.restitution)*this.computeGW()):(h=n.dot(g,f)+this.offset,b=this.computeGW());l=this.computeGiMf();return-h*a-b*c-d*l}},{"../math/vec2":30,"./Equation":22}],22:[function(b,g,k){function f(a,c,d,b){this.minForce="undefined"===typeof d?-Number.MAX_VALUE:d;this.maxForce="undefined"===typeof b?Number.MAX_VALUE:b;this.bodyA=a;this.bodyB=c;this.stiffness=f.DEFAULT_STIFFNESS;this.relaxation=f.DEFAULT_RELAXATION;this.G=new n.ARRAY_TYPE(6);for(a=
0;6>a;a++)this.G[a]=0;this.epsilon=this.b=this.a=this.offset=0;this.timeStep=1/60;this.needsUpdate=!0;this.relativeVelocity=this.multiplier=0;this.enabled=!0}g.exports=f;var m=b("../math/vec2"),n=b("../utils/Utils");b("../objects/Body");f.prototype.constructor=f;f.DEFAULT_STIFFNESS=1E6;f.DEFAULT_RELAXATION=4;f.prototype.update=function(){var a=this.stiffness,c=this.relaxation,d=this.timeStep;this.a=4/(d*(1+4*c));this.b=4*c/(1+4*c);this.epsilon=4/(d*d*a*(1+4*c));this.needsUpdate=!1};f.prototype.gmult=
function(a,c,d,b,e){return a[0]*c[0]+a[1]*c[1]+a[2]*d+a[3]*b[0]+a[4]*b[1]+a[5]*e};f.prototype.computeB=function(a,c,d){var b=this.computeGW(),e=this.computeGq(),h=this.computeGiMf();return-e*a-b*c-h*d};var a=m.create(),c=m.create();f.prototype.computeGq=function(){return this.gmult(this.G,a,this.bodyA.angle,c,this.bodyB.angle)+this.offset};f.prototype.computeGW=function(){var a=this.bodyA,c=this.bodyB;return this.gmult(this.G,a.velocity,a.angularVelocity,c.velocity,c.angularVelocity)+this.relativeVelocity};
f.prototype.computeGWlambda=function(){var a=this.bodyA,c=this.bodyB;return this.gmult(this.G,a.vlambda,a.wlambda,c.vlambda,c.wlambda)};var d=m.create(),e=m.create();f.prototype.computeGiMf=function(){var a=this.bodyA,c=this.bodyB,b=a.angularForce,h=c.force,l=c.angularForce,q=c.invMassSolve,f=a.invInertiaSolve,g=c.invInertiaSolve,n=this.G;m.scale(d,a.force,a.invMassSolve);m.multiply(d,a.massMultiplier,d);m.scale(e,h,q);m.multiply(e,c.massMultiplier,e);return this.gmult(n,d,b*f,e,l*g)};f.prototype.computeGiMGt=
function(){var a=this.bodyA,c=this.bodyB,d=a.invMassSolve,b=c.invMassSolve,e=this.G;return e[0]*e[0]*d*a.massMultiplier[0]+e[1]*e[1]*d*a.massMultiplier[1]+e[2]*e[2]*a.invInertiaSolve+e[3]*e[3]*b*c.massMultiplier[0]+e[4]*e[4]*b*c.massMultiplier[1]+e[5]*e[5]*c.invInertiaSolve};var h=m.create(),l=m.create(),q=m.create();m.create();m.create();m.create();f.prototype.addToWlambda=function(a){var c=this.bodyA,d=this.bodyB,b=c.invMassSolve,e=d.invMassSolve,f=c.invInertiaSolve,g=d.invInertiaSolve,t=this.G;
l[0]=t[0];l[1]=t[1];q[0]=t[3];q[1]=t[4];m.scale(h,l,b*a);m.multiply(h,h,c.massMultiplier);m.add(c.vlambda,c.vlambda,h);c.wlambda+=f*t[2]*a;m.scale(h,q,e*a);m.multiply(h,h,d.massMultiplier);m.add(d.vlambda,d.vlambda,h);d.wlambda+=g*t[5]*a};f.prototype.computeInvC=function(a){return 1/(this.computeGiMGt()+a)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(b,g,k){function f(a,c,d){n.call(this,a,c,-d,d);this.contactPointA=m.create();this.contactPointB=m.create();this.t=m.create();
this.contactEquations=[];this.shapeB=this.shapeA=null;this.frictionCoefficient=.3}var m=b("../math/vec2"),n=b("./Equation");b("../utils/Utils");g.exports=f;f.prototype=new n;f.prototype.constructor=f;f.prototype.setSlipForce=function(a){this.maxForce=a;this.minForce=-a};f.prototype.getSlipForce=function(){return this.maxForce};f.prototype.computeB=function(a,c,d){a=this.contactPointA;var b=this.contactPointB,h=this.t,l=this.G;l[0]=-h[0];l[1]=-h[1];l[2]=-m.crossLength(a,h);l[3]=h[0];l[4]=h[1];l[5]=
m.crossLength(b,h);a=this.computeGW();b=this.computeGiMf();return-a*c-d*b}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(b,g,k){function f(a,c,d){d=d||{};m.call(this,a,c,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=d.angle||0;a=this.G;a[2]=1;a[5]=-1}var m=b("./Equation"),n=b("../math/vec2");g.exports=f;f.prototype=new m;f.prototype.constructor=f;var a=n.create(),c=n.create(),d=n.fromValues(1,0),e=n.fromValues(0,1);f.prototype.computeGq=function(){n.rotate(a,d,this.bodyA.angle+
this.angle);n.rotate(c,e,this.bodyB.angle);return n.dot(a,c)}},{"../math/vec2":30,"./Equation":22}],25:[function(b,g,k){function f(b,a){m.call(this,b,a,-Number.MAX_VALUE,Number.MAX_VALUE);this.ratio=this.relativeVelocity=1}var m=b("./Equation");b("../math/vec2");g.exports=f;f.prototype=new m;f.prototype.constructor=f;f.prototype.computeB=function(b,a,c){b=this.G;b[2]=-1;b[5]=this.ratio;b=this.computeGiMf();return-this.computeGW()*a-c*b}},{"../math/vec2":30,"./Equation":22}],26:[function(b,g,k){b=
function(){};g.exports=b;b.prototype={constructor:b,on:function(b,g,n){g.context=n||this;void 0===this._listeners&&(this._listeners={});n=this._listeners;void 0===n[b]&&(n[b]=[]);-1===n[b].indexOf(g)&&n[b].push(g);return this},has:function(b,g){if(void 0===this._listeners)return!1;var f=this._listeners;if(g){if(void 0!==f[b]&&-1!==f[b].indexOf(g))return!0}else if(void 0!==f[b])return!0;return!1},off:function(b,g){if(void 0===this._listeners)return this;var f=this._listeners,a=f[b].indexOf(g);-1!==
a&&f[b].splice(a,1);return this},emit:function(b){if(void 0===this._listeners)return this;var f=this._listeners[b.type];if(void 0!==f){b.target=this;for(var g=0,a=f.length;g<a;g++){var c=f[g];c.call(c.context,b)}}return this}}},{}],27:[function(b,g,k){function f(a,c,d){d=d||{};if(!(a instanceof m&&c instanceof m))throw Error("First two arguments must be Material instances.");this.id=f.idCounter++;this.materialA=a;this.materialB=c;this.friction="undefined"!==typeof d.friction?Number(d.friction):.3;
this.restitution="undefined"!==typeof d.restitution?Number(d.restitution):0;this.stiffness="undefined"!==typeof d.stiffness?Number(d.stiffness):n.DEFAULT_STIFFNESS;this.relaxation="undefined"!==typeof d.relaxation?Number(d.relaxation):n.DEFAULT_RELAXATION;this.frictionStiffness="undefined"!==typeof d.frictionStiffness?Number(d.frictionStiffness):n.DEFAULT_STIFFNESS;this.frictionRelaxation="undefined"!==typeof d.frictionRelaxation?Number(d.frictionRelaxation):n.DEFAULT_RELAXATION;this.surfaceVelocity=
"undefined"!==typeof d.surfaceVelocity?Number(d.surfaceVelocity):0;this.contactSkinSize=.005}var m=b("./Material"),n=b("../equations/Equation");g.exports=f;f.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(b,g,k){function f(b){this.id=b||f.idCounter++}g.exports=f;f.idCounter=0},{}],29:[function(b,g,k){var f={GetArea:function(b){if(6>b.length)return 0;for(var f=b.length-2,a=0,c=0;c<f;c+=2)a+=(b[c+2]-b[c])*(b[c+1]+b[c+3]);a+=(b[0]-b[f])*(b[f+1]+b[1]);return.5*-a},Triangulate:function(b){var g=
b.length>>1;if(3>g)return[];for(var a=[],c=[],d=0;d<g;d++)c.push(d);for(d=0;3<g;){var e=c[(d+0)%g],h=c[(d+1)%g],l=c[(d+2)%g],q=b[2*e],t=b[2*e+1],v=b[2*h],r=b[2*h+1],k=b[2*l],m=b[2*l+1],u=!1;if(f._convex(q,t,v,r,k,m))for(var u=!0,x=0;x<g;x++){var z=c[x];if(z!=e&&z!=h&&z!=l&&f._PointInTriangle(b[2*z],b[2*z+1],q,t,v,r,k,m)){u=!1;break}}if(u)a.push(e,h,l),c.splice((d+1)%g,1),g--,d=0;else if(d++>3*g)break}a.push(c[0],c[1],c[2]);return a},_PointInTriangle:function(b,f,a,c,d,e,h,l){h-=a;l-=c;d-=a;e-=c;b-=
a;a=f-c;f=h*h+l*l;c=h*d+l*e;h=h*b+l*a;l=d*d+e*e;d=d*b+e*a;e=1/(f*l-c*c);l=(l*h-c*d)*e;h=(f*d-c*h)*e;return 0<=l&&0<=h&&1>l+h},_convex:function(b,f,a,c,d,e){return 0<=(f-c)*(d-a)+(a-b)*(e-c)}};g.exports=f},{}],30:[function(b,g,k){var f=g.exports={},m=b("../utils/Utils");f.crossLength=function(b,a){return b[0]*a[1]-b[1]*a[0]};f.crossVZ=function(b,a,c){f.rotate(b,a,-Math.PI/2);f.scale(b,b,c);return b};f.crossZV=function(b,a,c){f.rotate(b,c,Math.PI/2);f.scale(b,b,a);return b};f.rotate=function(b,a,c){if(0!==
c){var d=Math.cos(c);c=Math.sin(c);var e=a[0];a=a[1];b[0]=d*e-c*a;b[1]=c*e+d*a}else b[0]=a[0],b[1]=a[1]};f.rotate90cw=function(b,a){var c=a[0];b[0]=a[1];b[1]=-c};f.toLocalFrame=function(b,a,c,d){f.copy(b,a);f.sub(b,b,c);f.rotate(b,b,-d)};f.toGlobalFrame=function(b,a,c,d){f.copy(b,a);f.rotate(b,b,d);f.add(b,b,c)};f.vectorToLocalFrame=function(b,a,c){f.rotate(b,a,-c)};f.vectorToGlobalFrame=function(b,a,c){f.rotate(b,a,c)};f.centroid=function(b,a,c,d){f.add(b,a,c);f.add(b,b,d);f.scale(b,b,1/3);return b};
f.create=function(){var b=new m.ARRAY_TYPE(2);b[0]=0;b[1]=0;return b};f.clone=function(b){var a=new m.ARRAY_TYPE(2);a[0]=b[0];a[1]=b[1];return a};f.fromValues=function(b,a){var c=new m.ARRAY_TYPE(2);c[0]=b;c[1]=a;return c};f.copy=function(b,a){b[0]=a[0];b[1]=a[1];return b};f.set=function(b,a,c){b[0]=a;b[1]=c;return b};f.add=function(b,a,c){b[0]=a[0]+c[0];b[1]=a[1]+c[1];return b};f.subtract=function(b,a,c){b[0]=a[0]-c[0];b[1]=a[1]-c[1];return b};f.sub=f.subtract;f.multiply=function(b,a,c){b[0]=a[0]*
c[0];b[1]=a[1]*c[1];return b};f.mul=f.multiply;f.divide=function(b,a,c){b[0]=a[0]/c[0];b[1]=a[1]/c[1];return b};f.div=f.divide;f.scale=function(b,a,c){b[0]=a[0]*c;b[1]=a[1]*c;return b};f.distance=function(b,a){var c=a[0]-b[0],d=a[1]-b[1];return Math.sqrt(c*c+d*d)};f.dist=f.distance;f.squaredDistance=function(b,a){var c=a[0]-b[0],d=a[1]-b[1];return c*c+d*d};f.sqrDist=f.squaredDistance;f.length=function(b){var a=b[0];b=b[1];return Math.sqrt(a*a+b*b)};f.len=f.length;f.squaredLength=function(b){var a=
b[0];b=b[1];return a*a+b*b};f.sqrLen=f.squaredLength;f.negate=function(b,a){b[0]=-a[0];b[1]=-a[1];return b};f.normalize=function(b,a){var c=a[0],d=a[1],c=c*c+d*d;0<c&&(c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c);return b};f.dot=function(b,a){return b[0]*a[0]+b[1]*a[1]};f.str=function(b){return"vec2("+b[0]+", "+b[1]+")"};f.lerp=function(b,a,c,d){var e=a[0];a=a[1];b[0]=e+d*(c[0]-e);b[1]=a+d*(c[1]-a);return b};f.reflect=function(b,a,c){var d=a[0]*c[0]+a[1]*c[1];b[0]=a[0]-2*c[0]*d;b[1]=a[1]-2*c[1]*d};f.getLineSegmentsIntersection=
function(b,a,c,d,e){d=f.getLineSegmentsIntersectionFraction(a,c,d,e);if(0>d)return!1;b[0]=a[0]+d*(c[0]-a[0]);b[1]=a[1]+d*(c[1]-a[1]);return!0};f.getLineSegmentsIntersectionFraction=function(b,a,c,d){var e=a[0]-b[0];a=a[1]-b[1];var h=d[0]-c[0],l=d[1]-c[1];d=(-a*(b[0]-c[0])+e*(b[1]-c[1]))/(-h*a+e*l);b=(h*(b[1]-c[1])-l*(b[0]-c[0]))/(-h*a+e*l);return 0<=d&&1>=d&&0<=b&&1>=b?b:-1}},{"../utils/Utils":57}],31:[function(b,g,k){function f(a){a=a||{};e.call(this);this.id=a.id||++f._idCounter;this.world=null;
this.shapes=[];this.mass=a.mass||0;this.invInertiaSolve=this.invMassSolve=this.invInertia=this.inertia=this.invMass=0;this.fixedRotation=!!a.fixedRotation;this.fixedX=!!a.fixedX;this.fixedY=!!a.fixedY;this.massMultiplier=m.create();this.position=m.fromValues(0,0);a.position&&m.copy(this.position,a.position);this.interpolatedPosition=m.fromValues(0,0);this.interpolatedAngle=0;this.previousPosition=m.fromValues(0,0);this.previousAngle=0;this.velocity=m.fromValues(0,0);a.velocity&&m.copy(this.velocity,
a.velocity);this.vlambda=m.fromValues(0,0);this.wlambda=0;this.angle=a.angle||0;this.angularVelocity=a.angularVelocity||0;this.force=m.create();a.force&&m.copy(this.force,a.force);this.angularForce=a.angularForce||0;this.damping="number"===typeof a.damping?a.damping:.1;this.angularDamping="number"===typeof a.angularDamping?a.angularDamping:.1;this.type=f.STATIC;this.type="undefined"!==typeof a.type?a.type:a.mass?f.DYNAMIC:f.STATIC;this.boundingRadius=0;this.aabb=new d;this.aabbNeedsUpdate=!0;this.allowSleep=
void 0!==a.allowSleep?a.allowSleep:!0;this.wantsToSleep=!1;this.sleepState=f.AWAKE;this.sleepSpeedLimit=void 0!==a.sleepSpeedLimit?a.sleepSpeedLimit:.2;this.sleepTimeLimit=void 0!==a.sleepTimeLimit?a.sleepTimeLimit:1;this.gravityScale=void 0!==a.gravityScale?a.gravityScale:1;this.collisionResponse=void 0!==a.collisionResponse?a.collisionResponse:!0;this.timeLastSleepy=this.idleTime=0;this.ccdSpeedThreshold=void 0!==a.ccdSpeedThreshold?a.ccdSpeedThreshold:-1;this.ccdIterations=void 0!==a.ccdIterations?
a.ccdIterations:10;this.concavePath=null;this._wakeUpAfterNarrowphase=!1;this.updateMassProperties()}var m=b("../math/vec2"),n=b("poly-decomp"),a=b("../shapes/Convex");k=b("../collision/RaycastResult");var c=b("../collision/Ray"),d=b("../collision/AABB"),e=b("../events/EventEmitter");g.exports=f;f.prototype=new e;f.prototype.constructor=f;f._idCounter=0;f.prototype.updateSolveMassProperties=function(){this.sleepState===f.SLEEPING||this.type===f.KINEMATIC?this.invInertiaSolve=this.invMassSolve=0:(this.invMassSolve=
this.invMass,this.invInertiaSolve=this.invInertia)};f.prototype.setDensity=function(a){this.mass=this.getArea()*a;this.updateMassProperties()};f.prototype.getArea=function(){for(var a=0,c=0;c<this.shapes.length;c++)a+=this.shapes[c].area;return a};f.prototype.getAABB=function(){this.aabbNeedsUpdate&&this.updateAABB();return this.aabb};var h=new d,l=m.create();f.prototype.updateAABB=function(){for(var a=this.shapes,c=a.length,d=this.angle,b=0;b!==c;b++){var e=a[b],q=e.angle+d;m.rotate(l,e.position,
d);m.add(l,l,this.position);e.computeAABB(h,l,q);0===b?this.aabb.copy(h):this.aabb.extend(h)}this.aabbNeedsUpdate=!1};f.prototype.updateBoundingRadius=function(){for(var a=this.shapes,c=a.length,d=0,b=0;b!==c;b++){var e=a[b],h=m.length(e.position),e=e.boundingRadius;h+e>d&&(d=h+e)}this.boundingRadius=d};f.prototype.addShape=function(a,c,d){if(a.body)throw Error("A shape can only be added to one body.");a.body=this;c?m.copy(a.position,c):m.set(a.position,0,0);a.angle=d||0;this.shapes.push(a);this.updateMassProperties();
this.updateBoundingRadius();this.aabbNeedsUpdate=!0};f.prototype.removeShape=function(a){var c=this.shapes.indexOf(a);return-1!==c?(this.shapes.splice(c,1),this.aabbNeedsUpdate=!0,a.body=null,!0):!1};f.prototype.updateMassProperties=function(){if(this.type===f.STATIC||this.type===f.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var a=this.shapes,c=a.length,d=this.mass/c,b=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=
0;else{for(var e=0;e<c;e++)var h=a[e],l=m.squaredLength(h.position),h=h.computeMomentOfInertia(d),b=b+(h+d*l);this.inertia=b;this.invInertia=0<b?1/b:0}this.invMass=1/this.mass;m.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};m.create();f.prototype.applyForce=function(a,c){m.add(this.force,this.force,a);if(c){var d=m.crossLength(c,a);this.angularForce+=d}};var q=m.create(),t=m.create(),v=m.create();f.prototype.applyForceLocal=function(a,c){c=c||v;this.vectorToWorldFrame(q,a);this.vectorToWorldFrame(t,
c);this.applyForce(q,t)};var r=m.create();f.prototype.applyImpulse=function(a,c){if(this.type===f.DYNAMIC&&(m.scale(r,a,this.invMass),m.multiply(r,this.massMultiplier,r),m.add(this.velocity,r,this.velocity),c)){var d=m.crossLength(c,a),d=d*this.invInertia;this.angularVelocity+=d}};var y=m.create(),w=m.create(),u=m.create();f.prototype.applyImpulseLocal=function(a,c){c=c||u;this.vectorToWorldFrame(y,a);this.vectorToWorldFrame(w,c);this.applyImpulse(y,w)};f.prototype.toLocalFrame=function(a,c){m.toLocalFrame(a,
c,this.position,this.angle)};f.prototype.toWorldFrame=function(a,c){m.toGlobalFrame(a,c,this.position,this.angle)};f.prototype.vectorToLocalFrame=function(a,c){m.vectorToLocalFrame(a,c,this.angle)};f.prototype.vectorToWorldFrame=function(a,c){m.vectorToGlobalFrame(a,c,this.angle)};f.prototype.fromPolygon=function(c,d){d=d||{};for(var b=this.shapes.length;0<=b;--b)this.removeShape(this.shapes[b]);var e=new n.Polygon;e.vertices=c;e.makeCCW();"number"===typeof d.removeCollinearPoints&&e.removeCollinearPoints(d.removeCollinearPoints);
if("undefined"===typeof d.skipSimpleCheck&&!e.isSimple())return!1;this.concavePath=e.vertices.slice(0);for(b=0;b<this.concavePath.length;b++){var h=[0,0];m.copy(h,this.concavePath[b]);this.concavePath[b]=h}for(var e=d.optimalDecomp?e.decomp():e.quickDecomp(),l=m.create(),b=0;b!==e.length;b++){for(var q=new a({vertices:e[b].vertices}),f=0;f!==q.vertices.length;f++)h=q.vertices[f],m.sub(h,h,q.centerOfMass);m.scale(l,q.centerOfMass,1);q.updateTriangles();q.updateCenterOfMass();q.updateBoundingRadius();
this.addShape(q,l)}this.adjustCenterOfMass();return this.aabbNeedsUpdate=!0};m.fromValues(0,0);var x=m.fromValues(0,0),z=m.fromValues(0,0),D=m.fromValues(0,0);f.prototype.adjustCenterOfMass=function(){var a=0;m.set(z,0,0);for(var c=0;c!==this.shapes.length;c++){var d=this.shapes[c];m.scale(x,d.position,d.area);m.add(z,z,x);a+=d.area}m.scale(D,z,1/a);for(c=0;c!==this.shapes.length;c++)d=this.shapes[c],m.sub(d.position,d.position,D);m.add(this.position,this.position,D);for(c=0;this.concavePath&&c<this.concavePath.length;c++)m.sub(this.concavePath[c],
this.concavePath[c],D);this.updateMassProperties();this.updateBoundingRadius()};f.prototype.setZeroForce=function(){m.set(this.force,0,0);this.angularForce=0};f.prototype.resetConstraintVelocity=function(){m.set(this.vlambda,0,0);this.wlambda=0};f.prototype.addConstraintVelocity=function(){var a=this.velocity;m.add(a,a,this.vlambda);this.angularVelocity+=this.wlambda};f.prototype.applyDamping=function(a){if(this.type===f.DYNAMIC){var c=this.velocity;m.scale(c,c,Math.pow(1-this.damping,a));this.angularVelocity*=
Math.pow(1-this.angularDamping,a)}};f.prototype.wakeUp=function(){var a=this.sleepState;this.sleepState=f.AWAKE;this.idleTime=0;a!==f.AWAKE&&this.emit(f.wakeUpEvent)};f.prototype.sleep=function(){this.sleepState=f.SLEEPING;this.angularForce=this.angularVelocity=0;m.set(this.velocity,0,0);m.set(this.force,0,0);this.emit(f.sleepEvent)};f.prototype.sleepTick=function(a,c,d){this.allowSleep&&this.type!==f.SLEEPING&&(this.wantsToSleep=!1,m.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)>=
Math.pow(this.sleepSpeedLimit,2)?(this.idleTime=0,this.sleepState=f.AWAKE):(this.idleTime+=d,this.sleepState=f.SLEEPY),this.idleTime>this.sleepTimeLimit&&(c?this.wantsToSleep=!0:this.sleep()))};f.prototype.overlaps=function(a){return this.world.overlapKeeper.bodiesAreOverlapping(this,a)};var A=m.create(),E=m.create();f.prototype.integrate=function(a){var c=this.invMass,d=this.force,b=this.position,e=this.velocity;m.copy(this.previousPosition,this.position);this.previousAngle=this.angle;this.fixedRotation||
(this.angularVelocity+=this.angularForce*this.invInertia*a);m.scale(A,d,a*c);m.multiply(A,this.massMultiplier,A);m.add(e,A,e);this.integrateToTimeOfImpact(a)||(m.scale(E,e,a),m.add(b,b,E),this.fixedRotation||(this.angle+=this.angularVelocity*a));this.aabbNeedsUpdate=!0};var C=new k,F=new c({mode:c.ALL}),I=m.create(),H=m.create(),B=m.create(),G=m.create();f.prototype.integrateToTimeOfImpact=function(a){if(0>this.ccdSpeedThreshold||m.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;
m.normalize(I,this.velocity);m.scale(H,this.velocity,a);m.add(H,H,this.position);m.sub(B,H,this.position);a*=this.angularVelocity;var c=m.length(B),d=1,b,e=this;C.reset();F.callback=function(a){a.body!==e&&(b=a.body,a.getHitPoint(H,F),m.sub(B,H,e.position),d=m.length(B)/c,a.stop())};m.copy(F.from,this.position);m.copy(F.to,H);F.update();this.world.raycast(C,F);if(!b)return!1;var h=this.angle;m.copy(G,this.position);for(var l=0,q=0,f=0,g=d;g>=q&&l<this.ccdIterations;)l++,f=(g-q)/2,m.scale(E,B,d),m.add(this.position,
G,E),this.angle=h+a*d,this.updateAABB(),this.aabb.overlaps(b.aabb)&&this.world.narrowphase.bodiesOverlap(this,b)?q=f:g=f;d=f;m.copy(this.position,G);this.angle=h;m.scale(E,B,d);m.add(this.position,this.position,E);this.fixedRotation||(this.angle+=a*d);return!0};f.prototype.getVelocityAtPoint=function(a,c){m.crossVZ(a,c,this.angularVelocity);m.subtract(a,this.velocity,a);return a};f.sleepyEvent={type:"sleepy"};f.sleepEvent={type:"sleep"};f.wakeUpEvent={type:"wakeup"};f.DYNAMIC=1;f.STATIC=2;f.KINEMATIC=
4;f.AWAKE=0;f.SLEEPY=1;f.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(b,g,k){function f(a,c,d){d=d||{};n.call(this,a,c,d);this.localAnchorA=m.fromValues(0,0);this.localAnchorB=m.fromValues(0,0);d.localAnchorA&&m.copy(this.localAnchorA,d.localAnchorA);d.localAnchorB&&m.copy(this.localAnchorB,d.localAnchorB);d.worldAnchorA&&this.setWorldAnchorA(d.worldAnchorA);
d.worldAnchorB&&this.setWorldAnchorB(d.worldAnchorB);a=m.create();c=m.create();this.getWorldAnchorA(a);this.getWorldAnchorB(c);a=m.distance(a,c);this.restLength="number"===typeof d.restLength?d.restLength:a}var m=b("../math/vec2"),n=b("./Spring");b("../utils/Utils");g.exports=f;f.prototype=new n;f.prototype.constructor=f;f.prototype.setWorldAnchorA=function(a){this.bodyA.toLocalFrame(this.localAnchorA,a)};f.prototype.setWorldAnchorB=function(a){this.bodyB.toLocalFrame(this.localAnchorB,a)};f.prototype.getWorldAnchorA=
function(a){this.bodyA.toWorldFrame(a,this.localAnchorA)};f.prototype.getWorldAnchorB=function(a){this.bodyB.toWorldFrame(a,this.localAnchorB)};var a=m.create(),c=m.create(),d=m.create(),e=m.create(),h=m.create(),l=m.create(),q=m.create(),t=m.create(),v=m.create();f.prototype.applyForce=function(){var b=this.stiffness,f=this.damping,g=this.restLength,n=this.bodyA,k=this.bodyB;this.getWorldAnchorA(h);this.getWorldAnchorB(l);m.sub(q,h,n.position);m.sub(t,l,k.position);m.sub(a,l,h);var z=m.len(a);m.normalize(c,
a);m.sub(d,k.velocity,n.velocity);m.crossZV(v,k.angularVelocity,t);m.add(d,d,v);m.crossZV(v,n.angularVelocity,q);m.sub(d,d,v);m.scale(e,c,-b*(z-g)-f*m.dot(d,c));m.sub(n.force,n.force,e);m.add(k.force,k.force,e);b=m.crossLength(q,e);f=m.crossLength(t,e);n.angularForce-=b;k.angularForce+=f}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(b,g,k){function f(b,a,c){c=c||{};m.call(this,b,a,c);this.restAngle="number"===typeof c.restAngle?c.restAngle:a.angle-b.angle}b("../math/vec2");
var m=b("./Spring");g.exports=f;f.prototype=new m;f.prototype.constructor=f;f.prototype.applyForce=function(){var b=this.bodyA,a=this.bodyB,c=-this.stiffness*(a.angle-b.angle-this.restAngle)-this.damping*(a.angularVelocity-b.angularVelocity)*0;b.angularForce-=c;a.angularForce+=c}},{"../math/vec2":30,"./Spring":34}],34:[function(b,g,k){function f(b,a,c){c=m.defaults(c,{stiffness:100,damping:1});this.stiffness=c.stiffness;this.damping=c.damping;this.bodyA=b;this.bodyB=a}b("../math/vec2");var m=b("../utils/Utils");
g.exports=f;f.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(b,g,k){function f(a,c){this.chassisBody=a;this.wheels=[];this.groundBody=new d({mass:0});this.world=null;var b=this;this.preStepCallback=function(){b.update()}}function m(d,b){b=b||{};this.vehicle=d;this.forwardEquation=new c(d.chassisBody,d.groundBody);this.sideEquation=new c(d.chassisBody,d.groundBody);this.engineForce=this.steerValue=0;this.setSideFriction(void 0!==b.sideFriction?b.sideFriction:
5);this.localForwardVector=n.fromValues(0,1);b.localForwardVector&&n.copy(this.localForwardVector,b.localForwardVector);this.localPosition=n.fromValues(0,0);b.localPosition&&n.copy(this.localPosition,b.localPosition);a.apply(this,d.chassisBody,d.groundBody);this.equations.push(this.forwardEquation,this.sideEquation);this.setBrakeForce(0)}var n=b("../math/vec2");b("../utils/Utils");var a=b("../constraints/Constraint"),c=b("../equations/FrictionEquation"),d=b("../objects/Body");g.exports=f;f.prototype.addToWorld=
function(a){this.world=a;a.addBody(this.groundBody);a.on("preStep",this.preStepCallback);for(var c=0;c<this.wheels.length;c++)a.addConstraint(this.wheels[c])};f.prototype.removeFromWorld=function(){var a=this.world;a.removeBody(this.groundBody);a.off("preStep",this.preStepCallback);for(var c=0;c<this.wheels.length;c++)a.removeConstraint(this.wheels[c]);this.world=null};f.prototype.addWheel=function(a){a=new m(this,a);this.wheels.push(a);return a};f.prototype.update=function(){for(var a=0;a<this.wheels.length;a++)this.wheels[a].update()};
m.prototype=new a;m.prototype.setBrakeForce=function(a){this.forwardEquation.setSlipForce(a)};m.prototype.setSideFriction=function(a){this.sideEquation.setSlipForce(a)};var e=n.create(),h=n.create();m.prototype.getSpeed=function(){this.vehicle.chassisBody.vectorToWorldFrame(h,this.localForwardVector);this.vehicle.chassisBody.getVelocityAtPoint(e,h);return n.dot(e,h)};var l=n.create();m.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector);
n.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2);this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t);n.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue);n.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue);this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition);n.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB);this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,
this.localPosition);n.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA);n.normalize(l,this.forwardEquation.t);n.scale(l,l,this.engineForce);this.vehicle.chassisBody.applyForce(l,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(b,g,k){b=g.exports={AABB:b("./collision/AABB"),AngleLockEquation:b("./equations/AngleLockEquation"),Body:b("./objects/Body"),
Broadphase:b("./collision/Broadphase"),Capsule:b("./shapes/Capsule"),Circle:b("./shapes/Circle"),Constraint:b("./constraints/Constraint"),ContactEquation:b("./equations/ContactEquation"),ContactEquationPool:b("./utils/ContactEquationPool"),ContactMaterial:b("./material/ContactMaterial"),Convex:b("./shapes/Convex"),DistanceConstraint:b("./constraints/DistanceConstraint"),Equation:b("./equations/Equation"),EventEmitter:b("./events/EventEmitter"),FrictionEquation:b("./equations/FrictionEquation"),FrictionEquationPool:b("./utils/FrictionEquationPool"),
GearConstraint:b("./constraints/GearConstraint"),GSSolver:b("./solver/GSSolver"),Heightfield:b("./shapes/Heightfield"),Line:b("./shapes/Line"),LockConstraint:b("./constraints/LockConstraint"),Material:b("./material/Material"),Narrowphase:b("./collision/Narrowphase"),NaiveBroadphase:b("./collision/NaiveBroadphase"),Particle:b("./shapes/Particle"),Plane:b("./shapes/Plane"),Pool:b("./utils/Pool"),RevoluteConstraint:b("./constraints/RevoluteConstraint"),PrismaticConstraint:b("./constraints/PrismaticConstraint"),
Ray:b("./collision/Ray"),RaycastResult:b("./collision/RaycastResult"),Box:b("./shapes/Box"),RotationalVelocityEquation:b("./equations/RotationalVelocityEquation"),SAPBroadphase:b("./collision/SAPBroadphase"),Shape:b("./shapes/Shape"),Solver:b("./solver/Solver"),Spring:b("./objects/Spring"),TopDownVehicle:b("./objects/TopDownVehicle"),LinearSpring:b("./objects/LinearSpring"),RotationalSpring:b("./objects/RotationalSpring"),Utils:b("./utils/Utils"),World:b("./world/World"),vec2:b("./math/vec2"),version:b("../package.json").version};
Object.defineProperty(b,"Rectangle",{get:function(){console.warn("The Rectangle class has been renamed to Box.");return this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,
"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,
"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(b,g,k){function f(c,d){"number"===typeof c&&"number"===typeof d&&(c={width:c,height:d},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })"));
c=c||{};var b=this.width=c.width||1,h=this.height=c.height||1,b=[m.fromValues(-b/2,-h/2),m.fromValues(b/2,-h/2),m.fromValues(b/2,h/2),m.fromValues(-b/2,h/2)],h=[m.fromValues(1,0),m.fromValues(0,1)];c.vertices=b;c.axes=h;c.type=n.BOX;a.call(this,c)}var m=b("../math/vec2"),n=b("./Shape"),a=b("./Convex");g.exports=f;f.prototype=new a;f.prototype.constructor=f;f.prototype.computeMomentOfInertia=function(a){var c=this.width,b=this.height;return a*(b*b+c*c)/12};f.prototype.updateBoundingRadius=function(){var a=
this.width,d=this.height;this.boundingRadius=Math.sqrt(a*a+d*d)/2};m.create();m.create();m.create();m.create();f.prototype.computeAABB=function(a,d,b){a.setFromPoints(this.vertices,d,b,0)};f.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(b,g,k){function f(a,c){"number"===typeof a&&"number"===typeof c&&(a={length:a,radius:c},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })"));
a=a||{};this.length=a.length||1;this.radius=a.radius||1;a.type=m.CAPSULE;m.call(this,a)}var m=b("./Shape"),n=b("../math/vec2");g.exports=f;f.prototype=new m;f.prototype.constructor=f;f.prototype.computeMomentOfInertia=function(a){var c=this.radius,d=this.length+c,c=2*c;return a*(c*c+d*d)/12};f.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2};f.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var a=n.create();
f.prototype.computeAABB=function(c,d,b){var e=this.radius;n.set(a,this.length/2,0);0!==b&&n.rotate(a,a,b);n.set(c.upperBound,Math.max(a[0]+e,-a[0]+e),Math.max(a[1]+e,-a[1]+e));n.set(c.lowerBound,Math.min(a[0]-e,-a[0]-e),Math.min(a[1]-e,-a[1]-e));n.add(c.lowerBound,c.lowerBound,d);n.add(c.upperBound,c.upperBound,d)};var c=n.create(),d=n.create(),e=n.create(),h=n.create(),l=n.fromValues(0,1);f.prototype.raycast=function(a,b,f,g){for(var q=b.from,t=b.to,v=this.length/2,k=0;2>k;k++){var m=this.radius*
(2*k-1);n.set(e,-v,m);n.set(h,v,m);n.toGlobalFrame(e,e,f,g);n.toGlobalFrame(h,h,f,g);var r=n.getLineSegmentsIntersectionFraction(q,t,e,h);if(0<=r&&(n.rotate(d,l,g),n.scale(d,d,2*k-1),b.reportIntersection(a,r,d,-1),a.shouldStop(b)))return}m=Math.pow(this.radius,2)+Math.pow(v,2);for(k=0;2>k;k++){n.set(e,v*(2*k-1),0);n.toGlobalFrame(e,e,f,g);var A=Math.pow(t[0]-q[0],2)+Math.pow(t[1]-q[1],2),E=2*((t[0]-q[0])*(q[0]-e[0])+(t[1]-q[1])*(q[1]-e[1])),r=Math.pow(E,2)-4*A*(Math.pow(q[0]-e[0],2)+Math.pow(q[1]-
e[1],2)-Math.pow(this.radius,2));if(!(0>r))if(0===r){if(n.lerp(c,q,t,r),n.squaredDistance(c,f)>m&&(n.sub(d,c,e),n.normalize(d,d),b.reportIntersection(a,r,d,-1),a.shouldStop(b)))break}else{var r=Math.sqrt(r),C=1/(2*A),A=(-E-r)*C,E=(-E+r)*C;if(0<=A&&1>=A&&(n.lerp(c,q,t,A),n.squaredDistance(c,f)>m&&(n.sub(d,c,e),n.normalize(d,d),b.reportIntersection(a,A,d,-1),a.shouldStop(b))))break;if(0<=E&&1>=E&&(n.lerp(c,q,t,E),n.squaredDistance(c,f)>m&&(n.sub(d,c,e),n.normalize(d,d),b.reportIntersection(a,E,d,-1),
a.shouldStop(b))))break}}}},{"../math/vec2":30,"./Shape":45}],39:[function(b,g,k){function f(a){"number"===typeof a&&(a={radius:a},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })"));a=a||{};this.radius=a.radius||1;a.type=m.CIRCLE;m.call(this,a)}var m=b("./Shape"),n=b("../math/vec2");g.exports=f;f.prototype=new m;f.prototype.constructor=f;f.prototype.computeMomentOfInertia=function(a){var c=this.radius;return a*c*c/2};f.prototype.updateBoundingRadius=
function(){this.boundingRadius=this.radius};f.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius};f.prototype.computeAABB=function(a,c,b){b=this.radius;n.set(a.upperBound,b,b);n.set(a.lowerBound,-b,-b);c&&(n.add(a.lowerBound,a.lowerBound,c),n.add(a.upperBound,a.upperBound,c))};var a=n.create(),c=n.create();f.prototype.raycast=function(d,b,h,l){l=b.from;var e=b.to,f=Math.pow(e[0]-l[0],2)+Math.pow(e[1]-l[1],2),g=2*((e[0]-l[0])*(l[0]-h[0])+(e[1]-l[1])*(l[1]-h[1])),k=Math.pow(g,
2)-4*f*(Math.pow(l[0]-h[0],2)+Math.pow(l[1]-h[1],2)-Math.pow(this.radius,2));if(!(0>k))if(0===k)n.lerp(a,l,e,k),n.sub(c,a,h),n.normalize(c,c),b.reportIntersection(d,k,c,-1);else{var k=Math.sqrt(k),m=1/(2*f),f=(-g-k)*m,g=(-g+k)*m;if(0<=f&&1>=f&&(n.lerp(a,l,e,f),n.sub(c,a,h),n.normalize(c,c),b.reportIntersection(d,f,c,-1),d.shouldStop(b)))return;0<=g&&1>=g&&(n.lerp(a,l,e,g),n.sub(c,a,h),n.normalize(c,c),b.reportIntersection(d,g,c,-1))}}},{"../math/vec2":30,"./Shape":45}],40:[function(b,g,k){function f(a,
c){Array.isArray(a)&&(a={vertices:a,axes:c},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })"));a=a||{};this.vertices=[];for(var d=void 0!==a.vertices?a.vertices:[],b=0;b<d.length;b++){var e=n.create();n.copy(e,d[b]);this.vertices.push(e)}this.axes=[];if(a.axes)for(b=0;b<a.axes.length;b++)d=n.create(),n.copy(d,a.axes[b]),this.axes.push(d);else for(b=0;b<this.vertices.length;b++){var d=this.vertices[b],e=this.vertices[(b+
1)%this.vertices.length],h=n.create();n.sub(h,e,d);n.rotate90cw(h,h);n.normalize(h,h);this.axes.push(h)}this.centerOfMass=n.fromValues(0,0);this.triangles=[];this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass());this.boundingRadius=0;a.type=m.CONVEX;m.call(this,a);this.updateBoundingRadius();this.updateArea();if(0>this.area)throw Error("Convex vertices must be given in conter-clockwise winding.");}var m=b("./Shape"),n=b("../math/vec2"),a=b("../math/polyk");b("poly-decomp");g.exports=
f;f.prototype=new m;f.prototype.constructor=f;var c=n.create(),d=n.create();f.prototype.projectOntoLocalAxis=function(a,d){var b=null,e=null,h;a=c;for(var l=0;l<this.vertices.length;l++){h=this.vertices[l];h=n.dot(h,a);if(null===b||h>b)b=h;if(null===e||h<e)e=h}e>b&&(l=e,e=b,b=l);n.set(d,e,b)};f.prototype.projectOntoWorldAxis=function(a,c,b,e){var h=d;this.projectOntoLocalAxis(a,e);0!==b?n.rotate(h,a,b):h=a;a=n.dot(c,h);n.set(e,e[0]+a,e[1]+a)};f.prototype.updateTriangles=function(){this.triangles.length=
0;for(var c=[],d=0;d<this.vertices.length;d++){var b=this.vertices[d];c.push(b[0],b[1])}c=a.Triangulate(c);for(d=0;d<c.length;d+=3)this.triangles.push([c[d],c[d+1],c[d+2]])};var e=n.create(),h=n.create();n.create();n.create();n.create();n.create();n.create();n.create();n.create();f.prototype.updateCenterOfMass=function(){var a=this.triangles,c=this.vertices,d=this.centerOfMass,b,l,q;n.set(d,0,0);for(var g=0,t=0;t!==a.length;t++)q=a[t],b=c[q[0]],l=c[q[1]],q=c[q[2]],n.centroid(e,b,l,q),b=f.triangleArea(b,
l,q),g+=b,n.scale(h,e,b),n.add(d,d,h);n.scale(d,d,1/g)};f.prototype.computeMomentOfInertia=function(a){for(var c=0,d=0,b=this.vertices.length,e=b-1,h=0;h<b;e=h,h++)var l=this.vertices[e],q=this.vertices[h],e=Math.abs(n.crossLength(l,q)),l=n.dot(q,q)+n.dot(q,l)+n.dot(l,l),c=c+e*l,d=d+e;return a/6*(c/d)};f.prototype.updateBoundingRadius=function(){for(var a=this.vertices,c=0,d=0;d!==a.length;d++){var b=n.squaredLength(a[d]);b>c&&(c=b)}this.boundingRadius=Math.sqrt(c)};f.triangleArea=function(a,c,d){return.5*
((c[0]-a[0])*(d[1]-a[1])-(d[0]-a[0])*(c[1]-a[1]))};f.prototype.updateArea=function(){this.updateTriangles();this.area=0;for(var a=this.triangles,c=this.vertices,d=0;d!==a.length;d++){var b=a[d],b=f.triangleArea(c[b[0]],c[b[1]],c[b[2]]);this.area+=b}};f.prototype.computeAABB=function(a,c,d){a.setFromPoints(this.vertices,c,d,0)};var l=n.create(),q=n.create(),t=n.create();f.prototype.raycast=function(a,c,d,b){var e=this.vertices;n.toLocalFrame(l,c.from,d,b);n.toLocalFrame(q,c.to,d,b);d=e.length;for(var h=
0;h<d&&!a.shouldStop(c);h++){var f=e[h],g=e[(h+1)%d],k=n.getLineSegmentsIntersectionFraction(l,q,f,g);0<=k&&(n.sub(t,g,f),n.rotate(t,t,-Math.PI/2+b),n.normalize(t,t),c.reportIntersection(a,k,t,h))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(b,g,k){function f(a,c){if(Array.isArray(a)){a={heights:a};if("object"===typeof c)for(var d in c)a[d]=c[d];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}a=
a||{};this.heights=a.heights?a.heights.slice(0):[];this.maxValue=a.maxValue||null;this.minValue=a.minValue||null;this.elementWidth=a.elementWidth||.1;void 0!==a.maxValue&&void 0!==a.minValue||this.updateMaxMinValues();a.type=m.HEIGHTFIELD;m.call(this,a)}var m=b("./Shape"),n=b("../math/vec2");b("../utils/Utils");g.exports=f;f.prototype=new m;f.prototype.constructor=f;f.prototype.updateMaxMinValues=function(){for(var a=this.heights,c=a[0],d=a[0],b=0;b!==a.length;b++){var e=a[b];e>c&&(c=e);e<d&&(d=e)}this.maxValue=
c;this.minValue=d};f.prototype.computeMomentOfInertia=function(a){return Number.MAX_VALUE};f.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};f.prototype.updateArea=function(){for(var a=this.heights,c=0,d=0;d<a.length-1;d++)c+=(a[d]+a[d+1])/2*this.elementWidth;this.area=c};var a=[n.create(),n.create(),n.create(),n.create()];f.prototype.computeAABB=function(c,d,b){n.set(a[0],0,this.maxValue);n.set(a[1],this.elementWidth*this.heights.length,this.maxValue);n.set(a[2],this.elementWidth*
this.heights.length,this.minValue);n.set(a[3],0,this.minValue);c.setFromPoints(a,d,b)};f.prototype.getLineSegment=function(a,c,d){var b=this.heights,e=this.elementWidth;n.set(a,d*e,b[d]);n.set(c,(d+1)*e,b[d+1])};f.prototype.getSegmentIndex=function(a){return Math.floor(a[0]/this.elementWidth)};f.prototype.getClampedSegmentIndex=function(a){a=this.getSegmentIndex(a);return a=Math.min(this.heights.length,Math.max(a,0))};n.create();var c=n.create(),d=n.create(),e=n.create(),h=n.create(),l=n.create();
n.fromValues(0,1);f.prototype.raycast=function(a,b,f,g){var q=b.to;n.toLocalFrame(h,b.from,f,g);n.toLocalFrame(l,q,f,g);this.getClampedSegmentIndex(h);this.getClampedSegmentIndex(l);for(f=0;f<this.heights.length-1&&!(this.getLineSegment(d,e,f),q=n.getLineSegmentsIntersectionFraction(h,l,d,e),0<=q&&(n.sub(c,e,d),n.rotate(c,c,g+Math.PI/2),n.normalize(c,c),b.reportIntersection(a,q,c,-1),a.shouldStop(b)));f++);}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(b,g,k){function f(a){"number"===
typeof a&&(a={length:a},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })"));a=a||{};this.length=a.length||1;a.type=m.LINE;m.call(this,a)}var m=b("./Shape"),n=b("../math/vec2");g.exports=f;f.prototype=new m;f.prototype.constructor=f;f.prototype.computeMomentOfInertia=function(a){return a*Math.pow(this.length,2)/12};f.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var a=[n.create(),n.create()];f.prototype.computeAABB=
function(c,d,b){var e=this.length/2;n.set(a[0],-e,0);n.set(a[1],e,0);c.setFromPoints(a,d,b,0)};n.create();var c=n.create(),d=n.create(),e=n.create(),h=n.fromValues(0,1);f.prototype.raycast=function(a,b,f,g){var l=b.from,q=b.to,t=this.length/2;n.set(d,-t,0);n.set(e,t,0);n.toGlobalFrame(d,d,f,g);n.toGlobalFrame(e,e,f,g);f=n.getLineSegmentsIntersectionFraction(d,e,l,q);0<=f&&(n.rotate(c,h,g),b.reportIntersection(a,f,c,-1))}},{"../math/vec2":30,"./Shape":45}],43:[function(b,g,k){function f(a){a=a||{};
a.type=m.PARTICLE;m.call(this,a)}var m=b("./Shape"),n=b("../math/vec2");g.exports=f;f.prototype=new m;f.prototype.constructor=f;f.prototype.computeMomentOfInertia=function(a){return 0};f.prototype.updateBoundingRadius=function(){this.boundingRadius=0};f.prototype.computeAABB=function(a,c,d){n.copy(a.lowerBound,c);n.copy(a.upperBound,c)}},{"../math/vec2":30,"./Shape":45}],44:[function(b,g,k){function f(a){a=a||{};a.type=m.PLANE;m.call(this,a)}var m=b("./Shape"),n=b("../math/vec2");b("../utils/Utils");
g.exports=f;f.prototype=new m;f.prototype.constructor=f;f.prototype.computeMomentOfInertia=function(a){return 0};f.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};f.prototype.computeAABB=function(a,c,d){d%=2*Math.PI;var b=n.set,e=Number.MAX_VALUE,h=a.lowerBound;a=a.upperBound;0===d?(b(h,-e,-e),b(a,e,0)):d===Math.PI/2?(b(h,0,-e),b(a,e,e)):d===Math.PI?(b(h,-e,0),b(a,e,e)):d===3*Math.PI/2?(b(h,-e,-e),b(a,0,e)):(b(h,-e,-e),b(a,e,e));n.add(h,h,c);n.add(a,a,c)};f.prototype.updateArea=
function(){this.area=Number.MAX_VALUE};var a=n.create();n.create();n.create();var c=n.create(),d=n.create();f.prototype.raycast=function(b,h,l,f){var e=h.from,q=h.to,g=h.direction;n.set(c,0,1);n.rotate(c,c,f);n.sub(d,e,l);f=n.dot(d,c);n.sub(d,q,l);var k=n.dot(d,c);0<f*k||n.squaredDistance(e,q)<f*f||(q=n.dot(c,g),n.sub(a,e,l),l=-n.dot(c,a)/q/h.length,h.reportIntersection(b,l,c,-1))}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(b,g,k){function f(b){b=b||{};this.body=null;this.position=
m.fromValues(0,0);b.position&&m.copy(this.position,b.position);this.angle=b.angle||0;this.type=b.type||0;this.id=f.idCounter++;this.boundingRadius=0;this.collisionGroup=void 0!==b.collisionGroup?b.collisionGroup:1;this.collisionResponse=void 0!==b.collisionResponse?b.collisionResponse:!0;this.collisionMask=void 0!==b.collisionMask?b.collisionMask:1;this.material=b.material||null;this.area=0;this.sensor=void 0!==b.sensor?b.sensor:!1;this.type&&this.updateBoundingRadius();this.updateArea()}g.exports=
f;var m=b("../math/vec2");f.idCounter=0;f.CIRCLE=1;f.PARTICLE=2;f.PLANE=4;f.CONVEX=8;f.LINE=16;f.BOX=32;Object.defineProperty(f,"RECTANGLE",{get:function(){console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead.");return f.BOX}});f.CAPSULE=64;f.HEIGHTFIELD=128;f.prototype.computeMomentOfInertia=function(b){};f.prototype.updateBoundingRadius=function(){};f.prototype.updateArea=function(){};f.prototype.computeAABB=function(b,a,c){};f.prototype.raycast=function(b,a,c,d){}},{"../math/vec2":30}],
46:[function(b,g,k){function f(a){m.call(this,a,m.GS);a=a||{};this.iterations=a.iterations||10;this.tolerance=a.tolerance||1E-7;this.arrayStep=30;this.lambda=new n.ARRAY_TYPE(this.arrayStep);this.Bs=new n.ARRAY_TYPE(this.arrayStep);this.invCs=new n.ARRAY_TYPE(this.arrayStep);this.useZeroRHS=!1;this.usedIterations=this.frictionIterations=0}b("../math/vec2");var m=b("./Solver"),n=b("../utils/Utils"),a=b("../equations/FrictionEquation");g.exports=f;f.prototype=new m;f.prototype.constructor=f;f.prototype.solve=
function(c,d){this.sortEquations();var b,h=this.iterations,l=this.frictionIterations,q=this.equations,g=q.length,k=Math.pow(this.tolerance*g,2),m=d.bodies,y=d.bodies.length,w=this.useZeroRHS,u=this.lambda;this.usedIterations=0;if(g)for(var x=0;x!==y;x++)b=m[x],b.updateSolveMassProperties();u.length<g&&(u=this.lambda=new n.ARRAY_TYPE(g+this.arrayStep),this.Bs=new n.ARRAY_TYPE(g+this.arrayStep),this.invCs=new n.ARRAY_TYPE(g+this.arrayStep));for(var z=u.length;z--;)u[z]=0;for(var z=this.invCs,D=this.Bs,
u=this.lambda,x=0;x!==q.length;x++){var A=q[x];if(A.timeStep!==c||A.needsUpdate)A.timeStep=c,A.update();D[x]=A.computeB(A.a,A.b,c);z[x]=A.computeInvC(A.epsilon)}var E;if(0!==g){for(x=0;x!==y;x++)b=m[x],b.resetConstraintVelocity();if(l){for(b=0;b!==l;b++){for(x=E=0;x!==g;x++)A=q[x],A=f.iterateEquation(x,A,A.epsilon,D,z,u,w,c,b),E+=Math.abs(A);this.usedIterations++;if(E*E<=k)break}f.updateMultipliers(q,u,1/c);for(x=0;x!==g;x++)if(l=q[x],l instanceof a){for(A=b=0;A!==l.contactEquations.length;A++)b+=
l.contactEquations[A].multiplier;b*=l.frictionCoefficient/l.contactEquations.length;l.maxForce=b;l.minForce=-b}}for(b=0;b!==h;b++){for(x=E=0;x!==g;x++)A=q[x],A=f.iterateEquation(x,A,A.epsilon,D,z,u,w,c,b),E+=Math.abs(A);this.usedIterations++;if(E*E<=k)break}for(x=0;x!==y;x++)m[x].addConstraintVelocity();f.updateMultipliers(q,u,1/c)}};f.updateMultipliers=function(a,d,b){for(var c=a.length;c--;)a[c].multiplier=d[c]*b};f.iterateEquation=function(a,d,b,h,l,f,g,k,n){var c=h[a],e=l[a];l=f[a];var q=d.computeGWlambda();
h=d.maxForce;n=d.minForce;g&&(c=0);b=e*(c-q-b*l);g=l+b;g<n*k?b=n*k-l:g>h*k&&(b=h*k-l);f[a]+=b;d.addToWlambda(b);return b}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(b,g,k){function f(a,c){a=a||{};m.call(this);this.type=c;this.equations=[];this.equationSortFunction=a.equationSortFunction||!1}b("../utils/Utils");var m=b("../events/EventEmitter");g.exports=f;f.prototype=new m;f.prototype.constructor=f;f.prototype.solve=function(a,c){throw Error("Solver.solve should be implemented by subclasses!");
};var n={bodies:[]};f.prototype.solveIsland=function(a,c){this.removeAllEquations();c.equations.length&&(this.addEquations(c.equations),n.bodies.length=0,c.getBodies(n.bodies),n.bodies.length&&this.solve(a,n))};f.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)};f.prototype.addEquation=function(a){a.enabled&&this.equations.push(a)};f.prototype.addEquations=function(a){for(var c=0,d=a.length;c!==d;c++){var b=a[c];b.enabled&&this.equations.push(b)}};
f.prototype.removeEquation=function(a){a=this.equations.indexOf(a);-1!==a&&this.equations.splice(a,1)};f.prototype.removeAllEquations=function(){this.equations.length=0};f.GS=1;f.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(b,g,k){function f(){n.apply(this,arguments)}var m=b("../equations/ContactEquation"),n=b("./Pool");g.exports=f;f.prototype=new n;f.prototype.constructor=f;f.prototype.create=function(){return new m};f.prototype.destroy=function(a){a.bodyA=a.bodyB=null;
return this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(b,g,k){function f(){n.apply(this,arguments)}var m=b("../equations/FrictionEquation"),n=b("./Pool");g.exports=f;f.prototype=new n;f.prototype.constructor=f;f.prototype.create=function(){return new m};f.prototype.destroy=function(a){a.bodyA=a.bodyB=null;return this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(b,g,k){function f(){n.apply(this,arguments)}var m=b("../world/IslandNode"),n=b("./Pool");g.exports=
f;f.prototype=new n;f.prototype.constructor=f;f.prototype.create=function(){return new m};f.prototype.destroy=function(a){a.reset();return this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(b,g,k){function f(){n.apply(this,arguments)}var m=b("../world/Island"),n=b("./Pool");g.exports=f;f.prototype=new n;f.prototype.constructor=f;f.prototype.create=function(){return new m};f.prototype.destroy=function(a){a.reset();return this}},{"../world/Island":58,"./Pool":55}],52:[function(b,g,k){function f(){this.overlappingShapesLastState=
new m;this.overlappingShapesCurrentState=new m;this.recordPool=new n({size:16});this.tmpDict=new m;this.tmpArray1=[]}var m=b("./TupleDictionary");b("./OverlapKeeperRecord");var n=b("./OverlapKeeperRecordPool");b("./Utils");g.exports=f;f.prototype.tick=function(){for(var a=this.overlappingShapesLastState,c=this.overlappingShapesCurrentState,d=a.keys.length;d--;){var b=a.keys[d],h=a.getByKey(b);c.getByKey(b);h&&this.recordPool.release(h)}a.reset();a.copy(c);c.reset()};f.prototype.setOverlapping=function(a,
c,d,b){var e=this.overlappingShapesCurrentState;if(!e.get(c.id,b.id)){var l=this.recordPool.get();l.set(a,c,d,b);e.set(c.id,b.id,l)}};f.prototype.getNewOverlaps=function(a){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,a)};f.prototype.getEndOverlaps=function(a){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,a)};f.prototype.bodiesAreOverlapping=function(a,c){for(var d=this.overlappingShapesCurrentState,b=d.keys.length;b--;){var h=
d.data[d.keys[b]];if(h.bodyA===a&&h.bodyB===c||h.bodyA===c&&h.bodyB===a)return!0}return!1};f.prototype.getDiff=function(a,c,d){d=d||[];d.length=0;for(var b=c.keys.length;b--;){var h=c.keys[b],l=c.data[h];if(!l)throw Error("Key "+h+" had no data!");a.data[h]||d.push(l)}return d};f.prototype.isNewOverlap=function(a,c){var d=a.id|0,b=c.id|0,h=this.overlappingShapesCurrentState;return!this.overlappingShapesLastState.get(d,b)&&!!h.get(d,b)};f.prototype.getNewBodyOverlaps=function(a){this.tmpArray1.length=
0;var c=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(c,a)};f.prototype.getEndBodyOverlaps=function(a){this.tmpArray1.length=0;var c=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(c,a)};f.prototype.getBodyDiff=function(a,c){c=c||[];for(var d=this.tmpDict,b=a.length;b--;){var h=a[b];d.set(h.bodyA.id|0,h.bodyB.id|0,h)}for(b=d.keys.length;b--;)(h=d.getByKey(d.keys[b]))&&c.push(h.bodyA,h.bodyB);d.reset();return c}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,
"./TupleDictionary":56,"./Utils":57}],53:[function(b,g,k){function f(b,f,a,c){this.shapeA=f;this.shapeB=c;this.bodyA=b;this.bodyB=a}g.exports=f;f.prototype.set=function(b,g,a,c){f.call(this,b,g,a,c)}},{}],54:[function(b,g,k){function f(){n.apply(this,arguments)}var m=b("./OverlapKeeperRecord"),n=b("./Pool");g.exports=f;f.prototype=new n;f.prototype.constructor=f;f.prototype.create=function(){return new m};f.prototype.destroy=function(a){a.bodyA=a.bodyB=a.shapeA=a.shapeB=null;return this}},{"./OverlapKeeperRecord":53,
"./Pool":55}],55:[function(b,g,k){function f(b){b=b||{};this.objects=[];void 0!==b.size&&this.resize(b.size)}g.exports=f;f.prototype.resize=function(b){for(var f=this.objects;f.length>b;)f.pop();for(;f.length<b;)f.push(this.create());return this};f.prototype.get=function(){var b=this.objects;return b.length?b.pop():this.create()};f.prototype.release=function(b){this.destroy(b);this.objects.push(b);return this}},{}],56:[function(b,g,k){function f(){this.data={};this.keys=[]}var m=b("./Utils");g.exports=
f;f.prototype.getKey=function(b,a){b|=0;a|=0;return(b|0)===(a|0)?-1:((b|0)>(a|0)?b<<16|a&65535:a<<16|b&65535)|0};f.prototype.getByKey=function(b){return this.data[b|0]};f.prototype.get=function(b,a){return this.data[this.getKey(b,a)]};f.prototype.set=function(b,a,c){if(!c)throw Error("No data!");b=this.getKey(b,a);this.data[b]||this.keys.push(b);this.data[b]=c;return b};f.prototype.reset=function(){for(var b=this.data,a=this.keys,c=a.length;c--;)delete b[a[c]];a.length=0};f.prototype.copy=function(b){this.reset();
m.appendArray(this.keys,b.keys);for(var a=b.keys.length;a--;){var c=b.keys[a];this.data[c]=b.data[c]}}},{"./Utils":57}],57:[function(b,g,k){function f(){}g.exports=f;f.appendArray=function(b,f){if(15E4>f.length)b.push.apply(b,f);else for(var a=0,c=f.length;a!==c;++a)b.push(f[a])};f.splice=function(b,f,a){a=a||1;for(var c=b.length-a;f<c;f++)b[f]=b[f+a];b.length=c};f.ARRAY_TYPE="undefined"!==typeof P2_ARRAY_TYPE?P2_ARRAY_TYPE:"undefined"!==typeof Float32Array?Float32Array:Array;f.extend=function(b,
f){for(var a in f)b[a]=f[a]};f.defaults=function(b,f){b=b||{};for(var a in f)a in b||(b[a]=f[a]);return b}},{}],58:[function(b,g,k){function f(){this.equations=[];this.bodies=[]}var m=b("../objects/Body");g.exports=f;f.prototype.reset=function(){this.equations.length=this.bodies.length=0};var n=[];f.prototype.getBodies=function(a){a=a||[];for(var c=this.equations,b=n.length=0;b!==c.length;b++){var e=c[b];-1===n.indexOf(e.bodyA.id)&&(a.push(e.bodyA),n.push(e.bodyA.id));-1===n.indexOf(e.bodyB.id)&&
(a.push(e.bodyB),n.push(e.bodyB.id))}return a};f.prototype.wantsToSleep=function(){for(var a=0;a<this.bodies.length;a++){var c=this.bodies[a];if(c.type===m.DYNAMIC&&!c.wantsToSleep)return!1}return!0};f.prototype.sleep=function(){for(var a=0;a<this.bodies.length;a++)this.bodies[a].sleep();return!0}},{"../objects/Body":31}],59:[function(b,g,k){function f(a){this.nodePool=new m({size:16});this.islandPool=new n({size:8});this.equations=[];this.islands=[];this.nodes=[];this.queue=[]}b("../math/vec2");
b("./Island");b("./IslandNode");var m=b("./../utils/IslandNodePool"),n=b("./../utils/IslandPool"),a=b("../objects/Body");g.exports=f;f.getUnvisitedNode=function(c){for(var b=c.length,e=0;e!==b;e++){var h=c[e];if(!h.visited&&h.body.type===a.DYNAMIC)return h}return!1};f.prototype.visit=function(a,b,e){b.push(a.body);b=a.equations.length;for(var c=0;c!==b;c++){var d=a.equations[c];-1===e.indexOf(d)&&e.push(d)}};f.prototype.bfs=function(c,b,e){var d=this.queue;d.length=0;d.push(c);c.visited=!0;for(this.visit(c,
b,e);d.length;){c=d.pop();for(var l;l=f.getUnvisitedNode(c.neighbors);)l.visited=!0,this.visit(l,b,e),l.body.type===a.DYNAMIC&&d.push(l)}};f.prototype.split=function(a){var c=a.bodies;a=this.nodes;for(var b=this.equations;a.length;)this.nodePool.release(a.pop());for(var h=0;h!==c.length;h++){var l=this.nodePool.get();l.body=c[h];a.push(l)}for(l=0;l!==b.length;l++){var q=b[l],h=c.indexOf(q.bodyA),g=c.indexOf(q.bodyB),h=a[h],g=a[g];h.neighbors.push(g);g.neighbors.push(h);h.equations.push(q);g.equations.push(q)}c=
this.islands;for(h=0;h<c.length;h++)this.islandPool.release(c[h]);for(c.length=0;b=f.getUnvisitedNode(a);)h=this.islandPool.get(),this.bfs(b,h.bodies,h.equations),c.push(h);return c}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(b,g,k){function f(b){this.body=b;this.neighbors=[];this.equations=[];this.visited=!1}g.exports=f;f.prototype.reset=function(){this.equations.length=0;this.neighbors.length=
0;this.visited=!1;this.body=null}},{}],61:[function(b,g,k){function f(a){l.apply(this);a=a||{};this.springs=[];this.bodies=[];this.disabledBodyCollisionPairs=[];this.solver=a.solver||new m;this.narrowphase=new y(this);this.islandManager=new x;this.gravity=n.fromValues(0,-9.78);a.gravity&&n.copy(this.gravity,a.gravity);this.frictionGravity=n.length(this.gravity)||10;this.useFrictionGravityOnZeroGravity=this.useWorldGravityAsFrictionGravity=!0;this.broadphase=a.broadphase||new r;this.broadphase.setWorld(this);
this.constraints=[];this.defaultMaterial=new t;this.defaultContactMaterial=new v(this.defaultMaterial,this.defaultMaterial);this.lastTimeStep=1/60;this.solveConstraints=this.applyGravity=this.applyDamping=this.applySpringForces=!0;this.contactMaterials=[];this.accumulator=this.time=0;this.stepping=!1;this.bodiesToBeRemoved=[];this.islandSplit="undefined"!==typeof a.islandSplit?!!a.islandSplit:!0;this.emitImpactEvent=!0;this._bodyIdCounter=this._constraintIdCounter=0;this.postStepEvent={type:"postStep"};
this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null};this.addSpringEvent={type:"addSpring",spring:null};this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null};this.postBroadphaseEvent={type:"postBroadphase",pairs:null};this.sleepMode=f.NO_SLEEPING;this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]};this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,
bodyA:null,bodyB:null};this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null};this.overlappingShapesLastState={keys:[]};this.overlappingShapesCurrentState={keys:[]};this.overlapKeeper=new u}var m=b("../solver/GSSolver");b("../solver/Solver");b("../collision/Ray");var n=b("../math/vec2"),a=b("../shapes/Circle"),c=b("../shapes/Convex");b("../shapes/Line");var d=b("../shapes/Plane"),e=b("../shapes/Capsule"),h=b("../shapes/Particle"),l=b("../events/EventEmitter"),q=b("../objects/Body");
b("../shapes/Shape");b("../objects/LinearSpring");var t=b("../material/Material"),v=b("../material/ContactMaterial");b("../constraints/DistanceConstraint");b("../constraints/Constraint");b("../constraints/LockConstraint");b("../constraints/RevoluteConstraint");b("../constraints/PrismaticConstraint");b("../constraints/GearConstraint");b("../../package.json");b("../collision/Broadphase");k=b("../collision/AABB");var r=b("../collision/SAPBroadphase"),y=b("../collision/Narrowphase"),w=b("../utils/Utils"),
u=b("../utils/OverlapKeeper"),x=b("./IslandManager");b("../objects/RotationalSpring");g.exports=f;f.prototype=Object(l.prototype);f.prototype.constructor=f;f.NO_SLEEPING=1;f.BODY_SLEEPING=2;f.ISLAND_SLEEPING=4;f.prototype.addConstraint=function(a){this.constraints.push(a)};f.prototype.addContactMaterial=function(a){this.contactMaterials.push(a)};f.prototype.removeContactMaterial=function(a){a=this.contactMaterials.indexOf(a);-1!==a&&w.splice(this.contactMaterials,a,1)};f.prototype.getContactMaterial=
function(a,c){for(var b=this.contactMaterials,d=0,e=b.length;d!==e;d++){var h=b[d];if(h.materialA.id===a.id&&h.materialB.id===c.id||h.materialA.id===c.id&&h.materialB.id===a.id)return h}return!1};f.prototype.removeConstraint=function(a){a=this.constraints.indexOf(a);-1!==a&&w.splice(this.constraints,a,1)};n.create();n.create();n.create();n.create();n.create();n.create();var z=n.create(),D=n.fromValues(0,0),A=n.fromValues(0,0);n.fromValues(0,0);n.fromValues(0,0);f.prototype.step=function(a,c,b){b=
b||10;c=c||0;if(0===c)this.internalStep(a),this.time+=a;else{this.accumulator+=c;for(c=0;this.accumulator>=a&&c<b;)this.internalStep(a),this.time+=a,this.accumulator-=a,c++;a=this.accumulator%a/a;for(b=0;b!==this.bodies.length;b++)c=this.bodies[b],n.lerp(c.interpolatedPosition,c.previousPosition,c.position,a),c.interpolatedAngle=c.previousAngle+a*(c.angle-c.previousAngle)}};var E=[];f.prototype.internalStep=function(a){this.stepping=!0;var c=this.springs.length,b=this.springs,d=this.bodies,e=this.gravity,
h=this.solver,l=this.bodies.length,g=this.broadphase,t=this.narrowphase,k=this.constraints,m=n.add,v=this.islandManager;this.overlapKeeper.tick();this.lastTimeStep=a;if(this.useWorldGravityAsFrictionGravity){var r=n.length(this.gravity);0===r&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=r)}if(this.applyGravity)for(r=0;r!==l;r++){var y=d[r],u=y.force;y.type===q.DYNAMIC&&y.sleepState!==q.SLEEPING&&(n.scale(z,e,y.mass*y.gravityScale),m(u,u,z))}if(this.applySpringForces)for(r=0;r!==c;r++)b[r].applyForce();
if(this.applyDamping)for(r=0;r!==l;r++)y=d[r],y.type===q.DYNAMIC&&y.applyDamping(a);c=g.getCollisionPairs(this);e=this.disabledBodyCollisionPairs;for(r=e.length-2;0<=r;r-=2)for(b=c.length-2;0<=b;b-=2)(e[r]===c[b]&&e[r+1]===c[b+1]||e[r+1]===c[b]&&e[r]===c[b+1])&&c.splice(b,2);e=k.length;for(r=0;r!==e;r++)if(g=k[r],!g.collideConnected)for(b=c.length-2;0<=b;b-=2)(g.bodyA===c[b]&&g.bodyB===c[b+1]||g.bodyB===c[b]&&g.bodyA===c[b+1])&&c.splice(b,2);this.postBroadphaseEvent.pairs=c;this.emit(this.postBroadphaseEvent);
this.postBroadphaseEvent.pairs=null;t.reset(this);r=0;for(e=c.length;r!==e;r+=2)for(g=c[r],m=c[r+1],y=0,u=g.shapes.length;y!==u;y++)for(var B=g.shapes[y],x=B.position,A=B.angle,b=0,D=m.shapes.length;b!==D;b++){var C=m.shapes[b],F=C.position,H=C.angle,I=this.defaultContactMaterial;if(B.material&&C.material){var ia=this.getContactMaterial(B.material,C.material);ia&&(I=ia)}this.runNarrowphase(t,g,B,x,A,m,C,F,H,I,this.frictionGravity)}for(r=0;r!==l;r++)c=d[r],c._wakeUpAfterNarrowphase&&(c.wakeUp(),c._wakeUpAfterNarrowphase=
!1);if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(E);r=this.endContactEvent;for(b=E.length;b--;)c=E[b],r.shapeA=c.shapeA,r.shapeB=c.shapeB,r.bodyA=c.bodyA,r.bodyB=c.bodyB,this.emit(r);E.length=0}r=this.preSolveEvent;r.contactEquations=t.contactEquations;r.frictionEquations=t.frictionEquations;this.emit(r);r.contactEquations=r.frictionEquations=null;e=k.length;for(r=0;r!==e;r++)k[r].update();if(t.contactEquations.length||t.frictionEquations.length||e)if(this.islandSplit){v.equations.length=
0;w.appendArray(v.equations,t.contactEquations);w.appendArray(v.equations,t.frictionEquations);for(r=0;r!==e;r++)w.appendArray(v.equations,k[r].equations);v.split(this);for(r=0;r!==v.islands.length;r++)k=v.islands[r],k.equations.length&&h.solveIsland(a,k)}else{h.addEquations(t.contactEquations);h.addEquations(t.frictionEquations);for(r=0;r!==e;r++)h.addEquations(k[r].equations);this.solveConstraints&&h.solve(a,this);h.removeAllEquations()}for(r=0;r!==l;r++)c=d[r],c.integrate(a);for(r=0;r!==l;r++)d[r].setZeroForce();
if(this.emitImpactEvent&&this.has("impact"))for(h=this.impactEvent,r=0;r!==t.contactEquations.length;r++)v=t.contactEquations[r],v.firstImpact&&(h.bodyA=v.bodyA,h.bodyB=v.bodyB,h.shapeA=v.shapeA,h.shapeB=v.shapeB,h.contactEquation=v,this.emit(h));if(this.sleepMode===f.BODY_SLEEPING)for(r=0;r!==l;r++)d[r].sleepTick(this.time,!1,a);else if(this.sleepMode===f.ISLAND_SLEEPING&&this.islandSplit){for(r=0;r!==l;r++)d[r].sleepTick(this.time,!0,a);for(r=0;r<this.islandManager.islands.length;r++)k=this.islandManager.islands[r],
k.wantsToSleep()&&k.sleep()}this.stepping=!1;a=this.bodiesToBeRemoved;for(r=0;r!==a.length;r++)this.removeBody(a[r]);a.length=0;this.emit(this.postStepEvent)};f.prototype.runNarrowphase=function(a,c,b,d,e,h,l,f,g,t,k){if(0!==(b.collisionGroup&l.collisionMask)&&0!==(l.collisionGroup&b.collisionMask)&&(n.rotate(D,d,c.angle),n.rotate(A,f,h.angle),n.add(D,D,c.position),n.add(A,A,h.position),d=e+c.angle,g+=h.angle,a.enableFriction=0<t.friction,a.frictionCoefficient=t.friction,a.slipForce=t.friction*k*
(c.type===q.STATIC||c.type===q.KINEMATIC?h.mass:h.type===q.STATIC||h.type===q.KINEMATIC?c.mass:c.mass*h.mass/(c.mass+h.mass)),a.restitution=t.restitution,a.surfaceVelocity=t.surfaceVelocity,a.frictionStiffness=t.frictionStiffness,a.frictionRelaxation=t.frictionRelaxation,a.stiffness=t.stiffness,a.relaxation=t.relaxation,a.contactSkinSize=t.contactSkinSize,a.enabledEquations=c.collisionResponse&&h.collisionResponse&&b.collisionResponse&&l.collisionResponse,k=a[b.type|l.type])&&(e=b.sensor||l.sensor,
t=a.frictionEquations.length,k=b.type<l.type?k.call(a,c,b,D,d,h,l,A,g,e):k.call(a,h,l,A,g,c,b,D,d,e),t=a.frictionEquations.length-t,k)){c.allowSleep&&c.type===q.DYNAMIC&&c.sleepState===q.SLEEPING&&h.sleepState===q.AWAKE&&h.type!==q.STATIC&&n.squaredLength(h.velocity)+Math.pow(h.angularVelocity,2)>=2*Math.pow(h.sleepSpeedLimit,2)&&(c._wakeUpAfterNarrowphase=!0);h.allowSleep&&h.type===q.DYNAMIC&&h.sleepState===q.SLEEPING&&c.sleepState===q.AWAKE&&c.type!==q.STATIC&&n.squaredLength(c.velocity)+Math.pow(c.angularVelocity,
2)>=2*Math.pow(c.sleepSpeedLimit,2)&&(h._wakeUpAfterNarrowphase=!0);this.overlapKeeper.setOverlapping(c,b,h,l);if(this.has("beginContact")&&this.overlapKeeper.isNewOverlap(b,l)){d=this.beginContactEvent;d.shapeA=b;d.shapeB=l;d.bodyA=c;d.bodyB=h;d.contactEquations.length=0;if("number"===typeof k)for(c=a.contactEquations.length-k;c<a.contactEquations.length;c++)d.contactEquations.push(a.contactEquations[c]);this.emit(d)}if("number"===typeof k&&1<t)for(c=a.frictionEquations.length-t;c<a.frictionEquations.length;c++)b=
a.frictionEquations[c],b.setSlipForce(b.getSlipForce()/t)}};f.prototype.addSpring=function(a){this.springs.push(a);var c=this.addSpringEvent;c.spring=a;this.emit(c);c.spring=null};f.prototype.removeSpring=function(a){a=this.springs.indexOf(a);-1!==a&&w.splice(this.springs,a,1)};f.prototype.addBody=function(a){if(-1===this.bodies.indexOf(a)){this.bodies.push(a);a.world=this;var c=this.addBodyEvent;c.body=a;this.emit(c);c.body=null}};f.prototype.removeBody=function(a){if(this.stepping)this.bodiesToBeRemoved.push(a);
else{a.world=null;var c=this.bodies.indexOf(a);-1!==c&&(w.splice(this.bodies,c,1),this.removeBodyEvent.body=a,a.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}};f.prototype.getBodyById=function(a){for(var c=this.bodies,b=0;b<c.length;b++){var d=c[b];if(d.id===a)return d}return!1};f.prototype.disableBodyCollision=function(a,c){this.disabledBodyCollisionPairs.push(a,c)};f.prototype.enableBodyCollision=function(a,c){for(var b=this.disabledBodyCollisionPairs,
d=0;d<b.length;d+=2)if(b[d]===a&&b[d+1]===c||b[d+1]===a&&b[d]===c){b.splice(d,2);break}};f.prototype.clear=function(){this.time=0;this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var a=this.constraints,c=a.length-1;0<=c;c--)this.removeConstraint(a[c]);a=this.bodies;for(c=a.length-1;0<=c;c--)this.removeBody(a[c]);a=this.springs;for(c=a.length-1;0<=c;c--)this.removeSpring(a[c]);a=this.contactMaterials;for(c=a.length-1;0<=c;c--)this.removeContactMaterial(a[c]);f.apply(this)};
var C=n.create();n.fromValues(0,0);var F=n.fromValues(0,0);f.prototype.hitTest=function(b,l,f){f=f||0;var g=new q({position:b}),t=new h;g.addShape(t);for(var k=this.narrowphase,r=[],m=0,v=l.length;m!==v;m++)for(var y=l[m],w=0,u=y.shapes.length;w!==u;w++){var x=y.shapes[w];n.rotate(C,x.position,y.angle);n.add(C,C,y.position);var z=x.angle+y.angle;(x instanceof a&&k.circleParticle(y,x,C,z,g,t,b,0,!0)||x instanceof c&&k.particleConvex(g,t,b,0,y,x,C,z,!0)||x instanceof d&&k.particlePlane(g,t,b,0,y,x,
C,z,!0)||x instanceof e&&k.particleCapsule(g,t,b,0,y,x,C,z,!0)||x instanceof h&&n.squaredLength(n.sub(F,C,b))<f*f)&&r.push(y)}return r};f.prototype.setGlobalStiffness=function(a){for(var c=this.constraints,b=0;b!==c.length;b++)for(var d=c[b],e=0;e!==d.equations.length;e++){var h=d.equations[e];h.stiffness=a;h.needsUpdate=!0}c=this.contactMaterials;for(b=0;b!==c.length;b++)d=c[b],d.stiffness=d.frictionStiffness=a;d=this.defaultContactMaterial;d.stiffness=d.frictionStiffness=a};f.prototype.setGlobalRelaxation=
function(a){for(var c=0;c!==this.constraints.length;c++)for(var b=this.constraints[c],d=0;d!==b.equations.length;d++){var e=b.equations[d];e.relaxation=a;e.needsUpdate=!0}for(c=0;c!==this.contactMaterials.length;c++)b=this.contactMaterials[c],b.relaxation=b.frictionRelaxation=a;b=this.defaultContactMaterial;b.relaxation=b.frictionRelaxation=a};var I=new k,H=[];f.prototype.raycast=function(a,c){c.getAABB(I);this.broadphase.aabbQuery(this,I,H);c.intersectBodies(a,H);H.length=0;return a.hasHit()}},{"../../package.json":6,
"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,
"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)});
(function(){var p=p||{};p.game=null;p.WEBGL_RENDERER=0;p.CANVAS_RENDERER=1;p.VERSION="v2.2.9";p._UID=0;"undefined"!=typeof Float32Array?(p.Float32Array=Float32Array,p.Uint16Array=Uint16Array,p.Uint32Array=Uint32Array,p.ArrayBuffer=ArrayBuffer):(p.Float32Array=Array,p.Uint16Array=Array);p.PI_2=2*Math.PI;p.RAD_TO_DEG=180/Math.PI;p.DEG_TO_RAD=Math.PI/180;p.RETINA_PREFIX="@2x";p.DisplayObject=function(){this.position=new p.Point(0,0);this.scale=new p.Point(1,1);this.skew=new p.Point(0,0);this.pivot=new p.Point(0,
0);this.rotation=0;this.alpha=1;this.visible=!0;this.hitArea=null;this.renderable=!1;this.parent=null;this.worldAlpha=1;this.worldTransform=new p.Matrix;this.worldPosition=new p.Point(0,0);this.worldScale=new p.Point(1,1);this.worldRotation=0;this.filterArea=null;this._sr=0;this._cr=1;this._bounds=new p.Rectangle(0,0,0,0);this._mask=this._currentBounds=null;this._cacheIsDirty=this._cacheAsBitmap=!1};p.DisplayObject.prototype.constructor=p.DisplayObject;p.DisplayObject.prototype={destroy:function(){if(this.children){for(var b=
this.children.length;b--;)this.children[b].destroy();this.children=[]}this.filterArea=this.worldTransform=this.parent=this.hitArea=null;this.renderable=!1;this._mask=this._currentBounds=this._bounds=null;this._destroyCachedSprite()},updateTransform:function(b){if(!b&&!this.parent&&!this.game)return this;var g=this.parent;b?g=b:this.parent||(g=this.game.world);b=g.worldTransform;var k=this.worldTransform,f,m,n,a,c,d;if(this.skew.x||this.skew.y)null==f&&(f=new p.Matrix),f.setTransform(this.position.x,
this.position.y,this.pivot.x,this.pivot.y,this.scale.x,this.scale.y,this.rotation,this.skew.x,this.skew.y),k.a=f.a*b.a+f.b*b.c,k.b=f.a*b.b+f.b*b.d,k.c=f.c*b.a+f.d*b.c,k.d=f.c*b.b+f.d*b.d,k.tx=f.tx*b.a+f.ty*b.c+b.tx,k.ty=f.tx*b.b+f.ty*b.d+b.ty;else{if(this.rotation%p.PI_2){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));f=this._cr*this.scale.x;m=this._sr*this.scale.x;n=-this._sr*this.scale.y;a=this._cr*this.scale.y;
c=this.position.x;d=this.position.y;if(this.pivot.x||this.pivot.y)c-=this.pivot.x*f+this.pivot.y*n,d-=this.pivot.x*m+this.pivot.y*a;k.a=f*b.a+m*b.c;k.b=f*b.b+m*b.d;k.c=n*b.a+a*b.c;k.d=n*b.b+a*b.d}else f=this.scale.x,a=this.scale.y,c=this.position.x-this.pivot.x*f,d=this.position.y-this.pivot.y*a,k.a=f*b.a,k.b=f*b.b,k.c=a*b.c,k.d=a*b.d;k.tx=c*b.a+d*b.c+b.tx;k.ty=c*b.b+d*b.d+b.ty}this.worldAlpha=this.alpha*g.worldAlpha;this.worldPosition.set(k.tx,k.ty);this.worldScale.set(this.scale.x*Math.sqrt(k.a*
k.a+k.c*k.c),this.scale.y*Math.sqrt(k.b*k.b+k.d*k.d));this.worldRotation=Math.atan2(-k.c,k.d);this._currentBounds=null;this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,k,b);return this},preUpdate:function(){},generateTexture:function(b,g,k){var f=this.getLocalBounds();b=new p.RenderTexture(f.width|0,f.height|0,k,g,b);p.DisplayObject._tempMatrix.tx=-f.x;p.DisplayObject._tempMatrix.ty=-f.y;b.render(this,p.DisplayObject._tempMatrix);return b},updateCache:function(){this._generateCachedSprite();
return this},toGlobal:function(b){this.updateTransform();return this.worldTransform.apply(b)},toLocal:function(b,g){g&&(b=g.toGlobal(b));this.updateTransform();return this.worldTransform.applyInverse(b)},_renderCachedSprite:function(b){this._cachedSprite.worldAlpha=this.worldAlpha;b.gl?p.Sprite.prototype._renderWebGL.call(this._cachedSprite,b):p.Sprite.prototype._renderCanvas.call(this._cachedSprite,b)},_generateCachedSprite:function(){this._cacheAsBitmap=!1;var b=this.getLocalBounds();b.width=Math.max(1,
Math.ceil(b.width));b.height=Math.max(1,Math.ceil(b.height));this.updateTransform();if(this._cachedSprite)this._cachedSprite.texture.resize(b.width,b.height);else{var g=new p.RenderTexture(b.width,b.height);this._cachedSprite=new p.Sprite(g);this._cachedSprite.worldTransform=this.worldTransform}g=this._filters;this._filters=null;this._cachedSprite.filters=g;p.DisplayObject._tempMatrix.tx=-b.x;p.DisplayObject._tempMatrix.ty=-b.y;this._cachedSprite.texture.render(this,p.DisplayObject._tempMatrix,!0);
this._cachedSprite.anchor.x=-(b.x/b.width);this._cachedSprite.anchor.y=-(b.y/b.height);this._filters=g;this._cacheAsBitmap=!0},_destroyCachedSprite:function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)}};p.DisplayObject.prototype.displayObjectUpdateTransform=p.DisplayObject.prototype.updateTransform;Object.defineProperties(p.DisplayObject.prototype,{x:{get:function(){return this.position.x},set:function(b){this.position.x=b}},y:{get:function(){return this.position.y},
set:function(b){this.position.y=b}},worldVisible:{get:function(){if(this.visible){var b=this.parent;if(b){do{if(!b.visible)return!1;b=b.parent}while(b)}else return this.visible;return!0}return!1}},mask:{get:function(){return this._mask},set:function(b){this._mask&&(this._mask.isMask=!1);if(this._mask=b)this._mask.isMask=!0}},filters:{get:function(){return this._filters},set:function(b){if(Array.isArray(b)){for(var g=[],k=0;k<b.length;k++)for(var f=b[k].passes,m=0;m<f.length;m++)g.push(f[m]);this._filterBlock=
{target:this,filterPasses:g}}this._filters=b;this.blendMode&&this.blendMode===p.blendModes.MULTIPLY&&(this.blendMode=p.blendModes.NORMAL)}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(b){this._cacheAsBitmap!==b&&(b?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=b)}}});p.DisplayObjectContainer=function(){p.DisplayObject.call(this);this.children=[];this.ignoreChildInput=!1};p.DisplayObjectContainer.prototype=Object.create(p.DisplayObject.prototype);
p.DisplayObjectContainer.prototype.constructor=p.DisplayObjectContainer;p.DisplayObjectContainer.prototype.addChild=function(b){return this.addChildAt(b,this.children.length)};p.DisplayObjectContainer.prototype.addChildAt=function(b,g){if(0<=g&&g<=this.children.length)return b.parent&&b.parent.removeChild(b),b.parent=this,this.children.splice(g,0,b),b;throw Error(b+"addChildAt: The index "+g+" supplied is out of bounds "+this.children.length);};p.DisplayObjectContainer.prototype.swapChildren=function(b,
g){if(b!==g){var k=this.getChildIndex(b),f=this.getChildIndex(g);if(0>k||0>f)throw Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[k]=g;this.children[f]=b}};p.DisplayObjectContainer.prototype.getChildIndex=function(b){b=this.children.indexOf(b);if(-1===b)throw Error("The supplied DisplayObject must be a child of the caller");return b};p.DisplayObjectContainer.prototype.setChildIndex=function(b,g){if(0>g||g>=this.children.length)throw Error("The supplied index is out of bounds");
var k=this.getChildIndex(b);this.children.splice(k,1);this.children.splice(g,0,b)};p.DisplayObjectContainer.prototype.getChildAt=function(b){if(0>b||b>=this.children.length)throw Error("getChildAt: Supplied index "+b+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[b]};p.DisplayObjectContainer.prototype.removeChild=function(b){b=this.children.indexOf(b);if(-1!==b)return this.removeChildAt(b)};p.DisplayObjectContainer.prototype.removeChildAt=
function(b){var g=this.getChildAt(b);g&&(g.parent=void 0,this.children.splice(b,1));return g};p.DisplayObjectContainer.prototype.removeChildren=function(b,g){void 0===b&&(b=0);void 0===g&&(g=this.children.length);var k=g-b;if(0<k&&k<=g){for(var k=this.children.splice(begin,k),f=0;f<k.length;f++)k[f].parent=void 0;return k}if(0===k&&0===this.children.length)return[];throw Error("removeChildren: Range Error, numeric values are outside the acceptable range");};p.DisplayObjectContainer.prototype.updateTransform=
function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var b=0;b<this.children.length;b++)this.children[b].updateTransform()};p.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=p.DisplayObjectContainer.prototype.updateTransform;p.DisplayObjectContainer.prototype.getBounds=function(b){var g=b&&b instanceof p.DisplayObject,k=!0;g?k=b instanceof p.DisplayObjectContainer?b.contains(this):!1:b=this;var f;if(g){var m=b.worldTransform;b.worldTransform=
p.identityMatrix;for(f=0;f<b.children.length;f++)b.children[f].updateTransform()}var n=Infinity,a=Infinity,c=-Infinity,d=-Infinity,e,h,l=!1;for(f=0;f<this.children.length;f++)this.children[f].visible&&(l=!0,e=this.children[f].getBounds(),n=n<e.x?n:e.x,a=a<e.y?a:e.y,h=e.width+e.x,e=e.height+e.y,c=c>h?c:h,d=d>e?d:e);h=this._bounds;if(!l){h=new p.Rectangle;var q=h.x,c=h.width+h.x,d=h.y,l=h.height+h.y;f=this.worldTransform;var t=f.a,v=f.b,r=f.c,y=f.d,w=f.tx,u=f.ty,n=t*c+r*l+w,a=y*l+v*c+u;f=t*q+r*l+w;
l=y*l+v*q+u;e=t*q+r*d+w;q=y*d+v*q+u;t=t*c+r*d+w;v=y*d+v*c+u;c=n;d=a;n=f<n?f:n;n=e<n?e:n;n=t<n?t:n;a=l<a?l:a;a=q<a?q:a;a=v<a?v:a;c=f>c?f:c;c=e>c?e:c;c=t>c?t:c;d=l>d?l:d;d=q>d?q:d;d=v>d?v:d}h.x=n;h.y=a;h.width=c-n;h.height=d-a;if(g)for(b.worldTransform=m,f=0;f<b.children.length;f++)b.children[f].updateTransform();k||(b=b.getBounds(),h.x-=b.x,h.y-=b.y);return h};p.DisplayObjectContainer.prototype.getLocalBounds=function(){return this.getBounds(this)};p.DisplayObjectContainer.prototype.contains=function(b){return b?
b===this?!0:this.contains(b.parent):!1};p.DisplayObjectContainer.prototype._renderWebGL=function(b){if(this.visible&&!(0>=this.alpha))if(this._cacheAsBitmap)this._renderCachedSprite(b);else{var g;if(this._mask||this._filters){this._filters&&(b.spriteBatch.flush(),b.filterManager.pushFilter(this._filterBlock));this._mask&&(b.spriteBatch.stop(),b.maskManager.pushMask(this.mask,b),b.spriteBatch.start());for(g=0;g<this.children.length;g++)this.children[g]._renderWebGL(b);b.spriteBatch.stop();this._mask&&
b.maskManager.popMask(this._mask,b);this._filters&&b.filterManager.popFilter();b.spriteBatch.start()}else for(g=0;g<this.children.length;g++)this.children[g]._renderWebGL(b)}};p.DisplayObjectContainer.prototype._renderCanvas=function(b){if(!1!==this.visible&&0!==this.alpha)if(this._cacheAsBitmap)this._renderCachedSprite(b);else{this._mask&&b.maskManager.pushMask(this._mask,b);for(var g=0;g<this.children.length;g++)this.children[g]._renderCanvas(b);this._mask&&b.maskManager.popMask(b)}};Object.defineProperty(p.DisplayObjectContainer.prototype,
"width",{get:function(){return this.getLocalBounds().width*this.scale.x},set:function(b){var g=this.getLocalBounds().width;this.scale.x=0!==g?b/g:1;this._width=b}});Object.defineProperty(p.DisplayObjectContainer.prototype,"height",{get:function(){return this.getLocalBounds().height*this.scale.y},set:function(b){var g=this.getLocalBounds().height;this.scale.y=0!==g?b/g:1;this._height=b}});p.Sprite=function(b){p.DisplayObjectContainer.call(this);this.anchor=new p.Point;this.texture=b||p.Texture.emptyTexture;
this._height=this._width=0;this.tint=16777215;this.cachedTint=-1;this.tintedTexture=null;this.blendMode=p.blendModes.NORMAL;this.shader=null;this.exists=!0;if(this.texture.baseTexture.hasLoaded)this.onTextureUpdate();this.renderable=!0};p.Sprite.prototype=Object.create(p.DisplayObjectContainer.prototype);p.Sprite.prototype.constructor=p.Sprite;Object.defineProperty(p.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(b){this.scale.x=b/this.texture.frame.width;
this._width=b}});Object.defineProperty(p.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(b){this.scale.y=b/this.texture.frame.height;this._height=b}});p.Sprite.prototype.setTexture=function(b,g){void 0!==g&&this.texture.baseTexture.destroy();this.texture.baseTexture.skipRender=!1;this.texture=b;this.texture.valid=!0;this.cachedTint=-1};p.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width);
this._height&&(this.scale.y=this._height/this.texture.frame.height)};p.Sprite.prototype.getBounds=function(b){var g=this.texture.frame.width,k=this.texture.frame.height,f=g*(1-this.anchor.x),g=g*-this.anchor.x,m=k*(1-this.anchor.y),n=k*-this.anchor.y,k=b||this.worldTransform,a=k.a,c=k.b,d=k.c;b=k.d;var e=k.tx,h=k.ty,l=k=-Infinity,q=Infinity,t=Infinity;if(0===c&&0===d)0>a&&(a*=-1,k=f,f=-g,g=-k),0>b&&(b*=-1,k=m,m=-n,n=-k),q=a*g+e,k=a*f+e,t=b*n+h,l=b*m+h;else var v=a*g+d*n+e,r=b*n+c*g+h,p=a*f+d*n+e,
n=b*n+c*f+h,w=a*f+d*m+e,f=b*m+c*f+h,a=a*g+d*m+e,g=b*m+c*g+h,q=v<q?v:q,q=p<q?p:q,q=w<q?w:q,q=a<q?a:q,t=r<t?r:t,t=n<t?n:t,t=f<t?f:t,t=g<t?g:t,k=v>k?v:k,k=p>k?p:k,k=w>k?w:k,k=a>k?a:k,l=r>l?r:l,l=n>l?n:l,l=f>l?f:l,l=g>l?g:l;g=this._bounds;g.x=q;g.width=k-q;g.y=t;g.height=l-t;return this._currentBounds=g};p.Sprite.prototype.getLocalBounds=function(){var b=this.worldTransform;this.worldTransform=p.identityMatrix;for(var g=0;g<this.children.length;g++)this.children[g].updateTransform();var k=this.getBounds();
this.worldTransform=b;for(g=0;g<this.children.length;g++)this.children[g].updateTransform();return k};p.Sprite.prototype._renderWebGL=function(b,g){if(this.visible&&!(0>=this.alpha)&&this.renderable){var k=this.worldTransform;g&&(k=g);if(this._mask||this._filters){k=b.spriteBatch;this._filters&&(k.flush(),b.filterManager.pushFilter(this._filterBlock));this._mask&&(k.stop(),b.maskManager.pushMask(this.mask,b),k.start());k.render(this);for(var f=0;f<this.children.length;f++)this.children[f]._renderWebGL(b);
k.stop();this._mask&&b.maskManager.popMask(this._mask,b);this._filters&&b.filterManager.popFilter();k.start()}else for(b.spriteBatch.render(this),f=0;f<this.children.length;f++)this.children[f]._renderWebGL(b,k)}};p.Sprite.prototype._renderCanvas=function(b,g){if(!(!this.visible||0===this.alpha||!this.renderable||0>=this.texture.crop.width||0>=this.texture.crop.height)){var k=this.worldTransform;g&&(k=g);this.blendMode!==b.currentBlendMode&&(b.currentBlendMode=this.blendMode,b.context.globalCompositeOperation=
p.blendModesCanvas[b.currentBlendMode]);this._mask&&b.maskManager.pushMask(this._mask,b);if(this.texture.valid){var f=this.texture.baseTexture.resolution/b.resolution;b.context.globalAlpha=this.worldAlpha;b.smoothProperty&&b.scaleMode!==this.texture.baseTexture.scaleMode&&(b.scaleMode=this.texture.baseTexture.scaleMode,b.context[b.smoothProperty]=b.scaleMode===p.scaleModes.LINEAR);var m=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,
n=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,a=k.tx*b.resolution+b.shakeX,c=k.ty*b.resolution+b.shakeY;b.roundPixels?(b.context.setTransform(k.a,k.b,k.c,k.d,a|0,c|0),m|=0,n|=0):b.context.setTransform(k.a,k.b,k.c,k.d,a,c);k=this.texture.crop.width;a=this.texture.crop.height;m/=f;n/=f;if(16777215!==this.tint){if(this.texture.requiresReTint||this.cachedTint!==this.tint)this.tintedTexture=p.CanvasTinter.getTintedTexture(this,this.tint),
this.cachedTint=this.tint,this.texture.requiresReTint=!1;b.context.drawImage(this.tintedTexture,0,0,k,a,m,n,k/f,a/f)}else b.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,k,a,m,n,k/f,a/f)}for(f=0;f<this.children.length;f++)this.children[f]._renderCanvas(b);this._mask&&b.maskManager.popMask(b)}};p.SpriteBatch=function(b){p.DisplayObjectContainer.call(this);this.textureThing=b;this.ready=!1};p.SpriteBatch.prototype=Object.create(p.DisplayObjectContainer.prototype);
p.SpriteBatch.prototype.constructor=p.SpriteBatch;p.SpriteBatch.prototype.initWebGL=function(b){this.fastSpriteBatch=new p.WebGLFastSpriteBatch(b);this.ready=!0};p.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()};p.SpriteBatch.prototype._renderWebGL=function(b){!this.visible||0>=this.alpha||!this.children.length||(this.ready||this.initWebGL(b.gl),this.fastSpriteBatch.gl!==b.gl&&this.fastSpriteBatch.setContext(b.gl),b.spriteBatch.stop(),b.shaderManager.setShader(b.shaderManager.fastShader),
this.fastSpriteBatch.begin(this,b),this.fastSpriteBatch.render(this),b.spriteBatch.start())};p.SpriteBatch.prototype._renderCanvas=function(b){if(this.visible&&!(0>=this.alpha)&&this.children.length){var g=b.context;g.globalAlpha=this.worldAlpha;this.displayObjectUpdateTransform();for(var k=this.worldTransform,f=!0,m=0;m<this.children.length;m++){var n=this.children[m];if(n.visible){var a=n.texture,c=a.frame;g.globalAlpha=this.worldAlpha*n.alpha;if(0===n.rotation%(2*Math.PI))f&&(g.setTransform(k.a,
k.b,k.c,k.d,k.tx,k.ty),f=!1),g.drawImage(a.baseTexture.source,c.x,c.y,c.width,c.height,n.anchor.x*-c.width*n.scale.x+n.position.x+.5+b.shakeX|0,n.anchor.y*-c.height*n.scale.y+n.position.y+.5+b.shakeY|0,c.width*n.scale.x,c.height*n.scale.y);else{f||(f=!0);n.displayObjectUpdateTransform();var d=n.worldTransform,e=d.tx*b.resolution+b.shakeX,h=d.ty*b.resolution+b.shakeY;b.roundPixels?g.setTransform(d.a,d.b,d.c,d.d,e|0,h|0):g.setTransform(d.a,d.b,d.c,d.d,e,h);g.drawImage(a.baseTexture.source,c.x,c.y,c.width,
c.height,n.anchor.x*-c.width+.5|0,n.anchor.y*-c.height+.5|0,c.width,c.height)}}}}};p.hex2rgb=function(b){return[(b>>16&255)/255,(b>>8&255)/255,(b&255)/255]};p.rgb2hex=function(b){return(255*b[0]<<16)+(255*b[1]<<8)+255*b[2]};p.canUseNewCanvasBlendModes=function(){if(void 0===document)return!1;var b=new Image;b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/AP804Oa6AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==";var g=new Image;g.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX//wCKxvRFAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==";
var k=p.CanvasPool.create(this,6,1).getContext("2d");k.globalCompositeOperation="multiply";k.drawImage(b,0,0);k.drawImage(g,2,0);if(!k.getImageData(2,0,1,1))return!1;b=k.getImageData(2,0,1,1).data;p.CanvasPool.remove(this);return 255===b[0]&&0===b[1]&&0===b[2]};p.getNextPowerOfTwo=function(b){if(0<b&&0===(b&b-1))return b;for(var g=1;g<b;)g<<=1;return g};p.isPowerOfTwo=function(b,g){return 0<b&&0===(b&b-1)&&0<g&&0===(g&g-1)};p.CanvasPool={create:function(b,g,k){var f=p.CanvasPool.getFirst();-1===f?
(b={parent:b,canvas:document.createElement("canvas")},p.CanvasPool.pool.push(b),b=b.canvas):(p.CanvasPool.pool[f].parent=b,b=p.CanvasPool.pool[f].canvas);void 0!==g&&(b.width=g,b.height=k);return b},getFirst:function(){for(var b=p.CanvasPool.pool,g=0;g<b.length;g++)if(!b[g].parent)return g;return-1},remove:function(b){for(var g=p.CanvasPool.pool,k=0;k<g.length;k++)g[k].parent===b&&(g[k].parent=null,g[k].canvas.width=1,g[k].canvas.height=1)},removeByCanvas:function(b){for(var g=p.CanvasPool.pool,k=
0;k<g.length;k++)g[k].canvas===b&&(g[k].parent=null,g[k].canvas.width=1,g[k].canvas.height=1)},getTotal:function(){for(var b=p.CanvasPool.pool,g=0,k=0;k<b.length;k++)b[k].parent&&g++;return g},getFree:function(){for(var b=p.CanvasPool.pool,g=0,k=0;k<b.length;k++)b[k].parent||g++;return g}};p.CanvasPool.pool=[];p.initDefaultShaders=function(){};p.CompileVertexShader=function(b,g){return p._CompileShader(b,g,b.VERTEX_SHADER)};p.CompileFragmentShader=function(b,g){return p._CompileShader(b,g,b.FRAGMENT_SHADER)};
p._CompileShader=function(b,g,k){var f=g;Array.isArray(g)&&(f=g.join("\n"));g=b.createShader(k);b.shaderSource(g,f);b.compileShader(g);return b.getShaderParameter(g,b.COMPILE_STATUS)?g:(window.console.log(b.getShaderInfoLog(g)),null)};p.compileProgram=function(b,g,k){k=p.CompileFragmentShader(b,k);g=p.CompileVertexShader(b,g);var f=b.createProgram();b.attachShader(f,g);b.attachShader(f,k);b.linkProgram(f);b.getProgramParameter(f,b.LINK_STATUS)||(window.console.log(b.getProgramInfoLog(f)),window.console.log("Could not initialise shaders"));
return f};p.PixiShader=function(b){this._UID=p._UID++;this.gl=b;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.textureCount=0;this.dirty=this.firstRun=!0;this.attributes=[];this.init()};p.PixiShader.prototype.constructor=p.PixiShader;p.PixiShader.prototype.init=function(){var b=this.gl,g=p.compileProgram(b,this.vertexSrc||
p.PixiShader.defaultVertexSrc,this.fragmentSrc);b.useProgram(g);this.uSampler=b.getUniformLocation(g,"uSampler");this.projectionVector=b.getUniformLocation(g,"projectionVector");this.offsetVector=b.getUniformLocation(g,"offsetVector");this.dimensions=b.getUniformLocation(g,"dimensions");this.aVertexPosition=b.getAttribLocation(g,"aVertexPosition");this.aTextureCoord=b.getAttribLocation(g,"aTextureCoord");this.colorAttribute=b.getAttribLocation(g,"aColor");-1===this.colorAttribute&&(this.colorAttribute=
2);this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var k in this.uniforms)this.uniforms[k].uniformLocation=b.getUniformLocation(g,k);this.initUniforms();this.program=g};p.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var b=this.gl,g,k;for(k in this.uniforms){g=this.uniforms[k];var f=g.type;"sampler2D"===f?(g._init=!1,null!==g.value&&this.initSampler2D(g)):"mat2"===f||"mat3"===f||"mat4"===f?(g.glMatrix=!0,g.glValueLength=1,"mat2"===f?g.glFunc=b.uniformMatrix2fv:
"mat3"===f?g.glFunc=b.uniformMatrix3fv:"mat4"===f&&(g.glFunc=b.uniformMatrix4fv)):(g.glFunc=b["uniform"+f],g.glValueLength="2f"===f||"2i"===f?2:"3f"===f||"3i"===f?3:"4f"===f||"4i"===f?4:1)}};p.PixiShader.prototype.initSampler2D=function(b){if(b.value&&b.value.baseTexture&&b.value.baseTexture.hasLoaded){var g=this.gl;g.activeTexture(g["TEXTURE"+this.textureCount]);g.bindTexture(g.TEXTURE_2D,b.value.baseTexture._glTextures[g.id]);if(b.textureData){var k=b.textureData,f=k.magFilter?k.magFilter:g.LINEAR,
m=k.minFilter?k.minFilter:g.LINEAR,n=k.wrapS?k.wrapS:g.CLAMP_TO_EDGE,a=k.wrapT?k.wrapT:g.CLAMP_TO_EDGE,c=k.luminance?g.LUMINANCE:g.RGBA;k.repeat&&(a=n=g.REPEAT);g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!!k.flipY);k.width?g.texImage2D(g.TEXTURE_2D,0,c,k.width?k.width:512,k.height?k.height:2,k.border?k.border:0,c,g.UNSIGNED_BYTE,null):g.texImage2D(g.TEXTURE_2D,0,c,g.RGBA,g.UNSIGNED_BYTE,b.value.baseTexture.source);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,f);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,
m);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,n);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,a)}g.uniform1i(b.uniformLocation,this.textureCount);b._init=!0;this.textureCount++}};p.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var b,g=this.gl,k;for(k in this.uniforms)b=this.uniforms[k],1===b.glValueLength?!0===b.glMatrix?b.glFunc.call(g,b.uniformLocation,b.transpose,b.value):b.glFunc.call(g,b.uniformLocation,b.value):2===b.glValueLength?b.glFunc.call(g,b.uniformLocation,b.value.x,
b.value.y):3===b.glValueLength?b.glFunc.call(g,b.uniformLocation,b.value.x,b.value.y,b.value.z):4===b.glValueLength?b.glFunc.call(g,b.uniformLocation,b.value.x,b.value.y,b.value.z,b.value.w):"sampler2D"===b.type&&(b._init?(g.activeTexture(g["TEXTURE"+this.textureCount]),b.value.baseTexture._dirty[g.id]?p.instances[g.id].updateTexture(b.value.baseTexture):g.bindTexture(g.TEXTURE_2D,b.value.baseTexture._glTextures[g.id]),g.uniform1i(b.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(b))};
p.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attributes=this.gl=this.uniforms=null};p.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);",
"   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"];p.PixiFastShader=function(b){this._UID=p._UID++;this.gl=b;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;",
"attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);",
"   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"];this.textureCount=0;this.init()};p.PixiFastShader.prototype.constructor=p.PixiFastShader;p.PixiFastShader.prototype.init=function(){var b=this.gl,g=p.compileProgram(b,this.vertexSrc,this.fragmentSrc);b.useProgram(g);this.uSampler=b.getUniformLocation(g,"uSampler");this.projectionVector=b.getUniformLocation(g,"projectionVector");this.offsetVector=b.getUniformLocation(g,"offsetVector");this.dimensions=b.getUniformLocation(g,"dimensions");
this.uMatrix=b.getUniformLocation(g,"uMatrix");this.aVertexPosition=b.getAttribLocation(g,"aVertexPosition");this.aPositionCoord=b.getAttribLocation(g,"aPositionCoord");this.aScale=b.getAttribLocation(g,"aScale");this.aRotation=b.getAttribLocation(g,"aRotation");this.aTextureCoord=b.getAttribLocation(g,"aTextureCoord");this.colorAttribute=b.getAttribLocation(g,"aColor");-1===this.colorAttribute&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,
this.aTextureCoord,this.colorAttribute];this.program=g};p.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attributes=this.gl=this.uniforms=null};p.StripShader=function(b){this._UID=p._UID++;this.gl=b;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"];this.vertexSrc=
["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"];this.init()};p.StripShader.prototype.constructor=p.StripShader;
p.StripShader.prototype.init=function(){var b=this.gl,g=p.compileProgram(b,this.vertexSrc,this.fragmentSrc);b.useProgram(g);this.uSampler=b.getUniformLocation(g,"uSampler");this.projectionVector=b.getUniformLocation(g,"projectionVector");this.offsetVector=b.getUniformLocation(g,"offsetVector");this.colorAttribute=b.getAttribLocation(g,"aColor");this.aVertexPosition=b.getAttribLocation(g,"aVertexPosition");this.aTextureCoord=b.getAttribLocation(g,"aTextureCoord");this.attributes=[this.aVertexPosition,
this.aTextureCoord];this.translationMatrix=b.getUniformLocation(g,"translationMatrix");this.alpha=b.getUniformLocation(g,"alpha");this.program=g};p.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attribute=this.gl=this.uniforms=null};p.PrimitiveShader=function(b){this._UID=p._UID++;this.gl=b;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;",
"attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};
p.PrimitiveShader.prototype.constructor=p.PrimitiveShader;p.PrimitiveShader.prototype.init=function(){var b=this.gl,g=p.compileProgram(b,this.vertexSrc,this.fragmentSrc);b.useProgram(g);this.projectionVector=b.getUniformLocation(g,"projectionVector");this.offsetVector=b.getUniformLocation(g,"offsetVector");this.tintColor=b.getUniformLocation(g,"tint");this.flipY=b.getUniformLocation(g,"flipY");this.aVertexPosition=b.getAttribLocation(g,"aVertexPosition");this.colorAttribute=b.getAttribLocation(g,
"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=b.getUniformLocation(g,"translationMatrix");this.alpha=b.getUniformLocation(g,"alpha");this.program=g};p.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attributes=this.gl=this.uniforms=null};p.ComplexPrimitiveShader=function(b){this._UID=p._UID++;this.gl=b;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;",
"}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);",
"}"];this.init()};p.ComplexPrimitiveShader.prototype.constructor=p.ComplexPrimitiveShader;p.ComplexPrimitiveShader.prototype.init=function(){var b=this.gl,g=p.compileProgram(b,this.vertexSrc,this.fragmentSrc);b.useProgram(g);this.projectionVector=b.getUniformLocation(g,"projectionVector");this.offsetVector=b.getUniformLocation(g,"offsetVector");this.tintColor=b.getUniformLocation(g,"tint");this.color=b.getUniformLocation(g,"color");this.flipY=b.getUniformLocation(g,"flipY");this.aVertexPosition=b.getAttribLocation(g,
"aVertexPosition");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=b.getUniformLocation(g,"translationMatrix");this.alpha=b.getUniformLocation(g,"alpha");this.program=g};p.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attribute=this.gl=this.uniforms=null};p.glContexts=[];p.instances=[];p.WebGLRenderer=function(b){this.game=b;p.defaultRenderer||(p.defaultRenderer=this);this.type=p.WEBGL_RENDERER;this.resolution=b.resolution;
this.transparent=b.transparent;this.autoResize=!1;this.preserveDrawingBuffer=b.preserveDrawingBuffer;this.clearBeforeRender=b.clearBeforeRender;this.width=b.width;this.height=b.height;this.view=b.canvas;this._contextOptions={alpha:this.transparent,antialias:b.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:this.preserveDrawingBuffer};this.projection=new p.Point;this.offset=new p.Point;this.shaderManager=new p.WebGLShaderManager;this.spriteBatch=
new p.WebGLSpriteBatch;this.maskManager=new p.WebGLMaskManager;this.filterManager=new p.WebGLFilterManager;this.stencilManager=new p.WebGLStencilManager;this.blendModeManager=new p.WebGLBlendModeManager;this.renderSession={};this.renderSession.game=this.game;this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=
this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;this.renderSession.resolution=this.resolution;this.initContext();this.mapBlendModes()};p.WebGLRenderer.prototype.constructor=p.WebGLRenderer;p.WebGLRenderer.prototype.initContext=function(){var b=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);this.gl=b;if(!b)throw Error("This browser does not support webGL. Try using the canvas renderer");
this.glContextId=b.id=p.WebGLRenderer.glContextId++;p.glContexts[this.glContextId]=b;p.instances[this.glContextId]=this;b.disable(b.DEPTH_TEST);b.disable(b.CULL_FACE);b.enable(b.BLEND);this.shaderManager.setContext(b);this.spriteBatch.setContext(b);this.maskManager.setContext(b);this.filterManager.setContext(b);this.blendModeManager.setContext(b);this.stencilManager.setContext(b);this.renderSession.gl=this.gl;this.resize(this.width,this.height)};p.WebGLRenderer.prototype.render=function(b){if(!this.contextLost){var g=
this.gl;g.viewport(0,0,this.width,this.height);g.bindFramebuffer(g.FRAMEBUFFER,null);this.game.clearBeforeRender&&(g.clearColor(b._bgColor.r,b._bgColor.g,b._bgColor.b,b._bgColor.a),g.clear(g.COLOR_BUFFER_BIT));this.offset.x=this.game.camera._shake.x;this.offset.y=this.game.camera._shake.y;this.renderDisplayObject(b,this.projection)}};p.WebGLRenderer.prototype.renderDisplayObject=function(b,g,k,f){this.renderSession.blendModeManager.setBlendMode(p.blendModes.NORMAL);this.renderSession.drawCount=0;
this.renderSession.flipY=k?-1:1;this.renderSession.projection=g;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,k);b._renderWebGL(this.renderSession,f);this.spriteBatch.end()};p.WebGLRenderer.prototype.resize=function(b,g){this.width=b*this.resolution;this.height=g*this.resolution;this.view.width=this.width;this.view.height=this.height;this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=
this.height/this.resolution+"px");this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2/this.resolution;this.projection.y=-this.height/2/this.resolution};p.WebGLRenderer.prototype.updateTexture=function(b){if(!b.hasLoaded)return!1;var g=this.gl;b._glTextures[g.id]||(b._glTextures[g.id]=g.createTexture());g.bindTexture(g.TEXTURE_2D,b._glTextures[g.id]);g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultipliedAlpha);g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,
b.source);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,b.scaleMode===p.scaleModes.LINEAR?g.LINEAR:g.NEAREST);b.mipmap&&p.isPowerOfTwo(b.width,b.height)?(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,b.scaleMode===p.scaleModes.LINEAR?g.LINEAR_MIPMAP_LINEAR:g.NEAREST_MIPMAP_NEAREST),g.generateMipmap(g.TEXTURE_2D)):g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,b.scaleMode===p.scaleModes.LINEAR?g.LINEAR:g.NEAREST);b._powerOf2?(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT),g.texParameteri(g.TEXTURE_2D,
g.TEXTURE_WRAP_T,g.REPEAT)):(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE));b._dirty[g.id]=!1;return!0};p.WebGLRenderer.prototype.destroy=function(){this.offset=this.projection=p.glContexts[this.glContextId]=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.renderSession=this.gl=this.filterManager=this.maskManager=this.spriteBatch=this.shaderManager=
null;p.CanvasPool.remove(this);p.instances[this.glContextId]=null;p.WebGLRenderer.glContextId--};p.WebGLRenderer.prototype.mapBlendModes=function(){var b=this.gl;if(!p.blendModesWebGL){var g=[],k=p.blendModes;g[k.NORMAL]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];g[k.ADD]=[b.SRC_ALPHA,b.DST_ALPHA];g[k.MULTIPLY]=[b.DST_COLOR,b.ONE_MINUS_SRC_ALPHA];g[k.SCREEN]=[b.SRC_ALPHA,b.ONE];g[k.OVERLAY]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];g[k.DARKEN]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];g[k.LIGHTEN]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];g[k.COLOR_DODGE]=
[b.ONE,b.ONE_MINUS_SRC_ALPHA];g[k.COLOR_BURN]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];g[k.HARD_LIGHT]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];g[k.SOFT_LIGHT]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];g[k.DIFFERENCE]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];g[k.EXCLUSION]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];g[k.HUE]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];g[k.SATURATION]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];g[k.COLOR]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];g[k.LUMINOSITY]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];p.blendModesWebGL=g}};p.WebGLRenderer.glContextId=0;p.WebGLBlendModeManager=
function(){this.currentBlendMode=99999};p.WebGLBlendModeManager.prototype.constructor=p.WebGLBlendModeManager;p.WebGLBlendModeManager.prototype.setContext=function(b){this.gl=b};p.WebGLBlendModeManager.prototype.setBlendMode=function(b){if(this.currentBlendMode===b)return!1;this.currentBlendMode=b;(b=p.blendModesWebGL[this.currentBlendMode])&&this.gl.blendFunc(b[0],b[1]);return!0};p.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null};p.WebGLMaskManager=function(){};p.WebGLMaskManager.prototype.constructor=
p.WebGLMaskManager;p.WebGLMaskManager.prototype.setContext=function(b){this.gl=b};p.WebGLMaskManager.prototype.pushMask=function(b,g){var k=g.gl;b.dirty&&p.WebGLGraphics.updateGraphics(b,k);void 0!==b._webGL[k.id]&&void 0!==b._webGL[k.id].data&&0!==b._webGL[k.id].data.length&&g.stencilManager.pushStencil(b,b._webGL[k.id].data[0],g)};p.WebGLMaskManager.prototype.popMask=function(b,g){var k=this.gl;void 0!==b._webGL[k.id]&&void 0!==b._webGL[k.id].data&&0!==b._webGL[k.id].data.length&&g.stencilManager.popStencil(b,
b._webGL[k.id].data[0],g)};p.WebGLMaskManager.prototype.destroy=function(){this.gl=null};p.WebGLStencilManager=function(){this.stencilStack=[];this.reverse=!0;this.count=0};p.WebGLStencilManager.prototype.setContext=function(b){this.gl=b};p.WebGLStencilManager.prototype.pushStencil=function(b,g,k){var f=this.gl;this.bindGraphics(b,g,k);0===this.stencilStack.length&&(f.enable(f.STENCIL_TEST),f.clear(f.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0);this.stencilStack.push(g);b=this.count;f.colorMask(!1,
!1,!1,!1);f.stencilFunc(f.ALWAYS,0,255);f.stencilOp(f.KEEP,f.KEEP,f.INVERT);1===g.mode?(f.drawElements(f.TRIANGLE_FAN,g.indices.length-4,f.UNSIGNED_SHORT,0),this.reverse?(f.stencilFunc(f.EQUAL,255-b,255),f.stencilOp(f.KEEP,f.KEEP,f.DECR)):(f.stencilFunc(f.EQUAL,b,255),f.stencilOp(f.KEEP,f.KEEP,f.INCR)),f.drawElements(f.TRIANGLE_FAN,4,f.UNSIGNED_SHORT,2*(g.indices.length-4)),this.reverse?f.stencilFunc(f.EQUAL,255-(b+1),255):f.stencilFunc(f.EQUAL,b+1,255),this.reverse=!this.reverse):(this.reverse?(f.stencilFunc(f.EQUAL,
b,255),f.stencilOp(f.KEEP,f.KEEP,f.INCR)):(f.stencilFunc(f.EQUAL,255-b,255),f.stencilOp(f.KEEP,f.KEEP,f.DECR)),f.drawElements(f.TRIANGLE_STRIP,g.indices.length,f.UNSIGNED_SHORT,0),this.reverse?f.stencilFunc(f.EQUAL,b+1,255):f.stencilFunc(f.EQUAL,255-(b+1),255));f.colorMask(!0,!0,!0,!0);f.stencilOp(f.KEEP,f.KEEP,f.KEEP);this.count++};p.WebGLStencilManager.prototype.bindGraphics=function(b,g,k){this._currentGraphics=b;var f=this.gl,m=k.projection,n=k.offset,a;1===g.mode?(a=k.shaderManager.complexPrimitiveShader,
k.shaderManager.setShader(a),f.uniform1f(a.flipY,k.flipY),f.uniformMatrix3fv(a.translationMatrix,!1,b.worldTransform.toArray(!0)),f.uniform2f(a.projectionVector,m.x,-m.y),f.uniform2f(a.offsetVector,-n.x,-n.y),f.uniform3fv(a.tintColor,p.hex2rgb(b.tint)),f.uniform3fv(a.color,g.color),f.uniform1f(a.alpha,b.worldAlpha*g.alpha),f.bindBuffer(f.ARRAY_BUFFER,g.buffer),f.vertexAttribPointer(a.aVertexPosition,2,f.FLOAT,!1,8,0)):(a=k.shaderManager.primitiveShader,k.shaderManager.setShader(a),f.uniformMatrix3fv(a.translationMatrix,
!1,b.worldTransform.toArray(!0)),f.uniform1f(a.flipY,k.flipY),f.uniform2f(a.projectionVector,m.x,-m.y),f.uniform2f(a.offsetVector,-n.x,-n.y),f.uniform3fv(a.tintColor,p.hex2rgb(b.tint)),f.uniform1f(a.alpha,b.worldAlpha),f.bindBuffer(f.ARRAY_BUFFER,g.buffer),f.vertexAttribPointer(a.aVertexPosition,2,f.FLOAT,!1,24,0),f.vertexAttribPointer(a.colorAttribute,4,f.FLOAT,!1,24,8));f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,g.indexBuffer)};p.WebGLStencilManager.prototype.popStencil=function(b,g,k){var f=this.gl;this.stencilStack.pop();
this.count--;if(0===this.stencilStack.length)f.disable(f.STENCIL_TEST);else{var m=this.count;this.bindGraphics(b,g,k);f.colorMask(!1,!1,!1,!1);1===g.mode?((this.reverse=!this.reverse)?(f.stencilFunc(f.EQUAL,255-(m+1),255),f.stencilOp(f.KEEP,f.KEEP,f.INCR)):(f.stencilFunc(f.EQUAL,m+1,255),f.stencilOp(f.KEEP,f.KEEP,f.DECR)),f.drawElements(f.TRIANGLE_FAN,4,f.UNSIGNED_SHORT,2*(g.indices.length-4)),f.stencilFunc(f.ALWAYS,0,255),f.stencilOp(f.KEEP,f.KEEP,f.INVERT),f.drawElements(f.TRIANGLE_FAN,g.indices.length-
4,f.UNSIGNED_SHORT,0)):(this.reverse?(f.stencilFunc(f.EQUAL,m+1,255),f.stencilOp(f.KEEP,f.KEEP,f.DECR)):(f.stencilFunc(f.EQUAL,255-(m+1),255),f.stencilOp(f.KEEP,f.KEEP,f.INCR)),f.drawElements(f.TRIANGLE_STRIP,g.indices.length,f.UNSIGNED_SHORT,0));this.reverse?f.stencilFunc(f.EQUAL,m,255):f.stencilFunc(f.EQUAL,255-m,255);f.colorMask(!0,!0,!0,!0);f.stencilOp(f.KEEP,f.KEEP,f.KEEP)}};p.WebGLStencilManager.prototype.destroy=function(){this.gl=this.stencilStack=null};p.WebGLShaderManager=function(){this.maxAttibs=
10;this.attribState=[];this.tempAttribState=[];for(var b=0;b<this.maxAttibs;b++)this.attribState[b]=!1;this.stack=[]};p.WebGLShaderManager.prototype.constructor=p.WebGLShaderManager;p.WebGLShaderManager.prototype.setContext=function(b){this.gl=b;this.primitiveShader=new p.PrimitiveShader(b);this.complexPrimitiveShader=new p.ComplexPrimitiveShader(b);this.defaultShader=new p.PixiShader(b);this.fastShader=new p.PixiFastShader(b);this.stripShader=new p.StripShader(b);this.setShader(this.defaultShader)};
p.WebGLShaderManager.prototype.setAttribs=function(b){var g;for(g=0;g<this.tempAttribState.length;g++)this.tempAttribState[g]=!1;for(g=0;g<b.length;g++)this.tempAttribState[b[g]]=!0;b=this.gl;for(g=0;g<this.attribState.length;g++)this.attribState[g]!==this.tempAttribState[g]&&(this.attribState[g]=this.tempAttribState[g],this.tempAttribState[g]?b.enableVertexAttribArray(g):b.disableVertexAttribArray(g))};p.WebGLShaderManager.prototype.setShader=function(b){if(this._currentId===b._UID)return!1;this._currentId=
b._UID;this.currentShader=b;this.gl.useProgram(b.program);this.setAttribs(b.attributes);return!0};p.WebGLShaderManager.prototype.destroy=function(){this.tempAttribState=this.attribState=null;this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.gl=null};p.WebGLSpriteBatch=function(){this.vertSize=5;this.size=2E3;var b=6*this.size;this.vertices=new p.ArrayBuffer(16*this.size*this.vertSize);this.positions=
new p.Float32Array(this.vertices);this.colors=new p.Uint32Array(this.vertices);this.indices=new p.Uint16Array(b);for(var g=this.lastIndexCount=0,k=0;g<b;g+=6,k+=4)this.indices[g+0]=k+0,this.indices[g+1]=k+1,this.indices[g+2]=k+2,this.indices[g+3]=k+0,this.indices[g+4]=k+2,this.indices[g+5]=k+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.dirty=!0;this.textures=[];this.blendModes=[];this.shaders=[];this.sprites=[];this.defaultShader=new p.AbstractFilter(["precision lowp float;",
"varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])};p.WebGLSpriteBatch.prototype.setContext=function(b){this.gl=b;this.vertexBuffer=b.createBuffer();this.indexBuffer=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.indices,b.STATIC_DRAW);b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer);b.bufferData(b.ARRAY_BUFFER,this.vertices,
b.DYNAMIC_DRAW);this.currentBlendMode=99999;var g=new p.PixiShader(b);g.fragmentSrc=this.defaultShader.fragmentSrc;g.uniforms={};g.init();this.defaultShader.shaders[b.id]=g};p.WebGLSpriteBatch.prototype.begin=function(b){this.renderSession=b;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};p.WebGLSpriteBatch.prototype.end=function(){this.flush()};p.WebGLSpriteBatch.prototype.render=function(b,g){var k=b.texture,f=b.worldTransform;g&&(f=g);this.currentBatchSize>=this.size&&
(this.flush(),this.currentBaseTexture=k.baseTexture);var m=k._uvs;if(m){var n=b.anchor.x,a=b.anchor.y,c,d,e;k.trim?(d=k.trim,n=d.x-n*d.width,c=n+k.crop.width,e=d.y-a*d.height,d=e+k.crop.height):(c=k.frame.width*(1-n),n=k.frame.width*-n,d=k.frame.height*(1-a),e=k.frame.height*-a);var a=4*this.currentBatchSize*this.vertSize,h=k.baseTexture.resolution,k=f.a/h,l=f.b/h,q=f.c/h,h=f.d/h,t=f.tx,v=f.ty,f=this.colors,r=this.positions;this.renderSession.roundPixels?(r[a]=k*n+q*e+t|0,r[a+1]=h*e+l*n+v|0,r[a+5]=
k*c+q*e+t|0,r[a+6]=h*e+l*c+v|0,r[a+10]=k*c+q*d+t|0,r[a+11]=h*d+l*c+v|0,r[a+15]=k*n+q*d+t|0,r[a+16]=h*d+l*n+v|0):(r[a]=k*n+q*e+t,r[a+1]=h*e+l*n+v,r[a+5]=k*c+q*e+t,r[a+6]=h*e+l*c+v,r[a+10]=k*c+q*d+t,r[a+11]=h*d+l*c+v,r[a+15]=k*n+q*d+t,r[a+16]=h*d+l*n+v);r[a+2]=m.x0;r[a+3]=m.y0;r[a+7]=m.x1;r[a+8]=m.y1;r[a+12]=m.x2;r[a+13]=m.y2;r[a+17]=m.x3;r[a+18]=m.y3;m=b.tint;f[a+4]=f[a+9]=f[a+14]=f[a+19]=(m>>16)+(m&65280)+((m&255)<<16)+(255*b.worldAlpha<<24);this.sprites[this.currentBatchSize++]=b}};p.WebGLSpriteBatch.prototype.renderTilingSprite=
function(b){var g=b.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=g.baseTexture);b._uvs||(b._uvs=new p.TextureUvs);var k=b._uvs,f=g.baseTexture.width,m=g.baseTexture.height;b.tilePosition.x%=f*b.tileScaleOffset.x;b.tilePosition.y%=m*b.tileScaleOffset.y;var n=b.tilePosition.x/(f*b.tileScaleOffset.x),a=b.tilePosition.y/(m*b.tileScaleOffset.y),f=b.width/f/(b.tileScale.x*b.tileScaleOffset.x),m=b.height/m/(b.tileScale.y*b.tileScaleOffset.y);k.x0=0-n;k.y0=0-a;k.x1=
1*f-n;k.y1=0-a;k.x2=1*f-n;k.y2=1*m-a;k.x3=0-n;k.y3=1*m-a;var n=b.tint,n=(n>>16)+(n&65280)+((n&255)<<16)+(255*b.worldAlpha<<24),a=this.positions,m=this.colors,c=b.width,d=b.height,e=b.anchor.x,h=b.anchor.y,f=c*(1-e),c=c*-e,e=d*(1-h),d=d*-h,h=4*this.currentBatchSize*this.vertSize,l=g.baseTexture.resolution,q=b.worldTransform,g=q.a/l,t=q.b/l,v=q.c/l,l=q.d/l,r=q.tx,q=q.ty;a[h++]=g*c+v*d+r;a[h++]=l*d+t*c+q;a[h++]=k.x0;a[h++]=k.y0;m[h++]=n;a[h++]=g*f+v*d+r;a[h++]=l*d+t*f+q;a[h++]=k.x1;a[h++]=k.y1;m[h++]=
n;a[h++]=g*f+v*e+r;a[h++]=l*e+t*f+q;a[h++]=k.x2;a[h++]=k.y2;m[h++]=n;a[h++]=g*c+v*e+r;a[h++]=l*e+t*c+q;a[h++]=k.x3;a[h++]=k.y3;m[h++]=n;this.sprites[this.currentBatchSize++]=b};p.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var b=this.gl,g;if(this.dirty){this.dirty=!1;b.activeTexture(b.TEXTURE0);b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer);g=this.defaultShader.shaders[b.id];var k=4*this.vertSize;b.vertexAttribPointer(g.aVertexPosition,
2,b.FLOAT,!1,k,0);b.vertexAttribPointer(g.aTextureCoord,2,b.FLOAT,!1,k,8);b.vertexAttribPointer(g.colorAttribute,4,b.UNSIGNED_BYTE,!0,k,16)}this.currentBatchSize>.5*this.size?b.bufferSubData(b.ARRAY_BUFFER,0,this.vertices):(k=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize),b.bufferSubData(b.ARRAY_BUFFER,0,k));for(var f,m,n=k=0,a=null,c=this.renderSession.blendModeManager.currentBlendMode,d=null,e,h,l,q=0,t=this.currentBatchSize;q<t;q++){l=this.sprites[q];g=l.tilingTexture?l.tilingTexture.baseTexture:
l.texture.baseTexture;f=l.blendMode;m=l.shader||this.defaultShader;e=c!==f;h=d!==m;var v=g.skipRender;v&&0<l.children.length&&(v=!1);if(a!==g&&!v||e||h)this.renderBatch(a,k,n),n=q,k=0,a=g,e&&(c=f,this.renderSession.blendModeManager.setBlendMode(c)),h&&(d=m,g=d.shaders[b.id],g||(g=new p.PixiShader(b),g.fragmentSrc=d.fragmentSrc,g.uniforms=d.uniforms,g.init(),d.shaders[b.id]=g),this.renderSession.shaderManager.setShader(g),g.dirty&&g.syncUniforms(),f=this.renderSession.projection,b.uniform2f(g.projectionVector,
f.x,f.y),f=this.renderSession.offset,b.uniform2f(g.offsetVector,f.x,f.y));k++}this.renderBatch(a,k,n);this.currentBatchSize=0}};p.WebGLSpriteBatch.prototype.renderBatch=function(b,g,k){if(0!==g){var f=this.gl;if(b._dirty[f.id]){if(!this.renderSession.renderer.updateTexture(b))return}else f.bindTexture(f.TEXTURE_2D,b._glTextures[f.id]);f.drawElements(f.TRIANGLES,6*g,f.UNSIGNED_SHORT,12*k);this.renderSession.drawCount++}};p.WebGLSpriteBatch.prototype.stop=function(){this.flush();this.dirty=!0};p.WebGLSpriteBatch.prototype.start=
function(){this.dirty=!0};p.WebGLSpriteBatch.prototype.destroy=function(){this.indices=this.vertices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.gl=this.currentBaseTexture=null};p.WebGLFastSpriteBatch=function(b){this.vertSize=10;this.size=this.maxSize=6E3;var g=6*this.maxSize;this.vertices=new p.Float32Array(4*this.size*this.vertSize);this.indices=new p.Uint16Array(g);this.indexBuffer=this.vertexBuffer=null;for(var k=this.lastIndexCount=0,f=0;k<g;k+=6,
f+=4)this.indices[k+0]=f+0,this.indices[k+1]=f+1,this.indices[k+2]=f+2,this.indices[k+3]=f+0,this.indices[k+4]=f+2,this.indices[k+5]=f+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.matrix=this.shader=this.renderSession=null;this.setContext(b)};p.WebGLFastSpriteBatch.prototype.constructor=p.WebGLFastSpriteBatch;p.WebGLFastSpriteBatch.prototype.setContext=function(b){this.gl=b;this.vertexBuffer=b.createBuffer();this.indexBuffer=b.createBuffer();
b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.indices,b.STATIC_DRAW);b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer);b.bufferData(b.ARRAY_BUFFER,this.vertices,b.DYNAMIC_DRAW)};p.WebGLFastSpriteBatch.prototype.begin=function(b,g){this.renderSession=g;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=b.worldTransform.toArray(!0);this.start()};p.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};p.WebGLFastSpriteBatch.prototype.render=
function(b){b=b.children;var g=b[0];if(g.texture._uvs){this.currentBaseTexture=g.texture.baseTexture;g.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(g.blendMode));for(var g=0,k=b.length;g<k;g++)this.renderSprite(b[g]);this.flush()}};p.WebGLFastSpriteBatch.prototype.renderSprite=function(b){if(b.visible){if(b.texture.baseTexture!==this.currentBaseTexture&&!b.texture.baseTexture.skipRender&&(this.flush(),this.currentBaseTexture=
b.texture.baseTexture,!b.texture._uvs))return;var g,k=this.vertices,f,m,n,a,c;g=b.texture._uvs;b.texture.trim?(n=b.texture.trim,m=n.x-b.anchor.x*n.width,f=m+b.texture.crop.width,a=n.y-b.anchor.y*n.height,n=a+b.texture.crop.height):(f=b.texture.frame.width*(1-b.anchor.x),m=b.texture.frame.width*-b.anchor.x,n=b.texture.frame.height*(1-b.anchor.y),a=b.texture.frame.height*-b.anchor.y);c=4*this.currentBatchSize*this.vertSize;k[c++]=m;k[c++]=a;k[c++]=b.position.x;k[c++]=b.position.y;k[c++]=b.scale.x;k[c++]=
b.scale.y;k[c++]=b.rotation;k[c++]=g.x0;k[c++]=g.y1;k[c++]=b.alpha;k[c++]=f;k[c++]=a;k[c++]=b.position.x;k[c++]=b.position.y;k[c++]=b.scale.x;k[c++]=b.scale.y;k[c++]=b.rotation;k[c++]=g.x1;k[c++]=g.y1;k[c++]=b.alpha;k[c++]=f;k[c++]=n;k[c++]=b.position.x;k[c++]=b.position.y;k[c++]=b.scale.x;k[c++]=b.scale.y;k[c++]=b.rotation;k[c++]=g.x2;k[c++]=g.y2;k[c++]=b.alpha;k[c++]=m;k[c++]=n;k[c++]=b.position.x;k[c++]=b.position.y;k[c++]=b.scale.x;k[c++]=b.scale.y;k[c++]=b.rotation;k[c++]=g.x3;k[c++]=g.y3;k[c++]=
b.alpha;this.currentBatchSize++;this.currentBatchSize>=this.size&&this.flush()}};p.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var b=this.gl;this.currentBaseTexture._glTextures[b.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,b);b.bindTexture(b.TEXTURE_2D,this.currentBaseTexture._glTextures[b.id]);if(this.currentBatchSize>.5*this.size)b.bufferSubData(b.ARRAY_BUFFER,0,this.vertices);else{var g=this.vertices.subarray(0,4*this.currentBatchSize*
this.vertSize);b.bufferSubData(b.ARRAY_BUFFER,0,g)}b.drawElements(b.TRIANGLES,6*this.currentBatchSize,b.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++}};p.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};p.WebGLFastSpriteBatch.prototype.start=function(){var b=this.gl;b.activeTexture(b.TEXTURE0);b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var g=this.renderSession.projection;b.uniform2f(this.shader.projectionVector,
g.x,g.y);b.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);g=4*this.vertSize;b.vertexAttribPointer(this.shader.aVertexPosition,2,b.FLOAT,!1,g,0);b.vertexAttribPointer(this.shader.aPositionCoord,2,b.FLOAT,!1,g,8);b.vertexAttribPointer(this.shader.aScale,2,b.FLOAT,!1,g,16);b.vertexAttribPointer(this.shader.aRotation,1,b.FLOAT,!1,g,24);b.vertexAttribPointer(this.shader.aTextureCoord,2,b.FLOAT,!1,g,28);b.vertexAttribPointer(this.shader.colorAttribute,1,b.FLOAT,!1,g,36)};p.WebGLFilterManager=function(){this.filterStack=
[];this.offsetY=this.offsetX=0};p.WebGLFilterManager.prototype.constructor=p.WebGLFilterManager;p.WebGLFilterManager.prototype.setContext=function(b){this.gl=b;this.texturePool=[];this.initShaderBuffers()};p.WebGLFilterManager.prototype.begin=function(b,g){this.renderSession=b;this.defaultShader=b.shaderManager.defaultShader;var k=this.renderSession.projection;this.width=2*k.x;this.height=2*-k.y;this.buffer=g};p.WebGLFilterManager.prototype.pushFilter=function(b){var g=this.gl,k=this.renderSession.projection,
f=this.renderSession.offset;b._filterArea=b.target.filterArea||b.target.getBounds();b._previous_stencil_mgr=this.renderSession.stencilManager;this.renderSession.stencilManager=new p.WebGLStencilManager;this.renderSession.stencilManager.setContext(g);g.disable(g.STENCIL_TEST);this.filterStack.push(b);var m=b.filterPasses[0];this.offsetX+=b._filterArea.x;this.offsetY+=b._filterArea.y;var n=this.texturePool.pop();n?n.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution):
n=new p.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution);g.bindTexture(g.TEXTURE_2D,n.texture);var a=b._filterArea,m=m.padding;a.x-=m;a.y-=m;a.width+=2*m;a.height+=2*m;0>a.x&&(a.x=0);a.width>this.width&&(a.width=this.width);0>a.y&&(a.y=0);a.height>this.height&&(a.height=this.height);g.bindFramebuffer(g.FRAMEBUFFER,n.frameBuffer);g.viewport(0,0,a.width*this.renderSession.resolution,a.height*this.renderSession.resolution);k.x=a.width/2;k.y=-a.height/
2;f.x=-a.x;f.y=-a.y;g.colorMask(!0,!0,!0,!0);g.clearColor(0,0,0,0);g.clear(g.COLOR_BUFFER_BIT);b._glFilterTexture=n};p.WebGLFilterManager.prototype.popFilter=function(){var b=this.gl,g=this.filterStack.pop(),k=g._filterArea,f=g._glFilterTexture,m=this.renderSession.projection,n=this.renderSession.offset;if(1<g.filterPasses.length){b.viewport(0,0,k.width*this.renderSession.resolution,k.height*this.renderSession.resolution);b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=
k.height;this.vertexArray[2]=k.width;this.vertexArray[3]=k.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=k.width;this.vertexArray[7]=0;b.bufferSubData(b.ARRAY_BUFFER,0,this.vertexArray);b.bindBuffer(b.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=k.width/this.width;this.uvArray[5]=k.height/this.height;this.uvArray[6]=k.width/this.width;this.uvArray[7]=k.height/this.height;b.bufferSubData(b.ARRAY_BUFFER,0,this.uvArray);var a=this.texturePool.pop();a||(a=new p.FilterTexture(this.gl,
this.width*this.renderSession.resolution,this.height*this.renderSession.resolution));a.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution);b.bindFramebuffer(b.FRAMEBUFFER,a.frameBuffer);b.clear(b.COLOR_BUFFER_BIT);b.disable(b.BLEND);for(var c=0;c<g.filterPasses.length-1;c++){var d=g.filterPasses[c];b.bindFramebuffer(b.FRAMEBUFFER,a.frameBuffer);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,f.texture);this.applyFilterPass(d,k,k.width,k.height);d=f;f=
a;a=d}b.enable(b.BLEND);this.texturePool.push(a)}a=g.filterPasses[g.filterPasses.length-1];this.offsetX-=k.x;this.offsetY-=k.y;var c=this.width,d=this.height,e=0,h=0,l=this.buffer;0===this.filterStack.length?b.colorMask(!0,!0,!0,!0):(l=this.filterStack[this.filterStack.length-1],k=l._filterArea,c=k.width,d=k.height,e=k.x,h=k.y,l=l._glFilterTexture.frameBuffer);m.x=c/2;m.y=-d/2;n.x=e;n.y=h;k=g._filterArea;m=k.x-e;n=k.y-h;b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=m;this.vertexArray[1]=
n+k.height;this.vertexArray[2]=m+k.width;this.vertexArray[3]=n+k.height;this.vertexArray[4]=m;this.vertexArray[5]=n;this.vertexArray[6]=m+k.width;this.vertexArray[7]=n;b.bufferSubData(b.ARRAY_BUFFER,0,this.vertexArray);b.bindBuffer(b.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=k.width/this.width;this.uvArray[5]=k.height/this.height;this.uvArray[6]=k.width/this.width;this.uvArray[7]=k.height/this.height;b.bufferSubData(b.ARRAY_BUFFER,0,this.uvArray);b.viewport(0,0,c*this.renderSession.resolution,d*
this.renderSession.resolution);b.bindFramebuffer(b.FRAMEBUFFER,l);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,f.texture);this.renderSession.stencilManager&&this.renderSession.stencilManager.destroy();this.renderSession.stencilManager=g._previous_stencil_mgr;g._previous_stencil_mgr=null;0<this.renderSession.stencilManager.count?b.enable(b.STENCIL_TEST):b.disable(b.STENCIL_TEST);this.applyFilterPass(a,k,c,d);this.texturePool.push(f);g._glFilterTexture=null};p.WebGLFilterManager.prototype.applyFilterPass=
function(b,g,k,f){g=this.gl;var m=b.shaders[g.id];m||(m=new p.PixiShader(g),m.fragmentSrc=b.fragmentSrc,m.uniforms=b.uniforms,m.init(),b.shaders[g.id]=m);this.renderSession.shaderManager.setShader(m);g.uniform2f(m.projectionVector,k/2,-f/2);g.uniform2f(m.offsetVector,0,0);b.uniforms.dimensions&&(b.uniforms.dimensions.value[0]=this.width,b.uniforms.dimensions.value[1]=this.height,b.uniforms.dimensions.value[2]=this.vertexArray[0],b.uniforms.dimensions.value[3]=this.vertexArray[5]);m.syncUniforms();
g.bindBuffer(g.ARRAY_BUFFER,this.vertexBuffer);g.vertexAttribPointer(m.aVertexPosition,2,g.FLOAT,!1,0,0);g.bindBuffer(g.ARRAY_BUFFER,this.uvBuffer);g.vertexAttribPointer(m.aTextureCoord,2,g.FLOAT,!1,0,0);g.bindBuffer(g.ARRAY_BUFFER,this.colorBuffer);g.vertexAttribPointer(m.colorAttribute,2,g.FLOAT,!1,0,0);g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this.indexBuffer);g.drawElements(g.TRIANGLES,6,g.UNSIGNED_SHORT,0);this.renderSession.drawCount++};p.WebGLFilterManager.prototype.initShaderBuffers=function(){var b=
this.gl;this.vertexBuffer=b.createBuffer();this.uvBuffer=b.createBuffer();this.colorBuffer=b.createBuffer();this.indexBuffer=b.createBuffer();this.vertexArray=new p.Float32Array([0,0,1,0,0,1,1,1]);b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer);b.bufferData(b.ARRAY_BUFFER,this.vertexArray,b.STATIC_DRAW);this.uvArray=new p.Float32Array([0,0,1,0,0,1,1,1]);b.bindBuffer(b.ARRAY_BUFFER,this.uvBuffer);b.bufferData(b.ARRAY_BUFFER,this.uvArray,b.STATIC_DRAW);this.colorArray=new p.Float32Array([1,16777215,
1,16777215,1,16777215,1,16777215]);b.bindBuffer(b.ARRAY_BUFFER,this.colorBuffer);b.bufferData(b.ARRAY_BUFFER,this.colorArray,b.STATIC_DRAW);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),b.STATIC_DRAW)};p.WebGLFilterManager.prototype.destroy=function(){var b=this.gl;this.filterStack=null;for(var g=this.offsetY=this.offsetX=0;g<this.texturePool.length;g++)this.texturePool[g].destroy();this.texturePool=null;b.deleteBuffer(this.vertexBuffer);
b.deleteBuffer(this.uvBuffer);b.deleteBuffer(this.colorBuffer);b.deleteBuffer(this.indexBuffer)};p.FilterTexture=function(b,g,k,f){this.gl=b;this.frameBuffer=b.createFramebuffer();this.texture=b.createTexture();f=f||p.scaleModes.DEFAULT;b.bindTexture(b.TEXTURE_2D,this.texture);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,f===p.scaleModes.LINEAR?b.LINEAR:b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f===p.scaleModes.LINEAR?b.LINEAR:b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,
b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.bindFramebuffer(b.FRAMEBUFFER,this.frameBuffer);b.bindFramebuffer(b.FRAMEBUFFER,this.frameBuffer);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this.texture,0);this.renderBuffer=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,this.renderBuffer);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,this.renderBuffer);this.resize(g,k)};p.FilterTexture.prototype.constructor=
p.FilterTexture;p.FilterTexture.prototype.clear=function(){var b=this.gl;b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT)};p.FilterTexture.prototype.resize=function(b,g){if(this.width!==b||this.height!==g){this.width=b;this.height=g;var k=this.gl;k.bindTexture(k.TEXTURE_2D,this.texture);k.texImage2D(k.TEXTURE_2D,0,k.RGBA,b,g,0,k.RGBA,k.UNSIGNED_BYTE,null);k.bindRenderbuffer(k.RENDERBUFFER,this.renderBuffer);k.renderbufferStorage(k.RENDERBUFFER,k.DEPTH_STENCIL,b,g)}};p.FilterTexture.prototype.destroy=
function(){var b=this.gl;b.deleteFramebuffer(this.frameBuffer);b.deleteTexture(this.texture);this.texture=this.frameBuffer=null};p.CanvasBuffer=function(b,g){this.width=b;this.height=g;this.canvas=p.CanvasPool.create(this,this.width,this.height);this.context=this.canvas.getContext("2d");this.canvas.width=b;this.canvas.height=g};p.CanvasBuffer.prototype.constructor=p.CanvasBuffer;p.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,
this.height)};p.CanvasBuffer.prototype.resize=function(b,g){this.width=this.canvas.width=b;this.height=this.canvas.height=g};p.CanvasBuffer.prototype.destroy=function(){p.CanvasPool.remove(this)};p.CanvasMaskManager=function(){};p.CanvasMaskManager.prototype.constructor=p.CanvasMaskManager;p.CanvasMaskManager.prototype.pushMask=function(b,g){var k=g.context;k.save();var f=b.alpha,m=b.worldTransform,n=g.resolution;k.setTransform(m.a*n,m.b*n,m.c*n,m.d*n,m.tx*n,m.ty*n);p.CanvasGraphics.renderGraphicsMask(b,
k);k.clip();b.worldAlpha=f};p.CanvasMaskManager.prototype.popMask=function(b){b.context.restore()};p.CanvasTinter=function(){};p.CanvasTinter.getTintedTexture=function(b,g){var k=b.tintedTexture||p.CanvasPool.create(this);p.CanvasTinter.tintMethod(b.texture,g,k);return k};p.CanvasTinter.tintWithMultiply=function(b,g,k){var f=k.getContext("2d"),m=b.crop;if(k.width!==m.width||k.height!==m.height)k.width=m.width,k.height=m.height;f.clearRect(0,0,m.width,m.height);f.fillStyle="#"+("00000"+(g|0).toString(16)).substr(-6);
f.fillRect(0,0,m.width,m.height);f.globalCompositeOperation="multiply";f.drawImage(b.baseTexture.source,m.x,m.y,m.width,m.height,0,0,m.width,m.height);f.globalCompositeOperation="destination-atop";f.drawImage(b.baseTexture.source,m.x,m.y,m.width,m.height,0,0,m.width,m.height)};p.CanvasTinter.tintWithPerPixel=function(b,g,k){var f=k.getContext("2d"),m=b.crop;k.width=m.width;k.height=m.height;f.globalCompositeOperation="copy";f.drawImage(b.baseTexture.source,m.x,m.y,m.width,m.height,0,0,m.width,m.height);
k=p.hex2rgb(g);b=k[0];g=k[1];k=k[2];for(var m=f.getImageData(0,0,m.width,m.height),n=m.data,a=0;a<n.length;a+=4)if(n[a+0]*=b,n[a+1]*=g,n[a+2]*=k,!p.CanvasTinter.canHandleAlpha){var c=n[a+3];n[a+0]/=255/c;n[a+1]/=255/c;n[a+2]/=255/c}f.putImageData(m,0,0)};p.CanvasTinter.checkInverseAlpha=function(){var b=new p.CanvasBuffer(2,1);b.context.fillStyle="rgba(10, 20, 30, 0.5)";b.context.fillRect(0,0,1,1);var g=b.context.getImageData(0,0,1,1);if(null===g)return!1;b.context.putImageData(g,1,0);b=b.context.getImageData(1,
0,1,1);return b.data[0]===g.data[0]&&b.data[1]===g.data[1]&&b.data[2]===g.data[2]&&b.data[3]===g.data[3]};p.CanvasTinter.canHandleAlpha=p.CanvasTinter.checkInverseAlpha();p.CanvasTinter.canUseMultiply=p.canUseNewCanvasBlendModes();p.CanvasTinter.tintMethod=p.CanvasTinter.canUseMultiply?p.CanvasTinter.tintWithMultiply:p.CanvasTinter.tintWithPerPixel;p.CanvasRenderer=function(b){this.game=b;p.defaultRenderer||(p.defaultRenderer=this);this.type=p.CANVAS_RENDERER;this.resolution=b.resolution;this.clearBeforeRender=
b.clearBeforeRender;this.transparent=b.transparent;this.autoResize=!1;this.width=b.width*this.resolution;this.height=b.height*this.resolution;this.view=b.canvas;this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=!0;this.count=0;this.maskManager=new p.CanvasMaskManager;this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:Phaser.Canvas.getSmoothingPrefix(this.context),roundPixels:!1};this.mapBlendModes();this.resize(this.width,
this.height)};p.CanvasRenderer.prototype.constructor=p.CanvasRenderer;p.CanvasRenderer.prototype.render=function(b){this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.renderSession.currentBlendMode=0;this.renderSession.shakeX=this.game.camera._shake.x;this.renderSession.shakeY=this.game.camera._shake.y;this.context.globalCompositeOperation="source-over";navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear());this.clearBeforeRender&&(this.transparent?
this.context.clearRect(0,0,this.width,this.height):b._bgColor&&(this.context.fillStyle=b._bgColor.rgba,this.context.fillRect(0,0,this.width,this.height)));this.renderDisplayObject(b)};p.CanvasRenderer.prototype.destroy=function(b){void 0===b&&(b=!0);b&&this.view.parent&&this.view.parent.removeChild(this.view);this.renderSession=this.maskManager=this.context=this.view=null};p.CanvasRenderer.prototype.resize=function(b,g){this.width=b*this.resolution;this.height=g*this.resolution;this.view.width=this.width;
this.view.height=this.height;this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px");this.renderSession.smoothProperty&&(this.context[this.renderSession.smoothProperty]=this.renderSession.scaleMode===p.scaleModes.LINEAR)};p.CanvasRenderer.prototype.renderDisplayObject=function(b,g,k){this.renderSession.context=g||this.context;this.renderSession.resolution=this.resolution;b._renderCanvas(this.renderSession,k)};p.CanvasRenderer.prototype.mapBlendModes=
function(){if(!p.blendModesCanvas){var b=[],g=p.blendModes,k=p.canUseNewCanvasBlendModes();b[g.NORMAL]="source-over";b[g.ADD]="lighter";b[g.MULTIPLY]=k?"multiply":"source-over";b[g.SCREEN]=k?"screen":"source-over";b[g.OVERLAY]=k?"overlay":"source-over";b[g.DARKEN]=k?"darken":"source-over";b[g.LIGHTEN]=k?"lighten":"source-over";b[g.COLOR_DODGE]=k?"color-dodge":"source-over";b[g.COLOR_BURN]=k?"color-burn":"source-over";b[g.HARD_LIGHT]=k?"hard-light":"source-over";b[g.SOFT_LIGHT]=k?"soft-light":"source-over";
b[g.DIFFERENCE]=k?"difference":"source-over";b[g.EXCLUSION]=k?"exclusion":"source-over";b[g.HUE]=k?"hue":"source-over";b[g.SATURATION]=k?"saturation":"source-over";b[g.COLOR]=k?"color":"source-over";b[g.LUMINOSITY]=k?"luminosity":"source-over";p.blendModesCanvas=b}};p.BaseTexture=function(b,g){this.resolution=1;this.height=this.width=100;this.scaleMode=g||p.scaleModes.DEFAULT;this.hasLoaded=!1;this.source=b;this.premultipliedAlpha=!0;this._glTextures=[];this.mipmap=!1;this._dirty=[!0,!0,!0,!0];b&&
((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height&&(this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty()),this._powerOf2=this.skipRender=!1)};p.BaseTexture.prototype.constructor=p.BaseTexture;p.BaseTexture.prototype.forceLoaded=function(b,g){this.hasLoaded=!0;this.width=b;this.height=g;this.dirty()};p.BaseTexture.prototype.destroy=function(){this.source&&p.CanvasPool.removeByCanvas(this.source);
this.source=null;this.unloadFromGPU()};p.BaseTexture.prototype.updateSourceImage=function(b){console.warn("PIXI.BaseTexture.updateSourceImage is deprecated. Use Phaser.Sprite.loadTexture instead.")};p.BaseTexture.prototype.dirty=function(){for(var b=0;b<this._glTextures.length;b++)this._dirty[b]=!0};p.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var b=this._glTextures.length-1;0<=b;b--){var g=this._glTextures[b],k=p.glContexts[b];k&&g&&k.deleteTexture(g)}this._glTextures.length=
0;this.dirty()};p.BaseTexture.fromCanvas=function(b,g){0===b.width&&(b.width=1);0===b.height&&(b.height=1);return new p.BaseTexture(b,g)};p.TextureSilentFail=!1;p.Texture=function(b,g,k,f){this.noFrame=!1;g||(this.noFrame=!0,g=new p.Rectangle(0,0,1,1));b instanceof p.Texture&&(b=b.baseTexture);this.baseTexture=b;this.frame=g;this.trim=f;this.requiresReTint=this.requiresUpdate=this.isTiling=this.valid=!1;this._uvs=null;this.height=this.width=0;this.crop=k||new p.Rectangle(0,0,1,1);b.hasLoaded&&(this.noFrame&&
(g=new p.Rectangle(0,0,b.width,b.height)),this.setFrame(g))};p.Texture.prototype.constructor=p.Texture;p.Texture.prototype.onBaseTextureLoaded=function(){var b=this.baseTexture;this.noFrame&&(this.frame=new p.Rectangle(0,0,b.width,b.height));this.setFrame(this.frame)};p.Texture.prototype.destroy=function(b){b&&this.baseTexture.destroy();this.valid=!1};p.Texture.prototype.setFrame=function(b){this.noFrame=!1;this.frame=b;this.width=b.width;this.height=b.height;this.crop.x=b.x;this.crop.y=b.y;this.crop.width=
b.width;this.crop.height=b.height;if(!this.trim&&(b.x+b.width>this.baseTexture.width||b.y+b.height>this.baseTexture.height)){if(!p.TextureSilentFail)throw Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=!1}else this.valid=b&&b.width&&b.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()};
p.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new p.TextureUvs);var b=this.crop,g=this.baseTexture.width,k=this.baseTexture.height;this._uvs.x0=b.x/g;this._uvs.y0=b.y/k;this._uvs.x1=(b.x+b.width)/g;this._uvs.y1=b.y/k;this._uvs.x2=(b.x+b.width)/g;this._uvs.y2=(b.y+b.height)/k;this._uvs.x3=b.x/g;this._uvs.y3=(b.y+b.height)/k};p.Texture.fromCanvas=function(b,g){var k=p.BaseTexture.fromCanvas(b,g);return new p.Texture(k)};p.TextureUvs=function(){this.y3=this.x3=this.y2=this.x2=this.y1=
this.x1=this.y0=this.x0=0};p.RenderTexture=function(b,g,k,f,m){this.width=b||100;this.height=g||100;this.resolution=m||1;this.frame=new p.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution);this.crop=new p.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution);this.baseTexture=new p.BaseTexture;this.baseTexture.width=this.width*this.resolution;this.baseTexture.height=this.height*this.resolution;this.baseTexture._glTextures=[];this.baseTexture.resolution=this.resolution;
this.baseTexture.scaleMode=f||p.scaleModes.DEFAULT;this.baseTexture.hasLoaded=!0;p.Texture.call(this,this.baseTexture,new p.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution));this.renderer=k||p.defaultRenderer;this.renderer.type===p.WEBGL_RENDERER?(b=this.renderer.gl,this.baseTexture._dirty[b.id]=!1,this.textureBuffer=new p.FilterTexture(b,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[b.id]=this.textureBuffer.texture,this.render=this.renderWebGL,
this.projection=new p.Point(.5*this.width,.5*-this.height)):(this.render=this.renderCanvas,this.textureBuffer=new p.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas);this.valid=!0;this.tempMatrix=new Phaser.Matrix;this._updateUvs()};p.RenderTexture.prototype=Object.create(p.Texture.prototype);p.RenderTexture.prototype.constructor=p.RenderTexture;p.RenderTexture.prototype.resize=function(b,g,k){if(b!==this.width||g!==this.height)this.valid=
0<b&&0<g,this.width=b,this.height=g,this.frame.width=this.crop.width=b*this.resolution,this.frame.height=this.crop.height=g*this.resolution,k&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===p.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width,this.height)};p.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===p.WEBGL_RENDERER&&
this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())};p.RenderTexture.prototype.renderWebGL=function(b,g,k){if(this.valid&&0!==b.alpha){var f=b.worldTransform;f.identity();f.translate(0,2*this.projection.y);g&&f.append(g);f.scale(1,-1);for(f=0;f<b.children.length;f++)b.children[f].updateTransform();f=this.renderer.gl;f.viewport(0,0,this.width*this.resolution,this.height*this.resolution);f.bindFramebuffer(f.FRAMEBUFFER,this.textureBuffer.frameBuffer);
k&&this.textureBuffer.clear();this.renderer.spriteBatch.dirty=!0;this.renderer.renderDisplayObject(b,this.projection,this.textureBuffer.frameBuffer,g);this.renderer.spriteBatch.dirty=!0}};p.RenderTexture.prototype.renderCanvas=function(b,g,k){if(this.valid&&0!==b.alpha){var f=b.worldTransform;f.identity();g&&f.append(g);for(f=0;f<b.children.length;f++)b.children[f].updateTransform();k&&this.textureBuffer.clear();k=this.renderer.resolution;this.renderer.resolution=this.resolution;this.renderer.renderDisplayObject(b,
this.textureBuffer.context,g);this.renderer.resolution=k}};p.RenderTexture.prototype.getImage=function(){var b=new Image;b.src=this.getBase64();return b};p.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()};p.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===p.WEBGL_RENDERER){var b=this.renderer.gl,g=this.textureBuffer.width,k=this.textureBuffer.height,f=new Uint8Array(4*g*k);b.bindFramebuffer(b.FRAMEBUFFER,this.textureBuffer.frameBuffer);b.readPixels(0,
0,g,k,b.RGBA,b.UNSIGNED_BYTE,f);b.bindFramebuffer(b.FRAMEBUFFER,null);b=new p.CanvasBuffer(g,k);g=b.context.getImageData(0,0,g,k);g.data.set(f);b.context.putImageData(g,0,0);return b.canvas}return this.textureBuffer.canvas};p.AbstractFilter=function(b,g){this.passes=[this];this.shaders=[];this.dirty=!0;this.padding=0;this.uniforms=g||{};this.fragmentSrc=b||[]};p.AbstractFilter.prototype.constructor=p.AbstractFilter;p.AbstractFilter.prototype.syncUniforms=function(){for(var b=0,g=this.shaders.length;b<
g;b++)this.shaders[b].dirty=!0};p.Strip=function(b){p.DisplayObjectContainer.call(this);this.texture=b;this.uvs=new p.Float32Array([0,1,1,1,1,0,0,1]);this.vertices=new p.Float32Array([0,0,100,0,100,100,0,100]);this.colors=new p.Float32Array([1,1,1,1]);this.indices=new p.Uint16Array([0,1,2,3]);this.dirty=!0;this.blendMode=p.blendModes.NORMAL;this.canvasPadding=0;this.drawMode=p.Strip.DrawModes.TRIANGLE_STRIP};p.Strip.prototype=Object.create(p.DisplayObjectContainer.prototype);p.Strip.prototype.constructor=
p.Strip;p.Strip.prototype._renderWebGL=function(b){!this.visible||0>=this.alpha||(b.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(b),b.shaderManager.setShader(b.shaderManager.stripShader),this._renderStrip(b),b.spriteBatch.start())};p.Strip.prototype._initWebGL=function(b){b=b.gl;this._vertexBuffer=b.createBuffer();this._indexBuffer=b.createBuffer();this._uvBuffer=b.createBuffer();this._colorBuffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this._vertexBuffer);b.bufferData(b.ARRAY_BUFFER,
this.vertices,b.DYNAMIC_DRAW);b.bindBuffer(b.ARRAY_BUFFER,this._uvBuffer);b.bufferData(b.ARRAY_BUFFER,this.uvs,b.STATIC_DRAW);b.bindBuffer(b.ARRAY_BUFFER,this._colorBuffer);b.bufferData(b.ARRAY_BUFFER,this.colors,b.STATIC_DRAW);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._indexBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.indices,b.STATIC_DRAW)};p.Strip.prototype._renderStrip=function(b){var g=b.gl,k=b.projection,f=b.offset,m=b.shaderManager.stripShader,n=this.drawMode===p.Strip.DrawModes.TRIANGLE_STRIP?
g.TRIANGLE_STRIP:g.TRIANGLES;b.blendModeManager.setBlendMode(this.blendMode);g.uniformMatrix3fv(m.translationMatrix,!1,this.worldTransform.toArray(!0));g.uniform2f(m.projectionVector,k.x,-k.y);g.uniform2f(m.offsetVector,-f.x,-f.y);g.uniform1f(m.alpha,this.worldAlpha);this.dirty?(this.dirty=!1,g.bindBuffer(g.ARRAY_BUFFER,this._vertexBuffer),g.bufferData(g.ARRAY_BUFFER,this.vertices,g.STATIC_DRAW),g.vertexAttribPointer(m.aVertexPosition,2,g.FLOAT,!1,0,0),g.bindBuffer(g.ARRAY_BUFFER,this._uvBuffer),
g.bufferData(g.ARRAY_BUFFER,this.uvs,g.STATIC_DRAW),g.vertexAttribPointer(m.aTextureCoord,2,g.FLOAT,!1,0,0),g.activeTexture(g.TEXTURE0),this.texture.baseTexture._dirty[g.id]?b.renderer.updateTexture(this.texture.baseTexture):g.bindTexture(g.TEXTURE_2D,this.texture.baseTexture._glTextures[g.id]),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this._indexBuffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,this.indices,g.STATIC_DRAW)):(g.bindBuffer(g.ARRAY_BUFFER,this._vertexBuffer),g.bufferSubData(g.ARRAY_BUFFER,0,this.vertices),
g.vertexAttribPointer(m.aVertexPosition,2,g.FLOAT,!1,0,0),g.bindBuffer(g.ARRAY_BUFFER,this._uvBuffer),g.vertexAttribPointer(m.aTextureCoord,2,g.FLOAT,!1,0,0),g.activeTexture(g.TEXTURE0),this.texture.baseTexture._dirty[g.id]?b.renderer.updateTexture(this.texture.baseTexture):g.bindTexture(g.TEXTURE_2D,this.texture.baseTexture._glTextures[g.id]),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this._indexBuffer));g.drawElements(n,this.indices.length,g.UNSIGNED_SHORT,0)};p.Strip.prototype._renderCanvas=function(b){var g=
b.context,k=this.worldTransform,f=k.tx*b.resolution+b.shakeX,m=k.ty*b.resolution+b.shakeY;b.roundPixels?g.setTransform(k.a,k.b,k.c,k.d,f|0,m|0):g.setTransform(k.a,k.b,k.c,k.d,f,m);this.drawMode===p.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(g):this._renderCanvasTriangles(g)};p.Strip.prototype._renderCanvasTriangleStrip=function(b){var g=this.vertices,k=this.uvs,f=g.length/2;this.count++;for(var m=0;m<f-2;m++){var n=2*m;this._renderCanvasDrawTriangle(b,g,k,n,n+2,n+4)}};p.Strip.prototype._renderCanvasTriangles=
function(b){var g=this.vertices,k=this.uvs,f=this.indices,m=f.length;this.count++;for(var n=0;n<m;n+=3)this._renderCanvasDrawTriangle(b,g,k,2*f[n],2*f[n+1],2*f[n+2])};p.Strip.prototype._renderCanvasDrawTriangle=function(b,g,k,f,m,n){var a=this.texture.baseTexture.source,c=this.texture.width,d=this.texture.height,e=g[f],h=g[m],l=g[n],q=g[f+1],t=g[m+1];g=g[n+1];var v=k[f]*c,r=k[m]*c,c=k[n]*c;f=k[f+1]*d;m=k[m+1]*d;k=k[n+1]*d;if(0<this.canvasPadding){n=this.canvasPadding/this.worldTransform.a;var d=this.canvasPadding/
this.worldTransform.d,p=(e+h+l)/3,w=(q+t+g)/3,u=e-p,x=q-w,z=Math.sqrt(u*u+x*x),e=p+u/z*(z+n),q=w+x/z*(z+d),u=h-p,x=t-w,z=Math.sqrt(u*u+x*x),h=p+u/z*(z+n),t=w+x/z*(z+d),u=l-p,x=g-w,z=Math.sqrt(u*u+x*x),l=p+u/z*(z+n);g=w+x/z*(z+d)}b.save();b.beginPath();b.moveTo(e,q);b.lineTo(h,t);b.lineTo(l,g);b.closePath();b.clip();n=v*m+f*c+r*k-m*c-f*r-v*k;b.transform((e*m+f*l+h*k-m*l-f*h-e*k)/n,(q*m+f*g+t*k-m*g-f*t-q*k)/n,(v*h+e*c+r*l-h*c-e*r-v*l)/n,(v*t+q*c+r*g-t*c-q*r-v*g)/n,(v*m*l+f*h*c+e*r*k-e*m*c-f*r*l-v*h*
k)/n,(v*m*g+f*t*c+q*r*k-q*m*c-f*r*g-v*t*k)/n);b.drawImage(a,0,0);b.restore()};p.Strip.prototype.renderStripFlat=function(b){var g=this.context;b=b.vertices;var k=b.length/2;this.count++;g.beginPath();for(var f=1;f<k-2;f++){var m=2*f,n=b[m+2],a=b[m+4],c=b[m+3],d=b[m+5];g.moveTo(b[m],b[m+1]);g.lineTo(n,c);g.lineTo(a,d)}g.fillStyle="#FF0000";g.fill();g.closePath()};p.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0};p.Strip.prototype.getBounds=function(b){var g=b||this.worldTransform;b=
g.a;for(var k=g.b,f=g.c,m=g.d,n=g.tx,a=g.ty,c=g=-Infinity,d=Infinity,e=Infinity,h=this.vertices,l=0,q=h.length;l<q;l+=2)var t=h[l],v=h[l+1],r=b*t+f*v+n,t=m*v+k*t+a,d=r<d?r:d,e=t<e?t:e,g=r>g?r:g,c=t>c?t:c;if(-Infinity===d||Infinity===c)return p.EmptyRectangle;b=this._bounds;b.x=d;b.width=g-d;b.y=e;b.height=c-e;return this._currentBounds=b};p.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1};p.Rope=function(b,g){p.Strip.call(this,b);this.points=g;this.vertices=new p.Float32Array(4*g.length);this.uvs=new p.Float32Array(4*
g.length);this.colors=new p.Float32Array(2*g.length);this.indices=new p.Uint16Array(2*g.length);this.refresh()};p.Rope.prototype=Object.create(p.Strip.prototype);p.Rope.prototype.constructor=p.Rope;p.Rope.prototype.refresh=function(){var b=this.points;if(!(1>b.length)){var g=this.uvs,k=this.indices,f=this.colors;this.count-=.2;g[0]=0;g[1]=0;g[2]=0;g[3]=1;f[0]=1;f[1]=1;k[0]=0;k[1]=1;for(var b=b.length,m,n,a=1;a<b;a++)m=4*a,n=a/(b-1),g[m]=n,g[m+1]=0,g[m+2]=n,g[m+3]=1,m=2*a,f[m]=1,f[m+1]=1,m=2*a,k[m]=
m,k[m+1]=m+1}};p.Rope.prototype.updateTransform=function(){var b=this.points;if(!(1>b.length)){var g=b[0],k,f;this.count-=.2;for(var m=this.vertices,n=b.length,a,c,d,e=0;e<n;e++)a=b[e],c=4*e,k=e<b.length-1?b[e+1]:a,f=-(k.x-g.x),g=k.y-g.y,k=Math.sqrt(g*g+f*f),d=this.texture.height/2,g/=k,f/=k,g*=d,f*=d,m[c]=a.x+g,m[c+1]=a.y+f,m[c+2]=a.x-g,m[c+3]=a.y-f,g=a;p.DisplayObjectContainer.prototype.updateTransform.call(this)}};p.Rope.prototype.setTexture=function(b){this.texture=b};p.TilingSprite=function(b,
g,k){p.Sprite.call(this,b);this._width=g||128;this._height=k||128;this.tileScale=new p.Point(1,1);this.tileScaleOffset=new p.Point(1,1);this.tilePosition=new p.Point;this.renderable=!0;this.tint=16777215;this.textureDebug=!1;this.blendMode=p.blendModes.NORMAL;this.tilePattern=this.tilingTexture=this.canvasBuffer=null;this.refreshTexture=!0;this.frameHeight=this.frameWidth=0};p.TilingSprite.prototype=Object.create(p.Sprite.prototype);p.TilingSprite.prototype.constructor=p.TilingSprite;p.TilingSprite.prototype.setTexture=
function(b){this.texture!==b&&(this.texture=b,this.refreshTexture=!0,this.cachedTint=16777215)};p.TilingSprite.prototype._renderWebGL=function(b){if(this.visible&&this.renderable&&0!==this.alpha){this._mask&&(b.spriteBatch.stop(),b.maskManager.pushMask(this.mask,b),b.spriteBatch.start());this._filters&&(b.spriteBatch.flush(),b.filterManager.pushFilter(this._filterBlock));if(this.refreshTexture)if(this.generateTilingTexture(!0,b),this.tilingTexture)this.tilingTexture.needsUpdate&&(b.renderer.updateTexture(this.tilingTexture.baseTexture),
this.tilingTexture.needsUpdate=!1);else return;b.spriteBatch.renderTilingSprite(this);for(var g=0;g<this.children.length;g++)this.children[g]._renderWebGL(b);b.spriteBatch.stop();this._filters&&b.filterManager.popFilter();this._mask&&b.maskManager.popMask(this._mask,b);b.spriteBatch.start()}};p.TilingSprite.prototype._renderCanvas=function(b){if(this.visible&&this.renderable&&0!==this.alpha){var g=b.context;this._mask&&b.maskManager.pushMask(this._mask,b);g.globalAlpha=this.worldAlpha;var k=this.worldTransform,
f=b.resolution,m=k.tx*f+b.shakeX,n=k.ty*f+b.shakeY;g.setTransform(k.a*f,k.b*f,k.c*f,k.d*f,m,n);if(this.refreshTexture)if(this.generateTilingTexture(!1,b),this.tilingTexture)this.tilePattern=g.createPattern(this.tilingTexture.baseTexture.source,"repeat");else return;k=b.currentBlendMode;this.blendMode!==b.currentBlendMode&&(b.currentBlendMode=this.blendMode,g.globalCompositeOperation=p.blendModesCanvas[b.currentBlendMode]);var f=this.tilePosition,a=this.tileScale;f.x%=this.tilingTexture.baseTexture.width;
f.y%=this.tilingTexture.baseTexture.height;g.scale(a.x,a.y);g.translate(f.x+this.anchor.x*-this._width,f.y+this.anchor.y*-this._height);g.fillStyle=this.tilePattern;var m=-f.x,n=-f.y,c=this._width/a.x,d=this._height/a.y;b.roundPixels&&(m|=0,n|=0,c|=0,d|=0);g.fillRect(m,n,c,d);g.scale(1/a.x,1/a.y);g.translate(-f.x+this.anchor.x*this._width,-f.y+this.anchor.y*this._height);this._mask&&b.maskManager.popMask(b);for(m=0;m<this.children.length;m++)this.children[m]._renderCanvas(b);k!==this.blendMode&&(b.currentBlendMode=
k,g.globalCompositeOperation=p.blendModesCanvas[k])}};p.TilingSprite.prototype.onTextureUpdate=function(){};p.TilingSprite.prototype.generateTilingTexture=function(b,g){if(this.texture.baseTexture.hasLoaded){var k=this.texture,f=k.frame,m=this._frame.sourceSizeW||this._frame.width,n=this._frame.sourceSizeH||this._frame.height,a=0,c=0;this._frame.trimmed&&(a=this._frame.spriteSourceSizeX,c=this._frame.spriteSourceSizeY);b&&(m=p.getNextPowerOfTwo(m),n=p.getNextPowerOfTwo(n));this.canvasBuffer?(this.canvasBuffer.resize(m,
n),this.tilingTexture.baseTexture.width=m,this.tilingTexture.baseTexture.height=n):(this.canvasBuffer=new p.CanvasBuffer(m,n),this.tilingTexture=p.Texture.fromCanvas(this.canvasBuffer.canvas),this.tilingTexture.isTiling=!0);this.tilingTexture.needsUpdate=!0;this.textureDebug&&(this.canvasBuffer.context.strokeStyle="#00ff00",this.canvasBuffer.context.strokeRect(0,0,m,n));var d=k.crop.width,e=k.crop.height;if(d!==m||e!==n)d=m,e=n;this.canvasBuffer.context.drawImage(k.baseTexture.source,k.crop.x,k.crop.y,
k.crop.width,k.crop.height,a,c,d,e);this.tileScaleOffset.x=f.width/m;this.tileScaleOffset.y=f.height/n;this.refreshTexture=!1;this.tilingTexture.baseTexture._powerOf2=!0}};p.TilingSprite.prototype.getBounds=function(){var b=this._width,g=this._height,k=b*(1-this.anchor.x),f=b*-this.anchor.x,m=g*(1-this.anchor.y),n=g*-this.anchor.y,g=this.worldTransform,a=g.a,c=g.b,d=g.c,e=g.d,h=g.tx,l=g.ty,g=a*f+d*n+h,b=e*n+c*f+l,q=a*k+d*n+h,n=e*n+c*k+l,t=a*k+d*m+h,k=e*m+c*k+l,a=a*f+d*m+h,f=e*m+c*f+l,c=m=-Infinity,
d=e=Infinity,e=g<e?g:e,e=q<e?q:e,e=t<e?t:e,e=a<e?a:e,d=b<d?b:d,d=n<d?n:d,d=k<d?k:d,d=f<d?f:d,m=g>m?g:m,m=q>m?q:m,m=t>m?t:m,c=b>c?b:c,c=n>c?n:c,c=k>c?k:c,g=this._bounds;g.x=e;g.width=(a>m?a:m)-e;g.y=d;g.height=(f>c?f:c)-d;return this._currentBounds=g};p.TilingSprite.prototype.destroy=function(){p.Sprite.prototype.destroy.call(this);this.canvasBuffer&&(this.canvasBuffer.destroy(),this.canvasBuffer=null);this.tilePosition=this.tileScaleOffset=this.tileScale=null;this.tilingTexture&&(this.tilingTexture.destroy(!0),
this.tilingTexture=null)};Object.defineProperty(p.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(b){this._width=b}});Object.defineProperty(p.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(b){this._height=b}});"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=p),exports.PIXI=p):"undefined"!==typeof define&&define.amd?define("PIXI",this.PIXI=p):this.PIXI=p;return p}).call(this);
(function(){function p(a,c){this._scaleFactor=a;this._deltaMode=c;this.originalEvent=null}var b=b||{VERSION:"2.6.2",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,
CREATURE:27,VIDEO:28,PENDING_ATLAS:-1,HORIZONTAL:0,VERTICAL:1,LANDSCAPE:0,PORTRAIT:1,ANGLE_UP:270,ANGLE_DOWN:90,ANGLE_LEFT:180,ANGLE_RIGHT:0,ANGLE_NORTH_EAST:315,ANGLE_NORTH_WEST:225,ANGLE_SOUTH_EAST:45,ANGLE_SOUTH_WEST:135,TOP_LEFT:0,TOP_CENTER:1,TOP_RIGHT:2,LEFT_TOP:3,LEFT_CENTER:4,LEFT_BOTTOM:5,CENTER:6,RIGHT_TOP:7,RIGHT_CENTER:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM_CENTER:11,BOTTOM_RIGHT:12,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,
HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1},PIXI:PIXI||{}};Math.trunc||(Math.trunc=function(a){return 0>a?Math.ceil(a):Math.floor(a)});Function.prototype.bind||(Function.prototype.bind=function(){var a=Array.prototype.slice;return function(c){function b(){var d=h.concat(a.call(arguments));e.apply(this instanceof b?this:c,d)}var e=this,h=a.call(arguments,1);if("function"!==typeof e)throw new TypeError;
b.prototype=function q(a){a&&(q.prototype=a);if(!(this instanceof q))return new q}(e.prototype);return b}}());Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});Array.prototype.forEach||(Array.prototype.forEach=function(a){if(void 0===this||null===this)throw new TypeError;var c=Object(this),b=c.length>>>0;if("function"!==typeof a)throw new TypeError;for(var e=2<=arguments.length?arguments[1]:void 0,h=0;h<b;h++)h in c&&a.call(e,c[h],h,c)});if("function"!==
typeof window.Uint32Array&&"object"!==typeof window.Uint32Array){var g=function(a){window[a]=function(a){if("number"===typeof a){Array.call(this,a);this.length=a;for(var c=0;c<this.length;c++)this[c]=0}else for(Array.call(this,a.length),this.length=a.length,c=0;c<this.length;c++)this[c]=a[c]};window[a].prototype=[];window[a].constructor=window[a]};g("Uint32Array");g("Int16Array")}window.console||(window.console={},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=
function(){});b.Utils={reverseString:function(a){return a.split("").reverse().join("")},getProperty:function(a,c){for(var b=c.split("."),e=b.pop(),h=b.length,l=1,f=b[0];l<h&&(a=a[f]);)f=b[l],l++;return a?a[e]:null},setProperty:function(a,c,b){c=c.split(".");for(var d=c.pop(),h=c.length,l=1,f=c[0];l<h&&(a=a[f]);)f=c[l],l++;a&&(a[d]=b);return a},chanceRoll:function(a){void 0===a&&(a=50);return 0<a&&100*Math.random()<=a},randomChoice:function(a,c){return.5>Math.random()?a:c},parseDimension:function(a,
c){var b;"string"===typeof a?"%"===a.substr(-1)?(b=parseInt(a,10)/100,b=0===c?window.innerWidth*b:window.innerHeight*b):b=parseInt(a,10):b=a;return b},pad:function(a,c,b,e){void 0===c&&(c=0);void 0===b&&(b=" ");void 0===e&&(e=3);a=a.toString();if(c+1>=a.length)switch(e){case 1:a=Array(c+1-a.length).join(b)+a;break;case 3:e=Math.ceil((c-=a.length)/2);a=Array(c-e+1).join(b)+a+Array(e+1).join(b);break;default:a+=Array(c+1-a.length).join(b)}return a},isPlainObject:function(a){if("object"!==typeof a||
a.nodeType||a===a.window)return!1;try{if(a.constructor&&!{}.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}return!0},extend:function(){var a,c,d,e,h,l=arguments[0]||{},f=1,g=arguments.length,k=!1;"boolean"===typeof l&&(k=l,l=arguments[1]||{},f=2);g===f&&(l=this,--f);for(;f<g;f++)if(null!=(a=arguments[f]))for(c in a)d=l[c],e=a[c],l!==e&&(k&&e&&(b.Utils.isPlainObject(e)||(h=Array.isArray(e)))?(h?(h=!1,d=d&&Array.isArray(d)?d:[]):d=d&&b.Utils.isPlainObject(d)?
d:{},l[c]=b.Utils.extend(k,d,e)):void 0!==e&&(l[c]=e));return l},mixinPrototype:function(a,c,b){void 0===b&&(b=!1);for(var d=Object.keys(c),h=0;h<d.length;h++){var l=d[h],f=c[l];!b&&l in a||(!f||"function"!==typeof f.get&&"function"!==typeof f.set?a[l]=f:"function"===typeof f.clone?a[l]=f.clone():Object.defineProperty(a,l,f))}},mixin:function(a,c){if(!a||"object"!==typeof a)return c;for(var d in a){var e=a[d];if(!e.childNodes&&!e.cloneNode){var h=typeof a[d];c[d]=a[d]&&"object"===h?typeof c[d]===
h?b.Utils.mixin(a[d],c[d]):b.Utils.mixin(a[d],new e.constructor):a[d]}}return c}};b.Circle=function(a,c,d){d=d||0;this.x=a||0;this.y=c||0;this._diameter=d;this._radius=0;0<d&&(this._radius=.5*d);this.type=b.CIRCLE};b.Circle.prototype={circumference:function(){return 2*Math.PI*this._radius},random:function(a){void 0===a&&(a=new b.Point);var c=2*Math.PI*Math.random(),d=Math.random()+Math.random(),d=1<d?2-d:d,e=d*Math.sin(c);a.x=this.x+d*Math.cos(c)*this.radius;a.y=this.y+e*this.radius;return a},getBounds:function(){return new b.Rectangle(this.x-
this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(a,c,b){this.x=a;this.y=c;this._diameter=b;this._radius=.5*b;return this},copyFrom:function(a){return this.setTo(a.x,a.y,a.diameter)},copyTo:function(a){a.x=this.x;a.y=this.y;a.diameter=this._diameter;return a},distance:function(a,c){var d=b.Math.distance(this.x,this.y,a.x,a.y);return c?Math.round(d):d},clone:function(a){void 0===a||null===a?a=new b.Circle(this.x,this.y,this.diameter):a.setTo(this.x,this.y,this.diameter);return a},
contains:function(a,c){return b.Circle.contains(this,a,c)},circumferencePoint:function(a,c,d){return b.Circle.circumferencePoint(this,a,c,d)},offset:function(a,c){this.x+=a;this.y+=c;return this},offsetPoint:function(a){return this.offset(a.x,a.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}};b.Circle.prototype.constructor=b.Circle;Object.defineProperty(b.Circle.prototype,"diameter",{get:function(){return this._diameter},
set:function(a){0<a&&(this._diameter=a,this._radius=.5*a)}});Object.defineProperty(b.Circle.prototype,"radius",{get:function(){return this._radius},set:function(a){0<a&&(this._radius=a,this._diameter=2*a)}});Object.defineProperty(b.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(a){a>this.x?this._diameter=this._radius=0:this.radius=this.x-a}});Object.defineProperty(b.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(a){a<this.x?this._diameter=
this._radius=0:this.radius=a-this.x}});Object.defineProperty(b.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(a){a>this.y?this._diameter=this._radius=0:this.radius=this.y-a}});Object.defineProperty(b.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(a){a<this.y?this._diameter=this._radius=0:this.radius=a-this.y}});Object.defineProperty(b.Circle.prototype,"area",{get:function(){return 0<this._radius?Math.PI*this._radius*this._radius:
0}});Object.defineProperty(b.Circle.prototype,"empty",{get:function(){return 0===this._diameter},set:function(a){!0===a&&this.setTo(0,0,0)}});b.Circle.contains=function(a,c,b){return 0<a.radius&&c>=a.left&&c<=a.right&&b>=a.top&&b<=a.bottom?(a.x-c)*(a.x-c)+(a.y-b)*(a.y-b)<=a.radius*a.radius:!1};b.Circle.equals=function(a,c){return a.x===c.x&&a.y===c.y&&a.diameter===c.diameter};b.Circle.intersects=function(a,c){return b.Math.distance(a.x,a.y,c.x,c.y)<=a.radius+c.radius};b.Circle.circumferencePoint=
function(a,c,d,e){void 0===d&&(d=!1);void 0===e&&(e=new b.Point);!0===d&&(c=b.Math.degToRad(c));e.x=a.x+a.radius*Math.cos(c);e.y=a.y+a.radius*Math.sin(c);return e};b.Circle.intersectsRectangle=function(a,c){var b=Math.abs(a.x-c.x-c.halfWidth);if(b>c.halfWidth+a.radius)return!1;var e=Math.abs(a.y-c.y-c.halfHeight);if(e>c.halfHeight+a.radius)return!1;if(b<=c.halfWidth||e<=c.halfHeight)return!0;b-=c.halfWidth;e-=c.halfHeight;return b*b+e*e<=a.radius*a.radius};PIXI.Circle=b.Circle;b.Ellipse=function(a,
c,d,e){this.x=a||0;this.y=c||0;this.width=d||0;this.height=e||0;this.type=b.ELLIPSE};b.Ellipse.prototype={setTo:function(a,c,b,e){this.x=a;this.y=c;this.width=b;this.height=e;return this},getBounds:function(){return new b.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(a){return this.setTo(a.x,a.y,a.width,a.height)},copyTo:function(a){a.x=this.x;a.y=this.y;a.width=this.width;a.height=this.height;return a},clone:function(a){void 0===a||null===a?a=new b.Ellipse(this.x,
this.y,this.width,this.height):a.setTo(this.x,this.y,this.width,this.height);return a},contains:function(a,c){return b.Ellipse.contains(this,a,c)},random:function(a){void 0===a&&(a=new b.Point);var c=Math.random()*Math.PI*2,d=Math.random();a.x=Math.sqrt(d)*Math.cos(c);a.y=Math.sqrt(d)*Math.sin(c);a.x=this.x+a.x*this.width/2;a.y=this.y+a.y*this.height/2;return a},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}};b.Ellipse.prototype.constructor=
b.Ellipse;Object.defineProperty(b.Ellipse.prototype,"left",{get:function(){return this.x},set:function(a){this.x=a}});Object.defineProperty(b.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(a){this.width=a<this.x?0:a-this.x}});Object.defineProperty(b.Ellipse.prototype,"top",{get:function(){return this.y},set:function(a){this.y=a}});Object.defineProperty(b.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(a){this.height=a<this.y?0:a-
this.y}});Object.defineProperty(b.Ellipse.prototype,"empty",{get:function(){return 0===this.width||0===this.height},set:function(a){!0===a&&this.setTo(0,0,0,0)}});b.Ellipse.contains=function(a,c,b){if(0>=a.width||0>=a.height)return!1;c=(c-a.x)/a.width-.5;a=(b-a.y)/a.height-.5;return.25>c*c+a*a};PIXI.Ellipse=b.Ellipse;b.Line=function(a,c,d,e){d=d||0;e=e||0;this.start=new b.Point(a||0,c||0);this.end=new b.Point(d,e);this.type=b.LINE};b.Line.prototype={setTo:function(a,c,b,e){this.start.setTo(a,c);this.end.setTo(b,
e);return this},fromSprite:function(a,c,b){void 0===b&&(b=!1);return b?this.setTo(a.center.x,a.center.y,c.center.x,c.center.y):this.setTo(a.x,a.y,c.x,c.y)},fromAngle:function(a,c,b,e){this.start.setTo(a,c);this.end.setTo(a+Math.cos(b)*e,c+Math.sin(b)*e);return this},rotate:function(a,c){var b=(this.start.x+this.end.x)/2,e=(this.start.y+this.end.y)/2;this.start.rotate(b,e,a,c);this.end.rotate(b,e,a,c);return this},rotateAround:function(a,c,b,e){this.start.rotate(a,c,b,e);this.end.rotate(a,c,b,e);return this},
intersects:function(a,c,d){return b.Line.intersectsPoints(this.start,this.end,a.start,a.end,c,d)},reflect:function(a){return b.Line.reflect(this,a)},midPoint:function(a){void 0===a&&(a=new b.Point);a.x=(this.start.x+this.end.x)/2;a.y=(this.start.y+this.end.y)/2;return a},centerOn:function(a,c){var b=a-(this.start.x+this.end.x)/2,e=c-(this.start.y+this.end.y)/2;this.start.add(b,e);this.end.add(b,e)},pointOnLine:function(a,c){return(a-this.start.x)*(this.end.y-this.start.y)===(this.end.x-this.start.x)*
(c-this.start.y)},pointOnSegment:function(a,c){var b=Math.min(this.start.x,this.end.x),e=Math.max(this.start.x,this.end.x),h=Math.min(this.start.y,this.end.y),l=Math.max(this.start.y,this.end.y);return this.pointOnLine(a,c)&&a>=b&&a<=e&&c>=h&&c<=l},random:function(a){void 0===a&&(a=new b.Point);var c=Math.random();a.x=this.start.x+c*(this.end.x-this.start.x);a.y=this.start.y+c*(this.end.y-this.start.y);return a},coordinatesOnLine:function(a,c){void 0===a&&(a=1);void 0===c&&(c=[]);var b=Math.round(this.start.x),
e=Math.round(this.start.y),h=Math.round(this.end.x),l=Math.round(this.end.y),f=Math.abs(h-b),g=Math.abs(l-e),k=b<h?1:-1,r=e<l?1:-1,m=f-g;c.push([b,e]);for(var n=1;b!==h||e!==l;){var p=m<<1;p>-g&&(m-=g,b+=k);p<f&&(m+=f,e+=r);0===n%a&&c.push([b,e]);n++}return c},clone:function(a){void 0===a||null===a?a=new b.Line(this.start.x,this.start.y,this.end.x,this.end.y):a.setTo(this.start.x,this.start.y,this.end.x,this.end.y);return a}};Object.defineProperty(b.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-
this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}});Object.defineProperty(b.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}});Object.defineProperty(b.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}});Object.defineProperty(b.Line.prototype,"perpSlope",{get:function(){return-((this.end.x-this.start.x)/(this.end.y-this.start.y))}});Object.defineProperty(b.Line.prototype,
"x",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(b.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(b.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(b.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}});Object.defineProperty(b.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(b.Line.prototype,
"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}});Object.defineProperty(b.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}});Object.defineProperty(b.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}});Object.defineProperty(b.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}});Object.defineProperty(b.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}});
Object.defineProperty(b.Line.prototype,"normalAngle",{get:function(){return b.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}});b.Line.intersectsPoints=function(a,c,d,e,h,l){void 0===h&&(h=!0);void 0===l&&(l=new b.Point);var f=c.y-a.y,g=e.y-d.y,k=a.x-c.x,r=d.x-e.x,m=c.x*a.y-a.x*c.y,n=e.x*d.y-d.x*e.y,p=f*r-g*k;if(0===p)return null;l.x=(k*n-r*m)/p;l.y=(g*m-f*n)/p;return!h||(h=(e.y-d.y)*(c.x-a.x)-(e.x-d.x)*(c.y-a.y),e=((e.x-d.x)*(a.y-d.y)-(e.y-d.y)*(a.x-d.x))/h,a=((c.x-a.x)*(a.y-d.y)-(c.y-
a.y)*(a.x-d.x))/h,0<=e&&1>=e&&0<=a&&1>=a)?l:null};b.Line.intersects=function(a,c,d,e){return b.Line.intersectsPoints(a.start,a.end,c.start,c.end,d,e)};b.Line.intersectsRectangle=function(a,c){if(!b.Rectangle.intersects(a,c))return!1;var d=a.start.x,e=a.start.y,h=a.end.x,l=a.end.y,f=c.x,g=c.y,k=c.right,r=c.bottom,m;if(d>=f&&d<=k&&e>=g&&e<=r||h>=f&&h<=k&&l>=g&&l<=r)return!0;if(d<f&&h>=f){if(m=e+(l-e)*(f-d)/(h-d),m>g&&m<=r)return!0}else if(d>k&&h<=k&&(m=e+(l-e)*(k-d)/(h-d),m>=g&&m<=r))return!0;if(e<
g&&l>=g){if(m=d+(h-d)*(g-e)/(l-e),m>=f&&m<=k)return!0}else if(e>r&&l<=r&&(m=d+(h-d)*(r-e)/(l-e),m>=f&&m<=k))return!0;return!1};b.Line.reflect=function(a,c){return 2*c.normalAngle-3.141592653589793-a.angle};b.Matrix=function(a,c,d,e,h,l){if(void 0===a||null===a)a=1;if(void 0===c||null===c)c=0;if(void 0===d||null===d)d=0;if(void 0===e||null===e)e=1;if(void 0===h||null===h)h=0;if(void 0===l||null===l)l=0;this.a=a;this.b=c;this.c=d;this.d=e;this.tx=h;this.ty=l;this.type=b.MATRIX};b.Matrix.prototype={fromArray:function(a){return this.setTo(a[0],
a[1],a[3],a[4],a[2],a[5])},setTo:function(a,c,b,e,h,l){this.a=a;this.b=c;this.c=b;this.d=e;this.tx=h;this.ty=l;return this},clone:function(a){void 0===a||null===a?a=new b.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty):(a.a=this.a,a.b=this.b,a.c=this.c,a.d=this.d,a.tx=this.tx,a.ty=this.ty);return a},copyTo:function(a){a.copyFrom(this);return a},copyFrom:function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.d=a.d;this.tx=a.tx;this.ty=a.ty;return this},toArray:function(a,c){void 0===c&&(c=new PIXI.Float32Array(9));
a?(c[0]=this.a,c[1]=this.b,c[2]=0,c[3]=this.c,c[4]=this.d,c[5]=0,c[6]=this.tx,c[7]=this.ty):(c[0]=this.a,c[1]=this.c,c[2]=this.tx,c[3]=this.b,c[4]=this.d,c[5]=this.ty,c[6]=0,c[7]=0);c[8]=1;return c},apply:function(a,c){void 0===c&&(c=new b.Point);c.x=this.a*a.x+this.c*a.y+this.tx;c.y=this.b*a.x+this.d*a.y+this.ty;return c},applyInverse:function(a,c){void 0===c&&(c=new b.Point);var d=1/(this.a*this.d+this.c*-this.b),e=a.x,h=a.y;c.x=this.d*d*e+-this.c*d*h+(this.ty*this.c-this.tx*this.d)*d;c.y=this.a*
d*h+-this.b*d*e+(-this.ty*this.a+this.tx*this.b)*d;return c},translate:function(a,c){this.tx+=a;this.ty+=c;return this},scale:function(a,c){this.a*=a;this.d*=c;this.c*=a;this.b*=c;this.tx*=a;this.ty*=c;return this},rotate:function(a){var c=Math.cos(a);a=Math.sin(a);var b=this.a,e=this.c,h=this.tx;this.a=b*c-this.b*a;this.b=b*a+this.b*c;this.c=e*c-this.d*a;this.d=e*a+this.d*c;this.tx=h*c-this.ty*a;this.ty=h*a+this.ty*c;return this},append:function(a){var c=this.a,b=this.b,e=this.c,h=this.d;this.a=
a.a*c+a.b*e;this.b=a.a*b+a.b*h;this.c=a.c*c+a.d*e;this.d=a.c*b+a.d*h;this.tx=a.tx*c+a.ty*e+this.tx;this.ty=a.tx*b+a.ty*h+this.ty;return this},identity:function(){return this.setTo(1,0,0,1,0,0)}};b.identityMatrix=new b.Matrix;PIXI.Matrix=b.Matrix;PIXI.identityMatrix=b.identityMatrix;PIXI.Matrix.prototype.setTransform=function(a,c,b,e,h,l,f,g,k){var d,q,t,m;d=Math.sin(f);q=Math.cos(f);f=Math.cos(k);k=Math.sin(k);t=-Math.sin(g);m=Math.cos(g);g=q*h;h*=d;d=-d*l;l*=q;this.a=f*g+k*d;this.b=f*h+k*l;this.c=
t*g+m*d;this.d=t*h+m*l;this.tx=a+(b*g+e*d);this.ty=c+(b*h+e*l);return this};b.Point=function(a,c){this.x=a||0;this.y=c||0;this.type=b.POINT};b.Point.prototype={copyFrom:function(a){return this.setTo(a.x,a.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(a,c){this.x=a||0;this.y=c||(0!==c?this.x:0);return this},set:function(a,c){this.x=a||0;this.y=c||(0!==c?this.x:0);return this},add:function(a,c){this.x+=a;this.y+=c;return this},subtract:function(a,c){this.x-=a;this.y-=c;return this},
multiply:function(a,c){this.x*=a;this.y*=c;return this},divide:function(a,c){this.x/=a;this.y/=c;return this},clampX:function(a,c){this.x=b.Math.clamp(this.x,a,c);return this},clampY:function(a,c){this.y=b.Math.clamp(this.y,a,c);return this},clamp:function(a,c){this.x=b.Math.clamp(this.x,a,c);this.y=b.Math.clamp(this.y,a,c);return this},clone:function(a){void 0===a||null===a?a=new b.Point(this.x,this.y):a.setTo(this.x,this.y);return a},copyTo:function(a){a.x=this.x;a.y=this.y;return a},distance:function(a,
c){return b.Point.distance(this,a,c)},equals:function(a){return a.x===this.x&&a.y===this.y},angle:function(a,c){void 0===c&&(c=!1);return c?b.Math.radToDeg(Math.atan2(a.y-this.y,a.x-this.x)):Math.atan2(a.y-this.y,a.x-this.x)},rotate:function(a,c,d,e,h){return b.Point.rotate(this,a,c,d,e,h)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(a){return this.normalize().multiply(a,a)},normalize:function(){if(!this.isZero()){var a=
this.getMagnitude();this.x/=a;this.y/=a}return this},isZero:function(){return 0===this.x&&0===this.y},dot:function(a){return this.x*a.x+this.y*a.y},cross:function(a){return this.x*a.y-this.y*a.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(-1*this.y,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},
toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}};b.Point.prototype.constructor=b.Point;b.Point.add=function(a,c,d){void 0===d&&(d=new b.Point);d.x=a.x+c.x;d.y=a.y+c.y;return d};b.Point.subtract=function(a,c,d){void 0===d&&(d=new b.Point);d.x=a.x-c.x;d.y=a.y-c.y;return d};b.Point.multiply=function(a,c,d){void 0===d&&(d=new b.Point);d.x=a.x*c.x;d.y=a.y*c.y;return d};b.Point.divide=function(a,c,d){void 0===d&&(d=new b.Point);d.x=a.x/c.x;d.y=a.y/c.y;return d};b.Point.equals=function(a,
c){return a.x===c.x&&a.y===c.y};b.Point.angle=function(a,c){return Math.atan2(a.y-c.y,a.x-c.x)};b.Point.negative=function(a,c){void 0===c&&(c=new b.Point);return c.setTo(-a.x,-a.y)};b.Point.multiplyAdd=function(a,c,d,e){void 0===e&&(e=new b.Point);return e.setTo(a.x+c.x*d,a.y+c.y*d)};b.Point.interpolate=function(a,c,d,e){void 0===e&&(e=new b.Point);return e.setTo(a.x+(c.x-a.x)*d,a.y+(c.y-a.y)*d)};b.Point.perp=function(a,c){void 0===c&&(c=new b.Point);return c.setTo(-a.y,a.x)};b.Point.rperp=function(a,
c){void 0===c&&(c=new b.Point);return c.setTo(a.y,-a.x)};b.Point.distance=function(a,c,d){a=b.Math.distance(a.x,a.y,c.x,c.y);return d?Math.round(a):a};b.Point.project=function(a,c,d){void 0===d&&(d=new b.Point);a=a.dot(c)/c.getMagnitudeSq();0!==a&&d.setTo(a*c.x,a*c.y);return d};b.Point.projectUnit=function(a,c,d){void 0===d&&(d=new b.Point);a=a.dot(c);0!==a&&d.setTo(a*c.x,a*c.y);return d};b.Point.normalRightHand=function(a,c){void 0===c&&(c=new b.Point);return c.setTo(-1*a.y,a.x)};b.Point.normalize=
function(a,c){void 0===c&&(c=new b.Point);var d=a.getMagnitude();0!==d&&c.setTo(a.x/d,a.y/d);return c};b.Point.rotate=function(a,c,d,e,h,l){h&&(e=b.Math.degToRad(e));void 0===l?(a.subtract(c,d),l=Math.sin(e),e=Math.cos(e),h=l*a.x+e*a.y,a.x=e*a.x-l*a.y+c,a.y=h+d):(e+=Math.atan2(a.y-d,a.x-c),a.x=c+l*Math.cos(e),a.y=d+l*Math.sin(e));return a};b.Point.centroid=function(a,c){void 0===c&&(c=new b.Point);if("[object Array]"!==Object.prototype.toString.call(a))throw Error("Phaser.Point. Parameter 'points' must be an array");
var d=a.length;if(1>d)throw Error("Phaser.Point. Parameter 'points' array must not be empty");if(1===d)return c.copyFrom(a[0]),c;for(var e=0;e<d;e++)b.Point.add(c,a[e],c);c.divide(d,d);return c};b.Point.parse=function(a,c,d){c=c||"x";d=d||"y";var e=new b.Point;a[c]&&(e.x=parseInt(a[c],10));a[d]&&(e.y=parseInt(a[d],10));return e};PIXI.Point=b.Point;b.Polygon=function(){this.area=0;this._points=[];0<arguments.length&&this.setTo.apply(this,arguments);this.closed=!0;this.flattened=!1;this.type=b.POLYGON};
b.Polygon.prototype={toNumberArray:function(a){void 0===a&&(a=[]);for(var c=0;c<this._points.length;c++)"number"===typeof this._points[c]?(a.push(this._points[c]),a.push(this._points[c+1]),c++):(a.push(this._points[c].x),a.push(this._points[c].y));return a},flatten:function(){this._points=this.toNumberArray();this.flattened=!0;return this},clone:function(a){var c=this._points.slice();void 0===a||null===a?a=new b.Polygon(c):a.setTo(c);return a},contains:function(a,c){var b=!1;if(this.flattened)for(var e=
-2,h=this._points.length-2;(e+=2)<this._points.length;h=e){var l=this._points[e],f=this._points[e+1],g=this._points[h],h=this._points[h+1];(f<=c&&c<h||h<=c&&c<f)&&a<(g-l)*(c-f)/(h-f)+l&&(b=!b)}else for(e=-1,h=this._points.length-1;++e<this._points.length;h=e)l=this._points[e].x,f=this._points[e].y,g=this._points[h].x,h=this._points[h].y,(f<=c&&c<h||h<=c&&c<f)&&a<(g-l)*(c-f)/(h-f)+l&&(b=!b);return b},setTo:function(a){this.area=0;this._points=[];if(0<arguments.length){Array.isArray(a)||(a=Array.prototype.slice.call(arguments));
for(var c=Number.MAX_VALUE,b=0,e=a.length;b<e;b++){if("number"===typeof a[b]){var h=new PIXI.Point(a[b],a[b+1]);b++}else h=Array.isArray(a[b])?new PIXI.Point(a[b][0],a[b][1]):new PIXI.Point(a[b].x,a[b].y);this._points.push(h);h.y<c&&(c=h.y)}this.calculateArea(c)}return this},calculateArea:function(a){for(var c,b,e,h=0,l=this._points.length;h<l;h++)c=this._points[h],b=h===l-1?this._points[0]:this._points[h+1],e=(c.y-a+(b.y-a))/2,c=c.x-b.x,this.area+=e*c;return this.area}};b.Polygon.prototype.constructor=
b.Polygon;Object.defineProperty(b.Polygon.prototype,"points",{get:function(){return this._points},set:function(a){null!=a?this.setTo(a):this.setTo()}});PIXI.Polygon=b.Polygon;b.Rectangle=function(a,c,d,e){this.x=a||0;this.y=c||0;this.width=d||0;this.height=e||0;this.type=b.RECTANGLE};b.Rectangle.prototype={offset:function(a,c){this.x+=a;this.y+=c;return this},offsetPoint:function(a){return this.offset(a.x,a.y)},setTo:function(a,c,b,e){this.x=a;this.y=c;this.width=b;this.height=e;return this},scale:function(a,
c){void 0===c&&(c=a);this.width*=a;this.height*=c;return this},centerOn:function(a,c){this.centerX=a;this.centerY=c;return this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y)},ceilAll:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.width=Math.ceil(this.width);
this.height=Math.ceil(this.height)},copyFrom:function(a){return this.setTo(a.x,a.y,a.width,a.height)},copyTo:function(a){a.x=this.x;a.y=this.y;a.width=this.width;a.height=this.height;return a},inflate:function(a,c){return b.Rectangle.inflate(this,a,c)},size:function(a){return b.Rectangle.size(this,a)},resize:function(a,c){this.width=a;this.height=c;return this},clone:function(a){return b.Rectangle.clone(this,a)},contains:function(a,c){return b.Rectangle.contains(this,a,c)},containsRect:function(a){return b.Rectangle.containsRect(a,
this)},equals:function(a){return b.Rectangle.equals(this,a)},intersection:function(a,c){return b.Rectangle.intersection(this,a,c)},intersects:function(a){return b.Rectangle.intersects(this,a)},intersectsRaw:function(a,c,d,e,h){return b.Rectangle.intersectsRaw(this,a,c,d,e,h)},union:function(a,c){return b.Rectangle.union(this,a,c)},random:function(a){void 0===a&&(a=new b.Point);a.x=this.randomX;a.y=this.randomY;return a},getPoint:function(a,c){void 0===c&&(c=new b.Point);switch(a){default:case b.TOP_LEFT:return c.set(this.x,
this.y);case b.TOP_CENTER:return c.set(this.centerX,this.y);case b.TOP_RIGHT:return c.set(this.right,this.y);case b.LEFT_CENTER:return c.set(this.x,this.centerY);case b.CENTER:return c.set(this.centerX,this.centerY);case b.RIGHT_CENTER:return c.set(this.right,this.centerY);case b.BOTTOM_LEFT:return c.set(this.x,this.bottom);case b.BOTTOM_CENTER:return c.set(this.centerX,this.bottom);case b.BOTTOM_RIGHT:return c.set(this.right,this.bottom)}},toString:function(){return"[{Rectangle (x="+this.x+" y="+
this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}};Object.defineProperty(b.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}});Object.defineProperty(b.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}});Object.defineProperty(b.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(a){this.height=a<=this.y?0:a-this.y}});Object.defineProperty(b.Rectangle.prototype,"bottomLeft",
{get:function(){return new b.Point(this.x,this.bottom)},set:function(a){this.x=a.x;this.bottom=a.y}});Object.defineProperty(b.Rectangle.prototype,"bottomRight",{get:function(){return new b.Point(this.right,this.bottom)},set:function(a){this.right=a.x;this.bottom=a.y}});Object.defineProperty(b.Rectangle.prototype,"left",{get:function(){return this.x},set:function(a){this.width=a>=this.right?0:this.right-a;this.x=a}});Object.defineProperty(b.Rectangle.prototype,"right",{get:function(){return this.x+
this.width},set:function(a){this.width=a<=this.x?0:a-this.x}});Object.defineProperty(b.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}});Object.defineProperty(b.Rectangle.prototype,"perimeter",{get:function(){return 2*this.width+2*this.height}});Object.defineProperty(b.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(a){this.x=a-this.halfWidth}});Object.defineProperty(b.Rectangle.prototype,"centerY",{get:function(){return this.y+
this.halfHeight},set:function(a){this.y=a-this.halfHeight}});Object.defineProperty(b.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}});Object.defineProperty(b.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}});Object.defineProperty(b.Rectangle.prototype,"top",{get:function(){return this.y},set:function(a){a>=this.bottom?(this.height=0,this.y=a):this.height=this.bottom-a}});Object.defineProperty(b.Rectangle.prototype,"topLeft",
{get:function(){return new b.Point(this.x,this.y)},set:function(a){this.x=a.x;this.y=a.y}});Object.defineProperty(b.Rectangle.prototype,"topRight",{get:function(){return new b.Point(this.x+this.width,this.y)},set:function(a){this.right=a.x;this.y=a.y}});Object.defineProperty(b.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(a){!0===a&&this.setTo(0,0,0,0)}});b.Rectangle.prototype.constructor=b.Rectangle;b.Rectangle.inflate=function(a,c,b){a.x-=c;a.width+=2*
c;a.y-=b;a.height+=2*b;return a};b.Rectangle.inflatePoint=function(a,c){return b.Rectangle.inflate(a,c.x,c.y)};b.Rectangle.size=function(a,c){void 0===c||null===c?c=new b.Point(a.width,a.height):c.setTo(a.width,a.height);return c};b.Rectangle.clone=function(a,c){void 0===c||null===c?c=new b.Rectangle(a.x,a.y,a.width,a.height):c.setTo(a.x,a.y,a.width,a.height);return c};b.Rectangle.contains=function(a,c,b){return 0>=a.width||0>=a.height?!1:c>=a.x&&c<a.right&&b>=a.y&&b<a.bottom};b.Rectangle.containsRaw=
function(a,c,b,e,h,l){return h>=a&&h<a+b&&l>=c&&l<c+e};b.Rectangle.containsPoint=function(a,c){return b.Rectangle.contains(a,c.x,c.y)};b.Rectangle.containsRect=function(a,c){return a.volume>c.volume?!1:a.x>=c.x&&a.y>=c.y&&a.right<c.right&&a.bottom<c.bottom};b.Rectangle.equals=function(a,c){return a.x===c.x&&a.y===c.y&&a.width===c.width&&a.height===c.height};b.Rectangle.sameDimensions=function(a,c){return a.width===c.width&&a.height===c.height};b.Rectangle.intersection=function(a,c,d){void 0===d&&
(d=new b.Rectangle);b.Rectangle.intersects(a,c)&&(d.x=Math.max(a.x,c.x),d.y=Math.max(a.y,c.y),d.width=Math.min(a.right,c.right)-d.x,d.height=Math.min(a.bottom,c.bottom)-d.y);return d};b.Rectangle.intersects=function(a,c){return 0>=a.width||0>=a.height||0>=c.width||0>=c.height?!1:!(a.right<c.x||a.bottom<c.y||a.x>c.right||a.y>c.bottom)};b.Rectangle.intersectsRaw=function(a,c,b,e,h,l){void 0===l&&(l=0);return!(c>a.right+l||b<a.left-l||e>a.bottom+l||h<a.top-l)};b.Rectangle.union=function(a,c,d){void 0===
d&&(d=new b.Rectangle);return d.setTo(Math.min(a.x,c.x),Math.min(a.y,c.y),Math.max(a.right,c.right)-Math.min(a.left,c.left),Math.max(a.bottom,c.bottom)-Math.min(a.top,c.top))};b.Rectangle.aabb=function(a,c){void 0===c&&(c=new b.Rectangle);var d=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,l=Number.POSITIVE_INFINITY;a.forEach(function(a){a.x>d&&(d=a.x);a.x<e&&(e=a.x);a.y>h&&(h=a.y);a.y<l&&(l=a.y)});c.setTo(e,l,d-e,h-l);return c};PIXI.Rectangle=b.Rectangle;PIXI.EmptyRectangle=
new b.Rectangle(0,0,0,0);b.RoundedRectangle=function(a,c,d,e,h){void 0===a&&(a=0);void 0===c&&(c=0);void 0===d&&(d=0);void 0===e&&(e=0);void 0===h&&(h=20);this.x=a;this.y=c;this.width=d;this.height=e;this.radius=h||20;this.type=b.ROUNDEDRECTANGLE};b.RoundedRectangle.prototype={clone:function(){return new b.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},contains:function(a,c){if(0>=this.width||0>=this.height)return!1;var b=this.x;return a>=b&&a<=b+this.width&&(b=this.y,c>=b&&c<=
b+this.height)?!0:!1}};b.RoundedRectangle.prototype.constructor=b.RoundedRectangle;PIXI.RoundedRectangle=b.RoundedRectangle;b.Camera=function(a,c,d,e,h,l){this.game=a;this.world=a.world;this.id=0;this.view=new b.Rectangle(d,e,h,l);this.bounds=new b.Rectangle(d,e,h,l);this.deadzone=null;this.roundPx=this.visible=!0;this.atLimit={x:!1,y:!1};this.scale=this.displayObject=this.target=null;this.totalInView=0;this.lerp=new b.Point(1,1);this.onShakeComplete=new b.Signal;this.onFlashComplete=new b.Signal;
this.onFadeComplete=new b.Signal;this.fx=null;this._targetPosition=new b.Point;this._edge=0;this._position=new b.Point;this._shake={intensity:0,duration:0,horizontal:!1,vertical:!1,shakeBounds:!0,x:0,y:0};this._fxType=this._fxDuration=0};b.Camera.FOLLOW_LOCKON=0;b.Camera.FOLLOW_PLATFORMER=1;b.Camera.FOLLOW_TOPDOWN=2;b.Camera.FOLLOW_TOPDOWN_TIGHT=3;b.Camera.SHAKE_BOTH=4;b.Camera.SHAKE_HORIZONTAL=5;b.Camera.SHAKE_VERTICAL=6;b.Camera.ENABLE_FX=!0;b.Camera.prototype={boot:function(){this.displayObject=
this.game.world;this.scale=this.game.world.scale;this.game.camera=this;b.Graphics&&b.Camera.ENABLE_FX&&(this.fx=new b.Graphics(this.game),this.game.stage.addChild(this.fx))},preUpdate:function(){this.totalInView=0},follow:function(a,c,d,e){void 0===c&&(c=b.Camera.FOLLOW_LOCKON);void 0===d&&(d=1);void 0===e&&(e=1);this.target=a;this.lerp.set(d,e);switch(c){case b.Camera.FOLLOW_PLATFORMER:a=this.width/8;c=this.height/3;this.deadzone=new b.Rectangle((this.width-a)/2,(this.height-c)/2-.25*c,a,c);break;
case b.Camera.FOLLOW_TOPDOWN:a=Math.max(this.width,this.height)/4;this.deadzone=new b.Rectangle((this.width-a)/2,(this.height-a)/2,a,a);break;case b.Camera.FOLLOW_TOPDOWN_TIGHT:a=Math.max(this.width,this.height)/8;this.deadzone=new b.Rectangle((this.width-a)/2,(this.height-a)/2,a,a);break;case b.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null}},unfollow:function(){this.target=null},focusOn:function(a){this.setPosition(Math.round(a.x-this.view.halfWidth),Math.round(a.y-this.view.halfHeight))},
focusOnXY:function(a,c){this.setPosition(Math.round(a-this.view.halfWidth),Math.round(c-this.view.halfHeight))},shake:function(a,c,d,e,h){void 0===a&&(a=.05);void 0===c&&(c=500);void 0===d&&(d=!0);void 0===e&&(e=b.Camera.SHAKE_BOTH);void 0===h&&(h=!0);if(!d&&0<this._shake.duration)return!1;this._shake.intensity=a;this._shake.duration=c;this._shake.shakeBounds=h;this._shake.x=0;this._shake.y=0;this._shake.horizontal=e===b.Camera.SHAKE_BOTH||e===b.Camera.SHAKE_HORIZONTAL;this._shake.vertical=e===b.Camera.SHAKE_BOTH||
e===b.Camera.SHAKE_VERTICAL;return!0},flash:function(a,c,b){void 0===a&&(a=16777215);void 0===c&&(c=500);void 0===b&&(b=!1);if(!this.fx||!b&&0<this._fxDuration)return!1;this.fx.clear();this.fx.beginFill(a);this.fx.drawRect(0,0,this.width,this.height);this.fx.endFill();this.fx.alpha=1;this._fxDuration=c;this._fxType=0;return!0},fade:function(a,c,b){void 0===a&&(a=0);void 0===c&&(c=500);void 0===b&&(b=!1);if(!this.fx||!b&&0<this._fxDuration)return!1;this.fx.clear();this.fx.beginFill(a);this.fx.drawRect(0,
0,this.width,this.height);this.fx.endFill();this.fx.alpha=0;this._fxDuration=c;this._fxType=1;return!0},update:function(){0<this._fxDuration&&this.updateFX();0<this._shake.duration&&this.updateShake();this.bounds&&this.checkBounds();this.roundPx&&(this.view.floor(),this._shake.x=Math.floor(this._shake.x),this._shake.y=Math.floor(this._shake.y));this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateFX:function(){0===this._fxType?(this.fx.alpha-=this.game.time.elapsedMS/
this._fxDuration,0>=this.fx.alpha&&(this._fxDuration=0,this.fx.alpha=0,this.onFlashComplete.dispatch())):(this.fx.alpha+=this.game.time.elapsedMS/this._fxDuration,1<=this.fx.alpha&&(this._fxDuration=0,this.fx.alpha=1,this.onFadeComplete.dispatch()))},updateShake:function(){this._shake.duration-=this.game.time.elapsedMS;0>=this._shake.duration?(this.onShakeComplete.dispatch(),this._shake.x=0,this._shake.y=0):(this._shake.horizontal&&(this._shake.x=this.game.rnd.frac()*this._shake.intensity*this.view.width*
2-this._shake.intensity*this.view.width),this._shake.vertical&&(this._shake.y=this.game.rnd.frac()*this._shake.intensity*this.view.height*2-this._shake.intensity*this.view.height))},updateTarget:function(){this._targetPosition.x=this.view.x+this.target.worldPosition.x;this._targetPosition.y=this.view.y+this.target.worldPosition.y;this.deadzone?(this._edge=this._targetPosition.x-this.view.x,this._edge<this.deadzone.left?this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.left,
this.lerp.x):this._edge>this.deadzone.right&&(this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.right,this.lerp.x)),this._edge=this._targetPosition.y-this.view.y,this._edge<this.deadzone.top?this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.top,this.lerp.y):this._edge>this.deadzone.bottom&&(this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.bottom,this.lerp.y))):(this.view.x=this.game.math.linear(this.view.x,
this._targetPosition.x-this.view.halfWidth,this.lerp.x),this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.view.halfHeight,this.lerp.y));this.bounds&&this.checkBounds();this.roundPx&&this.view.floor();this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},setBoundsToWorld:function(){this.bounds&&this.bounds.copyFrom(this.game.world.bounds)},checkBounds:function(){this.atLimit.x=!1;this.atLimit.y=!1;var a=this.view.right+this._shake.x,c=this.view.y+
this._shake.y,b=this.view.bottom+this._shake.y;this.view.x+this._shake.x<=this.bounds.x*this.scale.x&&(this.atLimit.x=!0,this.view.x=this.bounds.x*this.scale.x,this._shake.shakeBounds||(this._shake.x=0));a>=this.bounds.right*this.scale.x&&(this.atLimit.x=!0,this.view.x=this.bounds.right*this.scale.x-this.width,this._shake.shakeBounds||(this._shake.x=0));c<=this.bounds.top*this.scale.y&&(this.atLimit.y=!0,this.view.y=this.bounds.top*this.scale.y,this._shake.shakeBounds||(this._shake.y=0));b>=this.bounds.bottom*
this.scale.y&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom*this.scale.y-this.height,this._shake.shakeBounds||(this._shake.y=0))},setPosition:function(a,c){this.view.x=a;this.view.y=c;this.bounds&&this.checkBounds()},setSize:function(a,c){this.view.width=a;this.view.height=c},reset:function(){this.target=null;this.view.x=0;this.view.y=0;this._shake.duration=0;this.resetFX()},resetFX:function(){this.fx.clear();this._fxDuration=this.fx.alpha=0}};b.Camera.prototype.constructor=b.Camera;Object.defineProperty(b.Camera.prototype,
"x",{get:function(){return this.view.x},set:function(a){this.view.x=a;this.bounds&&this.checkBounds()}});Object.defineProperty(b.Camera.prototype,"y",{get:function(){return this.view.y},set:function(a){this.view.y=a;this.bounds&&this.checkBounds()}});Object.defineProperty(b.Camera.prototype,"position",{get:function(){this._position.set(this.view.x,this.view.y);return this._position},set:function(a){"undefined"!==typeof a.x&&(this.view.x=a.x);"undefined"!==typeof a.y&&(this.view.y=a.y);this.bounds&&
this.checkBounds()}});Object.defineProperty(b.Camera.prototype,"width",{get:function(){return this.view.width},set:function(a){this.view.width=a}});Object.defineProperty(b.Camera.prototype,"height",{get:function(){return this.view.height},set:function(a){this.view.height=a}});Object.defineProperty(b.Camera.prototype,"shakeIntensity",{get:function(){return this._shake.intensity},set:function(a){this._shake.intensity=a}});b.State=function(){this.game=null;this.key="";this.rnd=this.physics=this.particles=
this.world=this.tweens=this.time=this.state=this.stage=this.scale=this.sound=this.math=this.load=this.input=this.cache=this.camera=this.make=this.add=null};b.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},preRender:function(){},render:function(){},resize:function(){},paused:function(){},resumed:function(){},pauseUpdate:function(){},shutdown:function(){}};b.State.prototype.constructor=b.State;b.StateManager=
function(a,c){this.game=a;this.states={};this._pendingState=null;"undefined"!==typeof c&&null!==c&&(this._pendingState=c);this._created=this._clearCache=this._clearWorld=!1;this._args=[];this.current="";this.onStateChange=new b.Signal;this.onShutDownCallback=this.onPauseUpdateCallback=this.onResumedCallback=this.onPausedCallback=this.onLoadRenderCallback=this.onLoadUpdateCallback=this.onPreRenderCallback=this.onResizeCallback=this.onRenderCallback=this.onUpdateCallback=this.onCreateCallback=this.onPreloadCallback=
this.onInitCallback=null};b.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);null!==this._pendingState&&"string"!==typeof this._pendingState&&this.add("default",this._pendingState,!0)},add:function(a,c,d){void 0===d&&(d=!1);var e;c instanceof b.State?e=c:"object"===typeof c?(e=c,e.game=this.game):"function"===typeof c&&(e=new c(this.game));this.states[a]=e;d&&(this.game.isBooted?this.start(a):this._pendingState=a);return e},remove:function(a){this.current===
a&&(this.onPauseUpdateCallback=this.onResumedCallback=this.onPausedCallback=this.onResizeCallback=this.onRenderCallback=this.onPreRenderCallback=this.onUpdateCallback=this.onCreateCallback=this.onLoadUpdateCallback=this.onLoadRenderCallback=this.onPreloadCallback=this.onShutDownCallback=this.onInitCallback=this.callbackContext=null);delete this.states[a]},start:function(a,c,b){void 0===c&&(c=!0);void 0===b&&(b=!1);this.checkState(a)&&(this._pendingState=a,this._clearWorld=c,this._clearCache=b,3<arguments.length&&
(this._args=Array.prototype.splice.call(arguments,3)))},restart:function(a,c){void 0===a&&(a=!0);void 0===c&&(c=!1);this._pendingState=this.current;this._clearWorld=a;this._clearCache=c;2<arguments.length&&(this._args=Array.prototype.slice.call(arguments,2))},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){var a=this.current;this.clearCurrentState();this.setCurrentState(this._pendingState);this.onStateChange.dispatch(this.current,a);this.current===this._pendingState&&
(this._pendingState=null,this.onPreloadCallback?(this.game.load.reset(!0),this.onPreloadCallback.call(this.callbackContext,this.game),0===this.game.load.totalQueuedFiles()&&0===this.game.load.totalQueuedPacks()?this.loadComplete():this.game.load.start()):this.loadComplete())}},clearCurrentState:function(){this.current&&(this.onShutDownCallback&&this.onShutDownCallback.call(this.callbackContext,this.game),this.game.tweens.removeAll(),this.game.camera.reset(),this.game.input.reset(!0),this.game.physics.clear(),
this.game.time.removeAll(),this.game.scale.reset(this._clearWorld),this.game.debug&&this.game.debug.reset(),this._clearWorld&&(this.game.world.shutdown(),this._clearCache&&this.game.cache.destroy()))},checkState:function(a){if(this.states[a]){if(this.states[a].preload||this.states[a].create||this.states[a].update||this.states[a].render)return!0;console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render");return!1}console.warn("Phaser.StateManager - No state found with the key: "+
a);return!1},link:function(a){this.states[a].game=this.game;this.states[a].add=this.game.add;this.states[a].make=this.game.make;this.states[a].camera=this.game.camera;this.states[a].cache=this.game.cache;this.states[a].input=this.game.input;this.states[a].load=this.game.load;this.states[a].math=this.game.math;this.states[a].sound=this.game.sound;this.states[a].scale=this.game.scale;this.states[a].state=this;this.states[a].stage=this.game.stage;this.states[a].time=this.game.time;this.states[a].tweens=
this.game.tweens;this.states[a].world=this.game.world;this.states[a].particles=this.game.particles;this.states[a].rnd=this.game.rnd;this.states[a].physics=this.game.physics;this.states[a].key=a},unlink:function(a){this.states[a]&&(this.states[a].game=null,this.states[a].add=null,this.states[a].make=null,this.states[a].camera=null,this.states[a].cache=null,this.states[a].input=null,this.states[a].load=null,this.states[a].math=null,this.states[a].sound=null,this.states[a].scale=null,this.states[a].state=
null,this.states[a].stage=null,this.states[a].time=null,this.states[a].tweens=null,this.states[a].world=null,this.states[a].particles=null,this.states[a].rnd=null,this.states[a].physics=null)},setCurrentState:function(a){this.callbackContext=this.states[a];this.link(a);this.onInitCallback=this.states[a].init||this.dummy;this.onPreloadCallback=this.states[a].preload||null;this.onLoadRenderCallback=this.states[a].loadRender||null;this.onLoadUpdateCallback=this.states[a].loadUpdate||null;this.onCreateCallback=
this.states[a].create||null;this.onUpdateCallback=this.states[a].update||null;this.onPreRenderCallback=this.states[a].preRender||null;this.onRenderCallback=this.states[a].render||null;this.onResizeCallback=this.states[a].resize||null;this.onPausedCallback=this.states[a].paused||null;this.onResumedCallback=this.states[a].resumed||null;this.onPauseUpdateCallback=this.states[a].pauseUpdate||null;this.onShutDownCallback=this.states[a].shutdown||this.dummy;""!==this.current&&this.game.physics.reset();
this.current=a;this._created=!1;this.onInitCallback.apply(this.callbackContext,this._args);a===this._pendingState&&(this._args=[]);this.game._kickstart=!0},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){!1===this._created&&this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game);!1===this._created&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},pause:function(){this._created&&
this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game)},resume:function(){this._created&&this.onResumedCallback&&this.onResumedCallback.call(this.callbackContext,this.game)},update:function(){this._created?this.onUpdateCallback&&this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pauseUpdate:function(){this._created?this.onPauseUpdateCallback&&this.onPauseUpdateCallback.call(this.callbackContext,
this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},preRender:function(a){this._created&&this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game,a)},resize:function(a,c){this.onResizeCallback&&this.onResizeCallback.call(this.callbackContext,a,c)},render:function(){this._created?this.onRenderCallback&&(this.game.renderType===b.CANVAS?(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0),this.onRenderCallback.call(this.callbackContext,
this.game),this.game.context.restore()):this.onRenderCallback.call(this.callbackContext,this.game)):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this._clearCache=this._clearWorld=!0;this.clearCurrentState();this.game=this.onPauseUpdateCallback=this.onResumedCallback=this.onPausedCallback=this.onRenderCallback=this.onUpdateCallback=this.onCreateCallback=this.onLoadUpdateCallback=this.onLoadRenderCallback=this.onPreloadCallback=this.onShutDownCallback=
this.onInitCallback=this.callbackContext=null;this.states={};this._pendingState=null;this.current=""}};b.StateManager.prototype.constructor=b.StateManager;Object.defineProperty(b.StateManager.prototype,"created",{get:function(){return this._created}});b.Signal=function(){};b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!1,validateListener:function(a,c){if("function"!==typeof a)throw Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",
c));},_registerListener:function(a,c,d,e,h){var l=this._indexOfListener(a,d);if(-1!==l){if(a=this._bindings[l],a.isOnce()!==c)throw Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.");}else a=new b.SignalBinding(this,a,c,d,e,h),this._addBinding(a);this.memorize&&this._prevParams&&a.execute(this._prevParams);return a},_addBinding:function(a){this._bindings||(this._bindings=[]);var c=this._bindings.length;do c--;while(this._bindings[c]&&
a._priority<=this._bindings[c]._priority);this._bindings.splice(c+1,0,a)},_indexOfListener:function(a,c){if(!this._bindings)return-1;void 0===c&&(c=null);for(var b=this._bindings.length,e;b--;)if(e=this._bindings[b],e._listener===a&&e.context===c)return b;return-1},has:function(a,c){return-1!==this._indexOfListener(a,c)},add:function(a,c,b){this.validateListener(a,"add");var d=[];if(3<arguments.length)for(var h=3;h<arguments.length;h++)d.push(arguments[h]);return this._registerListener(a,!1,c,b,d)},
addOnce:function(a,c,b){this.validateListener(a,"addOnce");var d=[];if(3<arguments.length)for(var h=3;h<arguments.length;h++)d.push(arguments[h]);return this._registerListener(a,!0,c,b,d)},remove:function(a,c){this.validateListener(a,"remove");var b=this._indexOfListener(a,c);-1!==b&&(this._bindings[b]._destroy(),this._bindings.splice(b,1));return a},removeAll:function(a){void 0===a&&(a=null);if(this._bindings){for(var c=this._bindings.length;c--;)a?this._bindings[c].context===a&&(this._bindings[c]._destroy(),
this._bindings.splice(c,1)):this._bindings[c]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a=Array.prototype.slice.call(arguments),c=this._bindings.length,b;this.memorize&&(this._prevParams=a);if(c){b=this._bindings.slice();this._shouldPropagate=!0;do c--;while(b[c]&&this._shouldPropagate&&!1!==b[c].execute(a))}}},forget:function(){this._prevParams&&
(this._prevParams=null)},dispose:function(){this.removeAll();this._bindings=null;this._prevParams&&(this._prevParams=null)},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}});b.Signal.prototype.constructor=b.Signal;b.SignalBinding=function(a,c,b,e,h,l){this._listener=
c;b&&(this._isOnce=!0);null!=e&&(this.context=e);this._signal=a;h&&(this._priority=h);l&&l.length&&(this._args=l)};b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var c;this.active&&this._listener&&(a=this.params?this.params.concat(a):a,this._args&&(a=a.concat(this._args)),c=this._listener.apply(this.context,a),this.callCount++,this._isOnce&&this.detach());return c},detach:function(){return this.isBound()?this._signal.remove(this._listener,
this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};b.SignalBinding.prototype.constructor=b.SignalBinding;b.Filter=function(a,c,d){this.game=
a;this.type=b.WEBGL_FILTER;this.passes=[this];this.shaders=[];this.dirty=!0;this.padding=0;this.prevPoint=new b.Point;a=new Date;this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[a.getFullYear(),a.getMonth(),a.getDate(),3600*a.getHours()+60*a.getMinutes()+a.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel1:{type:"sampler2D",value:null,
textureData:{repeat:!0}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:!0}}};if(c)for(var e in c)this.uniforms[e]=c[e];this.fragmentSrc=d||""};b.Filter.prototype={init:function(){},setResolution:function(a,c){this.uniforms.resolution.value.x=a;this.uniforms.resolution.value.y=c},update:function(a){if("undefined"!==typeof a){var c=a.x/this.game.width;a=1-a.y/this.game.height;if(c!==this.prevPoint.x||a!==this.prevPoint.y)this.uniforms.mouse.value.x=
c.toFixed(2),this.uniforms.mouse.value.y=a.toFixed(2),this.prevPoint.set(c,a)}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},addToWorld:function(a,c,b,e,h,l){void 0===h&&(h=0);void 0===l&&(l=0);void 0!==b&&null!==b?this.width=b:b=this.width;void 0!==e&&null!==e?this.height=e:e=this.height;a=this.game.add.image(a,c,"__default");a.width=b;a.height=e;a.anchor.set(h,l);a.filters=[this];return a},destroy:function(){this.game=null}};b.Filter.prototype.constructor=b.Filter;Object.defineProperty(b.Filter.prototype,
"width",{get:function(){return this.uniforms.resolution.value.x},set:function(a){this.uniforms.resolution.value.x=a}});Object.defineProperty(b.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(a){this.uniforms.resolution.value.y=a}});b.Plugin=function(a,c){void 0===c&&(c=null);this.game=a;this.parent=c;this.hasPostRender=this.hasRender=this.hasPostUpdate=this.hasUpdate=this.hasPreUpdate=this.visible=this.active=!1};b.Plugin.prototype={preUpdate:function(){},
update:function(){},render:function(){},postRender:function(){},destroy:function(){this.parent=this.game=null;this.visible=this.active=!1}};b.Plugin.prototype.constructor=b.Plugin;b.PluginManager=function(a){this.game=a;this.plugins=[];this._i=this._len=0};b.PluginManager.prototype={add:function(a){var c=Array.prototype.slice.call(arguments,1),b=!1;"function"===typeof a?a=new a(this.game,this):(a.game=this.game,a.parent=this);"function"===typeof a.preUpdate&&(b=a.hasPreUpdate=!0);"function"===typeof a.update&&
(b=a.hasUpdate=!0);"function"===typeof a.postUpdate&&(b=a.hasPostUpdate=!0);"function"===typeof a.render&&(b=a.hasRender=!0);"function"===typeof a.postRender&&(b=a.hasPostRender=!0);if(b){if(a.hasPreUpdate||a.hasUpdate||a.hasPostUpdate)a.active=!0;if(a.hasRender||a.hasPostRender)a.visible=!0;this._len=this.plugins.push(a);"function"===typeof a.init&&a.init.apply(a,c);return a}return null},remove:function(a,c){void 0===c&&(c=!0);for(this._i=this._len;this._i--;)if(this.plugins[this._i]===a){c&&a.destroy();
this.plugins.splice(this._i,1);this._len--;break}},removeAll:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].destroy();this._len=this.plugins.length=0},preUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate&&this.plugins[this._i].preUpdate()},update:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasUpdate&&this.plugins[this._i].update()},postUpdate:function(){for(this._i=
this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate&&this.plugins[this._i].postUpdate()},render:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasRender&&this.plugins[this._i].render()},postRender:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender&&this.plugins[this._i].postRender()},destroy:function(){this.removeAll();this.game=null}};b.PluginManager.prototype.constructor=
b.PluginManager;b.Stage=function(a){this.game=a;PIXI.DisplayObjectContainer.call(this);this.name="_stage_root";this.disableVisibilityChange=!1;this.exists=!0;this.worldTransform=new PIXI.Matrix;this.stage=this;this.currentRenderOrderID=0;this._hiddenVar="hidden";this._onChange=null;this._bgColor={r:0,g:0,b:0,a:0,color:0,rgba:"#000000"};this.game.transparent||(this._bgColor.a=1);a.config&&this.parseConfig(a.config)};b.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);b.Stage.prototype.constructor=
b.Stage;b.Stage.prototype.parseConfig=function(a){a.disableVisibilityChange&&(this.disableVisibilityChange=a.disableVisibilityChange);a.backgroundColor&&this.setBackgroundColor(a.backgroundColor)};b.Stage.prototype.boot=function(){b.DOM.getOffset(this.game.canvas,this.offset);b.Canvas.setUserSelect(this.game.canvas,"none");b.Canvas.setTouchAction(this.game.canvas,"none");this.checkVisibility()};b.Stage.prototype.preUpdate=function(){for(var a=this.currentRenderOrderID=0;a<this.children.length;a++)this.children[a].preUpdate()};
b.Stage.prototype.update=function(){for(var a=this.children.length;a--;)this.children[a].update()};b.Stage.prototype.postUpdate=function(){this.game.camera.update();this.game.camera.target&&(this.game.camera.target.postUpdate(),this.updateTransform(),this.game.camera.updateTarget());for(var a=0;a<this.children.length;a++)this.children[a].postUpdate();this.updateTransform()};b.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var a=0;a<this.children.length;a++)this.children[a].updateTransform()};
b.Stage.prototype.checkVisibility=function(){this._hiddenVar=void 0!==document.hidden?"visibilitychange":void 0!==document.webkitHidden?"webkitvisibilitychange":void 0!==document.mozHidden?"mozvisibilitychange":void 0!==document.msHidden?"msvisibilitychange":null;var a=this;this._onChange=function(c){return a.visibilityChange(c)};this._hiddenVar&&document.addEventListener(this._hiddenVar,this._onChange,!1);window.onblur=this._onChange;window.onfocus=this._onChange;window.onpagehide=this._onChange;
window.onpageshow=this._onChange;this.game.device.cocoonJSApp&&(CocoonJS.App.onSuspended.addEventListener(function(){b.Stage.prototype.visibilityChange.call(a,{type:"pause"})}),CocoonJS.App.onActivated.addEventListener(function(){b.Stage.prototype.visibilityChange.call(a,{type:"resume"})}))};b.Stage.prototype.visibilityChange=function(a){"pagehide"===a.type||"blur"===a.type||"pageshow"===a.type||"focus"===a.type?"pagehide"===a.type||"blur"===a.type?this.game.focusLoss(a):"pageshow"!==a.type&&"focus"!==
a.type||this.game.focusGain(a):this.disableVisibilityChange||(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||"pause"===a.type?this.game.gamePaused(a):this.game.gameResumed(a))};b.Stage.prototype.setBackgroundColor=function(a){this.game.transparent||(b.Color.valueToColor(a,this._bgColor),b.Color.updateColor(this._bgColor),this._bgColor.r/=255,this._bgColor.g/=255,this._bgColor.b/=255,this._bgColor.a=1)};b.Stage.prototype.destroy=function(){this._hiddenVar&&document.removeEventListener(this._hiddenVar,
this._onChange,!1);window.onpagehide=null;window.onpageshow=null;window.onblur=null;window.onfocus=null};Object.defineProperty(b.Stage.prototype,"backgroundColor",{get:function(){return this._bgColor.color},set:function(a){this.setBackgroundColor(a)}});Object.defineProperty(b.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(a){PIXI.scaleModes.DEFAULT=a?PIXI.scaleModes.LINEAR:PIXI.scaleModes.NEAREST}});b.Group=function(a,c,d,e,h,l){void 0===
e&&(e=!1);void 0===h&&(h=!1);void 0===l&&(l=b.Physics.ARCADE);this.game=a;void 0===c&&(c=a.world);this.name=d||"group";this.z=0;PIXI.DisplayObjectContainer.call(this);e?(this.game.stage.addChild(this),this.z=this.game.stage.children.length):c&&(c.addChild(this),this.z=c.children.length);this.physicsType=this.type=b.GROUP;this.exists=this.alive=!0;this.pendingDestroy=this.ignoreDestroy=!1;this.classType=b.Sprite;this.cursor=null;this.inputEnableChildren=!1;this.onChildInputDown=new b.Signal;this.onChildInputUp=
new b.Signal;this.onChildInputOver=new b.Signal;this.onChildInputOut=new b.Signal;this.enableBody=h;this.enableBodyDebug=!1;this.physicsBodyType=l;this.physicsSortDirection=null;this.onDestroy=new b.Signal;this.cursorIndex=0;this.fixedToCamera=!1;this.cameraOffset=new b.Point;this.hash=[];this._sortProperty="z"};b.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);b.Group.prototype.constructor=b.Group;b.Group.RETURN_NONE=0;b.Group.RETURN_TOTAL=1;b.Group.RETURN_CHILD=2;b.Group.RETURN_ALL=
3;b.Group.SORT_ASCENDING=-1;b.Group.SORT_DESCENDING=1;b.Group.prototype.add=function(a,c,b){void 0===c&&(c=!1);if(a.parent===this)return a;a.body&&a.parent&&a.parent.hash&&a.parent.removeFromHash(a);void 0===b?(a.z=this.children.length,this.addChild(a)):(this.addChildAt(a,b),this.updateZ());this.enableBody&&a.hasOwnProperty("body")&&null===a.body?this.game.physics.enable(a,this.physicsBodyType):a.body&&this.addToHash(a);!this.inputEnableChildren||a.input&&!a.inputEnabled||(a.inputEnabled=!0);if(!c&&
a.events)a.events.onAddedToGroup$dispatch(a,this);null===this.cursor&&(this.cursor=a);return a};b.Group.prototype.addAt=function(a,c,b){this.add(a,b,c)};b.Group.prototype.addToHash=function(a){return a.parent===this&&-1===this.hash.indexOf(a)?(this.hash.push(a),!0):!1};b.Group.prototype.removeFromHash=function(a){return a&&(a=this.hash.indexOf(a),-1!==a)?(this.hash.splice(a,1),!0):!1};b.Group.prototype.addMultiple=function(a,c){if(a instanceof b.Group)a.moveAll(this,c);else if(Array.isArray(a))for(var d=
0;d<a.length;d++)this.add(a[d],c);return a};b.Group.prototype.getAt=function(a){return 0>a||a>=this.children.length?-1:this.getChildAt(a)};b.Group.prototype.create=function(a,c,b,e,h,l){void 0===h&&(h=!0);a=new this.classType(this.game,a,c,b,e);a.exists=h;a.visible=h;a.alive=h;return this.add(a,!1,l)};b.Group.prototype.createMultiple=function(a,c,b,e){void 0===b&&(b=0);void 0===e&&(e=!1);Array.isArray(c)||(c=[c]);Array.isArray(b)||(b=[b]);var d=this,l=[];c.forEach(function(c){b.forEach(function(b){for(var h=
0;h<a;h++)l.push(d.create(0,0,c,b,e))})});return l};b.Group.prototype.updateZ=function(){for(var a=this.children.length;a--;)this.children[a].z=a};b.Group.prototype.align=function(a,c,d,e,h,l){void 0===h&&(h=b.TOP_LEFT);void 0===l&&(l=0);if(0===this.children.length||l>this.children.length||-1===a&&-1===c)return!1;for(var f=new b.Rectangle(0,0,d,e),g=a*d,k=c*e;l<this.children.length;l++){var r=this.children[l];if(r.alignIn)if(r.alignIn(f,h),-1===a)f.y+=e,f.y===k&&(f.x+=d,f.y=0);else if(-1===c)f.x+=
d,f.x===g&&(f.x=0,f.y+=e);else if(f.x+=d,f.x===g&&(f.x=0,f.y+=e,f.y===k))break}return!0};b.Group.prototype.resetCursor=function(a){void 0===a&&(a=0);a>this.children.length-1&&(a=0);if(this.cursor)return this.cursorIndex=a,this.cursor=this.children[this.cursorIndex]};b.Group.prototype.next=function(){if(this.cursor)return this.cursorIndex>=this.children.length-1?this.cursorIndex=0:this.cursorIndex++,this.cursor=this.children[this.cursorIndex]};b.Group.prototype.previous=function(){if(this.cursor)return 0===
this.cursorIndex?this.cursorIndex=this.children.length-1:this.cursorIndex--,this.cursor=this.children[this.cursorIndex]};b.Group.prototype.swap=function(a,c){this.swapChildren(a,c);this.updateZ()};b.Group.prototype.bringToTop=function(a){a.parent===this&&this.getIndex(a)<this.children.length&&(this.remove(a,!1,!0),this.add(a,!0));return a};b.Group.prototype.sendToBack=function(a){a.parent===this&&0<this.getIndex(a)&&(this.remove(a,!1,!0),this.addAt(a,0,!0));return a};b.Group.prototype.moveUp=function(a){if(a.parent===
this&&this.getIndex(a)<this.children.length-1){var c=this.getIndex(a);(c=this.getAt(c+1))&&this.swap(a,c)}return a};b.Group.prototype.moveDown=function(a){if(a.parent===this&&0<this.getIndex(a)){var c=this.getIndex(a);(c=this.getAt(c-1))&&this.swap(a,c)}return a};b.Group.prototype.xy=function(a,c,b){if(0>a||a>this.children.length)return-1;this.getChildAt(a).x=c;this.getChildAt(a).y=b};b.Group.prototype.reverse=function(){this.children.reverse();this.updateZ()};b.Group.prototype.getIndex=function(a){return this.children.indexOf(a)};
b.Group.prototype.getByName=function(a){for(var c=0;c<this.children.length;c++)if(this.children[c].name===a)return this.children[c];return null};b.Group.prototype.replace=function(a,c){var d=this.getIndex(a);if(-1!==d)return c.parent&&(c.parent instanceof b.Group?c.parent.remove(c):c.parent.removeChild(c)),this.remove(a),this.addAt(c,d),a};b.Group.prototype.hasProperty=function(a,c){var b=c.length;return 1===b&&c[0]in a||2===b&&c[0]in a&&c[1]in a[c[0]]||3===b&&c[0]in a&&c[1]in a[c[0]]&&c[2]in a[c[0]][c[1]]||
4===b&&c[0]in a&&c[1]in a[c[0]]&&c[2]in a[c[0]][c[1]]&&c[3]in a[c[0]][c[1]][c[2]]?!0:!1};b.Group.prototype.setProperty=function(a,c,b,e,h){void 0===h&&(h=!1);e=e||0;if(!this.hasProperty(a,c)&&(!h||0<e))return!1;h=c.length;1===h?0===e?a[c[0]]=b:1===e?a[c[0]]+=b:2===e?a[c[0]]-=b:3===e?a[c[0]]*=b:4===e&&(a[c[0]]/=b):2===h?0===e?a[c[0]][c[1]]=b:1===e?a[c[0]][c[1]]+=b:2===e?a[c[0]][c[1]]-=b:3===e?a[c[0]][c[1]]*=b:4===e&&(a[c[0]][c[1]]/=b):3===h?0===e?a[c[0]][c[1]][c[2]]=b:1===e?a[c[0]][c[1]][c[2]]+=b:
2===e?a[c[0]][c[1]][c[2]]-=b:3===e?a[c[0]][c[1]][c[2]]*=b:4===e&&(a[c[0]][c[1]][c[2]]/=b):4===h&&(0===e?a[c[0]][c[1]][c[2]][c[3]]=b:1===e?a[c[0]][c[1]][c[2]][c[3]]+=b:2===e?a[c[0]][c[1]][c[2]][c[3]]-=b:3===e?a[c[0]][c[1]][c[2]][c[3]]*=b:4===e&&(a[c[0]][c[1]][c[2]][c[3]]/=b));return!0};b.Group.prototype.checkProperty=function(a,c,d,e){void 0===e&&(e=!1);return!b.Utils.getProperty(a,c)&&e||b.Utils.getProperty(a,c)!==d?!1:!0};b.Group.prototype.set=function(a,c,b,e,h,l,f){void 0===f&&(f=!1);c=c.split(".");
void 0===e&&(e=!1);void 0===h&&(h=!1);if((!1===e||e&&a.alive)&&(!1===h||h&&a.visible))return this.setProperty(a,c,b,l,f)};b.Group.prototype.setAll=function(a,c,b,e,h,l){void 0===b&&(b=!1);void 0===e&&(e=!1);void 0===l&&(l=!1);a=a.split(".");h=h||0;for(var d=0;d<this.children.length;d++)(!b||b&&this.children[d].alive)&&(!e||e&&this.children[d].visible)&&this.setProperty(this.children[d],a,c,h,l)};b.Group.prototype.setAllChildren=function(a,c,d,e,h,l){void 0===d&&(d=!1);void 0===e&&(e=!1);void 0===
l&&(l=!1);h=h||0;for(var f=0;f<this.children.length;f++)(!d||d&&this.children[f].alive)&&(!e||e&&this.children[f].visible)&&(this.children[f]instanceof b.Group?this.children[f].setAllChildren(a,c,d,e,h,l):this.setProperty(this.children[f],a.split("."),c,h,l))};b.Group.prototype.checkAll=function(a,c,b,e,h){void 0===b&&(b=!1);void 0===e&&(e=!1);void 0===h&&(h=!1);for(var d=0;d<this.children.length;d++)if((!b||b&&this.children[d].alive)&&(!e||e&&this.children[d].visible)&&!this.checkProperty(this.children[d],
a,c,h))return!1;return!0};b.Group.prototype.addAll=function(a,c,b,e){this.setAll(a,c,b,e,1)};b.Group.prototype.subAll=function(a,c,b,e){this.setAll(a,c,b,e,2)};b.Group.prototype.multiplyAll=function(a,c,b,e){this.setAll(a,c,b,e,3)};b.Group.prototype.divideAll=function(a,c,b,e){this.setAll(a,c,b,e,4)};b.Group.prototype.callAllExists=function(a,c){var b;if(2<arguments.length){b=[];for(var e=2;e<arguments.length;e++)b.push(arguments[e])}for(e=0;e<this.children.length;e++)this.children[e].exists===c&&
this.children[e][a]&&this.children[e][a].apply(this.children[e],b)};b.Group.prototype.callbackFromArray=function(a,c,b){if(1===b){if(a[c[0]])return a[c[0]]}else if(2===b){if(a[c[0]][c[1]])return a[c[0]][c[1]]}else if(3===b){if(a[c[0]][c[1]][c[2]])return a[c[0]][c[1]][c[2]]}else if(4===b){if(a[c[0]][c[1]][c[2]][c[3]])return a[c[0]][c[1]][c[2]][c[3]]}else if(a[c])return a[c];return!1};b.Group.prototype.callAll=function(a,c){if(void 0!==a){a=a.split(".");var b=a.length;if(void 0===c||null===c||""===
c)c=null;else if("string"===typeof c){c=c.split(".");var e=c.length}var h;if(2<arguments.length){h=[];for(var l=2;l<arguments.length;l++)h.push(arguments[l])}for(var f,g,l=0;l<this.children.length;l++)f=this.callbackFromArray(this.children[l],a,b),c&&f?(g=this.callbackFromArray(this.children[l],c,e),f&&f.apply(g,h)):f&&f.apply(this.children[l],h)}};b.Group.prototype.preUpdate=function(){if(this.pendingDestroy)return this.destroy(),!1;if(!this.exists||!this.parent.exists)return this.renderOrderID=
-1,!1;for(var a=0;a<this.children.length;a++)this.children[a].preUpdate();return!0};b.Group.prototype.update=function(){for(var a=this.children.length;a--;)this.children[a].update()};b.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);for(var a=0;a<this.children.length;a++)this.children[a].postUpdate()};b.Group.prototype.filter=function(a,c){for(var d=-1,e=this.children.length,h=[];++d<
e;){var l=this.children[d];(!c||c&&l.exists)&&a(l,d,this.children)&&h.push(l)}return new b.ArraySet(h)};b.Group.prototype.forEach=function(a,c,b){void 0===b&&(b=!1);if(3>=arguments.length)for(var d=0;d<this.children.length;d++)(!b||b&&this.children[d].exists)&&a.call(c,this.children[d]);else{for(var h=[null],d=3;d<arguments.length;d++)h.push(arguments[d]);for(d=0;d<this.children.length;d++)if(!b||b&&this.children[d].exists)h[0]=this.children[d],a.apply(c,h)}};b.Group.prototype.forEachExists=function(a,
c){var d;if(2<arguments.length){d=[null];for(var e=2;e<arguments.length;e++)d.push(arguments[e])}this.iterate("exists",!0,b.Group.RETURN_TOTAL,a,c,d)};b.Group.prototype.forEachAlive=function(a,c){var d;if(2<arguments.length){d=[null];for(var e=2;e<arguments.length;e++)d.push(arguments[e])}this.iterate("alive",!0,b.Group.RETURN_TOTAL,a,c,d)};b.Group.prototype.forEachDead=function(a,c){var d;if(2<arguments.length){d=[null];for(var e=2;e<arguments.length;e++)d.push(arguments[e])}this.iterate("alive",
!1,b.Group.RETURN_TOTAL,a,c,d)};b.Group.prototype.sort=function(a,c){2>this.children.length||(void 0===a&&(a="z"),void 0===c&&(c=b.Group.SORT_ASCENDING),this._sortProperty=a,c===b.Group.SORT_ASCENDING?this.children.sort(this.ascendingSortHandler.bind(this)):this.children.sort(this.descendingSortHandler.bind(this)),this.updateZ())};b.Group.prototype.customSort=function(a,c){2>this.children.length||(this.children.sort(a.bind(c)),this.updateZ())};b.Group.prototype.ascendingSortHandler=function(a,c){return a[this._sortProperty]<
c[this._sortProperty]?-1:a[this._sortProperty]>c[this._sortProperty]?1:a.z<c.z?-1:1};b.Group.prototype.descendingSortHandler=function(a,c){return a[this._sortProperty]<c[this._sortProperty]?1:a[this._sortProperty]>c[this._sortProperty]?-1:0};b.Group.prototype.iterate=function(a,c,d,e,h,l){if(0===this.children.length){if(d===b.Group.RETURN_TOTAL)return 0;if(d===b.Group.RETURN_ALL)return[]}var f=0;if(d===b.Group.RETURN_ALL)var g=[];for(var k=0;k<this.children.length;k++)if(this.children[k][a]===c){f++;
e&&(l?(l[0]=this.children[k],e.apply(h,l)):e.call(h,this.children[k]));if(d===b.Group.RETURN_CHILD)return this.children[k];d===b.Group.RETURN_ALL&&g.push(this.children[k])}return d===b.Group.RETURN_TOTAL?f:d===b.Group.RETURN_ALL?g:null};b.Group.prototype.getFirstExists=function(a,c,d,e,h,l){void 0===c&&(c=!1);"boolean"!==typeof a&&(a=!0);a=this.iterate("exists",a,b.Group.RETURN_CHILD);return null===a&&c?this.create(d,e,h,l):this.resetChild(a,d,e,h,l)};b.Group.prototype.getFirstAlive=function(a,c,
d,e,h){void 0===a&&(a=!1);var l=this.iterate("alive",!0,b.Group.RETURN_CHILD);return null===l&&a?this.create(c,d,e,h):this.resetChild(l,c,d,e,h)};b.Group.prototype.getFirstDead=function(a,c,d,e,h){void 0===a&&(a=!1);var l=this.iterate("alive",!1,b.Group.RETURN_CHILD);return null===l&&a?this.create(c,d,e,h):this.resetChild(l,c,d,e,h)};b.Group.prototype.resetChild=function(a,c,b,e,h){if(null===a)return null;void 0===c&&(c=null);void 0===b&&(b=null);null!==c&&null!==b&&a.reset(c,b);void 0!==e&&a.loadTexture(e,
h);return a};b.Group.prototype.getTop=function(){if(0<this.children.length)return this.children[this.children.length-1]};b.Group.prototype.getBottom=function(){if(0<this.children.length)return this.children[0]};b.Group.prototype.getClosestTo=function(a,c,d){for(var e=Number.MAX_VALUE,h,l=null,f=0;f<this.children.length;f++){var g=this.children[f];g.exists&&(h=Math.abs(b.Point.distance(a,g)),h<e&&(!c||c.call(d,g,h))&&(e=h,l=g))}return l};b.Group.prototype.getFurthestFrom=function(a,c,d){for(var e=
0,h,l=null,f=0;f<this.children.length;f++){var g=this.children[f];g.exists&&(h=Math.abs(b.Point.distance(a,g)),h>e&&(!c||c.call(d,g,h))&&(e=h,l=g))}return l};b.Group.prototype.countLiving=function(){return this.iterate("alive",!0,b.Group.RETURN_TOTAL)};b.Group.prototype.countDead=function(){return this.iterate("alive",!1,b.Group.RETURN_TOTAL)};b.Group.prototype.getRandom=function(a,c){void 0===a&&(a=0);void 0===c&&(c=this.children.length);return 0===c?null:b.ArrayUtils.getRandomItem(this.children,
a,c)};b.Group.prototype.getRandomExists=function(a,c){var b=this.getAll("exists",!0,a,c);return this.game.rnd.pick(b)};b.Group.prototype.getAll=function(a,c,b,e){void 0===b&&(b=0);void 0===e&&(e=this.children.length);for(var d=[];b<e;b++){var l=this.children[b];a&&l[a]===c&&d.push(l)}return d};b.Group.prototype.remove=function(a,c,b){void 0===c&&(c=!1);void 0===b&&(b=!1);if(0===this.children.length||-1===this.children.indexOf(a))return!1;if(!b&&a.events&&!a.destroyPhase)a.events.onRemovedFromGroup$dispatch(a,
this);b=this.removeChild(a);this.removeFromHash(a);this.updateZ();this.cursor===a&&this.next();c&&b&&b.destroy(!0);return!0};b.Group.prototype.moveAll=function(a,c){void 0===c&&(c=!1);if(0<this.children.length&&a instanceof b.Group){do a.add(this.children[0],c);while(0<this.children.length);this.hash=[];this.cursor=null}return a};b.Group.prototype.removeAll=function(a,c,b){void 0===a&&(a=!1);void 0===c&&(c=!1);void 0===b&&(b=!1);if(0!==this.children.length){do{if(!c&&this.children[0].events)this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],
this);var d=this.removeChild(this.children[0]);this.removeFromHash(d);a&&d&&d.destroy(!0,b)}while(0<this.children.length);this.hash=[];this.cursor=null}};b.Group.prototype.removeBetween=function(a,c,b,e){void 0===c&&(c=this.children.length-1);void 0===b&&(b=!1);void 0===e&&(e=!1);if(0!==this.children.length){if(a>c||0>a||c>this.children.length)return!1;for(;c>=a;){if(!e&&this.children[c].events)this.children[c].events.onRemovedFromGroup$dispatch(this.children[c],this);var d=this.removeChild(this.children[c]);
this.removeFromHash(d);b&&d&&d.destroy(!0);this.cursor===this.children[c]&&(this.cursor=null);c--}this.updateZ()}};b.Group.prototype.destroy=function(a,c){null===this.game||this.ignoreDestroy||(void 0===a&&(a=!0),void 0===c&&(c=!1),this.onDestroy.dispatch(this,a,c),this.removeAll(a),this.filters=this.cursor=null,this.pendingDestroy=!1,c||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))};Object.defineProperty(b.Group.prototype,"total",{get:function(){return this.iterate("exists",
!0,b.Group.RETURN_TOTAL)}});Object.defineProperty(b.Group.prototype,"length",{get:function(){return this.children.length}});Object.defineProperty(b.Group.prototype,"angle",{get:function(){return b.Math.radToDeg(this.rotation)},set:function(a){this.rotation=b.Math.degToRad(a)}});Object.defineProperty(b.Group.prototype,"centerX",{get:function(){return this.getBounds(this.parent).centerX},set:function(a){var c=this.getBounds(this.parent);this.x=a+(this.x-c.x)-c.halfWidth}});Object.defineProperty(b.Group.prototype,
"centerY",{get:function(){return this.getBounds(this.parent).centerY},set:function(a){var c=this.getBounds(this.parent);this.y=a+(this.y-c.y)-c.halfHeight}});Object.defineProperty(b.Group.prototype,"left",{get:function(){return this.getBounds(this.parent).left},set:function(a){var c=this.getBounds(this.parent);this.x=a+(this.x-c.x)}});Object.defineProperty(b.Group.prototype,"right",{get:function(){return this.getBounds(this.parent).right},set:function(a){var c=this.getBounds(this.parent);this.x=a+
(this.x-c.x)-c.width}});Object.defineProperty(b.Group.prototype,"top",{get:function(){return this.getBounds(this.parent).top},set:function(a){var c=this.getBounds(this.parent);this.y=a+(this.y-c.y)}});Object.defineProperty(b.Group.prototype,"bottom",{get:function(){return this.getBounds(this.parent).bottom},set:function(a){var c=this.getBounds(this.parent);this.y=a+(this.y-c.y)-c.height}});b.World=function(a){b.Group.call(this,a,null,"__world",!1);this.bounds=new b.Rectangle(0,0,a.width,a.height);
this.camera=null;this._definedSize=!1;this._width=a.width;this._height=a.height;this.game.state.onStateChange.add(this.stateChange,this)};b.World.prototype=Object.create(b.Group.prototype);b.World.prototype.constructor=b.World;b.World.prototype.boot=function(){this.camera=new b.Camera(this.game,0,0,0,this.game.width,this.game.height);this.game.stage.addChild(this);this.camera.boot()};b.World.prototype.stateChange=function(){this.y=this.x=0;this.camera.reset()};b.World.prototype.setBounds=function(a,
c,b,e){this._definedSize=!0;this._width=b;this._height=e;this.bounds.setTo(a,c,b,e);this.x=a;this.y=c;this.camera.bounds&&this.camera.bounds.setTo(a,c,Math.max(b,this.game.width),Math.max(e,this.game.height));this.game.physics.setBoundsToWorld()};b.World.prototype.resize=function(a,c){this._definedSize&&(a<this._width&&(a=this._width),c<this._height&&(c=this._height));this.bounds.width=a;this.bounds.height=c;this.game.camera.setBoundsToWorld();this.game.physics.setBoundsToWorld()};b.World.prototype.shutdown=
function(){this.destroy(!0,!0)};b.World.prototype.wrap=function(a,c,b,e,h){void 0===c&&(c=0);void 0===b&&(b=!1);void 0===e&&(e=!0);void 0===h&&(h=!0);b?(a.getBounds(),e&&(a.x+a._currentBounds.width<this.bounds.x?a.x=this.bounds.right:a.x>this.bounds.right&&(a.x=this.bounds.left)),h&&(a.y+a._currentBounds.height<this.bounds.top?a.y=this.bounds.bottom:a.y>this.bounds.bottom&&(a.y=this.bounds.top))):(e&&a.x+c<this.bounds.x?a.x=this.bounds.right+c:e&&a.x-c>this.bounds.right&&(a.x=this.bounds.left-c),
h&&a.y+c<this.bounds.top?a.y=this.bounds.bottom+c:h&&a.y-c>this.bounds.bottom&&(a.y=this.bounds.top-c))};Object.defineProperty(b.World.prototype,"width",{get:function(){return this.bounds.width},set:function(a){a<this.game.width&&(a=this.game.width);this._width=this.bounds.width=a;this._definedSize=!0}});Object.defineProperty(b.World.prototype,"height",{get:function(){return this.bounds.height},set:function(a){a<this.game.height&&(a=this.game.height);this._height=this.bounds.height=a;this._definedSize=
!0}});Object.defineProperty(b.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth+this.bounds.x}});Object.defineProperty(b.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight+this.bounds.y}});Object.defineProperty(b.World.prototype,"randomX",{get:function(){return 0>this.bounds.x?this.game.rnd.between(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x)):this.game.rnd.between(this.bounds.x,this.bounds.width)}});Object.defineProperty(b.World.prototype,"randomY",
{get:function(){return 0>this.bounds.y?this.game.rnd.between(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y)):this.game.rnd.between(this.bounds.y,this.bounds.height)}});b.Game=function(a,c,d,e,h,l,f,g){this.id=b.GAMES.push(this)-1;this.config=null;this.physicsConfig=g;this.parent="";this.width=800;this.height=600;this.resolution=1;this._width=800;this._height=600;this.transparent=!1;this.antialias=!0;this.preserveDrawingBuffer=!1;this.clearBeforeRender=!0;this.renderer=null;this.renderType=
b.AUTO;this.state=null;this.isRunning=this.isBooted=!1;this.rnd=this.plugins=this.physics=this.world=this.tweens=this.time=this.stage=this.sound=this.scale=this.net=this.math=this.load=this.input=this.cache=this.make=this.add=this.raf=null;this.device=b.Device;this.create=this.particles=this.debug=this.context=this.canvas=this.camera=null;this.pendingStep=this.stepping=this.lockRender=!1;this.stepCount=0;this.onFocus=this.onBlur=this.onResume=this.onPause=null;this._codePaused=this._paused=!1;this.currentUpdateID=
0;this.updatesThisFrame=1;this._spiraling=this._lastCount=this._deltaTime=0;this._kickstart=!0;this.fpsProblemNotifier=new b.Signal;this.forceSingleUpdate=!0;this._nextFpsNotification=0;1===arguments.length&&"object"===typeof arguments[0]?this.parseConfig(arguments[0]):(this.config={enableDebug:!0},"undefined"!==typeof a&&(this._width=a),"undefined"!==typeof c&&(this._height=c),"undefined"!==typeof d&&(this.renderType=d),"undefined"!==typeof e&&(this.parent=e),"undefined"!==typeof l&&(this.transparent=
l),"undefined"!==typeof f&&(this.antialias=f),this.rnd=new b.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.state=new b.StateManager(this,h));this.device.whenReady(this.boot,this);return this};b.Game.prototype={parseConfig:function(a){this.config=a;void 0===a.enableDebug&&(this.config.enableDebug=!0);a.width&&(this._width=a.width);a.height&&(this._height=a.height);a.renderer&&(this.renderType=a.renderer);a.parent&&(this.parent=a.parent);void 0!==a.transparent&&(this.transparent=
a.transparent);void 0!==a.antialias&&(this.antialias=a.antialias);a.resolution&&(this.resolution=a.resolution);void 0!==a.preserveDrawingBuffer&&(this.preserveDrawingBuffer=a.preserveDrawingBuffer);a.physicsConfig&&(this.physicsConfig=a.physicsConfig);var c=[(Date.now()*Math.random()).toString()];a.seed&&(c=a.seed);this.rnd=new b.RandomDataGenerator(c);c=null;a.state&&(c=a.state);this.state=new b.StateManager(this,c)},boot:function(){this.isBooted||(this.onPause=new b.Signal,this.onResume=new b.Signal,
this.onBlur=new b.Signal,this.onFocus=new b.Signal,this.isBooted=!0,PIXI.game=this,this.math=b.Math,this.scale=new b.ScaleManager(this,this._width,this._height),this.stage=new b.Stage(this),this.setUpRenderer(),this.world=new b.World(this),this.add=new b.GameObjectFactory(this),this.make=new b.GameObjectCreator(this),this.cache=new b.Cache(this),this.load=new b.Loader(this),this.time=new b.Time(this),this.tweens=new b.TweenManager(this),this.input=new b.Input(this),this.sound=new b.SoundManager(this),
this.physics=new b.Physics(this,this.physicsConfig),this.particles=new b.Particles(this),this.create=new b.Create(this),this.plugins=new b.PluginManager(this),this.net=new b.Net(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.scale.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.config.enableDebug?(this.debug=new b.Utils.Debug(this),this.debug.boot()):this.debug={preUpdate:function(){},update:function(){},reset:function(){}},this.showDebugHeader(),this.isRunning=
!0,this.raf=this.config&&this.config.forceSetTimeOut?new b.RequestAnimationFrame(this,this.config.forceSetTimeOut):new b.RequestAnimationFrame(this,!1),this._kickstart=!0,window.focus&&(!window.PhaserGlobal||window.PhaserGlobal&&!window.PhaserGlobal.stopFocus)&&window.focus(),this.raf.start())},showDebugHeader:function(){if(!window.PhaserGlobal||!window.PhaserGlobal.hideBanner){var a=b.VERSION,c="Canvas",d="HTML Audio",e=1;this.renderType===b.WEBGL?(c="WebGL",e++):this.renderType===b.HEADLESS&&(c=
"Headless");this.device.webAudio&&(d="WebAudio",e++);if(this.device.chrome){a=["%c %c %c Phaser v"+a+" | Pixi.js | "+c+" | "+d+"  %c %c %c http://phaser.io %c\u2665%c\u2665%c\u2665","background: #fb8cb3","background: #d44a52","color: #ffffff; background: #871905;","background: #d44a52","background: #fb8cb3","background: #ffffff"];for(c=0;3>c;c++)c<e?a.push("color: #ff2424; background: #fff"):a.push("color: #959595; background: #fff");console.log.apply(console,a)}else window.console&&console.log("Phaser v"+
a+" | Pixi.js "+PIXI.VERSION+" | "+c+" | "+d+" | http://phaser.io")}},setUpRenderer:function(){this.canvas=this.config.canvas?this.config.canvas:b.Canvas.create(this,this.width,this.height,this.config.canvasID,!0);this.config.canvasStyle?this.canvas.style=this.config.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%";if(this.renderType===b.HEADLESS||this.renderType===b.CANVAS||this.renderType===b.AUTO&&!this.device.webGL)if(this.device.canvas)this.renderType=b.CANVAS,
this.renderer=new PIXI.CanvasRenderer(this),this.context=this.renderer.context;else throw Error("Phaser.Game - Cannot create Canvas or WebGL context, aborting.");else this.renderType=b.WEBGL,this.renderer=new PIXI.WebGLRenderer(this),this.context=null,this.canvas.addEventListener("webglcontextlost",this.contextLost.bind(this),!1),this.canvas.addEventListener("webglcontextrestored",this.contextRestored.bind(this),!1);this.device.cocoonJS&&(this.canvas.screencanvas=this.renderType===b.CANVAS?!0:!1);
this.renderType!==b.HEADLESS&&(this.stage.smoothed=this.antialias,b.Canvas.addToDOM(this.canvas,this.parent,!1),b.Canvas.setTouchAction(this.canvas))},contextLost:function(a){a.preventDefault();this.renderer.contextLost=!0},contextRestored:function(){this.renderer.initContext();this.cache.clearGLTextures();this.renderer.contextLost=!1},update:function(a){this.time.update(a);if(this._kickstart)this.updateLogic(this.time.desiredFpsMult),this.updateRender(this.time.slowMotion*this.time.desiredFps),this._kickstart=
!1;else if(1<this._spiraling&&!this.forceSingleUpdate)this.time.time>this._nextFpsNotification&&(this._nextFpsNotification=this.time.time+1E4,this.fpsProblemNotifier.dispatch()),this._spiraling=this._deltaTime=0,this.updateRender(this.time.slowMotion*this.time.desiredFps);else{a=1E3*this.time.slowMotion/this.time.desiredFps;this._deltaTime+=Math.max(Math.min(3*a,this.time.elapsed),0);var c=0;this.updatesThisFrame=Math.floor(this._deltaTime/a);this.forceSingleUpdate&&(this.updatesThisFrame=Math.min(1,
this.updatesThisFrame));for(;this._deltaTime>=a&&(this._deltaTime-=a,this.currentUpdateID=c,this.updateLogic(this.time.desiredFpsMult),c++,!this.forceSingleUpdate||1!==c);)this.time.refresh();c>this._lastCount?this._spiraling++:c<this._lastCount&&(this._spiraling=0);this._lastCount=c;this.updateRender(this._deltaTime/a)}},updateLogic:function(a){this._paused||this.pendingStep?(this.scale.pauseUpdate(),this.state.pauseUpdate(),this.debug.preUpdate()):(this.stepping&&(this.pendingStep=!0),this.scale.preUpdate(),
this.debug.preUpdate(),this.camera.preUpdate(),this.physics.preUpdate(),this.state.preUpdate(a),this.plugins.preUpdate(a),this.stage.preUpdate(),this.state.update(),this.stage.update(),this.tweens.update(),this.sound.update(),this.input.update(),this.physics.update(),this.particles.update(),this.plugins.update(),this.stage.postUpdate(),this.plugins.postUpdate());this.stage.updateTransform()},updateRender:function(a){this.lockRender||(this.state.preRender(a),this.renderType!==b.HEADLESS&&(this.renderer.render(this.stage),
this.plugins.render(a),this.state.render(a)),this.plugins.postRender(a))},enableStep:function(){this.stepping=!0;this.pendingStep=!1;this.stepCount=0},disableStep:function(){this.pendingStep=this.stepping=!1},step:function(){this.pendingStep=!1;this.stepCount++},destroy:function(){this.raf.stop();this.state.destroy();this.sound.destroy();this.scale.destroy();this.stage.destroy();this.input.destroy();this.physics.destroy();this.plugins.destroy();this.world=this.time=this.load=this.cache=this.plugins=
this.physics=this.input=this.stage=this.scale=this.sound=this.state=null;this.isBooted=!1;this.renderer.destroy(!1);b.Canvas.removeFromDOM(this.canvas);PIXI.defaultRenderer=null;b.GAMES[this.id]=null},gamePaused:function(a){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.muteOnPause&&this.sound.setMute(),this.onPause.dispatch(a),this.device.cordova&&this.device.iOS&&(this.lockRender=!0))},gameResumed:function(a){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),
this.input.reset(),this.sound.muteOnPause&&this.sound.unsetMute(),this.onResume.dispatch(a),this.device.cordova&&this.device.iOS&&(this.lockRender=!1))},focusLoss:function(a){this.onBlur.dispatch(a);this.stage.disableVisibilityChange||this.gamePaused(a)},focusGain:function(a){this.onFocus.dispatch(a);this.stage.disableVisibilityChange||this.gameResumed(a)}};b.Game.prototype.constructor=b.Game;Object.defineProperty(b.Game.prototype,"paused",{get:function(){return this._paused},set:function(a){!0===
a?(!1===this._paused&&(this._paused=!0,this.sound.setMute(),this.time.gamePaused(),this.onPause.dispatch(this)),this._codePaused=!0):(this._paused&&(this._paused=!1,this.input.reset(),this.sound.unsetMute(),this.time.gameResumed(),this.onResume.dispatch(this)),this._codePaused=!1)}});b.Input=function(a){this.game=a;this.hitContext=this.hitCanvas=null;this.moveCallbacks=[];this.customCandidateHandlerContext=this.customCandidateHandler=null;this.pollRate=0;this.enabled=!0;this.multiInputOverride=b.Input.MOUSE_TOUCH_COMBINE;
this.scale=this.circle=this.speed=this.position=null;this.maxPointers=-1;this.tapRate=200;this.doubleTapRate=300;this.holdRate=2E3;this.justReleasedRate=this.justPressedRate=200;this.recordPointerHistory=!1;this.recordLimit=this.recordRate=100;this.pointer10=this.pointer9=this.pointer8=this.pointer7=this.pointer6=this.pointer5=this.pointer4=this.pointer3=this.pointer2=this.pointer1=null;this.pointers=[];this.gamepad=this.mspointer=this.touch=this.keyboard=this.mouse=this.mousePointer=this.activePointer=
null;this.resetLocked=!1;this.onHold=this.onTap=this.onUp=this.onDown=null;this.minPriorityID=0;this.interactiveItems=new b.ArraySet;this._localPoint=new b.Point;this._pollCounter=0;this._oldPosition=null;this._y=this._x=0};b.Input.MOUSE_OVERRIDES_TOUCH=0;b.Input.TOUCH_OVERRIDES_MOUSE=1;b.Input.MOUSE_TOUCH_COMBINE=2;b.Input.MAX_POINTERS=10;b.Input.prototype={boot:function(){this.mousePointer=new b.Pointer(this.game,0,b.PointerMode.CURSOR);this.addPointer();this.addPointer();this.mouse=new b.Mouse(this.game);
this.touch=new b.Touch(this.game);this.mspointer=new b.MSPointer(this.game);b.Keyboard&&(this.keyboard=new b.Keyboard(this.game));b.Gamepad&&(this.gamepad=new b.Gamepad(this.game));this.onDown=new b.Signal;this.onUp=new b.Signal;this.onTap=new b.Signal;this.onHold=new b.Signal;this.scale=new b.Point(1,1);this.speed=new b.Point;this.position=new b.Point;this._oldPosition=new b.Point;this.circle=new b.Circle(0,0,44);this.activePointer=this.mousePointer;this.hitCanvas=PIXI.CanvasPool.create(this,1,1);
this.hitContext=this.hitCanvas.getContext("2d");this.mouse.start();this.touch.start();this.mspointer.start();this.mousePointer.active=!0;this.keyboard&&this.keyboard.start();var a=this;this._onClickTrampoline=function(c){a.onClickTrampoline(c)};this.game.canvas.addEventListener("click",this._onClickTrampoline,!1)},destroy:function(){this.mouse.stop();this.touch.stop();this.mspointer.stop();this.keyboard&&this.keyboard.stop();this.gamepad&&this.gamepad.stop();this.moveCallbacks=[];PIXI.CanvasPool.remove(this);
this.game.canvas.removeEventListener("click",this._onClickTrampoline)},setInteractiveCandidateHandler:function(a,c){this.customCandidateHandler=a;this.customCandidateHandlerContext=c},addMoveCallback:function(a,c){this.moveCallbacks.push({callback:a,context:c})},deleteMoveCallback:function(a,c){for(var b=this.moveCallbacks.length;b--;)if(this.moveCallbacks[b].callback===a&&this.moveCallbacks[b].context===c){this.moveCallbacks.splice(b,1);break}},addPointer:function(){if(this.pointers.length>=b.Input.MAX_POINTERS)return console.warn("Phaser.Input.addPointer: Maximum limit of "+
b.Input.MAX_POINTERS+" pointers reached."),null;var a=this.pointers.length+1,c=new b.Pointer(this.game,a,b.PointerMode.TOUCH);this.pointers.push(c);return this["pointer"+a]=c},update:function(){this.keyboard&&this.keyboard.update();if(0<this.pollRate&&this._pollCounter<this.pollRate)this._pollCounter++;else{this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);this.mousePointer.update();this.gamepad&&this.gamepad.active&&
this.gamepad.update();for(var a=0;a<this.pointers.length;a++)this.pointers[a].update();this._pollCounter=0}},reset:function(a){if(this.game.isBooted&&!this.resetLocked){void 0===a&&(a=!1);this.mousePointer.reset();this.keyboard&&this.keyboard.reset(a);this.gamepad&&this.gamepad.reset();for(var c=0;c<this.pointers.length;c++)this.pointers[c].reset();"none"!==this.game.canvas.style.cursor&&(this.game.canvas.style.cursor="inherit");a&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),
this.onDown=new b.Signal,this.onUp=new b.Signal,this.onTap=new b.Signal,this.onHold=new b.Signal,this.moveCallbacks=[]);this._pollCounter=0}},resetSpeed:function(a,c){this._oldPosition.setTo(a,c);this.speed.setTo(0,0)},startPointer:function(a){if(0<=this.maxPointers&&this.countActivePointers(this.maxPointers)>=this.maxPointers)return null;if(!this.pointer1.active)return this.pointer1.start(a);if(!this.pointer2.active)return this.pointer2.start(a);for(var c=2;c<this.pointers.length;c++){var b=this.pointers[c];
if(!b.active)return b.start(a)}return null},updatePointer:function(a){if(this.pointer1.active&&this.pointer1.identifier===a.identifier)return this.pointer1.move(a);if(this.pointer2.active&&this.pointer2.identifier===a.identifier)return this.pointer2.move(a);for(var c=2;c<this.pointers.length;c++){var b=this.pointers[c];if(b.active&&b.identifier===a.identifier)return b.move(a)}return null},stopPointer:function(a){if(this.pointer1.active&&this.pointer1.identifier===a.identifier)return this.pointer1.stop(a);
if(this.pointer2.active&&this.pointer2.identifier===a.identifier)return this.pointer2.stop(a);for(var c=2;c<this.pointers.length;c++){var b=this.pointers[c];if(b.active&&b.identifier===a.identifier)return b.stop(a)}return null},countActivePointers:function(a){void 0===a&&(a=this.pointers.length);for(var c=a,b=0;b<this.pointers.length&&0<c;b++)this.pointers[b].active&&c--;return a-c},getPointer:function(a){void 0===a&&(a=!1);for(var c=0;c<this.pointers.length;c++){var b=this.pointers[c];if(b.active===
a)return b}return null},getPointerFromIdentifier:function(a){for(var c=0;c<this.pointers.length;c++){var b=this.pointers[c];if(b.identifier===a)return b}return null},getPointerFromId:function(a){for(var c=0;c<this.pointers.length;c++){var b=this.pointers[c];if(b.pointerId===a)return b}return null},getLocalPosition:function(a,c,d){void 0===d&&(d=new b.Point);a=a.worldTransform;var e=1/(a.a*a.d+a.c*-a.b);return d.setTo(a.d*e*c.x+-a.c*e*c.y+(a.ty*a.c-a.tx*a.d)*e,a.a*e*c.y+-a.b*e*c.x+(-a.ty*a.a+a.tx*
a.b)*e)},hitTest:function(a,c,d){if(!a.worldVisible)return!1;this.getLocalPosition(a,c,this._localPoint);d.copyFrom(this._localPoint);if(a.hitArea&&a.hitArea.contains)return a.hitArea.contains(this._localPoint.x,this._localPoint.y);if(a instanceof b.TileSprite){var e=a.width,h=a.height,l=-e*a.anchor.x;if(this._localPoint.x>=l&&this._localPoint.x<l+e&&(e=-h*a.anchor.y,this._localPoint.y>=e&&this._localPoint.y<e+h))return!0}else if(a instanceof PIXI.Sprite){if(e=a.texture.frame.width,h=a.texture.frame.height,
l=-e*a.anchor.x,this._localPoint.x>=l&&this._localPoint.x<l+e&&(e=-h*a.anchor.y,this._localPoint.y>=e&&this._localPoint.y<e+h))return!0}else if(a instanceof b.Graphics)for(h=0;h<a.graphicsData.length;h++)if(e=a.graphicsData[h],e.fill&&e.shape&&e.shape.contains(this._localPoint.x,this._localPoint.y))return!0;for(h=0;h<a.children.length;h++)if(this.hitTest(a.children[h],c,d))return!0;return!1},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}};b.Input.prototype.constructor=
b.Input;Object.defineProperty(b.Input.prototype,"x",{get:function(){return this._x},set:function(a){this._x=Math.floor(a)}});Object.defineProperty(b.Input.prototype,"y",{get:function(){return this._y},set:function(a){this._y=Math.floor(a)}});Object.defineProperty(b.Input.prototype,"pollLocked",{get:function(){return 0<this.pollRate&&this._pollCounter<this.pollRate}});Object.defineProperty(b.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}});
Object.defineProperty(b.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}});Object.defineProperty(b.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}});Object.defineProperty(b.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}});b.Mouse=function(a){this.game=a;this.input=a.input;this.callbackContext=this.game;this.mouseWheelCallback=this.mouseOverCallback=this.mouseOutCallback=this.mouseUpCallback=this.mouseDownCallback=
null;this.capture=!1;this.button=-1;this.wheelDelta=0;this.enabled=!0;this.stopOnGameOut=this.locked=!1;this.pointerLock=new b.Signal;this._wheelEvent=this._onMouseWheel=this._onMouseOver=this._onMouseOut=this._onMouseUp=this._onMouseMove=this._onMouseDown=this.event=null};b.Mouse.NO_BUTTON=-1;b.Mouse.LEFT_BUTTON=0;b.Mouse.MIDDLE_BUTTON=1;b.Mouse.RIGHT_BUTTON=2;b.Mouse.BACK_BUTTON=3;b.Mouse.FORWARD_BUTTON=4;b.Mouse.WHEEL_UP=1;b.Mouse.WHEEL_DOWN=-1;b.Mouse.prototype={start:function(){if((!this.game.device.android||
!1!==this.game.device.chrome)&&null===this._onMouseDown){var a=this;this._onMouseDown=function(c){return a.onMouseDown(c)};this._onMouseMove=function(c){return a.onMouseMove(c)};this._onMouseUp=function(c){return a.onMouseUp(c)};this._onMouseUpGlobal=function(c){return a.onMouseUpGlobal(c)};this._onMouseOutGlobal=function(c){return a.onMouseOutGlobal(c)};this._onMouseOut=function(c){return a.onMouseOut(c)};this._onMouseOver=function(c){return a.onMouseOver(c)};this._onMouseWheel=function(c){return a.onMouseWheel(c)};
var c=this.game.canvas;c.addEventListener("mousedown",this._onMouseDown,!0);c.addEventListener("mousemove",this._onMouseMove,!0);c.addEventListener("mouseup",this._onMouseUp,!0);this.game.device.cocoonJS||(window.addEventListener("mouseup",this._onMouseUpGlobal,!0),window.addEventListener("mouseout",this._onMouseOutGlobal,!0),c.addEventListener("mouseover",this._onMouseOver,!0),c.addEventListener("mouseout",this._onMouseOut,!0));var b=this.game.device.wheelEvent;b&&(c.addEventListener(b,this._onMouseWheel,
!0),"mousewheel"===b?this._wheelEvent=new p(-.025,1):"DOMMouseScroll"===b&&(this._wheelEvent=new p(1,1)))}},onMouseDown:function(a){this.event=a;this.capture&&a.preventDefault();this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,a);this.input.enabled&&this.enabled&&(a.identifier=0,this.input.mousePointer.start(a))},onMouseMove:function(a){this.event=a;this.capture&&a.preventDefault();this.mouseMoveCallback&&this.mouseMoveCallback.call(this.callbackContext,a);this.input.enabled&&
this.enabled&&(a.identifier=0,this.input.mousePointer.move(a))},onMouseUp:function(a){this.event=a;this.capture&&a.preventDefault();this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,a);this.input.enabled&&this.enabled&&(a.identifier=0,this.input.mousePointer.stop(a))},onMouseUpGlobal:function(a){this.input.mousePointer.withinGame||(this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,a),a.identifier=0,this.input.mousePointer.stop(a))},onMouseOutGlobal:function(a){this.event=
a;this.capture&&a.preventDefault();this.input.mousePointer.withinGame=!1;this.input.enabled&&this.enabled&&(this.input.mousePointer.stop(a),this.input.mousePointer.leftButton.stop(a),this.input.mousePointer.rightButton.stop(a))},onMouseOut:function(a){this.event=a;this.capture&&a.preventDefault();this.input.mousePointer.withinGame=!1;this.mouseOutCallback&&this.mouseOutCallback.call(this.callbackContext,a);this.input.enabled&&this.enabled&&this.stopOnGameOut&&(a.identifier=0,this.input.mousePointer.stop(a))},
onMouseOver:function(a){this.event=a;this.capture&&a.preventDefault();this.input.mousePointer.withinGame=!0;this.mouseOverCallback&&this.mouseOverCallback.call(this.callbackContext,a)},onMouseWheel:function(a){this._wheelEvent&&(a=this._wheelEvent.bindEvent(a));this.event=a;this.capture&&a.preventDefault();this.wheelDelta=b.Math.clamp(-a.deltaY,-1,1);this.mouseWheelCallback&&this.mouseWheelCallback.call(this.callbackContext,a)},requestPointerLock:function(){if(this.game.device.pointerLock){var a=
this.game.canvas;a.requestPointerLock=a.requestPointerLock||a.mozRequestPointerLock||a.webkitRequestPointerLock;a.requestPointerLock();var c=this;this._pointerLockChange=function(a){return c.pointerLockChange(a)};document.addEventListener("pointerlockchange",this._pointerLockChange,!0);document.addEventListener("mozpointerlockchange",this._pointerLockChange,!0);document.addEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},pointerLockChange:function(a){var c=this.game.canvas;document.pointerLockElement===
c||document.mozPointerLockElement===c||document.webkitPointerLockElement===c?(this.locked=!0,this.pointerLock.dispatch(!0,a)):(this.locked=!1,this.pointerLock.dispatch(!1,a))},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;document.exitPointerLock();document.removeEventListener("pointerlockchange",this._pointerLockChange,!0);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0);
document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)},stop:function(){var a=this.game.canvas;a.removeEventListener("mousedown",this._onMouseDown,!0);a.removeEventListener("mousemove",this._onMouseMove,!0);a.removeEventListener("mouseup",this._onMouseUp,!0);a.removeEventListener("mouseover",this._onMouseOver,!0);a.removeEventListener("mouseout",this._onMouseOut,!0);var c=this.game.device.wheelEvent;c&&a.removeEventListener(c,this._onMouseWheel,!0);window.removeEventListener("mouseup",
this._onMouseUpGlobal,!0);window.removeEventListener("mouseout",this._onMouseOutGlobal,!0);document.removeEventListener("pointerlockchange",this._pointerLockChange,!0);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}};b.Mouse.prototype.constructor=b.Mouse;p.prototype={};p.prototype.constructor=p;p.prototype.bindEvent=function(a){if(!p._stubsGenerated&&a){var c=function(a){return function(){var c=
this.originalEvent[a];return"function"!==typeof c?c:c.bind(this.originalEvent)}},b;for(b in a)b in p.prototype||Object.defineProperty(p.prototype,b,{get:c(b)});p._stubsGenerated=!0}this.originalEvent=a;return this};Object.defineProperties(p.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||
0}},deltaZ:{value:0}});b.MSPointer=function(a){this.game=a;this.input=a.input;this.callbackContext=this.game;this.pointerUpCallback=this.pointerMoveCallback=this.pointerDownCallback=null;this.capture=!0;this.button=-1;this.event=null;this.enabled=!0;this._onMSPointerOver=this._onMSPointerOut=this._onMSPointerUpGlobal=this._onMSPointerUp=this._onMSPointerMove=this._onMSPointerDown=null};b.MSPointer.prototype={start:function(){if(null===this._onMSPointerDown){var a=this;if(this.game.device.mspointer){this._onMSPointerDown=
function(c){return a.onPointerDown(c)};this._onMSPointerMove=function(c){return a.onPointerMove(c)};this._onMSPointerUp=function(c){return a.onPointerUp(c)};this._onMSPointerUpGlobal=function(c){return a.onPointerUpGlobal(c)};this._onMSPointerOut=function(c){return a.onPointerOut(c)};this._onMSPointerOver=function(c){return a.onPointerOver(c)};var c=this.game.canvas;c.addEventListener("MSPointerDown",this._onMSPointerDown,!1);c.addEventListener("MSPointerMove",this._onMSPointerMove,!1);c.addEventListener("MSPointerUp",
this._onMSPointerUp,!1);c.addEventListener("pointerdown",this._onMSPointerDown,!1);c.addEventListener("pointermove",this._onMSPointerMove,!1);c.addEventListener("pointerup",this._onMSPointerUp,!1);c.style["-ms-content-zooming"]="none";c.style["-ms-touch-action"]="none";this.game.device.cocoonJS||(window.addEventListener("MSPointerUp",this._onMSPointerUpGlobal,!0),c.addEventListener("MSPointerOver",this._onMSPointerOver,!0),c.addEventListener("MSPointerOut",this._onMSPointerOut,!0),window.addEventListener("pointerup",
this._onMSPointerUpGlobal,!0),c.addEventListener("pointerover",this._onMSPointerOver,!0),c.addEventListener("pointerout",this._onMSPointerOut,!0))}}},onPointerDown:function(a){this.event=a;this.capture&&a.preventDefault();this.pointerDownCallback&&this.pointerDownCallback.call(this.callbackContext,a);this.input.enabled&&this.enabled&&(a.identifier=a.pointerId,"mouse"===a.pointerType||4===a.pointerType?this.input.mousePointer.start(a):this.input.startPointer(a))},onPointerMove:function(a){this.event=
a;this.capture&&a.preventDefault();this.pointerMoveCallback&&this.pointerMoveCallback.call(this.callbackContext,a);this.input.enabled&&this.enabled&&(a.identifier=a.pointerId,"mouse"===a.pointerType||4===a.pointerType?this.input.mousePointer.move(a):this.input.updatePointer(a))},onPointerUp:function(a){this.event=a;this.capture&&a.preventDefault();this.pointerUpCallback&&this.pointerUpCallback.call(this.callbackContext,a);this.input.enabled&&this.enabled&&(a.identifier=a.pointerId,"mouse"===a.pointerType||
4===a.pointerType?this.input.mousePointer.stop(a):this.input.stopPointer(a))},onPointerUpGlobal:function(a){if("mouse"!==a.pointerType&&4!==a.pointerType||this.input.mousePointer.withinGame){var c=this.input.getPointerFromIdentifier(a.identifier);if(c&&c.withinGame)this.onPointerUp(a)}else this.onPointerUp(a)},onPointerOut:function(a){this.event=a;this.capture&&a.preventDefault();if("mouse"===a.pointerType||4===a.pointerType)this.input.mousePointer.withinGame=!1;else{var c=this.input.getPointerFromIdentifier(a.identifier);
c&&(c.withinGame=!1)}this.input.mouse.mouseOutCallback&&this.input.mouse.mouseOutCallback.call(this.input.mouse.callbackContext,a);this.input.enabled&&this.enabled&&this.input.mouse.stopOnGameOut&&(a.identifier=0,c?c.stop(a):this.input.mousePointer.stop(a))},onPointerOver:function(a){this.event=a;this.capture&&a.preventDefault();if("mouse"===a.pointerType||4===a.pointerType)this.input.mousePointer.withinGame=!0;else{var c=this.input.getPointerFromIdentifier(a.identifier);c&&(c.withinGame=!0)}this.input.mouse.mouseOverCallback&&
this.input.mouse.mouseOverCallback.call(this.input.mouse.callbackContext,a)},stop:function(){var a=this.game.canvas;a.removeEventListener("MSPointerDown",this._onMSPointerDown,!1);a.removeEventListener("MSPointerMove",this._onMSPointerMove,!1);a.removeEventListener("MSPointerUp",this._onMSPointerUp,!1);a.removeEventListener("pointerdown",this._onMSPointerDown,!1);a.removeEventListener("pointermove",this._onMSPointerMove,!1);a.removeEventListener("pointerup",this._onMSPointerUp,!1);window.removeEventListener("MSPointerUp",
this._onMSPointerUpGlobal,!0);a.removeEventListener("MSPointerOver",this._onMSPointerOver,!0);a.removeEventListener("MSPointerOut",this._onMSPointerOut,!0);window.removeEventListener("pointerup",this._onMSPointerUpGlobal,!0);a.removeEventListener("pointerover",this._onMSPointerOver,!0);a.removeEventListener("pointerout",this._onMSPointerOut,!0)}};b.MSPointer.prototype.constructor=b.MSPointer;b.DeviceButton=function(a,c){this.parent=a;this.game=a.game;this.event=null;this.isDown=!1;this.isUp=!0;this.repeats=
this.timeUp=this.timeDown=0;this.ctrlKey=this.shiftKey=this.altKey=!1;this.value=0;this.buttonCode=c;this.onDown=new b.Signal;this.onUp=new b.Signal;this.onFloat=new b.Signal};b.DeviceButton.prototype={start:function(a,c){this.isDown||(this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.repeats=0,this.event=a,this.value=c,a&&(this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.ctrlKey=a.ctrlKey),this.onDown.dispatch(this,c))},stop:function(a,c){this.isUp||(this.isDown=!1,this.isUp=!0,
this.timeUp=this.game.time.time,this.event=a,this.value=c,a&&(this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.ctrlKey=a.ctrlKey),this.onUp.dispatch(this,c))},padFloat:function(a){this.value=a;this.onFloat.dispatch(this,a)},justPressed:function(a){return this.isDown&&this.timeDown+(a||250)>this.game.time.time},justReleased:function(a){return this.isUp&&this.timeUp+(a||250)>this.game.time.time},reset:function(){this.isDown=!1;this.isUp=!0;this.timeDown=this.game.time.time;this.repeats=0;this.ctrlKey=
this.shiftKey=this.altKey=!1},destroy:function(){this.onDown.dispose();this.onUp.dispose();this.onFloat.dispose();this.game=this.parent=null}};b.DeviceButton.prototype.constructor=b.DeviceButton;Object.defineProperty(b.DeviceButton.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}});b.Pointer=function(a,c,d){this.game=a;this.id=c;this.type=b.POINTER;this.exists=!0;this.identifier=0;this.pointerId=null;this.pointerMode=d||b.PointerMode.CURSOR|b.PointerMode.CONTACT;
this.button=this.target=null;this.leftButton=new b.DeviceButton(this,b.Pointer.LEFT_BUTTON);this.middleButton=new b.DeviceButton(this,b.Pointer.MIDDLE_BUTTON);this.rightButton=new b.DeviceButton(this,b.Pointer.RIGHT_BUTTON);this.backButton=new b.DeviceButton(this,b.Pointer.BACK_BUTTON);this.forwardButton=new b.DeviceButton(this,b.Pointer.FORWARD_BUTTON);this.eraserButton=new b.DeviceButton(this,b.Pointer.ERASER_BUTTON);this._holdSent=!1;this._history=[];this._nextDrop=0;this.withinGame=this._stateReset=
!1;this.screenY=this.screenX=this.pageY=this.pageX=this.clientY=this.clientX=-1;this.movementY=this.movementX=this.rawMovementY=this.rawMovementX=0;this.y=this.x=-1;this.isMouse=0===c;this.isDown=!1;this.isUp=!0;this.totalTouches=this.previousTapTime=this.timeUp=this.timeDown=0;this.msSinceLastClick=Number.MAX_VALUE;this.targetObject=null;this.interactiveCandidates=[];this.dirty=this.active=!1;this.position=new b.Point;this.positionDown=new b.Point;this.positionUp=new b.Point;this.circle=new b.Circle(0,
0,44);this._trampolineTargetObject=this._clickTrampolines=null};b.Pointer.NO_BUTTON=0;b.Pointer.LEFT_BUTTON=1;b.Pointer.RIGHT_BUTTON=2;b.Pointer.MIDDLE_BUTTON=4;b.Pointer.BACK_BUTTON=8;b.Pointer.FORWARD_BUTTON=16;b.Pointer.ERASER_BUTTON=32;b.Pointer.prototype={resetButtons:function(){this.isDown=!1;this.isUp=!0;this.isMouse&&(this.leftButton.reset(),this.middleButton.reset(),this.rightButton.reset(),this.backButton.reset(),this.forwardButton.reset(),this.eraserButton.reset())},processButtonsDown:function(a,
c){b.Pointer.LEFT_BUTTON&a&&this.leftButton.start(c);b.Pointer.RIGHT_BUTTON&a&&this.rightButton.start(c);b.Pointer.MIDDLE_BUTTON&a&&this.middleButton.start(c);b.Pointer.BACK_BUTTON&a&&this.backButton.start(c);b.Pointer.FORWARD_BUTTON&a&&this.forwardButton.start(c);b.Pointer.ERASER_BUTTON&a&&this.eraserButton.start(c)},processButtonsUp:function(a,c){a===b.Mouse.LEFT_BUTTON&&this.leftButton.stop(c);a===b.Mouse.RIGHT_BUTTON&&this.rightButton.stop(c);a===b.Mouse.MIDDLE_BUTTON&&this.middleButton.stop(c);
a===b.Mouse.BACK_BUTTON&&this.backButton.stop(c);a===b.Mouse.FORWARD_BUTTON&&this.forwardButton.stop(c);5===a&&this.eraserButton.stop(c)},updateButtons:function(a){this.button=a.button;var c="down"===a.type.toLowerCase().substr(-4);void 0!==a.buttons?c?this.processButtonsDown(a.buttons,a):this.processButtonsUp(a.button,a):c?this.leftButton.start(a):(this.leftButton.stop(a),this.rightButton.stop(a));1===a.buttons&&a.ctrlKey&&this.leftButton.isDown&&(this.leftButton.stop(a),this.rightButton.start(a));
this.isUp=!0;this.isDown=!1;if(this.leftButton.isDown||this.rightButton.isDown||this.middleButton.isDown||this.backButton.isDown||this.forwardButton.isDown||this.eraserButton.isDown)this.isUp=!1,this.isDown=!0},start:function(a){var c=this.game.input;a.pointerId&&(this.pointerId=a.pointerId);this.identifier=a.identifier;this.target=a.target;this.isMouse?this.updateButtons(a):(this.isDown=!0,this.isUp=!1);this.withinGame=this.active=!0;this.dirty=!1;this._history=[];this._trampolineTargetObject=this._clickTrampolines=
null;this.msSinceLastClick=this.game.time.time-this.timeDown;this.timeDown=this.game.time.time;this._holdSent=!1;this.move(a,!0);this.positionDown.setTo(this.x,this.y);if(c.multiInputOverride===b.Input.MOUSE_OVERRIDES_TOUCH||c.multiInputOverride===b.Input.MOUSE_TOUCH_COMBINE||c.multiInputOverride===b.Input.TOUCH_OVERRIDES_MOUSE&&0===c.totalActivePointers)c.x=this.x,c.y=this.y,c.position.setTo(this.x,this.y),c.onDown.dispatch(this,a),c.resetSpeed(this.x,this.y);this._stateReset=!1;this.totalTouches++;
null!==this.targetObject&&this.targetObject._touchedHandler(this);return this},update:function(){var a=this.game.input;this.active&&(this.dirty&&(0<a.interactiveItems.total&&this.processInteractiveObjects(!1),this.dirty=!1),!1===this._holdSent&&this.duration>=a.holdRate&&((a.multiInputOverride===b.Input.MOUSE_OVERRIDES_TOUCH||a.multiInputOverride===b.Input.MOUSE_TOUCH_COMBINE||a.multiInputOverride===b.Input.TOUCH_OVERRIDES_MOUSE&&0===a.totalActivePointers)&&a.onHold.dispatch(this),this._holdSent=
!0),a.recordPointerHistory&&this.game.time.time>=this._nextDrop&&(this._nextDrop=this.game.time.time+a.recordRate,this._history.push({x:this.position.x,y:this.position.y}),this._history.length>a.recordLimit&&this._history.shift()))},move:function(a,c){var d=this.game.input;if(!d.pollLocked){void 0===c&&(c=!1);void 0!==a.button&&(this.button=a.button);c&&this.isMouse&&this.updateButtons(a);this.clientX=a.clientX;this.clientY=a.clientY;this.pageX=a.pageX;this.pageY=a.pageY;this.screenX=a.screenX;this.screenY=
a.screenY;this.isMouse&&d.mouse.locked&&!c&&(this.rawMovementX=a.movementX||a.mozMovementX||a.webkitMovementX||0,this.rawMovementY=a.movementY||a.mozMovementY||a.webkitMovementY||0,this.movementX+=this.rawMovementX,this.movementY+=this.rawMovementY);this.x=(this.pageX-this.game.scale.offset.x)*d.scale.x;this.y=(this.pageY-this.game.scale.offset.y)*d.scale.y;this.position.setTo(this.x,this.y);this.circle.x=this.x;this.circle.y=this.y;if(d.multiInputOverride===b.Input.MOUSE_OVERRIDES_TOUCH||d.multiInputOverride===
b.Input.MOUSE_TOUCH_COMBINE||d.multiInputOverride===b.Input.TOUCH_OVERRIDES_MOUSE&&0===d.totalActivePointers)d.activePointer=this,d.x=this.x,d.y=this.y,d.position.setTo(d.x,d.y),d.circle.x=d.x,d.circle.y=d.y;this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY);if(this.game.paused)return this;for(var e=d.moveCallbacks.length;e--;)d.moveCallbacks[e].callback.call(d.moveCallbacks[e].context,this,this.x,this.y,c);null!==this.targetObject&&!0===this.targetObject.isDragged?!1===this.targetObject.update(this)&&
(this.targetObject=null):0<d.interactiveItems.total&&this.processInteractiveObjects(c);return this}},processInteractiveObjects:function(a){var c=0,b=-1,e=null,h=this.game.input.interactiveItems.first;for(this.interactiveCandidates=[];h;)h.checked=!1,h.validForInput(b,c,!1)&&(h.checked=!0,a&&h.checkPointerDown(this,!0)||!a&&h.checkPointerOver(this,!0))&&(c=h.sprite.renderOrderID,b=h.priorityID,e=h,this.interactiveCandidates.push(h)),h=this.game.input.interactiveItems.next;for(h=this.game.input.interactiveItems.first;h;)!h.checked&&
h.validForInput(b,c,!0)&&(a&&h.checkPointerDown(this,!1)||!a&&h.checkPointerOver(this,!1))&&(c=h.sprite.renderOrderID,b=h.priorityID,e=h,this.interactiveCandidates.push(h)),h=this.game.input.interactiveItems.next;this.game.input.customCandidateHandler&&(e=this.game.input.customCandidateHandler.call(this.game.input.customCandidateHandlerContext,this,this.interactiveCandidates,e));this.swapTarget(e,!1);return null!==this.targetObject},swapTarget:function(a,c){void 0===c&&(c=!1);null===a?this.targetObject&&
(this.targetObject._pointerOutHandler(this,c),this.targetObject=null):null===this.targetObject?(this.targetObject=a,a._pointerOverHandler(this,c)):this.targetObject===a?!1===a.update(this)&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this,c),this.targetObject=a,this.targetObject._pointerOverHandler(this,c))},leave:function(a){this.withinGame=!1;this.move(a,!1)},stop:function(a){var c=this.game.input;if(this._stateReset&&this.withinGame)a.preventDefault();else{this.timeUp=this.game.time.time;
if(c.multiInputOverride===b.Input.MOUSE_OVERRIDES_TOUCH||c.multiInputOverride===b.Input.MOUSE_TOUCH_COMBINE||c.multiInputOverride===b.Input.TOUCH_OVERRIDES_MOUSE&&0===c.totalActivePointers)c.onUp.dispatch(this,a),0<=this.duration&&this.duration<=c.tapRate&&(this.timeUp-this.previousTapTime<c.doubleTapRate?c.onTap.dispatch(this,!0):c.onTap.dispatch(this,!1),this.previousTapTime=this.timeUp);this.isMouse?this.updateButtons(a):(this.isDown=!1,this.isUp=!0);0<this.id&&(this.active=!1);this.withinGame=
this.game.scale.bounds.contains(a.pageX,a.pageY);this.identifier=this.pointerId=null;this.positionUp.setTo(this.x,this.y);!1===this.isMouse&&c.currentPointers--;c.interactiveItems.callAll("_releasedHandler",this);this._clickTrampolines&&(this._trampolineTargetObject=this.targetObject);this.targetObject=null;return this}},justPressed:function(a){a=a||this.game.input.justPressedRate;return!0===this.isDown&&this.timeDown+a>this.game.time.time},justReleased:function(a){a=a||this.game.input.justReleasedRate;
return this.isUp&&this.timeUp+a>this.game.time.time},addClickTrampoline:function(a,c,b,e){if(this.isDown){for(var d=this._clickTrampolines=this._clickTrampolines||[],l=0;l<d.length;l++)if(d[l].name===a){d.splice(l,1);break}d.push({name:a,targetObject:this.targetObject,callback:c,callbackContext:b,callbackArgs:e})}},processClickTrampolines:function(){var a=this._clickTrampolines;if(a){for(var c=0;c<a.length;c++){var b=a[c];b.targetObject===this._trampolineTargetObject&&b.callback.apply(b.callbackContext,
b.callbackArgs)}this._trampolineTargetObject=this._clickTrampolines=null}},reset:function(){!1===this.isMouse&&(this.active=!1);this.identifier=this.pointerId=null;this.dirty=!1;this.totalTouches=0;this._holdSent=!1;this._history.length=0;this._stateReset=!0;this.resetButtons();this.targetObject&&this.targetObject._releasedHandler(this);this.targetObject=null},resetMovement:function(){this.movementY=this.movementX=0}};b.Pointer.prototype.constructor=b.Pointer;Object.defineProperty(b.Pointer.prototype,
"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}});Object.defineProperty(b.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}});Object.defineProperty(b.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}});b.PointerMode={CURSOR:1,CONTACT:2};b.Touch=function(a){this.game=a;this.enabled=!0;this.touchLockCallbacks=[];this.callbackContext=this.game;this.touchCancelCallback=this.touchLeaveCallback=this.touchEnterCallback=
this.touchEndCallback=this.touchMoveCallback=this.touchStartCallback=null;this.preventDefault=!0;this._onTouchMove=this._onTouchCancel=this._onTouchLeave=this._onTouchEnter=this._onTouchEnd=this._onTouchMove=this._onTouchStart=this.event=null};b.Touch.prototype={start:function(){if(null===this._onTouchStart){var a=this;this.game.device.touch&&(this._onTouchStart=function(c){return a.onTouchStart(c)},this._onTouchMove=function(c){return a.onTouchMove(c)},this._onTouchEnd=function(c){return a.onTouchEnd(c)},
this._onTouchEnter=function(c){return a.onTouchEnter(c)},this._onTouchLeave=function(c){return a.onTouchLeave(c)},this._onTouchCancel=function(c){return a.onTouchCancel(c)},this.game.canvas.addEventListener("touchstart",this._onTouchStart,!1),this.game.canvas.addEventListener("touchmove",this._onTouchMove,!1),this.game.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,!1),this.game.device.cocoonJS||(this.game.canvas.addEventListener("touchenter",
this._onTouchEnter,!1),this.game.canvas.addEventListener("touchleave",this._onTouchLeave,!1)))}},consumeDocumentTouches:function(){this._documentTouchMove=function(a){a.preventDefault()};document.addEventListener("touchmove",this._documentTouchMove,!1)},addTouchLockCallback:function(a,c,b){void 0===b&&(b=!1);this.touchLockCallbacks.push({callback:a,context:c,onEnd:b})},removeTouchLockCallback:function(a,c){for(var b=this.touchLockCallbacks.length;b--;)if(this.touchLockCallbacks[b].callback===a&&this.touchLockCallbacks[b].context===
c)return this.touchLockCallbacks.splice(b,1),!0;return!1},onTouchStart:function(a){for(var c=this.touchLockCallbacks.length;c--;){var b=this.touchLockCallbacks[c];!b.onEnd&&b.callback.call(b.context,this,a)&&this.touchLockCallbacks.splice(c,1)}this.event=a;if(this.game.input.enabled&&this.enabled)for(this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,a),this.preventDefault&&a.preventDefault(),c=0;c<a.changedTouches.length;c++)this.game.input.startPointer(a.changedTouches[c])},
onTouchCancel:function(a){this.event=a;this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,a);if(this.game.input.enabled&&this.enabled){this.preventDefault&&a.preventDefault();for(var c=0;c<a.changedTouches.length;c++)this.game.input.stopPointer(a.changedTouches[c])}},onTouchEnter:function(a){this.event=a;this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,a);this.game.input.enabled&&this.enabled&&this.preventDefault&&a.preventDefault()},onTouchLeave:function(a){this.event=
a;this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,a);this.preventDefault&&a.preventDefault()},onTouchMove:function(a){this.event=a;this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,a);this.preventDefault&&a.preventDefault();for(var c=0;c<a.changedTouches.length;c++)this.game.input.updatePointer(a.changedTouches[c])},onTouchEnd:function(a){for(var c=this.touchLockCallbacks.length;c--;){var b=this.touchLockCallbacks[c];b.onEnd&&b.callback.call(b.context,
this,a)&&this.touchLockCallbacks.splice(c,1)}this.event=a;this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,a);this.preventDefault&&a.preventDefault();for(c=0;c<a.changedTouches.length;c++)this.game.input.stopPointer(a.changedTouches[c])},stop:function(){this.game.device.touch&&(this.game.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.canvas.removeEventListener("touchend",this._onTouchEnd),
this.game.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel))}};b.Touch.prototype.constructor=b.Touch;b.InputHandler=function(a){this.sprite=a;this.game=a.game;this.checked=this.enabled=!1;this.priorityID=0;this.isDragged=this._setHandCursor=this.useHandCursor=!1;this.allowVerticalDrag=this.allowHorizontalDrag=!0;this.bringToTop=!1;this.snapOffset=
null;this.snapOnRelease=this.snapOnDrag=!1;this.snapOffsetY=this.snapOffsetX=this.snapY=this.snapX=0;this.pixelPerfectClick=this.pixelPerfectOver=!1;this.pixelPerfectAlpha=255;this.draggable=!1;this.boundsSprite=this.boundsRect=null;this.scaleLayer=!1;this.dragOffset=new b.Point;this.dragStopBlocksInputUp=this.dragFromCenter=!1;this.dragStartPoint=new b.Point;this.dragTimeThreshold=this.dragDistanceThreshold=0;this.downPoint=new b.Point;this.snapPoint=new b.Point;this._dragPoint=new b.Point;this._wasEnabled=
this._dragDistancePass=this._dragTimePass=this._pendingDrag=this._dragPhase=!1;this._tempPoint=new b.Point;this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,camX:0,camY:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})};b.InputHandler.prototype={start:function(a,c){a=a||0;void 0===c&&(c=!1);if(!1===this.enabled){this.game.input.interactiveItems.add(this);this.useHandCursor=c;this.priorityID=a;for(var d=0;10>d;d++)this._pointerData[d]=
{id:d,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new b.Point;this._wasEnabled=this.enabled=!0}this.sprite.events.onAddedToGroup.add(this.addedToGroup,this);this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this);return this.sprite},addedToGroup:function(){this._dragPhase||this._wasEnabled&&!this.enabled&&this.start()},removedFromGroup:function(){this._dragPhase||(this.enabled?(this._wasEnabled=!0,
this.stop()):this._wasEnabled=!1)},reset:function(){this.enabled=!1;for(var a=0;10>a;a++)this._pointerData[a]={id:a,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){!1!==this.enabled&&(this.enabled=!1,this.game.input.interactiveItems.remove(this))},destroy:function(){this.sprite&&(this._setHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.enabled=!1,this.game.input.interactiveItems.remove(this),
this._pointerData.length=0,this.sprite=this.boundsSprite=this.boundsRect=null)},validForInput:function(a,c,b){void 0===b&&(b=!0);return!this.enabled||0===this.sprite.scale.x||0===this.sprite.scale.y||this.priorityID<this.game.input.minPriorityID||this.sprite.parent&&this.sprite.parent.ignoreChildInput||!b&&(this.pixelPerfectClick||this.pixelPerfectOver)?!1:this.priorityID>a||this.priorityID===a&&this.sprite.renderOrderID>c?!0:!1},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},
pointerX:function(a){return this._pointerData[a||0].x},pointerY:function(a){return this._pointerData[a||0].y},pointerDown:function(a){return this._pointerData[a||0].isDown},pointerUp:function(a){return this._pointerData[a||0].isUp},pointerTimeDown:function(a){return this._pointerData[a||0].timeDown},pointerTimeUp:function(a){return this._pointerData[a||0].timeUp},pointerOver:function(a){if(!this.enabled)return!1;if(void 0===a){for(a=0;10>a;a++)if(this._pointerData[a].isOver)return!0;return!1}return this._pointerData[a].isOver},
pointerOut:function(a){if(!this.enabled)return!1;if(void 0===a)for(a=0;10>a;a++){if(this._pointerData[a].isOut)return!0}else return this._pointerData[a].isOut},pointerTimeOver:function(a){return this._pointerData[a||0].timeOver},pointerTimeOut:function(a){return this._pointerData[a||0].timeOut},pointerDragged:function(a){return this._pointerData[a||0].isDragged},checkPointerDown:function(a,c){return a.isDown&&this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&
0!==this.sprite.worldScale.x&&0!==this.sprite.worldScale.y?this.game.input.hitTest(this.sprite,a,this._tempPoint)?(void 0===c&&(c=!1),!c&&this.pixelPerfectClick?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1:!1},checkPointerOver:function(a,c){return this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&0!==this.sprite.worldScale.x&&0!==this.sprite.worldScale.y?this.game.input.hitTest(this.sprite,a,this._tempPoint)?(void 0===c&&(c=!1),!c&&this.pixelPerfectOver?
this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1:!1},checkPixel:function(a,c,b){if(this.sprite.texture.baseTexture.source){null===a&&null===c&&(this.game.input.getLocalPosition(this.sprite,b,this._tempPoint),a=this._tempPoint.x,c=this._tempPoint.y);0!==this.sprite.anchor.x&&(a-=-this.sprite.texture.frame.width*this.sprite.anchor.x);0!==this.sprite.anchor.y&&(c-=-this.sprite.texture.frame.height*this.sprite.anchor.y);a+=this.sprite.texture.frame.x;c+=this.sprite.texture.frame.y;if(this.sprite.texture.trim&&
(a-=this.sprite.texture.trim.x,c-=this.sprite.texture.trim.y,a<this.sprite.texture.crop.x||a>this.sprite.texture.crop.right||c<this.sprite.texture.crop.y||c>this.sprite.texture.crop.bottom))return this._dx=a,this._dy=c,!1;this._dx=a;this._dy=c;this.game.input.hitContext.clearRect(0,0,1,1);this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,a,c,1,1,0,0,1,1);if(this.game.input.hitContext.getImageData(0,0,1,1).data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(a){if(null!==
this.sprite&&void 0!==this.sprite.parent){if(!this.enabled||!this.sprite.visible||!this.sprite.parent.visible)return this._pointerOutHandler(a),!1;if(this._pendingDrag)return this._dragDistancePass||(this._dragDistancePass=b.Math.distance(a.x,a.y,this.downPoint.x,this.downPoint.y)>=this.dragDistanceThreshold),this._dragDistancePass&&this._dragTimePass&&this.startDrag(a),!0;if(this.draggable&&this._draggedPointerID===a.id)return this.updateDrag(a,!1);if(this._pointerData[a.id].isOver){if(this.checkPointerOver(a))return this._pointerData[a.id].x=
a.x-this.sprite.x,this._pointerData[a.id].y=a.y-this.sprite.y,!0;this._pointerOutHandler(a);return!1}}},_pointerOverHandler:function(a,c){if(null!==this.sprite){var d=this._pointerData[a.id];if(!1===d.isOver||a.dirty){var e=!1===d.isOver;d.isOver=!0;d.isOut=!1;d.timeOver=this.game.time.time;d.x=a.x-this.sprite.x;d.y=a.y-this.sprite.y;this.useHandCursor&&!1===d.isDragged&&(this.game.canvas.style.cursor="pointer",this._setHandCursor=!0);if(!c&&e&&this.sprite&&this.sprite.events)this.sprite.events.onInputOver$dispatch(this.sprite,
a);this.sprite.parent&&this.sprite.parent.type===b.GROUP&&this.sprite.parent.onChildInputOver.dispatch(this.sprite,a)}}},_pointerOutHandler:function(a,c){if(null!==this.sprite){var d=this._pointerData[a.id];d.isOver=!1;d.isOut=!0;d.timeOut=this.game.time.time;this.useHandCursor&&!1===d.isDragged&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1);!c&&this.sprite&&this.sprite.events&&(this.sprite.events.onInputOut$dispatch(this.sprite,a),this.sprite&&this.sprite.parent&&this.sprite.parent.type===
b.GROUP&&this.sprite.parent.onChildInputOut.dispatch(this.sprite,a))}},_touchedHandler:function(a){if(null!==this.sprite){var c=this._pointerData[a.id];if(!c.isDown&&c.isOver&&(!this.pixelPerfectClick||this.checkPixel(null,null,a))){c.isDown=!0;c.isUp=!1;c.timeDown=this.game.time.time;this.downPoint.set(a.x,a.y);a.dirty=!0;if(this.sprite&&this.sprite.events&&(this.sprite.events.onInputDown$dispatch(this.sprite,a),this.sprite&&this.sprite.parent&&this.sprite.parent.type===b.GROUP&&this.sprite.parent.onChildInputDown.dispatch(this.sprite,
a),null===this.sprite))return;this.draggable&&!1===this.isDragged&&(0===this.dragTimeThreshold&&0===this.dragDistanceThreshold?this.startDrag(a):(this._pendingDrag=!0,this._dragDistancePass=0===this.dragDistanceThreshold,0<this.dragTimeThreshold?(this._dragTimePass=!1,this.game.time.events.add(this.dragTimeThreshold,this.dragTimeElapsed,this,a)):this._dragTimePass=!0));this.bringToTop&&this.sprite.bringToTop()}}},dragTimeElapsed:function(a){this._dragTimePass=!0;this._pendingDrag&&this.sprite&&this._dragDistancePass&&
this.startDrag(a)},_releasedHandler:function(a){if(null!==this.sprite){var c=this._pointerData[a.id];if(c.isDown&&a.isUp){c.isDown=!1;c.isUp=!0;c.timeUp=this.game.time.time;c.downDuration=c.timeUp-c.timeDown;var d=this.checkPointerOver(a);if(this.sprite&&this.sprite.events){if(!this.dragStopBlocksInputUp||this.dragStopBlocksInputUp&&(!this.draggable||!this.isDragged||this._draggedPointerID!==a.id))this.sprite.events.onInputUp$dispatch(this.sprite,a,d);this.sprite&&this.sprite.parent&&this.sprite.parent.type===
b.GROUP&&this.sprite.parent.onChildInputUp.dispatch(this.sprite,a,d);d&&(d=this.checkPointerOver(a))}c.isOver=d;!d&&this.useHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1);a.dirty=!0;this._pendingDrag=!1;this.draggable&&this.isDragged&&this._draggedPointerID===a.id&&this.stopDrag(a)}}},updateDrag:function(a,c){void 0===c&&(c=!1);if(a.isUp)return this.stopDrag(a),!1;var b=this.globalToLocalX(a.x)+this._dragPoint.x+this.dragOffset.x,e=this.globalToLocalY(a.y)+this._dragPoint.y+
this.dragOffset.y;if(this.sprite.fixedToCamera)this.allowHorizontalDrag&&(this.sprite.cameraOffset.x=b),this.allowVerticalDrag&&(this.sprite.cameraOffset.y=e),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/
this.snapY)*this.snapY+this.snapOffsetY%this.snapY,this.snapPoint.set(this.sprite.cameraOffset.x,this.sprite.cameraOffset.y));else{var h=this.game.camera.x-this._pointerData[a.id].camX,l=this.game.camera.y-this._pointerData[a.id].camY;this.allowHorizontalDrag&&(this.sprite.x=b+h);this.allowVerticalDrag&&(this.sprite.y=e+l);this.boundsRect&&this.checkBoundsRect();this.boundsSprite&&this.checkBoundsSprite();this.snapOnDrag&&(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*
this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,this.snapPoint.set(this.sprite.x,this.sprite.y))}this.sprite.events.onDragUpdate.dispatch(this.sprite,a,b,e,this.snapPoint,c);return!0},justOver:function(a,c){a=a||0;c=c||500;return this._pointerData[a].isOver&&this.overDuration(a)<c},justOut:function(a,c){a=a||0;return this._pointerData[a].isOut&&this.game.time.time-this._pointerData[a].timeOut<
(c||500)},justPressed:function(a,c){a=a||0;c=c||500;return this._pointerData[a].isDown&&this.downDuration(a)<c},justReleased:function(a,c){a=a||0;return this._pointerData[a].isUp&&this.game.time.time-this._pointerData[a].timeUp<(c||500)},overDuration:function(a){a=a||0;return this._pointerData[a].isOver?this.game.time.time-this._pointerData[a].timeOver:-1},downDuration:function(a){a=a||0;return this._pointerData[a].isDown?this.game.time.time-this._pointerData[a].timeDown:-1},enableDrag:function(a,
c,d,e,h,l){void 0===a&&(a=!1);void 0===c&&(c=!1);void 0===d&&(d=!1);void 0===e&&(e=255);void 0===h&&(h=null);void 0===l&&(l=null);this._dragPoint=new b.Point;this.draggable=!0;this.bringToTop=c;this.dragOffset=new b.Point;this.dragFromCenter=a;this.pixelPerfectClick=d;this.pixelPerfectAlpha=e;h&&(this.boundsRect=h);l&&(this.boundsSprite=l)},disableDrag:function(){if(this._pointerData)for(var a=0;10>a;a++)this._pointerData[a].isDragged=!1;this.isDragged=this.draggable=!1;this._draggedPointerID=-1;
this._pendingDrag=!1},startDrag:function(a){var c=this.sprite.x,b=this.sprite.y;this.isDragged=!0;this._draggedPointerID=a.id;this._pointerData[a.id].camX=this.game.camera.x;this._pointerData[a.id].camY=this.game.camera.y;this._pointerData[a.id].isDragged=!0;if(this.sprite.fixedToCamera){if(this.dragFromCenter){var e=this.sprite.getBounds();this.sprite.cameraOffset.x=this.globalToLocalX(a.x)+(this.sprite.cameraOffset.x-e.centerX);this.sprite.cameraOffset.y=this.globalToLocalY(a.y)+(this.sprite.cameraOffset.y-
e.centerY)}this._dragPoint.setTo(this.sprite.cameraOffset.x-a.x,this.sprite.cameraOffset.y-a.y)}else this.dragFromCenter&&(e=this.sprite.getBounds(),this.sprite.x=this.globalToLocalX(a.x)+(this.sprite.x-e.centerX),this.sprite.y=this.globalToLocalY(a.y)+(this.sprite.y-e.centerY)),this._dragPoint.setTo(this.sprite.x-this.globalToLocalX(a.x),this.sprite.y-this.globalToLocalY(a.y));this.updateDrag(a,!0);this.bringToTop&&(this._dragPhase=!0,this.sprite.bringToTop());this.dragStartPoint.set(c,b);this.sprite.events.onDragStart$dispatch(this.sprite,
a,c,b);this._pendingDrag=!1},globalToLocalX:function(a){this.scaleLayer&&(a-=this.game.scale.grid.boundsFluid.x,a*=this.game.scale.grid.scaleFluidInversed.x);return a},globalToLocalY:function(a){this.scaleLayer&&(a-=this.game.scale.grid.boundsFluid.y,a*=this.game.scale.grid.scaleFluidInversed.y);return a},stopDrag:function(a){this.isDragged=!1;this._draggedPointerID=-1;this._pendingDrag=this._dragPhase=this._pointerData[a.id].isDragged=!1;this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=
Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY));
this.sprite.events.onDragStop$dispatch(this.sprite,a);!1===this.checkPointerOver(a)&&this._pointerOutHandler(a)},setDragLock:function(a,c){void 0===a&&(a=!0);void 0===c&&(c=!0);this.allowHorizontalDrag=a;this.allowVerticalDrag=c},enableSnap:function(a,c,b,e,h,l){void 0===b&&(b=!0);void 0===e&&(e=!1);void 0===h&&(h=0);void 0===l&&(l=0);this.snapX=a;this.snapY=c;this.snapOffsetX=h;this.snapOffsetY=l;this.snapOnDrag=b;this.snapOnRelease=e},disableSnap:function(){this.snapOnRelease=this.snapOnDrag=!1},
checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.left:this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-
this.sprite.height)):(this.sprite.left<this.boundsRect.left?this.sprite.x=this.boundsRect.x+this.sprite.offsetX:this.sprite.right>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsRect.top?this.sprite.y=this.boundsRect.top+this.sprite.offsetY:this.sprite.bottom>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&
this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.cameraOffset.x+this.boundsSprite.width&&(this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y:this.sprite.cameraOffset.y+
this.sprite.height>this.boundsSprite.cameraOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.left<this.boundsSprite.left?this.sprite.x=this.boundsSprite.left+this.sprite.offsetX:this.sprite.right>this.boundsSprite.right&&(this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsSprite.top?this.sprite.y=this.boundsSprite.top+this.sprite.offsetY:this.sprite.bottom>
this.boundsSprite.bottom&&(this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)))}};b.InputHandler.prototype.constructor=b.InputHandler;b.Gamepad=function(a){this.game=a;this._gamepadIndexMap={};this._rawPads=[];this._active=!1;this.enabled=!0;this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||-1!==navigator.userAgent.indexOf("Firefox/")||!!navigator.getGamepads;this._prevRawGamepadTypes=[];this._prevTimestamps=[];this.callbackContext=
this;this._gamepaddisconnected=this._ongamepadconnected=this.onFloatCallback=this.onAxisCallback=this.onUpCallback=this.onDownCallback=this.onDisconnectCallback=this.onConnectCallback=null;this._gamepads=[new b.SinglePad(a,this),new b.SinglePad(a,this),new b.SinglePad(a,this),new b.SinglePad(a,this)]};b.Gamepad.prototype={addCallbacks:function(a,c){"undefined"!==typeof c&&(this.onConnectCallback="function"===typeof c.onConnect?c.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"===
typeof c.onDisconnect?c.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"===typeof c.onDown?c.onDown:this.onDownCallback,this.onUpCallback="function"===typeof c.onUp?c.onUp:this.onUpCallback,this.onAxisCallback="function"===typeof c.onAxis?c.onAxis:this.onAxisCallback,this.onFloatCallback="function"===typeof c.onFloat?c.onFloat:this.onFloatCallback,this.callbackContext=a)},start:function(){if(!this._active){this._active=!0;var a=this;this._onGamepadConnected=function(c){return a.onGamepadConnected(c)};
this._onGamepadDisconnected=function(c){return a.onGamepadDisconnected(c)};window.addEventListener("gamepadconnected",this._onGamepadConnected,!1);window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,!1)}},onGamepadConnected:function(a){a=a.gamepad;this._rawPads.push(a);this._gamepads[a.index].connect(a)},onGamepadDisconnected:function(a){a=a.gamepad;for(var c in this._rawPads)this._rawPads[c].index===a.index&&this._rawPads.splice(c,1);this._gamepads[a.index].disconnect()},update:function(){this._pollGamepads();
this.pad1.pollStatus();this.pad2.pollStatus();this.pad3.pollStatus();this.pad4.pollStatus()},_pollGamepads:function(){if(this._active){if(navigator.getGamepads)var a=navigator.getGamepads();else navigator.webkitGetGamepads?a=navigator.webkitGetGamepads():navigator.webkitGamepads&&(a=navigator.webkitGamepads());if(a){this._rawPads=[];for(var c=!1,b=0;b<a.length&&(typeof a[b]!==this._prevRawGamepadTypes[b]&&(c=!0,this._prevRawGamepadTypes[b]=typeof a[b]),a[b]&&this._rawPads.push(a[b]),3!==b);b++);for(a=
0;a<this._gamepads.length;a++)this._gamepads[a]._rawPad=this._rawPads[a];if(c){for(var c={},a={},e=0;e<this._gamepads.length;e++)if(b=this._gamepads[e],b.connected)for(var h=0;h<this._rawPads.length;h++)this._rawPads[h].index===b.index&&(c[b.index]=!0,a[e]=!0);for(e=0;e<this._gamepads.length;e++)if(b=this._gamepads[e],!a[e])for(1>this._rawPads.length&&b.disconnect(),h=0;h<this._rawPads.length&&!a[e];h++){var l=this._rawPads[h];l?c[l.index]?b.disconnect():(b.connect(l),c[l.index]=!0,a[e]=!0):b.disconnect()}}}}},
setDeadZones:function(a){for(var c=0;c<this._gamepads.length;c++)this._gamepads[c].deadZone=a},stop:function(){this._active=!1;window.removeEventListener("gamepadconnected",this._onGamepadConnected);window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var a=0;a<this._gamepads.length;a++)this._gamepads[a].reset()},justPressed:function(a,c){for(var b=0;b<this._gamepads.length;b++)if(!0===this._gamepads[b].justPressed(a,c))return!0;return!1},
justReleased:function(a,c){for(var b=0;b<this._gamepads.length;b++)if(!0===this._gamepads[b].justReleased(a,c))return!0;return!1},isDown:function(a){for(var c=0;c<this._gamepads.length;c++)if(!0===this._gamepads[c].isDown(a))return!0;return!1},destroy:function(){this.stop();for(var a=0;a<this._gamepads.length;a++)this._gamepads[a].destroy()}};b.Gamepad.prototype.constructor=b.Gamepad;Object.defineProperty(b.Gamepad.prototype,"active",{get:function(){return this._active}});Object.defineProperty(b.Gamepad.prototype,
"supported",{get:function(){return this._gamepadSupportAvailable}});Object.defineProperty(b.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}});Object.defineProperty(b.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}});Object.defineProperty(b.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}});Object.defineProperty(b.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}});Object.defineProperty(b.Gamepad.prototype,"pad4",
{get:function(){return this._gamepads[3]}});b.Gamepad.BUTTON_0=0;b.Gamepad.BUTTON_1=1;b.Gamepad.BUTTON_2=2;b.Gamepad.BUTTON_3=3;b.Gamepad.BUTTON_4=4;b.Gamepad.BUTTON_5=5;b.Gamepad.BUTTON_6=6;b.Gamepad.BUTTON_7=7;b.Gamepad.BUTTON_8=8;b.Gamepad.BUTTON_9=9;b.Gamepad.BUTTON_10=10;b.Gamepad.BUTTON_11=11;b.Gamepad.BUTTON_12=12;b.Gamepad.BUTTON_13=13;b.Gamepad.BUTTON_14=14;b.Gamepad.BUTTON_15=15;b.Gamepad.AXIS_0=0;b.Gamepad.AXIS_1=1;b.Gamepad.AXIS_2=2;b.Gamepad.AXIS_3=3;b.Gamepad.AXIS_4=4;b.Gamepad.AXIS_5=
5;b.Gamepad.AXIS_6=6;b.Gamepad.AXIS_7=7;b.Gamepad.AXIS_8=8;b.Gamepad.AXIS_9=9;b.Gamepad.XBOX360_A=0;b.Gamepad.XBOX360_B=1;b.Gamepad.XBOX360_X=2;b.Gamepad.XBOX360_Y=3;b.Gamepad.XBOX360_LEFT_BUMPER=4;b.Gamepad.XBOX360_RIGHT_BUMPER=5;b.Gamepad.XBOX360_LEFT_TRIGGER=6;b.Gamepad.XBOX360_RIGHT_TRIGGER=7;b.Gamepad.XBOX360_BACK=8;b.Gamepad.XBOX360_START=9;b.Gamepad.XBOX360_STICK_LEFT_BUTTON=10;b.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11;b.Gamepad.XBOX360_DPAD_LEFT=14;b.Gamepad.XBOX360_DPAD_RIGHT=15;b.Gamepad.XBOX360_DPAD_UP=
12;b.Gamepad.XBOX360_DPAD_DOWN=13;b.Gamepad.XBOX360_STICK_LEFT_X=0;b.Gamepad.XBOX360_STICK_LEFT_Y=1;b.Gamepad.XBOX360_STICK_RIGHT_X=2;b.Gamepad.XBOX360_STICK_RIGHT_Y=3;b.Gamepad.PS3XC_X=0;b.Gamepad.PS3XC_CIRCLE=1;b.Gamepad.PS3XC_SQUARE=2;b.Gamepad.PS3XC_TRIANGLE=3;b.Gamepad.PS3XC_L1=4;b.Gamepad.PS3XC_R1=5;b.Gamepad.PS3XC_L2=6;b.Gamepad.PS3XC_R2=7;b.Gamepad.PS3XC_SELECT=8;b.Gamepad.PS3XC_START=9;b.Gamepad.PS3XC_STICK_LEFT_BUTTON=10;b.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11;b.Gamepad.PS3XC_DPAD_UP=12;b.Gamepad.PS3XC_DPAD_DOWN=
13;b.Gamepad.PS3XC_DPAD_LEFT=14;b.Gamepad.PS3XC_DPAD_RIGHT=15;b.Gamepad.PS3XC_STICK_LEFT_X=0;b.Gamepad.PS3XC_STICK_LEFT_Y=1;b.Gamepad.PS3XC_STICK_RIGHT_X=2;b.Gamepad.PS3XC_STICK_RIGHT_Y=3;b.SinglePad=function(a,c){this.game=a;this.index=null;this.connected=!1;this.callbackContext=this;this.onFloatCallback=this.onAxisCallback=this.onUpCallback=this.onDownCallback=this.onDisconnectCallback=this.onConnectCallback=null;this.deadZone=.26;this._padParent=c;this._prevTimestamp=this._rawPad=null;this._buttons=
[];this._buttonsLen=0;this._axes=[];this._axesLen=0};b.SinglePad.prototype={addCallbacks:function(a,c){"undefined"!==typeof c&&(this.onConnectCallback="function"===typeof c.onConnect?c.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"===typeof c.onDisconnect?c.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"===typeof c.onDown?c.onDown:this.onDownCallback,this.onUpCallback="function"===typeof c.onUp?c.onUp:this.onUpCallback,this.onAxisCallback="function"===
typeof c.onAxis?c.onAxis:this.onAxisCallback,this.onFloatCallback="function"===typeof c.onFloat?c.onFloat:this.onFloatCallback,this.callbackContext=a)},getButton:function(a){return this._buttons[a]?this._buttons[a]:null},pollStatus:function(){if(this.connected&&this.game.input.enabled&&this.game.input.gamepad.enabled&&(!this._rawPad.timestamp||this._rawPad.timestamp!==this._prevTimestamp)){for(var a=0;a<this._buttonsLen;a++){var c=isNaN(this._rawPad.buttons[a])?this._rawPad.buttons[a].value:this._rawPad.buttons[a];
c!==this._buttons[a].value&&(1===c?this.processButtonDown(a,c):0===c?this.processButtonUp(a,c):this.processButtonFloat(a,c))}for(a=0;a<this._axesLen;a++)c=this._rawPad.axes[a],0<c&&c>this.deadZone||0>c&&c<-this.deadZone?this.processAxisChange(a,c):this.processAxisChange(a,0);this._prevTimestamp=this._rawPad.timestamp}},connect:function(a){var c=!this.connected;this.connected=!0;this.index=a.index;this._rawPad=a;this._buttons=[];this._buttonsLen=a.buttons.length;this._axes=[];this._axesLen=a.axes.length;
for(var d=0;d<this._axesLen;d++)this._axes[d]=a.axes[d];for(var e in a.buttons)e=parseInt(e,10),this._buttons[e]=new b.DeviceButton(this,e);c&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index);c&&this.onConnectCallback&&this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var a=this.connected,c=this.index;this.connected=!1;this.index=null;this._rawPad=void 0;for(var b=0;b<this._buttonsLen;b++)this._buttons[b].destroy();
this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;a&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,c);a&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},destroy:function(){this._rawPad=void 0;for(var a=0;a<this._buttonsLen;a++)this._buttons[a].destroy();this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;this.onFloatCallback=this.onAxisCallback=this.onUpCallback=this.onDownCallback=
this.onDisconnectCallback=this.onConnectCallback=null},processAxisChange:function(a,c){this._axes[a]!==c&&(this._axes[a]=c,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,a,c),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,this,a,c))},processButtonDown:function(a,c){this._buttons[a]&&this._buttons[a].start(null,c);this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,a,c,this.index);
this.onDownCallback&&this.onDownCallback.call(this.callbackContext,a,c)},processButtonUp:function(a,c){this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,a,c,this.index);this.onUpCallback&&this.onUpCallback.call(this.callbackContext,a,c);this._buttons[a]&&this._buttons[a].stop(null,c)},processButtonFloat:function(a,c){this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,a,c,this.index);this.onFloatCallback&&
this.onFloatCallback.call(this.callbackContext,a,c);this._buttons[a]&&this._buttons[a].padFloat(c)},axis:function(a){return this._axes[a]?this._axes[a]:!1},isDown:function(a){return this._buttons[a]?this._buttons[a].isDown:!1},isUp:function(a){return this._buttons[a]?this._buttons[a].isUp:!1},justReleased:function(a,c){if(this._buttons[a])return this._buttons[a].justReleased(c)},justPressed:function(a,c){if(this._buttons[a])return this._buttons[a].justPressed(c)},buttonValue:function(a){return this._buttons[a]?
this._buttons[a].value:null},reset:function(){for(var a=0;a<this._axes.length;a++)this._axes[a]=0}};b.SinglePad.prototype.constructor=b.SinglePad;b.Key=function(a,c){this.game=a;this._enabled=!0;this.event=null;this.isDown=!1;this.isUp=!0;this.shiftKey=this.ctrlKey=this.altKey=!1;this.duration=this.timeDown=0;this.timeUp=-2500;this.repeats=0;this.keyCode=c;this.onDown=new b.Signal;this.onHoldContext=this.onHoldCallback=null;this.onUp=new b.Signal;this._justUp=this._justDown=!1};b.Key.prototype={update:function(){this._enabled&&
this.isDown&&(this.duration=this.game.time.time-this.timeDown,this.repeats++,this.onHoldCallback&&this.onHoldCallback.call(this.onHoldContext,this))},processKeyDown:function(a){this._enabled&&(this.event=a,this.isDown||(this.altKey=a.altKey,this.ctrlKey=a.ctrlKey,this.shiftKey=a.shiftKey,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.repeats=this.duration=0,this._justDown=!0,this.onDown.dispatch(this)))},processKeyUp:function(a){this._enabled&&(this.event=a,this.isUp||(this.isDown=
!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=this.game.time.time-this.timeDown,this._justUp=!0,this.onUp.dispatch(this)))},reset:function(a){void 0===a&&(a=!0);this.isDown=!1;this.isUp=!0;this.timeUp=this.game.time.time;this.duration=0;this._enabled=!0;this._justUp=this._justDown=!1;a&&(this.onDown.removeAll(),this.onUp.removeAll(),this.onHoldContext=this.onHoldCallback=null)},downDuration:function(a){void 0===a&&(a=50);return this.isDown&&this.duration<a},upDuration:function(a){void 0===
a&&(a=50);return!this.isDown&&this.game.time.time-this.timeUp<a}};Object.defineProperty(b.Key.prototype,"justDown",{get:function(){var a=this._justDown;this._justDown=!1;return a}});Object.defineProperty(b.Key.prototype,"justUp",{get:function(){var a=this._justUp;this._justUp=!1;return a}});Object.defineProperty(b.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a=!!a;a!==this._enabled&&(a||this.reset(!1),this._enabled=a)}});b.Key.prototype.constructor=b.Key;b.Keyboard=
function(a){this.game=a;this.enabled=!0;this.pressEvent=this.event=null;this.callbackContext=this;this.onUpCallback=this.onPressCallback=this.onDownCallback=null;this._keys=[];this._capture=[];this._onKeyUp=this._onKeyPress=this._onKeyDown=null;this._k=this._i=0};b.Keyboard.prototype={addCallbacks:function(a,c,b,e){this.callbackContext=a;void 0!==c&&null!==c&&(this.onDownCallback=c);void 0!==b&&null!==b&&(this.onUpCallback=b);void 0!==e&&null!==e&&(this.onPressCallback=e)},addKey:function(a){this._keys[a]||
(this._keys[a]=new b.Key(this.game,a),this.addKeyCapture(a));return this._keys[a]},addKeys:function(a){var c={},b;for(b in a)c[b]=this.addKey(a[b]);return c},removeKey:function(a){this._keys[a]&&(this._keys[a]=null,this.removeKeyCapture(a))},createCursorKeys:function(){return this.addKeys({up:b.KeyCode.UP,down:b.KeyCode.DOWN,left:b.KeyCode.LEFT,right:b.KeyCode.RIGHT})},start:function(){if(!this.game.device.cocoonJS&&null===this._onKeyDown){var a=this;this._onKeyDown=function(c){return a.processKeyDown(c)};
this._onKeyUp=function(c){return a.processKeyUp(c)};this._onKeyPress=function(c){return a.processKeyPress(c)};window.addEventListener("keydown",this._onKeyDown,!1);window.addEventListener("keyup",this._onKeyUp,!1);window.addEventListener("keypress",this._onKeyPress,!1)}},stop:function(){window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp);window.removeEventListener("keypress",this._onKeyPress);this._onKeyPress=this._onKeyUp=this._onKeyDown=null},
destroy:function(){this.stop();this.clearCaptures();this._i=this._keys.length=0},addKeyCapture:function(a){if("object"===typeof a)for(var c in a)this._capture[a[c]]=!0;else this._capture[a]=!0},removeKeyCapture:function(a){delete this._capture[a]},clearCaptures:function(){this._capture={}},update:function(){for(this._i=this._keys.length;this._i--;)this._keys[this._i]&&this._keys[this._i].update()},processKeyDown:function(a){this.event=a;if(this.game.input.enabled&&this.enabled){var c=a.keyCode;this._capture[c]&&
a.preventDefault();this._keys[c]||(this._keys[c]=new b.Key(this.game,c));this._keys[c].processKeyDown(a);this._k=c;this.onDownCallback&&this.onDownCallback.call(this.callbackContext,a)}},processKeyPress:function(a){this.pressEvent=a;this.game.input.enabled&&this.enabled&&this.onPressCallback&&this.onPressCallback.call(this.callbackContext,String.fromCharCode(a.charCode),a)},processKeyUp:function(a){this.event=a;if(this.game.input.enabled&&this.enabled){var c=a.keyCode;this._capture[c]&&a.preventDefault();
this._keys[c]||(this._keys[c]=new b.Key(this.game,c));this._keys[c].processKeyUp(a);this.onUpCallback&&this.onUpCallback.call(this.callbackContext,a)}},reset:function(a){void 0===a&&(a=!0);this.event=null;for(var c=this._keys.length;c--;)this._keys[c]&&this._keys[c].reset(a)},downDuration:function(a,c){return this._keys[a]?this._keys[a].downDuration(c):null},upDuration:function(a,c){return this._keys[a]?this._keys[a].upDuration(c):null},isDown:function(a){return this._keys[a]?this._keys[a].isDown:
null}};Object.defineProperty(b.Keyboard.prototype,"lastChar",{get:function(){return 32===this.event.charCode?"":String.fromCharCode(this.pressEvent.charCode)}});Object.defineProperty(b.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}});b.Keyboard.prototype.constructor=b.Keyboard;b.KeyCode={A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,
EIGHT:56,NINE:57,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,COMMA:188,UNDERSCORE:189,PERIOD:190,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,
QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS:43,MINUS:44,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144};for(var k in b.KeyCode)b.KeyCode.hasOwnProperty(k)&&!k.match(/[a-z]/)&&(b.Keyboard[k]=b.KeyCode[k]);b.Component=function(){};b.Component.Angle=function(){};b.Component.Angle.prototype={angle:{get:function(){return b.Math.wrapAngle(b.Math.radToDeg(this.rotation))},set:function(a){this.rotation=
b.Math.degToRad(b.Math.wrapAngle(a))}}};b.Component.Animation=function(){};b.Component.Animation.prototype={play:function(a,c,b,e){if(this.animations)return this.animations.play(a,c,b,e)}};b.Component.AutoCull=function(){};b.Component.AutoCull.prototype={autoCull:!1,inCamera:{get:function(){this.autoCull||this.checkWorldBounds||(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y);return this.game.world.camera.view.intersects(this._bounds)}}};
b.Component.Bounds=function(){};b.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},centerX:{get:function(){return this.x-this.offsetX+.5*this.width},set:function(a){this.x=a+this.offsetX-.5*this.width}},centerY:{get:function(){return this.y-this.offsetY+.5*this.height},set:function(a){this.y=a+this.offsetY-.5*this.height}},left:{get:function(){return this.x-this.offsetX},set:function(a){this.x=a+this.offsetX}},
right:{get:function(){return this.x+this.width-this.offsetX},set:function(a){this.x=a-this.width+this.offsetX}},top:{get:function(){return this.y-this.offsetY},set:function(a){this.y=a+this.offsetY}},bottom:{get:function(){return this.y+this.height-this.offsetY},set:function(a){this.y=a-this.height+this.offsetY}},alignIn:function(a,c,d,e){void 0===d&&(d=0);void 0===e&&(e=0);switch(c){default:case b.TOP_LEFT:this.left=a.left-d;this.top=a.top-e;break;case b.TOP_CENTER:this.centerX=a.centerX+d;this.top=
a.top-e;break;case b.TOP_RIGHT:this.right=a.right+d;this.top=a.top-e;break;case b.LEFT_CENTER:this.left=a.left-d;this.centerY=a.centerY+e;break;case b.CENTER:this.centerX=a.centerX+d;this.centerY=a.centerY+e;break;case b.RIGHT_CENTER:this.right=a.right+d;this.centerY=a.centerY+e;break;case b.BOTTOM_LEFT:this.left=a.left-d;this.bottom=a.bottom+e;break;case b.BOTTOM_CENTER:this.centerX=a.centerX+d;this.bottom=a.bottom+e;break;case b.BOTTOM_RIGHT:this.right=a.right+d,this.bottom=a.bottom+e}return this},
alignTo:function(a,c,d,e){void 0===d&&(d=0);void 0===e&&(e=0);switch(c){default:case b.TOP_LEFT:this.left=a.left-d;this.bottom=a.top-e;break;case b.TOP_CENTER:this.centerX=a.centerX+d;this.bottom=a.top-e;break;case b.TOP_RIGHT:this.right=a.right+d;this.bottom=a.top-e;break;case b.LEFT_TOP:this.right=a.left-d;this.top=a.top-e;break;case b.LEFT_CENTER:this.right=a.left-d;this.centerY=a.centerY+e;break;case b.LEFT_BOTTOM:this.right=a.left-d;this.bottom=a.bottom+e;break;case b.RIGHT_TOP:this.left=a.right+
d;this.top=a.top-e;break;case b.RIGHT_CENTER:this.left=a.right+d;this.centerY=a.centerY+e;break;case b.RIGHT_BOTTOM:this.left=a.right+d;this.bottom=a.bottom+e;break;case b.BOTTOM_LEFT:this.left=a.left-d;this.top=a.bottom+e;break;case b.BOTTOM_CENTER:this.centerX=a.centerX+d;this.top=a.bottom+e;break;case b.BOTTOM_RIGHT:this.right=a.right+d,this.top=a.bottom+e}return this}};b.Group.prototype.alignIn=b.Component.Bounds.prototype.alignIn;b.Group.prototype.alignTo=b.Component.Bounds.prototype.alignTo;
b.Component.BringToTop=function(){};b.Component.BringToTop.prototype.bringToTop=function(){this.parent&&this.parent.bringToTop(this);return this};b.Component.BringToTop.prototype.sendToBack=function(){this.parent&&this.parent.sendToBack(this);return this};b.Component.BringToTop.prototype.moveUp=function(){this.parent&&this.parent.moveUp(this);return this};b.Component.BringToTop.prototype.moveDown=function(){this.parent&&this.parent.moveDown(this);return this};b.Component.Core=function(){};b.Component.Core.install=
function(a){b.Utils.mixinPrototype(this,b.Component.Core.prototype);this.components={};for(var c=0;c<a.length;c++){var d=a[c],e=!1;"Destroy"===d&&(e=!0);b.Utils.mixinPrototype(this,b.Component[d].prototype,e);this.components[d]=!0}};b.Component.Core.init=function(a,c,d,e,h){this.game=a;this.key=e;this.data={};this.position.set(c,d);this.world=new b.Point(c,d);this.previousPosition=new b.Point(c,d);this.events=new b.Events(this);this._bounds=new b.Rectangle;this.components.PhysicsBody&&(this.body=
this.body);this.components.Animation&&(this.animations=new b.AnimationManager(this));this.components.LoadTexture&&null!==e&&this.loadTexture(e,h);this.components.FixedToCamera&&(this.cameraOffset=new b.Point(c,d))};b.Component.Core.preUpdate=function(){if(this.pendingDestroy)this.destroy();else{this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;this.world.setTo(this.game.camera.x+this.worldTransform.tx,
this.game.camera.y+this.worldTransform.ty);this.visible&&(this.renderOrderID=this.game.stage.currentRenderOrderID++);this.animations&&this.animations.update();this.body&&this.body.preUpdate();for(var a=0;a<this.children.length;a++)this.children[a].preUpdate();return!0}};b.Component.Core.prototype={game:null,name:"",data:{},components:{},z:0,events:void 0,animations:void 0,key:"",world:null,debug:!1,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:!0,pendingDestroy:!1,_bounds:null,_exists:!0,
exists:{get:function(){return this._exists},set:function(a){a?(this._exists=!0,this.body&&this.body.type===b.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._exists=!1,this.body&&this.body.type===b.Physics.P2JS&&this.body.removeFromWorld(),this.visible=!1)}},update:function(){},postUpdate:function(){this.customRender&&this.key.render();this.components.PhysicsBody&&b.Component.PhysicsBody.postUpdate.call(this);this.components.FixedToCamera&&b.Component.FixedToCamera.postUpdate.call(this);
for(var a=0;a<this.children.length;a++)this.children[a].postUpdate()}};b.Component.Crop=function(){};b.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(a,c){void 0===c&&(c=!1);a?(c&&null!==this.cropRect?this.cropRect.setTo(a.x,a.y,a.width,a.height):this.cropRect=c&&null===this.cropRect?new b.Rectangle(a.x,a.y,a.width,a.height):a,this.updateCrop()):(this.cropRect=this._crop=null,this.resetFrame())},updateCrop:function(){if(this.cropRect){var a=this.texture.crop.x,c=this.texture.crop.y,
d=this.texture.crop.width,e=this.texture.crop.height;this._crop=b.Rectangle.clone(this.cropRect,this._crop);this._crop.x+=this._frame.x;this._crop.y+=this._frame.y;var h=Math.max(this._frame.x,this._crop.x),l=Math.max(this._frame.y,this._crop.y),f=Math.min(this._frame.right,this._crop.right)-h,g=Math.min(this._frame.bottom,this._crop.bottom)-l;this.texture.crop.x=h;this.texture.crop.y=l;this.texture.crop.width=f;this.texture.crop.height=g;this.texture.frame.width=Math.min(f,this.cropRect.width);this.texture.frame.height=
Math.min(g,this.cropRect.height);this.texture.width=this.texture.frame.width;this.texture.height=this.texture.frame.height;this.texture._updateUvs();16777215===this.tint||a===h&&c===l&&d===f&&e===g||(this.texture.requiresReTint=!0)}}};b.Component.Delta=function(){};b.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}};
b.Component.Destroy=function(){};b.Component.Destroy.prototype={destroyPhase:!1,destroy:function(a,c){if(null!==this.game&&!this.destroyPhase){void 0===a&&(a=!0);void 0===c&&(c=!1);this.destroyPhase=!0;if(this.events)this.events.onDestroy$dispatch(this);this.parent&&(this.parent instanceof b.Group?this.parent.remove(this):this.parent.removeChild(this));this.input&&this.input.destroy();this.animations&&this.animations.destroy();this.body&&this.body.destroy();this.events&&this.events.destroy();this.game.tweens.removeFrom(this);
var d=this.children.length;if(a)for(;d--;)this.children[d].destroy(a);else for(;d--;)this.removeChild(this.children[d]);this._crop&&(this.cropRect=this._crop=null);this._frame&&(this._frame=null);b.Video&&this.key instanceof b.Video&&this.key.onChangeSource.remove(this.resizeFrame,this);b.BitmapText&&this._glyphs&&(this._glyphs=[]);this.visible=this.exists=this.alive=!1;this.game=this.mask=this.filters=null;this.data={};this.renderable=!1;this.transformCallback&&(this.transformCallbackContext=this.transformCallback=
null);this._mask=this._currentBounds=this._bounds=this.filterArea=this.worldTransform=this.stage=this.parent=this.hitArea=null;this._destroyCachedSprite();c&&this.texture.destroy(!0);this.pendingDestroy=this.destroyPhase=!1}}};b.Events=function(a){this.parent=a};b.Events.prototype={destroy:function(){this._parent=null;this._onDestroy&&this._onDestroy.dispose();this._onAddedToGroup&&this._onAddedToGroup.dispose();this._onRemovedFromGroup&&this._onRemovedFromGroup.dispose();this._onRemovedFromWorld&&
this._onRemovedFromWorld.dispose();this._onKilled&&this._onKilled.dispose();this._onRevived&&this._onRevived.dispose();this._onEnterBounds&&this._onEnterBounds.dispose();this._onOutOfBounds&&this._onOutOfBounds.dispose();this._onInputOver&&this._onInputOver.dispose();this._onInputOut&&this._onInputOut.dispose();this._onInputDown&&this._onInputDown.dispose();this._onInputUp&&this._onInputUp.dispose();this._onDragStart&&this._onDragStart.dispose();this._onDragUpdate&&this._onDragUpdate.dispose();this._onDragStop&&
this._onDragStop.dispose();this._onAnimationStart&&this._onAnimationStart.dispose();this._onAnimationComplete&&this._onAnimationComplete.dispose();this._onAnimationLoop&&this._onAnimationLoop.dispose()},onAddedToGroup:null,onRemovedFromGroup:null,onRemovedFromWorld:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragUpdate:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,
onAnimationLoop:null};b.Events.prototype.constructor=b.Events;for(var f in b.Events.prototype)b.Events.prototype.hasOwnProperty(f)&&0===f.indexOf("on")&&null===b.Events.prototype[f]&&function(a,c){Object.defineProperty(b.Events.prototype,a,{get:function(){return this[c]||(this[c]=new b.Signal)}});b.Events.prototype[a+"$dispatch"]=function(){return this[c]?this[c].dispatch.apply(this[c],arguments):null}}(f,"_"+f);b.Component.FixedToCamera=function(){};b.Component.FixedToCamera.postUpdate=function(){this.fixedToCamera&&
(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)};b.Component.FixedToCamera.prototype={_fixedToCamera:!1,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(a){a?(this._fixedToCamera=!0,this.cameraOffset.set(this.x,this.y)):this._fixedToCamera=!1}},cameraOffset:new b.Point};b.Component.Health=function(){};b.Component.Health.prototype={health:1,maxHealth:100,
damage:function(a){this.alive&&(this.health-=a,0>=this.health&&this.kill());return this},setHealth:function(a){this.health=a;this.health>this.maxHealth&&(this.health=this.maxHealth);return this},heal:function(a){this.alive&&(this.health+=a,this.health>this.maxHealth&&(this.health=this.maxHealth));return this}};b.Component.InCamera=function(){};b.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}};b.Component.InputEnabled=function(){};
b.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return this.input&&this.input.enabled},set:function(a){a?null===this.input?(this.input=new b.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}};b.Component.InWorld=function(){};b.Component.InWorld.preUpdate=function(){if(this.autoCull||this.checkWorldBounds){this._bounds.copyFrom(this.getBounds());this._bounds.x+=this.game.camera.view.x;
this._bounds.y+=this.game.camera.view.y;if(this.autoCull)if(this.game.world.camera.view.intersects(this._bounds))this.renderable=!0,this.game.world.camera.totalInView++;else if(this.renderable=!1,this.outOfCameraBoundsKill)return this.kill(),!1;if(this.checkWorldBounds)if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds))this._outOfBoundsFired=!1,this.events.onEnterBounds$dispatch(this);else if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)&&(this._outOfBoundsFired=
!0,this.events.onOutOfBounds$dispatch(this),this.outOfBoundsKill))return this.kill(),!1}return!0};b.Component.InWorld.prototype={checkWorldBounds:!1,outOfBoundsKill:!1,outOfCameraBoundsKill:!1,_outOfBoundsFired:!1,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}};b.Component.LifeSpan=function(){};b.Component.LifeSpan.preUpdate=function(){return 0<this.lifespan&&(this.lifespan-=this.game.time.physicsElapsedMS,0>=this.lifespan)?(this.kill(),!1):!0};b.Component.LifeSpan.prototype=
{alive:!0,lifespan:0,revive:function(a){void 0===a&&(a=100);this.visible=this.exists=this.alive=!0;"function"===typeof this.setHealth&&this.setHealth(a);if(this.events)this.events.onRevived$dispatch(this);return this},kill:function(){this.visible=this.exists=this.alive=!1;if(this.events)this.events.onKilled$dispatch(this);return this}};b.Component.LoadTexture=function(){};b.Component.LoadTexture.prototype={customRender:!1,_frame:null,loadTexture:function(a,c,d){a===b.PENDING_ATLAS?(a=c,c=0):c=c||
0;(d||void 0===d)&&this.animations&&this.animations.stop();this.key=a;this.customRender=!1;var e=this.game.cache,h=!0;d=!this.texture.baseTexture.scaleMode;b.RenderTexture&&a instanceof b.RenderTexture?(this.key=a.key,this.setTexture(a)):b.BitmapData&&a instanceof b.BitmapData?(this.customRender=!0,this.setTexture(a.texture),h=e.hasFrameData(a.key,b.Cache.BITMAPDATA)?!this.animations.loadFrameData(e.getFrameData(a.key,b.Cache.BITMAPDATA),c):!this.animations.loadFrameData(a.frameData,0)):b.Video&&
a instanceof b.Video?(this.customRender=!0,c=a.texture.valid,this.setTexture(a.texture),this.setFrame(a.texture.frame.clone()),a.onChangeSource.add(this.resizeFrame,this),this.texture.valid=c):b.Tilemap&&a instanceof b.TilemapLayer?this.setTexture(PIXI.Texture.fromCanvas(a.canvas)):a instanceof PIXI.Texture?this.setTexture(a):(h=e.getImage(a,!0),this.key=h.key,this.setTexture(new PIXI.Texture(h.base)),this.texture.baseTexture.skipRender="__default"===a?!0:!1,h=!this.animations.loadFrameData(h.frameData,
c));h&&(this._frame=b.Rectangle.clone(this.texture.frame));d||(this.texture.baseTexture.scaleMode=1)},setFrame:function(a){this._frame=a;this.texture.frame.x=a.x;this.texture.frame.y=a.y;this.texture.frame.width=a.width;this.texture.frame.height=a.height;this.texture.crop.x=a.x;this.texture.crop.y=a.y;this.texture.crop.width=a.width;this.texture.crop.height=a.height;a.trimmed?(this.texture.trim?(this.texture.trim.x=a.spriteSourceSizeX,this.texture.trim.y=a.spriteSourceSizeY,this.texture.trim.width=
a.sourceSizeW,this.texture.trim.height=a.sourceSizeH):this.texture.trim={x:a.spriteSourceSizeX,y:a.spriteSourceSizeY,width:a.sourceSizeW,height:a.sourceSizeH},this.texture.width=a.sourceSizeW,this.texture.height=a.sourceSizeH,this.texture.frame.width=a.sourceSizeW,this.texture.frame.height=a.sourceSizeH):!a.trimmed&&this.texture.trim&&(this.texture.trim=null);this.cropRect&&this.updateCrop();this.texture.requiresReTint=!0;this.texture._updateUvs();this.tilingTexture&&(this.refreshTexture=!0)},resizeFrame:function(a,
c,b){this.texture.frame.resize(c,b);this.texture.setFrame(this.texture.frame)},resetFrame:function(){this._frame&&this.setFrame(this._frame)},frame:{get:function(){return this.animations.frame},set:function(a){this.animations.frame=a}},frameName:{get:function(){return this.animations.frameName},set:function(a){this.animations.frameName=a}}};b.Component.Overlap=function(){};b.Component.Overlap.prototype={overlap:function(a){return b.Rectangle.intersects(this.getBounds(),a.getBounds())}};b.Component.PhysicsBody=
function(){};b.Component.PhysicsBody.preUpdate=function(){if(this.fresh&&this.exists)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.body&&this.body.preUpdate(),this.fresh=!1;this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;return this._exists&&
this.parent.exists?!0:(this.renderOrderID=-1,!1)};b.Component.PhysicsBody.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate()};b.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(a){this.position.x=a;this.body&&!this.body.dirty&&(this.body._reset=!0)}},y:{get:function(){return this.position.y},set:function(a){this.position.y=a;this.body&&!this.body.dirty&&(this.body._reset=!0)}}};b.Component.Reset=function(){};b.Component.Reset.prototype.reset=
function(a,c,b){void 0===b&&(b=1);this.world.set(a,c);this.position.set(a,c);this.renderable=this.visible=this.exists=this.fresh=!0;this.components.InWorld&&(this._outOfBoundsFired=!1);this.components.LifeSpan&&(this.alive=!0,this.health=b);this.components.PhysicsBody&&this.body&&this.body.reset(a,c,!1,!1);return this};b.Component.ScaleMinMax=function(){};b.Component.ScaleMinMax.prototype={transformCallback:null,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(a){this.scaleMin&&
(a.a<this.scaleMin.x&&(a.a=this.scaleMin.x),a.d<this.scaleMin.y&&(a.d=this.scaleMin.y));this.scaleMax&&(a.a>this.scaleMax.x&&(a.a=this.scaleMax.x),a.d>this.scaleMax.y&&(a.d=this.scaleMax.y))},setScaleMinMax:function(a,c,d,e){void 0===c?c=d=e=a:void 0===d&&(d=e=c,c=a);null===a?this.scaleMin=null:this.scaleMin?this.scaleMin.set(a,c):this.scaleMin=new b.Point(a,c);null===d?this.scaleMax=null:this.scaleMax?this.scaleMax.set(d,e):this.scaleMax=new b.Point(d,e);null===this.scaleMin?this.transformCallback=
null:(this.transformCallback=this.checkTransform,this.transformCallbackContext=this)}};b.Component.Smoothed=function(){};b.Component.Smoothed.prototype={smoothed:{get:function(){return!this.texture.baseTexture.scaleMode},set:function(a){a?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}}};b.GameObjectFactory=function(a){this.game=a;this.world=this.game.world};b.GameObjectFactory.prototype={existing:function(a){return this.world.add(a)},weapon:function(a,
c,d,e){var h=this.game.plugins.add(b.Weapon);h.createBullets(a,c,d,e);return h},image:function(a,c,d,e,h){void 0===h&&(h=this.world);return h.add(new b.Image(this.game,a,c,d,e))},sprite:function(a,c,b,e,h){void 0===h&&(h=this.world);return h.create(a,c,b,e)},creature:function(a,c,d,e,h){void 0===h&&(h=this.world);a=new b.Creature(this.game,a,c,d,e);h.add(a);return a},tween:function(a){return this.game.tweens.create(a)},group:function(a,c,d,e,h){return new b.Group(this.game,a,c,d,e,h)},physicsGroup:function(a,
c,d,e){return new b.Group(this.game,c,d,e,!0,a)},spriteBatch:function(a,c,d){void 0===a&&(a=null);void 0===c&&(c="group");void 0===d&&(d=!1);return new b.SpriteBatch(this.game,a,c,d)},audio:function(a,c,b,e){return this.game.sound.add(a,c,b,e)},sound:function(a,c,b,e){return this.game.sound.add(a,c,b,e)},audioSprite:function(a){return this.game.sound.addSprite(a)},tileSprite:function(a,c,d,e,h,l,f){void 0===f&&(f=this.world);return f.add(new b.TileSprite(this.game,a,c,d,e,h,l))},rope:function(a,c,
d,e,h,l){void 0===l&&(l=this.world);return l.add(new b.Rope(this.game,a,c,d,e,h))},text:function(a,c,d,e,h){void 0===h&&(h=this.world);return h.add(new b.Text(this.game,a,c,d,e))},button:function(a,c,d,e,h,l,f,g,k,r){void 0===r&&(r=this.world);return r.add(new b.Button(this.game,a,c,d,e,h,l,f,g,k))},graphics:function(a,c,d){void 0===d&&(d=this.world);return d.add(new b.Graphics(this.game,a,c))},emitter:function(a,c,d){return this.game.particles.add(new b.Particles.Arcade.Emitter(this.game,a,c,d))},
retroFont:function(a,c,d,e,h,l,f,g,k){return new b.RetroFont(this.game,a,c,d,e,h,l,f,g,k)},bitmapText:function(a,c,d,e,h,l){void 0===l&&(l=this.world);return l.add(new b.BitmapText(this.game,a,c,d,e,h))},tilemap:function(a,c,d,e,h){return new b.Tilemap(this.game,a,c,d,e,h)},renderTexture:function(a,c,d,e){if(void 0===d||""===d)d=this.game.rnd.uuid();void 0===e&&(e=!1);a=new b.RenderTexture(this.game,a,c,d);e&&this.game.cache.addRenderTexture(d,a);return a},video:function(a,c){return new b.Video(this.game,
a,c)},bitmapData:function(a,c,d,e){void 0===e&&(e=!1);if(void 0===d||""===d)d=this.game.rnd.uuid();a=new b.BitmapData(this.game,d,a,c);e&&this.game.cache.addBitmapData(d,a);return a},filter:function(a){var c=Array.prototype.slice.call(arguments,1);a=new b.Filter[a](this.game);a.init.apply(a,c);return a},plugin:function(a){return this.game.plugins.add(a)}};b.GameObjectFactory.prototype.constructor=b.GameObjectFactory;b.GameObjectCreator=function(a){this.game=a;this.world=this.game.world};b.GameObjectCreator.prototype=
{image:function(a,c,d,e){return new b.Image(this.game,a,c,d,e)},sprite:function(a,c,d,e){return new b.Sprite(this.game,a,c,d,e)},tween:function(a){return new b.Tween(a,this.game,this.game.tweens)},group:function(a,c,d,e,h){return new b.Group(this.game,a,c,d,e,h)},spriteBatch:function(a,c,d){void 0===c&&(c="group");void 0===d&&(d=!1);return new b.SpriteBatch(this.game,a,c,d)},audio:function(a,c,b,e){return this.game.sound.add(a,c,b,e)},audioSprite:function(a){return this.game.sound.addSprite(a)},sound:function(a,
c,b,e){return this.game.sound.add(a,c,b,e)},tileSprite:function(a,c,d,e,h,l){return new b.TileSprite(this.game,a,c,d,e,h,l)},rope:function(a,c,d,e,h){return new b.Rope(this.game,a,c,d,e,h)},text:function(a,c,d,e){return new b.Text(this.game,a,c,d,e)},button:function(a,c,d,e,h,l,f,g,k){return new b.Button(this.game,a,c,d,e,h,l,f,g,k)},graphics:function(a,c){return new b.Graphics(this.game,a,c)},emitter:function(a,c,d){return new b.Particles.Arcade.Emitter(this.game,a,c,d)},retroFont:function(a,c,d,
e,h,l,f,g,k){return new b.RetroFont(this.game,a,c,d,e,h,l,f,g,k)},bitmapText:function(a,c,d,e,h,l){return new b.BitmapText(this.game,a,c,d,e,h,l)},tilemap:function(a,c,d,e,h){return new b.Tilemap(this.game,a,c,d,e,h)},renderTexture:function(a,c,d,e){if(void 0===d||""===d)d=this.game.rnd.uuid();void 0===e&&(e=!1);a=new b.RenderTexture(this.game,a,c,d);e&&this.game.cache.addRenderTexture(d,a);return a},bitmapData:function(a,c,d,e){void 0===e&&(e=!1);if(void 0===d||""===d)d=this.game.rnd.uuid();a=new b.BitmapData(this.game,
d,a,c);e&&this.game.cache.addBitmapData(d,a);return a},filter:function(a){var c=Array.prototype.slice.call(arguments,1);a=new b.Filter[a](this.game);a.init.apply(a,c);return a}};b.GameObjectCreator.prototype.constructor=b.GameObjectCreator;b.Sprite=function(a,c,d,e,h){c=c||0;d=d||0;e=e||null;h=h||null;this.physicsType=this.type=b.SPRITE;PIXI.Sprite.call(this,b.Cache.DEFAULT);b.Component.Core.init.call(this,a,c,d,e,h)};b.Sprite.prototype=Object.create(PIXI.Sprite.prototype);b.Sprite.prototype.constructor=
b.Sprite;b.Component.Core.install.call(b.Sprite.prototype,"Angle Animation AutoCull Bounds BringToTop Crop Delta Destroy FixedToCamera Health InCamera InputEnabled InWorld LifeSpan LoadTexture Overlap PhysicsBody Reset ScaleMinMax Smoothed".split(" "));b.Sprite.prototype.preUpdatePhysics=b.Component.PhysicsBody.preUpdate;b.Sprite.prototype.preUpdateLifeSpan=b.Component.LifeSpan.preUpdate;b.Sprite.prototype.preUpdateInWorld=b.Component.InWorld.preUpdate;b.Sprite.prototype.preUpdateCore=b.Component.Core.preUpdate;
b.Sprite.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1};b.Image=function(a,c,d,e,h){c=c||0;d=d||0;e=e||null;h=h||null;this.type=b.IMAGE;PIXI.Sprite.call(this,b.Cache.DEFAULT);b.Component.Core.init.call(this,a,c,d,e,h)};b.Image.prototype=Object.create(PIXI.Sprite.prototype);b.Image.prototype.constructor=b.Image;b.Component.Core.install.call(b.Image.prototype,"Angle Animation AutoCull Bounds BringToTop Crop Destroy FixedToCamera InputEnabled LifeSpan LoadTexture Overlap Reset ScaleMinMax Smoothed".split(" "));
b.Image.prototype.preUpdateInWorld=b.Component.InWorld.preUpdate;b.Image.prototype.preUpdateCore=b.Component.Core.preUpdate;b.Image.prototype.preUpdate=function(){return this.preUpdateInWorld()?this.preUpdateCore():!1};b.Button=function(a,c,d,e,h,l,f,g,k,r){h=h||null;l=l||this;b.Image.call(this,a,c||0,d||0,e||null,g);this.type=b.BUTTON;this.physicsType=b.SPRITE;this.onUpSound=this.onDownSound=this.onOutSound=this.onOverSound=this._onUpFrame=this._onDownFrame=this._onOutFrame=this._onOverFrame=null;
this.onUpSoundMarker=this.onDownSoundMarker=this.onOutSoundMarker=this.onOverSoundMarker="";this.onInputOver=new b.Signal;this.onInputOut=new b.Signal;this.onInputDown=new b.Signal;this.onInputUp=new b.Signal;this.onOverMouseOnly=!0;this.justReleasedPreventsOver=b.PointerMode.TOUCH;this.forceOut=this.freezeFrames=!1;this.inputEnabled=!0;this.input.start(0,!0);this.input.useHandCursor=!0;this.setFrames(f,g,k,r);null!==h&&this.onInputUp.add(h,l);this.events.onInputOver.add(this.onInputOverHandler,this);
this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this);this.events.onRemovedFromWorld.add(this.removedFromWorld,this)};b.Button.prototype=Object.create(b.Image.prototype);b.Button.prototype.constructor=b.Button;b.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)};b.Button.prototype.removedFromWorld=function(){this.inputEnabled=!1};b.Button.prototype.setStateFrame=
function(a,c,b){var d="_on"+a+"Frame";null!==c?(this[d]=c,b&&this.changeStateFrame(a)):this[d]=null};b.Button.prototype.changeStateFrame=function(a){if(this.freezeFrames)return!1;a=this["_on"+a+"Frame"];return"string"===typeof a?(this.frameName=a,!0):"number"===typeof a?(this.frame=a,!0):!1};b.Button.prototype.setFrames=function(a,c,b,e){this.setStateFrame("Over",a,this.input.pointerOver());this.setStateFrame("Out",c,!this.input.pointerOver());this.setStateFrame("Down",b,this.input.pointerDown());
this.setStateFrame("Up",e,this.input.pointerUp())};b.Button.prototype.setStateSound=function(a,c,d){var e="on"+a+"Sound";a="on"+a+"SoundMarker";c instanceof b.Sound||c instanceof b.AudioSprite?(this[e]=c,this[a]="string"===typeof d?d:""):(this[e]=null,this[a]="")};b.Button.prototype.playStateSound=function(a){var c=this["on"+a+"Sound"];return c?(c.play(this["on"+a+"SoundMarker"]),!0):!1};b.Button.prototype.setSounds=function(a,c,b,e,h,l,f,g){this.setStateSound("Over",a,c);this.setStateSound("Out",
h,l);this.setStateSound("Down",b,e);this.setStateSound("Up",f,g)};b.Button.prototype.setOverSound=function(a,c){this.setStateSound("Over",a,c)};b.Button.prototype.setOutSound=function(a,c){this.setStateSound("Out",a,c)};b.Button.prototype.setDownSound=function(a,c){this.setStateSound("Down",a,c)};b.Button.prototype.setUpSound=function(a,c){this.setStateSound("Up",a,c)};b.Button.prototype.onInputOverHandler=function(a,c){if(!c.justReleased()||(this.justReleasedPreventsOver&c.pointerMode)!==c.pointerMode)if(this.changeStateFrame("Over"),
!this.onOverMouseOnly||c.isMouse)this.playStateSound("Over"),this.onInputOver&&this.onInputOver.dispatch(this,c)};b.Button.prototype.onInputOutHandler=function(a,c){this.changeStateFrame("Out");this.playStateSound("Out");this.onInputOut&&this.onInputOut.dispatch(this,c)};b.Button.prototype.onInputDownHandler=function(a,c){this.changeStateFrame("Down");this.playStateSound("Down");this.onInputDown&&this.onInputDown.dispatch(this,c)};b.Button.prototype.onInputUpHandler=function(a,c,b){this.playStateSound("Up");
this.onInputUp&&this.onInputUp.dispatch(this,c,b);this.freezeFrames||(!0===this.forceOut||(this.forceOut&c.pointerMode)===c.pointerMode?this.changeStateFrame("Out"):this.changeStateFrame("Up")||(b?this.changeStateFrame("Over"):this.changeStateFrame("Out")))};b.SpriteBatch=function(a,c,d,e){if(void 0===c||null===c)c=a.world;PIXI.SpriteBatch.call(this);b.Group.call(this,a,c,d,e);this.type=b.SPRITEBATCH};b.SpriteBatch.prototype=b.Utils.extend(!0,b.SpriteBatch.prototype,PIXI.SpriteBatch.prototype,b.Group.prototype);
b.SpriteBatch.prototype.constructor=b.SpriteBatch;b.BitmapData=function(a,c,d,e,h){if(void 0===d||0===d)d=256;if(void 0===e||0===e)e=256;void 0===h&&(h=!1);this.game=a;this.key=c;this.width=d;this.height=e;this.canvas=b.Canvas.create(this,d,e,null,h);this.ctx=this.context=this.canvas.getContext("2d",{alpha:!0});this.smoothProperty=a.renderType===b.CANVAS?a.renderer.renderSession.smoothProperty:b.Canvas.getSmoothingPrefix(this.context);this.imageData=this.context.getImageData(0,0,d,e);this.data=null;
this.imageData&&(this.data=this.imageData.data);this.pixels=null;this.data&&(this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data);this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.frameData=new b.FrameData;this.textureFrame=this.frameData.addFrame(new b.Frame(0,
0,0,d,e,"bitmapData"));this.texture.frame=this.textureFrame;this.type=b.BITMAPDATA;this.dirty=this.disableTextureUpload=!1;this.cls=this.clear;this._image=null;this._pos=new b.Point;this._size=new b.Point;this._scale=new b.Point;this._rotate=0;this._alpha={prev:1,current:1};this._anchor=new b.Point;this._tempB=this._tempG=this._tempR=0;this._circle=new b.Circle;this._swapCanvas=void 0};b.BitmapData.prototype={move:function(a,c,b){0!==a&&this.moveH(a,b);0!==c&&this.moveV(c,b);return this},moveH:function(a,
c){void 0===c&&(c=!0);void 0===this._swapCanvas&&(this._swapCanvas=PIXI.CanvasPool.create(this,this.width,this.height));var b=this._swapCanvas.getContext("2d"),e=this.height,h=this.canvas;b.clearRect(0,0,this.width,this.height);if(0>a){a=Math.abs(a);var l=this.width-a;c&&b.drawImage(h,0,0,a,e,l,0,a,e);b.drawImage(h,a,0,l,e,0,0,l,e)}else l=this.width-a,c&&b.drawImage(h,l,0,a,e,0,0,a,e),b.drawImage(h,0,0,l,e,a,0,l,e);this.clear();return this.copy(this._swapCanvas)},moveV:function(a,c){void 0===c&&(c=
!0);void 0===this._swapCanvas&&(this._swapCanvas=PIXI.CanvasPool.create(this,this.width,this.height));var b=this._swapCanvas.getContext("2d"),e=this.width,h=this.canvas;b.clearRect(0,0,this.width,this.height);if(0>a){a=Math.abs(a);var l=this.height-a;c&&b.drawImage(h,0,0,e,a,0,l,e,a);b.drawImage(h,0,a,e,l,0,0,e,l)}else l=this.height-a,c&&b.drawImage(h,0,l,e,a,0,0,e,a),b.drawImage(h,0,0,e,l,0,a,e,l);this.clear();return this.copy(this._swapCanvas)},add:function(a){if(Array.isArray(a))for(var c=0;c<
a.length;c++)a[c].loadTexture&&a[c].loadTexture(this);else a.loadTexture(this);return this},load:function(a){"string"===typeof a&&(a=this.game.cache.getImage(a));if(a)return this.resize(a.width,a.height),this.cls(),this.draw(a),this.update(),this},clear:function(a,c,b,e){void 0===a&&(a=0);void 0===c&&(c=0);void 0===b&&(b=this.width);void 0===e&&(e=this.height);this.context.clearRect(a,c,b,e);this.dirty=!0;return this},fill:function(a,c,b,e){void 0===e&&(e=1);this.context.fillStyle="rgba("+a+","+c+
","+b+","+e+")";this.context.fillRect(0,0,this.width,this.height);this.dirty=!0;return this},generateTexture:function(a){var c=new Image;c.src=this.canvas.toDataURL("image/png");a=this.game.cache.addImage(a,"",c);return new PIXI.Texture(a.base)},resize:function(a,c){if(a!==this.width||c!==this.height)this.width=a,this.height=c,this.canvas.width=a,this.canvas.height=c,void 0!==this._swapCanvas&&(this._swapCanvas.width=a,this._swapCanvas.height=c),this.baseTexture.width=a,this.baseTexture.height=c,
this.textureFrame.width=a,this.textureFrame.height=c,this.texture.width=a,this.texture.height=c,this.texture.crop.width=a,this.texture.crop.height=c,this.update(),this.dirty=!0;return this},update:function(a,c,b,e){void 0===a&&(a=0);void 0===c&&(c=0);void 0===b&&(b=Math.max(1,this.width));void 0===e&&(e=Math.max(1,this.height));this.imageData=this.context.getImageData(a,c,b,e);this.data=this.imageData.data;this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):
window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data;return this},processPixelRGB:function(a,c,d,e,h,l){void 0===d&&(d=0);void 0===e&&(e=0);void 0===h&&(h=this.width);void 0===l&&(l=this.height);h=d+h;l=e+l;for(var f=b.Color.createColor(),g=!1,k=e;k<l;k++)for(var r=d;r<h;r++)b.Color.unpackPixel(this.getPixel32(r,k),f),e=a.call(c,f,r,k),!1!==e&&null!==e&&void 0!==e&&(this.setPixel32(r,k,e.r,e.g,e.b,e.a,
!1),g=!0);g&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0);return this},processPixel:function(a,c,b,e,h,l){void 0===b&&(b=0);void 0===e&&(e=0);void 0===h&&(h=this.width);void 0===l&&(l=this.height);h=b+h;l=e+l;for(var d,f=!1,g=e;g<l;g++)for(var k=b;k<h;k++)e=this.getPixel32(k,g),d=a.call(c,e,k,g),d!==e&&(this.pixels[g*this.width+k]=d,f=!0);f&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0);return this},replaceRGB:function(a,c,d,e,h,l,f,g,k){var q=0,t=0,m=this.width,n=
this.height;a=b.Color.packPixel(a,c,d,e);void 0!==k&&k instanceof b.Rectangle&&(q=k.x,t=k.y,m=k.width,n=k.height);for(k=0;k<n;k++)for(c=0;c<m;c++)this.getPixel32(q+c,t+k)===a&&this.setPixel32(q+c,t+k,h,l,f,g,!1);this.context.putImageData(this.imageData,0,0);this.dirty=!0;return this},setHSL:function(a,c,d,e){var h=a||0===a,l=c||0===c,f=d||0===d;if(h||l||f){void 0===e&&(e=new b.Rectangle(0,0,this.width,this.height));for(var g=b.Color.createColor(),k=e.y;k<e.bottom;k++)for(var m=e.x;m<e.right;m++)b.Color.unpackPixel(this.getPixel32(m,
k),g,!0),h&&(g.h=a),l&&(g.s=c),f&&(g.l=d),b.Color.HSLtoRGB(g.h,g.s,g.l,g),this.setPixel32(m,k,g.r,g.g,g.b,g.a,!1);this.context.putImageData(this.imageData,0,0);this.dirty=!0;return this}},shiftHSL:function(a,c,d,e){if(void 0===a||null===a)a=!1;if(void 0===c||null===c)c=!1;if(void 0===d||null===d)d=!1;if(a||c||d){void 0===e&&(e=new b.Rectangle(0,0,this.width,this.height));for(var h=b.Color.createColor(),l=e.y;l<e.bottom;l++)for(var f=e.x;f<e.right;f++)b.Color.unpackPixel(this.getPixel32(f,l),h,!0),
a&&(h.h=this.game.math.wrap(h.h+a,0,1)),c&&(h.s=this.game.math.clamp(h.s+c,0,1)),d&&(h.l=this.game.math.clamp(h.l+d,0,1)),b.Color.HSLtoRGB(h.h,h.s,h.l,h),this.setPixel32(f,l,h.r,h.g,h.b,h.a,!1);this.context.putImageData(this.imageData,0,0);this.dirty=!0;return this}},setPixel32:function(a,c,d,e,h,l,f){void 0===f&&(f=!0);0<=a&&a<=this.width&&0<=c&&c<=this.height&&(this.pixels[c*this.width+a]=b.Device.LITTLE_ENDIAN?l<<24|h<<16|e<<8|d:d<<24|e<<16|h<<8|l,f&&(this.context.putImageData(this.imageData,0,
0),this.dirty=!0));return this},setPixel:function(a,c,b,e,h,l){return this.setPixel32(a,c,b,e,h,255,l)},getPixel:function(a,c,d){d||(d=b.Color.createColor());a=~~(a+c*this.width);a*=4;d.r=this.data[a];d.g=this.data[++a];d.b=this.data[++a];d.a=this.data[++a];return d},getPixel32:function(a,c){if(0<=a&&a<=this.width&&0<=c&&c<=this.height)return this.pixels[c*this.width+a]},getPixelRGB:function(a,c,d,e,h){return b.Color.unpackPixel(this.getPixel32(a,c),d,e,h)},getPixels:function(a){return this.context.getImageData(a.x,
a.y,a.width,a.height)},getFirstPixel:function(a){void 0===a&&(a=0);var c=b.Color.createColor(),d=0,e=0,h=1,l=!1;1===a?(h=-1,e=this.height):3===a&&(h=-1,d=this.width);do if(b.Color.unpackPixel(this.getPixel32(d,e),c),0===a||1===a){if(d++,d===this.width&&(d=0,e+=h,e>=this.height||0>=e))l=!0}else if(2===a||3===a)if(e++,e===this.height&&(e=0,d+=h,d>=this.width||0>=d))l=!0;while(0===c.a&&!l);c.x=d;c.y=e;return c},getBounds:function(a){void 0===a&&(a=new b.Rectangle);a.x=this.getFirstPixel(2).x;if(a.x===
this.width)return a.setTo(0,0,0,0);a.y=this.getFirstPixel(0).y;a.width=this.getFirstPixel(3).x-a.x+1;a.height=this.getFirstPixel(1).y-a.y+1;return a},addToWorld:function(a,c,b,e,h,l){h=h||1;l=l||1;a=this.game.add.image(a,c,this);a.anchor.set(b,e);a.scale.set(h,l);return a},copy:function(a,c,d,e,h,l,f,g,k,m,n,p,u,x,z,D,A){if(void 0===a||null===a)a=this;if(a instanceof b.RenderTexture||a instanceof PIXI.RenderTexture)a=a.getCanvas();this._image=a;if(a instanceof b.Sprite||a instanceof b.Image||a instanceof
b.Text||a instanceof PIXI.Sprite){this._pos.set(a.texture.crop.x,a.texture.crop.y);this._size.set(a.texture.crop.width,a.texture.crop.height);this._scale.set(a.scale.x,a.scale.y);this._anchor.set(a.anchor.x,a.anchor.y);this._rotate=a.rotation;this._alpha.current=a.alpha;this._image=a.texture instanceof b.RenderTexture||a.texture instanceof PIXI.RenderTexture?a.texture.getCanvas():a.texture.baseTexture.source;if(void 0===l||null===l)l=a.x;if(void 0===f||null===f)f=a.y;a.texture.trim&&(l+=a.texture.trim.x-
a.anchor.x*a.texture.trim.width,f+=a.texture.trim.y-a.anchor.y*a.texture.trim.height);16777215!==a.tint&&(a.cachedTint!==a.tint&&(a.cachedTint=a.tint,a.tintedTexture=PIXI.CanvasTinter.getTintedTexture(a,a.tint)),this._image=a.tintedTexture,this._pos.set(0))}else{this._pos.set(0);this._scale.set(1);this._anchor.set(0);this._rotate=0;this._alpha.current=1;if(a instanceof b.BitmapData)this._image=a.canvas;else if("string"===typeof a){a=this.game.cache.getImage(a);if(null===a)return;this._image=a}this._size.set(this._image.width,
this._image.height)}if(void 0===c||null===c)c=0;if(void 0===d||null===d)d=0;e&&(this._size.x=e);h&&(this._size.y=h);if(void 0===l||null===l)l=c;if(void 0===f||null===f)f=d;if(void 0===g||null===g)g=this._size.x;if(void 0===k||null===k)k=this._size.y;"number"===typeof m&&(this._rotate=m);"number"===typeof n&&(this._anchor.x=n);"number"===typeof p&&(this._anchor.y=p);"number"===typeof u&&(this._scale.x=u);"number"===typeof x&&(this._scale.y=x);"number"===typeof z&&(this._alpha.current=z);void 0===D&&
(D=null);void 0===A&&(A=!1);if(!(0>=this._alpha.current||0===this._scale.x||0===this._scale.y||0===this._size.x||0===this._size.y))return a=this.context,this._alpha.prev=a.globalAlpha,a.save(),a.globalAlpha=this._alpha.current,D&&(this.op=D),A&&(l|=0,f|=0),a.translate(l,f),a.scale(this._scale.x,this._scale.y),a.rotate(this._rotate),a.drawImage(this._image,this._pos.x+c,this._pos.y+d,this._size.x,this._size.y,-g*this._anchor.x,-k*this._anchor.y,g,k),a.restore(),a.globalAlpha=this._alpha.prev,this.dirty=
!0,this},copyTransform:function(a,c,d){void 0===c&&(c=null);void 0===d&&(d=!1);if(!a.hasOwnProperty("worldTransform")||!a.worldVisible||0===a.worldAlpha)return this;var e=a.worldTransform;this._pos.set(a.texture.crop.x,a.texture.crop.y);this._size.set(a.texture.crop.width,a.texture.crop.height);if(0===e.a||0===e.d||0===this._size.x||0===this._size.y)return this;this._image=a.texture instanceof b.RenderTexture||a.texture instanceof PIXI.RenderTexture?a.texture.getCanvas():a.texture.baseTexture.source;
var h=e.tx,l=e.ty;a.texture.trim&&(h+=a.texture.trim.x-a.anchor.x*a.texture.trim.width,l+=a.texture.trim.y-a.anchor.y*a.texture.trim.height);16777215!==a.tint&&(a.cachedTint!==a.tint&&(a.cachedTint=a.tint,a.tintedTexture=PIXI.CanvasTinter.getTintedTexture(a,a.tint)),this._image=a.tintedTexture,this._pos.set(0));d&&(h|=0,l|=0);d=this.context;this._alpha.prev=d.globalAlpha;d.save();d.globalAlpha=this._alpha.current;c&&(this.op=c);d[this.smoothProperty]=a.texture.baseTexture.scaleMode===PIXI.scaleModes.LINEAR;
d.setTransform(e.a,e.b,e.c,e.d,h,l);d.drawImage(this._image,this._pos.x,this._pos.y,this._size.x,this._size.y,-this._size.x*a.anchor.x,-this._size.y*a.anchor.y,this._size.x,this._size.y);d.restore();d.globalAlpha=this._alpha.prev;this.dirty=!0;return this},copyRect:function(a,c,b,e,h,l,f){return this.copy(a,c.x,c.y,c.width,c.height,b,e,c.width,c.height,0,0,0,1,1,h,l,f)},draw:function(a,c,b,e,h,l,f){return this.copy(a,null,null,null,null,c,b,e,h,null,null,null,null,null,null,l,f)},drawGroup:function(a,
c,b){0<a.total&&a.forEachExists(this.drawGroupProxy,this,c,b);return this},drawGroupProxy:function(a,c,d){a.hasOwnProperty("texture")&&this.copyTransform(a,c,d);if(a.type===b.GROUP&&a.exists)this.drawGroup(a,c,d);else if(a.hasOwnProperty("children")&&0<a.children.length)for(var e=0;e<a.children.length;e++)a.children[e].exists&&this.copyTransform(a.children[e],c,d)},drawFull:function(a,c,d){if(!1===a.worldVisible||0===a.worldAlpha||a.hasOwnProperty("exists")&&!1===a.exists)return this;if(a.type!==
b.GROUP&&a.type!==b.EMITTER&&a.type!==b.BITMAPTEXT)if(a.type===b.GRAPHICS){var e=a.getBounds();this.ctx.save();this.ctx.translate(e.x,e.y);PIXI.CanvasGraphics.renderGraphics(a,this.ctx);this.ctx.restore()}else this.copy(a,null,null,null,null,a.worldPosition.x,a.worldPosition.y,null,null,a.worldRotation,null,null,a.worldScale.x,a.worldScale.y,a.worldAlpha,c,d);if(a.children)for(e=0;e<a.children.length;e++)this.drawFull(a.children[e],c,d);return this},shadow:function(a,c,b,e){var d=this.context;void 0===
a||null===a?d.shadowColor="rgba(0,0,0,0)":(d.shadowColor=a,d.shadowBlur=c||5,d.shadowOffsetX=b||10,d.shadowOffsetY=e||10);return this},alphaMask:function(a,c,b,e){void 0===e||null===e?this.draw(c).blendSourceAtop():this.draw(c,e.x,e.y,e.width,e.height).blendSourceAtop();void 0===b||null===b?this.draw(a).blendReset():this.draw(a,b.x,b.y,b.width,b.height).blendReset();return this},extract:function(a,c,b,e,h,l,f,g,k){void 0===h&&(h=255);void 0===l&&(l=!1);void 0===f&&(f=c);void 0===g&&(g=b);void 0===
k&&(k=e);l&&a.resize(this.width,this.height);this.processPixelRGB(function(d,l,q){d.r===c&&d.g===b&&d.b===e&&a.setPixel32(l,q,f,g,k,h,!1);return!1},this);a.context.putImageData(a.imageData,0,0);a.dirty=!0;return a},rect:function(a,c,b,e,h){"undefined"!==typeof h&&(this.context.fillStyle=h);this.context.fillRect(a,c,b,e);return this},text:function(a,c,b,e,h,l){void 0===c&&(c=0);void 0===b&&(b=0);void 0===e&&(e="14px Courier");void 0===h&&(h="rgb(255,255,255)");void 0===l&&(l=!0);var d=this.context,
f=d.font;d.font=e;l&&(d.fillStyle="rgb(0,0,0)",d.fillText(a,c+1,b+1));d.fillStyle=h;d.fillText(a,c,b);d.font=f;return this},circle:function(a,c,b,e){var d=this.context;void 0!==e&&(d.fillStyle=e);d.beginPath();d.arc(a,c,b,0,2*Math.PI,!1);d.closePath();d.fill();return this},line:function(a,c,b,e,h,l){void 0===h&&(h="#fff");void 0===l&&(l=1);var d=this.context;d.beginPath();d.moveTo(a,c);d.lineTo(b,e);d.lineWidth=l;d.strokeStyle=h;d.stroke();d.closePath();return this},textureLine:function(a,c,d){void 0===
d&&(d="repeat-x");if("string"===typeof c&&(c=this.game.cache.getImage(c),!c))return;var e=a.length;"no-repeat"===d&&e>c.width&&(e=c.width);var h=this.context;h.fillStyle=h.createPattern(c,d);this._circle=new b.Circle(a.start.x,a.start.y,c.height);this._circle.circumferencePoint(a.angle-1.5707963267948966,!1,this._pos);h.save();h.translate(this._pos.x,this._pos.y);h.rotate(a.angle);h.fillRect(0,0,e,c.height);h.restore();this.dirty=!0;return this},render:function(){!this.disableTextureUpload&&this.dirty&&
(this.baseTexture.dirty(),this.dirty=!1);return this},destroy:function(){this.frameData.destroy();this.texture.destroy(!0);PIXI.CanvasPool.remove(this)},blendReset:function(){this.op="source-over";return this},blendSourceOver:function(){this.op="source-over";return this},blendSourceIn:function(){this.op="source-in";return this},blendSourceOut:function(){this.op="source-out";return this},blendSourceAtop:function(){this.op="source-atop";return this},blendDestinationOver:function(){this.op="destination-over";
return this},blendDestinationIn:function(){this.op="destination-in";return this},blendDestinationOut:function(){this.op="destination-out";return this},blendDestinationAtop:function(){this.op="destination-atop";return this},blendXor:function(){this.op="xor";return this},blendAdd:function(){this.op="lighter";return this},blendMultiply:function(){this.op="multiply";return this},blendScreen:function(){this.op="screen";return this},blendOverlay:function(){this.op="overlay";return this},blendDarken:function(){this.op=
"darken";return this},blendLighten:function(){this.op="lighten";return this},blendColorDodge:function(){this.op="color-dodge";return this},blendColorBurn:function(){this.op="color-burn";return this},blendHardLight:function(){this.op="hard-light";return this},blendSoftLight:function(){this.op="soft-light";return this},blendDifference:function(){this.op="difference";return this},blendExclusion:function(){this.op="exclusion";return this},blendHue:function(){this.op="hue";return this},blendSaturation:function(){this.op=
"saturation";return this},blendColor:function(){this.op="color";return this},blendLuminosity:function(){this.op="luminosity";return this}};Object.defineProperty(b.BitmapData.prototype,"smoothed",{get:function(){b.Canvas.getSmoothingEnabled(this.context)},set:function(a){b.Canvas.setSmoothingEnabled(this.context,a)}});Object.defineProperty(b.BitmapData.prototype,"op",{get:function(){return this.context.globalCompositeOperation},set:function(a){this.context.globalCompositeOperation=a}});b.BitmapData.getTransform=
function(a,c,b,e,h,l){"number"!==typeof a&&(a=0);"number"!==typeof c&&(c=0);"number"!==typeof b&&(b=1);"number"!==typeof e&&(e=1);"number"!==typeof h&&(h=0);"number"!==typeof l&&(l=0);return{sx:b,sy:e,scaleX:b,scaleY:e,skewX:h,skewY:l,translateX:a,translateY:c,tx:a,ty:c}};b.BitmapData.prototype.constructor=b.BitmapData;PIXI.Graphics=function(){PIXI.DisplayObjectContainer.call(this);this.renderable=!0;this.fillAlpha=1;this.lineColor=this.lineWidth=0;this.graphicsData=[];this.tint=16777215;this.blendMode=
PIXI.blendModes.NORMAL;this.currentPath=null;this._webGL=[];this.isMask=!1;this.boundsPadding=0;this._localBounds=new PIXI.Rectangle(0,0,1,1);this.dirty=!0;this.cachedSpriteDirty=this.webGLDirty=this._boundsDirty=!1};PIXI.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);PIXI.Graphics.prototype.constructor=PIXI.Graphics;PIXI.Graphics.prototype.lineStyle=function(a,c,b){this.lineWidth=a||0;this.lineColor=c||0;this.lineAlpha=void 0===b?1:b;this.currentPath&&(this.currentPath.shape.points.length?
this.drawShape(new PIXI.Polygon(this.currentPath.shape.points.slice(-2))):(this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha));return this};PIXI.Graphics.prototype.moveTo=function(a,c){this.drawShape(new PIXI.Polygon([a,c]));return this};PIXI.Graphics.prototype.lineTo=function(a,c){this.currentPath||this.moveTo(0,0);this.currentPath.shape.points.push(a,c);this._boundsDirty=this.dirty=!0;return this};PIXI.Graphics.prototype.quadraticCurveTo=
function(a,c,b,e){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var d,l,f=this.currentPath.shape.points;0===f.length&&this.moveTo(0,0);for(var g=f[f.length-2],k=f[f.length-1],m,n=1;20>=n;++n)m=n/20,d=g+(a-g)*m,l=k+(c-k)*m,f.push(d+(a+(b-a)*m-d)*m,l+(c+(e-c)*m-l)*m);this._boundsDirty=this.dirty=!0;return this};PIXI.Graphics.prototype.bezierCurveTo=function(a,c,b,e,h,l){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=
[0,0]):this.moveTo(0,0);for(var d,f,g,k,m,n=this.currentPath.shape.points,p=n[n.length-2],x=n[n.length-1],z,D=1;20>=D;++D)z=D/20,d=1-z,f=d*d,g=f*d,k=z*z,m=k*z,n.push(g*p+3*f*z*a+3*d*k*b+m*h,g*x+3*f*z*c+3*d*k*e+m*l);this._boundsDirty=this.dirty=!0;return this};PIXI.Graphics.prototype.arcTo=function(a,c,b,e,h){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(a,c):this.moveTo(a,c);var d=this.currentPath.shape.points,f=d[d.length-1]-c,g=d[d.length-2]-a;e-=
c;b-=a;var k=Math.abs(f*b-g*e);if(1E-8>k||0===h)d[d.length-2]===a&&d[d.length-1]===c||d.push(a,c);else{var m=f*f+g*g,n=e*e+b*b,p=f*e+g*b,d=h*Math.sqrt(m)/k,k=h*Math.sqrt(n)/k,m=d*p/m,n=k*p/n,p=d*b+k*g,u=d*e+k*f;this.arc(p+a,u+c,h,Math.atan2(f*(k+m)-u,g*(k+m)-p),Math.atan2(e*(d+n)-u,b*(d+n)-p),g*e>b*f)}this._boundsDirty=this.dirty=!0;return this};PIXI.Graphics.prototype.arc=function(a,c,b,e,h,l,f){if(e===h)return this;void 0===l&&(l=!1);void 0===f&&(f=40);!l&&h<=e?h+=2*Math.PI:l&&e<=h&&(e+=2*Math.PI);
h=l?-1*(e-h):h-e;var d=Math.ceil(Math.abs(h)/(2*Math.PI))*f;if(0===h)return this;f=a+Math.cos(e)*b;var g=c+Math.sin(e)*b;l&&this.filling?this.moveTo(a,c):this.moveTo(f,g);l=this.currentPath.shape.points;h/=2*d;f=2*h;for(var g=Math.cos(h),q=Math.sin(h),d=d-1,k=d%1/d,m=0;m<=d;m++){var n=h+e+f*(m+k*m),p=Math.cos(n),n=-Math.sin(n);l.push((g*p+q*n)*b+a,(g*-n+q*p)*b+c)}this._boundsDirty=this.dirty=!0;return this};PIXI.Graphics.prototype.beginFill=function(a,c){this.filling=!0;this.fillColor=a||0;this.fillAlpha=
void 0===c?1:c;this.currentPath&&2>=this.currentPath.shape.points.length&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha);return this};PIXI.Graphics.prototype.endFill=function(){this.filling=!1;this.fillColor=null;this.fillAlpha=1;return this};PIXI.Graphics.prototype.drawRect=function(a,c,b,e){this.drawShape(new PIXI.Rectangle(a,c,b,e));return this};PIXI.Graphics.prototype.drawRoundedRect=function(a,c,b,e,h){this.drawShape(new PIXI.RoundedRectangle(a,
c,b,e,h));return this};PIXI.Graphics.prototype.drawCircle=function(a,c,b){this.drawShape(new PIXI.Circle(a,c,b));return this};PIXI.Graphics.prototype.drawEllipse=function(a,c,b,e){this.drawShape(new PIXI.Ellipse(a,c,b,e));return this};PIXI.Graphics.prototype.drawPolygon=function(a){if(a instanceof b.Polygon||a instanceof PIXI.Polygon)a=a.points;var c=a;if(!Array.isArray(c))for(var c=Array(arguments.length),d=0;d<c.length;++d)c[d]=arguments[d];this.drawShape(new b.Polygon(c));return this};PIXI.Graphics.prototype.clear=
function(){this.lineWidth=0;this.filling=!1;this.clearDirty=this._boundsDirty=this.dirty=!0;this.graphicsData=[];this.updateLocalBounds();return this};PIXI.Graphics.prototype.generateTexture=function(a,c,b){void 0===a&&(a=1);void 0===c&&(c=PIXI.scaleModes.DEFAULT);void 0===b&&(b=0);var d=this.getBounds();d.width+=b;d.height+=b;b=new PIXI.CanvasBuffer(d.width*a,d.height*a);c=PIXI.Texture.fromCanvas(b.canvas,c);c.baseTexture.resolution=a;b.context.scale(a,a);b.context.translate(-d.x,-d.y);PIXI.CanvasGraphics.renderGraphics(this,
b.context);return c};PIXI.Graphics.prototype._renderWebGL=function(a){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask)if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty)this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.dirty=this.cachedSpriteDirty=!1;this._cachedSprite.worldAlpha=this.worldAlpha;PIXI.Sprite.prototype._renderWebGL.call(this._cachedSprite,a)}else{a.spriteBatch.stop();a.blendModeManager.setBlendMode(this.blendMode);this._mask&&a.maskManager.pushMask(this._mask,
a);this._filters&&a.filterManager.pushFilter(this._filterBlock);if(this.blendMode!==a.spriteBatch.currentBlendMode){a.spriteBatch.currentBlendMode=this.blendMode;var c=PIXI.blendModesWebGL[a.spriteBatch.currentBlendMode];a.spriteBatch.gl.blendFunc(c[0],c[1])}this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1);PIXI.WebGLGraphics.renderGraphics(this,a);if(this.children.length){a.spriteBatch.start();for(c=0;c<this.children.length;c++)this.children[c]._renderWebGL(a);a.spriteBatch.stop()}this._filters&&
a.filterManager.popFilter();this._mask&&a.maskManager.popMask(this.mask,a);a.drawCount++;a.spriteBatch.start()}};PIXI.Graphics.prototype._renderCanvas=function(a){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask)if(this._prevTint!==this.tint&&(this.dirty=!0,this._prevTint=this.tint),this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty)this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.dirty=this.cachedSpriteDirty=!1;this._cachedSprite.alpha=this.alpha;PIXI.Sprite.prototype._renderCanvas.call(this._cachedSprite,
a)}else{var c=a.context,b=this.worldTransform;this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,c.globalCompositeOperation=PIXI.blendModesCanvas[a.currentBlendMode]);this._mask&&a.maskManager.pushMask(this._mask,a);var e=a.resolution;c.setTransform(b.a*e,b.b*e,b.c*e,b.d*e,b.tx*a.resolution+a.shakeX,b.ty*a.resolution+a.shakeY);PIXI.CanvasGraphics.renderGraphics(this,c);for(c=0;c<this.children.length;c++)this.children[c]._renderCanvas(a);this._mask&&a.maskManager.popMask(a)}};
PIXI.Graphics.prototype.getBounds=function(a){if(!this._currentBounds){if(!this.renderable)return PIXI.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.cachedSpriteDirty=this.webGLDirty=!0,this.dirty=!1);var c=this._localBounds,b=c.x,e=c.width+c.x,h=c.y,l=c.height+c.y;a=a||this.worldTransform;var f=a.a,g=a.b,k=a.c,m=a.d,n=a.tx,p=a.ty,u=f*e+k*l+n,c=m*l+g*e+p;a=f*b+k*l+n;var l=m*l+g*b+p,x=f*b+k*h+n,b=m*h+g*b+p,f=f*e+k*h+n,e=m*h+g*e+p,h=u,g=c,u=a<u?a:u,u=x<u?x:u,u=f<u?f:u,c=l<c?l:c,c=b<c?b:
c,c=e<c?e:c,h=a>h?a:h,h=x>h?x:h,g=l>g?l:g,g=b>g?b:g;this._bounds.x=u;this._bounds.width=(f>h?f:h)-u;this._bounds.y=c;this._bounds.height=(e>g?e:g)-c;this._currentBounds=this._bounds}return this._currentBounds};PIXI.Graphics.prototype.getLocalBounds=function(){var a=this.worldTransform;this.worldTransform=PIXI.identityMatrix;for(var c=0;c<this.children.length;c++)this.children[c].updateTransform();var b=this.getBounds();this.worldTransform=a;for(c=0;c<this.children.length;c++)this.children[c].updateTransform();
return b};PIXI.Graphics.prototype.containsPoint=function(a){this.worldTransform.applyInverse(a,tempPoint);a=this.graphicsData;for(var c=0;c<a.length;c++){var b=a[c];if(b.fill&&b.shape&&b.shape.contains(tempPoint.x,tempPoint.y))return!0}return!1};PIXI.Graphics.prototype.updateLocalBounds=function(){var a=Infinity,c=-Infinity,d=Infinity,e=-Infinity;if(this.graphicsData.length)for(var h,l,f,g,k,m=0;m<this.graphicsData.length;m++)if(f=this.graphicsData[m],l=f.type,k=f.lineWidth,h=f.shape,l===PIXI.Graphics.RECT||
l===PIXI.Graphics.RREC)l=h.x-k/2,f=h.y-k/2,g=h.width+k,k=h.height+k,a=l<a?l:a,c=l+g>c?l+g:c,d=f<d?f:d,e=f+k>e?f+k:e;else if(l===PIXI.Graphics.CIRC)l=h.x,f=h.y,g=h.radius+k/2,k=h.radius+k/2,a=l-g<a?l-g:a,c=l+g>c?l+g:c,d=f-k<d?f-k:d,e=f+k>e?f+k:e;else if(l===PIXI.Graphics.ELIP)l=h.x,f=h.y,g=h.width+k/2,k=h.height+k/2,a=l-g<a?l-g:a,c=l+g>c?l+g:c,d=f-k<d?f-k:d,e=f+k>e?f+k:e;else for(h=h.points,g=0;g<h.length;g++)h[g]instanceof b.Point?(l=h[g].x,f=h[g].y):(l=h[g],f=h[g+1],g<h.length-1&&g++),a=l-k<a?l-
k:a,c=l+k>c?l+k:c,d=f-k<d?f-k:d,e=f+k>e?f+k:e;else e=d=c=a=0;m=this.boundsPadding;this._localBounds.x=a-m;this._localBounds.width=c-a+2*m;this._localBounds.y=d-m;this._localBounds.height=e-d+2*m};PIXI.Graphics.prototype._generateCachedSprite=function(){var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(a.width,a.height);else{var c=new PIXI.CanvasBuffer(a.width,a.height),b=PIXI.Texture.fromCanvas(c.canvas);this._cachedSprite=new PIXI.Sprite(b);this._cachedSprite.buffer=
c;this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-(a.x/a.width);this._cachedSprite.anchor.y=-(a.y/a.height);this._cachedSprite.buffer.context.translate(-a.x,-a.y);this.worldAlpha=1;PIXI.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha};PIXI.Graphics.prototype.updateCachedSpriteTexture=function(){var a=this._cachedSprite,c=a.texture,b=a.buffer.canvas;c.baseTexture.width=b.width;c.baseTexture.height=b.height;
c.crop.width=c.frame.width=b.width;c.crop.height=c.frame.height=b.height;a._width=b.width;a._height=b.height;c.baseTexture.dirty()};PIXI.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0);this._cachedSprite=null};PIXI.Graphics.prototype.drawShape=function(a){this.currentPath&&2>=this.currentPath.shape.points.length&&this.graphicsData.pop();this.currentPath=null;a instanceof b.Polygon&&(a=a.clone(),a.flatten());a=new PIXI.GraphicsData(this.lineWidth,this.lineColor,
this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,a);this.graphicsData.push(a);a.type===PIXI.Graphics.POLY&&(a.shape.closed=this.filling,this.currentPath=a);this._boundsDirty=this.dirty=!0;return a};Object.defineProperty(PIXI.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){(this._cacheAsBitmap=a)?this._generateCachedSprite():this.destroyCachedSprite();this.webGLDirty=this.dirty=!0}});PIXI.GraphicsData=function(a,c,b,e,h,l,f){this.lineWidth=a;
this.lineColor=c;this.lineAlpha=b;this._lineTint=c;this.fillColor=e;this.fillAlpha=h;this._fillTint=e;this.fill=l;this.shape=f;this.type=f.type};PIXI.GraphicsData.prototype.constructor=PIXI.GraphicsData;PIXI.GraphicsData.prototype.clone=function(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)};PIXI.EarCut={};PIXI.EarCut.Triangulate=function(a,c,b){b=b||2;var d=c&&c.length,h=d?c[0]*b:a.length,l=PIXI.EarCut.linkedList(a,0,h,
b,!0),f=[];if(!l)return f;var g,k,m,n;d&&(l=PIXI.EarCut.eliminateHoles(a,c,l,b));if(a.length>80*b){g=c=a[0];k=d=a[1];for(var p=b;p<h;p+=b)m=a[p],n=a[p+1],m<g&&(g=m),n<k&&(k=n),m>c&&(c=m),n>d&&(d=n);m=Math.max(c-g,d-k)}PIXI.EarCut.earcutLinked(l,f,b,g,k,m);return f};PIXI.EarCut.linkedList=function(a,c,b,e,h){var d=0,f,g,k;f=c;for(g=b-e;f<b;f+=e)d+=(a[g]-a[f])*(a[f+1]+a[g+1]),g=f;if(h===0<d)for(f=c;f<b;f+=e)k=PIXI.EarCut.insertNode(f,a[f],a[f+1],k);else for(f=b-e;f>=c;f-=e)k=PIXI.EarCut.insertNode(f,
a[f],a[f+1],k);return k};PIXI.EarCut.filterPoints=function(a,c){if(!a)return a;c||(c=a);var b=a,e;do if(e=!1,b.steiner||!PIXI.EarCut.equals(b,b.next)&&0!==PIXI.EarCut.area(b.prev,b,b.next))b=b.next;else{PIXI.EarCut.removeNode(b);b=c=b.prev;if(b===b.next)return null;e=!0}while(e||b!==c);return c};PIXI.EarCut.earcutLinked=function(a,c,b,e,h,l,f){if(a){!f&&l&&PIXI.EarCut.indexCurve(a,e,h,l);for(var d=a,g,q;a.prev!==a.next;)if(g=a.prev,q=a.next,l?PIXI.EarCut.isEarHashed(a,e,h,l):PIXI.EarCut.isEar(a))c.push(g.i/
b),c.push(a.i/b),c.push(q.i/b),PIXI.EarCut.removeNode(a),d=a=q.next;else if(a=q,a===d){f?1===f?(a=PIXI.EarCut.cureLocalIntersections(a,c,b),PIXI.EarCut.earcutLinked(a,c,b,e,h,l,2)):2===f&&PIXI.EarCut.splitEarcut(a,c,b,e,h,l):PIXI.EarCut.earcutLinked(PIXI.EarCut.filterPoints(a),c,b,e,h,l,1);break}}};PIXI.EarCut.isEar=function(a){var c=a.prev,b=a.next;if(0<=PIXI.EarCut.area(c,a,b))return!1;for(var e=a.next.next;e!==a.prev;){if(PIXI.EarCut.pointInTriangle(c.x,c.y,a.x,a.y,b.x,b.y,e.x,e.y)&&0<=PIXI.EarCut.area(e.prev,
e,e.next))return!1;e=e.next}return!0};PIXI.EarCut.isEarHashed=function(a,c,b,e){var d=a.prev,l=a.next;if(0<=PIXI.EarCut.area(d,a,l))return!1;var f=d.x>a.x?d.x>l.x?d.x:l.x:a.x>l.x?a.x:l.x,g=d.y>a.y?d.y>l.y?d.y:l.y:a.y>l.y?a.y:l.y,k=PIXI.EarCut.zOrder(d.x<a.x?d.x<l.x?d.x:l.x:a.x<l.x?a.x:l.x,d.y<a.y?d.y<l.y?d.y:l.y:a.y<l.y?a.y:l.y,c,b,e);c=PIXI.EarCut.zOrder(f,g,c,b,e);for(b=a.nextZ;b&&b.z<=c;){if(b!==a.prev&&b!==a.next&&PIXI.EarCut.pointInTriangle(d.x,d.y,a.x,a.y,l.x,l.y,b.x,b.y)&&0<=PIXI.EarCut.area(b.prev,
b,b.next))return!1;b=b.nextZ}for(b=a.prevZ;b&&b.z>=k;){if(b!==a.prev&&b!==a.next&&PIXI.EarCut.pointInTriangle(d.x,d.y,a.x,a.y,l.x,l.y,b.x,b.y)&&0<=PIXI.EarCut.area(b.prev,b,b.next))return!1;b=b.prevZ}return!0};PIXI.EarCut.cureLocalIntersections=function(a,c,b){var d=a;do{var h=d.prev,l=d.next.next;PIXI.EarCut.intersects(h,d,d.next,l)&&PIXI.EarCut.locallyInside(h,l)&&PIXI.EarCut.locallyInside(l,h)&&(c.push(h.i/b),c.push(d.i/b),c.push(l.i/b),PIXI.EarCut.removeNode(d),PIXI.EarCut.removeNode(d.next),
d=a=l);d=d.next}while(d!==a);return d};PIXI.EarCut.splitEarcut=function(a,c,b,e,h,l){var d=a;do{for(var f=d.next.next;f!==d.prev;){if(d.i!==f.i&&PIXI.EarCut.isValidDiagonal(d,f)){a=PIXI.EarCut.splitPolygon(d,f);d=PIXI.EarCut.filterPoints(d,d.next);a=PIXI.EarCut.filterPoints(a,a.next);PIXI.EarCut.earcutLinked(d,c,b,e,h,l);PIXI.EarCut.earcutLinked(a,c,b,e,h,l);return}f=f.next}d=d.next}while(d!==a)};PIXI.EarCut.eliminateHoles=function(a,c,b,e){var d=[],l,f,g,k;l=0;for(f=c.length;l<f;l++)g=c[l]*e,k=l<
f-1?c[l+1]*e:a.length,g=PIXI.EarCut.linkedList(a,g,k,e,!1),g===g.next&&(g.steiner=!0),d.push(PIXI.EarCut.getLeftmost(g));d.sort(compareX);for(l=0;l<d.length;l++)PIXI.EarCut.eliminateHole(d[l],b),b=PIXI.EarCut.filterPoints(b,b.next);return b};PIXI.EarCut.compareX=function(a,c){return a.x-c.x};PIXI.EarCut.eliminateHole=function(a,c){if(c=PIXI.EarCut.findHoleBridge(a,c)){var b=PIXI.EarCut.splitPolygon(c,a);PIXI.EarCut.filterPoints(b,b.next)}};PIXI.EarCut.findHoleBridge=function(a,c){var b=c,e=a.x,h=
a.y,l=-Infinity,f;do{if(h<=b.y&&h>=b.next.y){var g=b.x+(h-b.y)*(b.next.x-b.x)/(b.next.y-b.y);g<=e&&g>l&&(l=g,f=b.x<b.next.x?b:b.next)}b=b.next}while(b!==c);if(!f)return null;if(a.x===f.x)return f.prev;for(var g=f,k=Infinity,m,b=f.next;b!==g;)e>=b.x&&b.x>=f.x&&PIXI.EarCut.pointInTriangle(h<f.y?e:l,h,f.x,f.y,h<f.y?l:e,h,b.x,b.y)&&(m=Math.abs(h-b.y)/(e-b.x),(m<k||m===k&&b.x>f.x)&&PIXI.EarCut.locallyInside(b,a)&&(f=b,k=m)),b=b.next;return f};PIXI.EarCut.indexCurve=function(a,c,b,e){var d=a;do null===
d.z&&(d.z=PIXI.EarCut.zOrder(d.x,d.y,c,b,e)),d.prevZ=d.prev,d=d.nextZ=d.next;while(d!==a);d.prevZ.nextZ=null;d.prevZ=null;PIXI.EarCut.sortLinked(d)};PIXI.EarCut.sortLinked=function(a){var c,b,e,h,l,f,g,k=1;do{b=a;h=a=null;for(l=0;b;){l++;e=b;for(c=f=0;c<k&&(f++,e=e.nextZ,e);c++);for(g=k;0<f||0<g&&e;)0===f?(c=e,e=e.nextZ,g--):0!==g&&e?b.z<=e.z?(c=b,b=b.nextZ,f--):(c=e,e=e.nextZ,g--):(c=b,b=b.nextZ,f--),h?h.nextZ=c:a=c,c.prevZ=h,h=c;b=e}h.nextZ=null;k*=2}while(1<l);return a};PIXI.EarCut.zOrder=function(a,
c,b,e,h){a=32767*(a-b)/h;c=32767*(c-e)/h;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;c=(c|c<<8)&16711935;c=(c|c<<4)&252645135;c=(c|c<<2)&858993459;return(a|a<<1)&1431655765|((c|c<<1)&1431655765)<<1};PIXI.EarCut.getLeftmost=function(a){var c=a,b=a;do c.x<b.x&&(b=c),c=c.next;while(c!==a);return b};PIXI.EarCut.pointInTriangle=function(a,c,b,e,h,l,f,g){return 0<=(h-f)*(c-g)-(a-f)*(l-g)&&0<=(a-f)*(e-g)-(b-f)*(c-g)&&0<=(b-f)*(l-g)-(h-f)*(e-g)};PIXI.EarCut.isValidDiagonal=function(a,c){return PIXI.EarCut.equals(a,
c)||a.next.i!==c.i&&a.prev.i!==c.i&&!PIXI.EarCut.intersectsPolygon(a,c)&&PIXI.EarCut.locallyInside(a,c)&&PIXI.EarCut.locallyInside(c,a)&&PIXI.EarCut.middleInside(a,c)};PIXI.EarCut.area=function(a,c,b){return(c.y-a.y)*(b.x-c.x)-(c.x-a.x)*(b.y-c.y)};PIXI.EarCut.equals=function(a,c){return a.x===c.x&&a.y===c.y};PIXI.EarCut.intersects=function(a,c,b,e){return 0<PIXI.EarCut.area(a,c,b)!==0<PIXI.EarCut.area(a,c,e)&&0<PIXI.EarCut.area(b,e,a)!==0<PIXI.EarCut.area(b,e,c)};PIXI.EarCut.intersectsPolygon=function(a,
c){var b=a;do{if(b.i!==a.i&&b.next.i!==a.i&&b.i!==c.i&&b.next.i!==c.i&&PIXI.EarCut.intersects(b,b.next,a,c))return!0;b=b.next}while(b!==a);return!1};PIXI.EarCut.locallyInside=function(a,c){return 0>PIXI.EarCut.area(a.prev,a,a.next)?0<=PIXI.EarCut.area(a,c,a.next)&&0<=PIXI.EarCut.area(a,a.prev,c):0>PIXI.EarCut.area(a,c,a.prev)||0>PIXI.EarCut.area(a,a.next,c)};PIXI.EarCut.middleInside=function(a,c){var b=a,e=!1,h=(a.x+c.x)/2,l=(a.y+c.y)/2;do b.y>l!==b.next.y>l&&h<(b.next.x-b.x)*(l-b.y)/(b.next.y-b.y)+
b.x&&(e=!e),b=b.next;while(b!==a);return e};PIXI.EarCut.splitPolygon=function(a,c){var b=new PIXI.EarCut.Node(a.i,a.x,a.y),e=new PIXI.EarCut.Node(c.i,c.x,c.y),h=a.next,l=c.prev;a.next=c;c.prev=a;b.next=h;h.prev=b;e.next=b;b.prev=e;l.next=e;e.prev=l;return e};PIXI.EarCut.insertNode=function(a,c,b,e){a=new PIXI.EarCut.Node(a,c,b);e?(a.next=e.next,a.prev=e,e.next.prev=a,e.next=a):(a.prev=a,a.next=a);return a};PIXI.EarCut.removeNode=function(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=
a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)};PIXI.EarCut.Node=function(a,c,b){this.i=a;this.x=c;this.y=b;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1};PIXI.WebGLGraphics=function(){};PIXI.WebGLGraphics.stencilBufferLimit=6;PIXI.WebGLGraphics.renderGraphics=function(a,c){var b=c.gl,e=c.projection,h=c.offset,l=c.shaderManager.primitiveShader,f;a.dirty&&PIXI.WebGLGraphics.updateGraphics(a,b);for(var g=a._webGL[b.id],k=0;k<g.data.length;k++)1===g.data[k].mode?(f=g.data[k],c.stencilManager.pushStencil(a,
f,c),b.drawElements(b.TRIANGLE_FAN,4,b.UNSIGNED_SHORT,2*(f.indices.length-4)),c.stencilManager.popStencil(a,f,c)):(f=g.data[k],c.shaderManager.setShader(l),l=c.shaderManager.primitiveShader,b.uniformMatrix3fv(l.translationMatrix,!1,a.worldTransform.toArray(!0)),b.uniform1f(l.flipY,1),b.uniform2f(l.projectionVector,e.x,-e.y),b.uniform2f(l.offsetVector,-h.x,-h.y),b.uniform3fv(l.tintColor,PIXI.hex2rgb(a.tint)),b.uniform1f(l.alpha,a.worldAlpha),b.bindBuffer(b.ARRAY_BUFFER,f.buffer),b.vertexAttribPointer(l.aVertexPosition,
2,b.FLOAT,!1,24,0),b.vertexAttribPointer(l.colorAttribute,4,b.FLOAT,!1,24,8),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,f.indexBuffer),b.drawElements(b.TRIANGLE_STRIP,f.indices.length,b.UNSIGNED_SHORT,0))};PIXI.WebGLGraphics.updateGraphics=function(a,c){var b=a._webGL[c.id];b||(b=a._webGL[c.id]={lastIndex:0,data:[],gl:c});a.dirty=!1;var e;if(a.clearDirty){a.clearDirty=!1;for(e=0;e<b.data.length;e++){var h=b.data[e];h.reset();PIXI.WebGLGraphics.graphicsDataPool.push(h)}b.data=[];b.lastIndex=0}for(e=b.lastIndex;e<
a.graphicsData.length;e++){var l=a.graphicsData[e];l.type===PIXI.Graphics.POLY?(l.points=l.shape.points.slice(),l.shape.closed&&(l.points[0]===l.points[l.points.length-2]&&l.points[1]===l.points[l.points.length-1]||l.points.push(l.points[0],l.points[1])),l.fill&&l.points.length>=PIXI.WebGLGraphics.stencilBufferLimit&&(l.points.length<2*PIXI.WebGLGraphics.stencilBufferLimit?(h=PIXI.WebGLGraphics.switchMode(b,0),PIXI.WebGLGraphics.buildPoly(l,h)||(h=PIXI.WebGLGraphics.switchMode(b,1),PIXI.WebGLGraphics.buildComplexPoly(l,
h))):(h=PIXI.WebGLGraphics.switchMode(b,1),PIXI.WebGLGraphics.buildComplexPoly(l,h))),0<l.lineWidth&&(h=PIXI.WebGLGraphics.switchMode(b,0),PIXI.WebGLGraphics.buildLine(l,h))):(h=PIXI.WebGLGraphics.switchMode(b,0),l.type===PIXI.Graphics.RECT?PIXI.WebGLGraphics.buildRectangle(l,h):l.type===PIXI.Graphics.CIRC||l.type===PIXI.Graphics.ELIP?PIXI.WebGLGraphics.buildCircle(l,h):l.type===PIXI.Graphics.RREC&&PIXI.WebGLGraphics.buildRoundedRectangle(l,h));b.lastIndex++}for(e=0;e<b.data.length;e++)h=b.data[e],
h.dirty&&h.upload()};PIXI.WebGLGraphics.switchMode=function(a,c){var b;if(a.data.length){if(b=a.data[a.data.length-1],b.mode!==c||1===c)b=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(a.gl),b.mode=c,a.data.push(b)}else b=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(a.gl),b.mode=c,a.data.push(b);b.dirty=!0;return b};PIXI.WebGLGraphics.buildRectangle=function(a,c){var b=a.shape,e=b.x,h=b.y,l=b.width,b=b.height;if(a.fill){var f=PIXI.hex2rgb(a.fillColor),
g=a.fillAlpha,k=f[0]*g,m=f[1]*g,f=f[2]*g,n=c.points,p=c.indices,u=n.length/6;n.push(e,h);n.push(k,m,f,g);n.push(e+l,h);n.push(k,m,f,g);n.push(e,h+b);n.push(k,m,f,g);n.push(e+l,h+b);n.push(k,m,f,g);p.push(u,u,u+1,u+2,u+3,u+3)}a.lineWidth&&(g=a.points,a.points=[e,h,e+l,h,e+l,h+b,e,h+b,e,h],PIXI.WebGLGraphics.buildLine(a,c),a.points=g)};PIXI.WebGLGraphics.buildRoundedRectangle=function(a,c){var b=a.shape,e=b.x,h=b.y,l=b.width,f=b.height,g=b.radius,b=[];b.push(e,h+g);b=b.concat(PIXI.WebGLGraphics.quadraticBezierCurve(e,
h+f-g,e,h+f,e+g,h+f));b=b.concat(PIXI.WebGLGraphics.quadraticBezierCurve(e+l-g,h+f,e+l,h+f,e+l,h+f-g));b=b.concat(PIXI.WebGLGraphics.quadraticBezierCurve(e+l,h+g,e+l,h,e+l-g,h));b=b.concat(PIXI.WebGLGraphics.quadraticBezierCurve(e+g,h,e,h,e,h+g));if(a.fill){var f=PIXI.hex2rgb(a.fillColor),e=a.fillAlpha,h=f[0]*e,l=f[1]*e,f=f[2]*e,g=c.points,k=c.indices,m=g.length/6,n=PIXI.EarCut.Triangulate(b,null,2),p;for(p=0;p<n.length;p+=3)k.push(n[p]+m),k.push(n[p]+m),k.push(n[p+1]+m),k.push(n[p+2]+m),k.push(n[p+
2]+m);for(p=0;p<b.length;p++)g.push(b[p],b[++p],h,l,f,e)}a.lineWidth&&(e=a.points,a.points=b,PIXI.WebGLGraphics.buildLine(a,c),a.points=e)};PIXI.WebGLGraphics.quadraticBezierCurve=function(a,c,b,e,h,l){for(var d,f,g,k,m=[],n,p=0;20>=p;p++)n=p/20,d=a+(b-a)*n,f=c+(e-c)*n,g=b+(h-b)*n,k=e+(l-e)*n,d+=(g-d)*n,f+=(k-f)*n,m.push(d,f);return m};PIXI.WebGLGraphics.buildCircle=function(a,c){var b=a.shape,e=b.x,h=b.y,l;a.type===PIXI.Graphics.CIRC?b=l=b.radius:(l=b.width,b=b.height);var f=2*Math.PI/40,g;if(a.fill){g=
PIXI.hex2rgb(a.fillColor);var k=a.fillAlpha,m=g[0]*k,n=g[1]*k,p=g[2]*k,u=c.points,x=c.indices,z=u.length/6;x.push(z);for(g=0;41>g;g++)u.push(e,h,m,n,p,k),u.push(e+Math.sin(f*g)*l,h+Math.cos(f*g)*b,m,n,p,k),x.push(z++,z++);x.push(z-1)}if(a.lineWidth){k=a.points;a.points=[];for(g=0;41>g;g++)a.points.push(e+Math.sin(f*g)*l,h+Math.cos(f*g)*b);PIXI.WebGLGraphics.buildLine(a,c);a.points=k}};PIXI.WebGLGraphics.buildLine=function(a,c){var b,e=a.points;if(0!==e.length){if(a.lineWidth%2)for(b=0;b<e.length;b++)e[b]+=
.5;var h=new PIXI.Point(e[0],e[1]),l=new PIXI.Point(e[e.length-2],e[e.length-1]);if(h.x===l.x&&h.y===l.y){e=e.slice();e.pop();e.pop();var l=new PIXI.Point(e[e.length-2],e[e.length-1]),f=l.x+.5*(h.x-l.x),h=l.y+.5*(h.y-l.y);e.unshift(f,h);e.push(f,h)}var f=c.points,h=c.indices,l=e.length/2,g=e.length,k=f.length/6,m=a.lineWidth/2;b=PIXI.hex2rgb(a.lineColor);var n=a.lineAlpha,p=b[0]*n,u=b[1]*n,x=b[2]*n,z,D,A,E,C,F,I,H,B,G,K,J,N;A=e[0];E=e[1];C=e[2];F=e[3];B=-(E-F);G=A-C;D=Math.sqrt(B*B+G*G);B=B/D*m;G=
G/D*m;f.push(A-B,E-G,p,u,x,n);f.push(A+B,E+G,p,u,x,n);for(b=1;b<l-1;b++)A=e[2*(b-1)],E=e[2*(b-1)+1],C=e[2*b],F=e[2*b+1],I=e[2*(b+1)],H=e[2*(b+1)+1],B=-(E-F),G=A-C,D=Math.sqrt(B*B+G*G),B/=D,G/=D,B*=m,G*=m,K=-(F-H),J=C-I,D=Math.sqrt(K*K+J*J),K/=D,J/=D,K*=m,J*=m,D=-G+E-(-G+F),z=-B+C-(-B+A),A=(-B+A)*(-G+F)-(-B+C)*(-G+E),E=-J+H-(-J+F),N=-K+C-(-K+I),I=(-K+I)*(-J+F)-(-K+C)*(-J+H),H=D*N-E*z,.1>Math.abs(H)?(f.push(C-B,F-G,p,u,x,n),f.push(C+B,F+G,p,u,x,n)):(z=(z*I-N*A)/H,D=(E*A-D*I)/H,I=(z-C)*(z-C)+(D-F)+(D-
F),19600<I?(B-=K,G-=J,D=Math.sqrt(B*B+G*G),B/=D,G/=D,B*=m,G*=m,f.push(C-B,F-G),f.push(p,u,x,n),f.push(C+B,F+G),f.push(p,u,x,n),f.push(C-B,F-G),f.push(p,u,x,n),g++):(f.push(z,D),f.push(p,u,x,n),f.push(C-(z-C),F-(D-F)),f.push(p,u,x,n)));A=e[2*(l-2)];E=e[2*(l-2)+1];C=e[2*(l-1)];F=e[2*(l-1)+1];B=-(E-F);G=A-C;D=Math.sqrt(B*B+G*G);B=B/D*m;G=G/D*m;f.push(C-B,F-G);f.push(p,u,x,n);f.push(C+B,F+G);f.push(p,u,x,n);h.push(k);for(b=0;b<g;b++)h.push(k++);h.push(k-1)}};PIXI.WebGLGraphics.buildComplexPoly=function(a,
c){var b=a.points.slice();if(!(6>b.length)){var e=c.indices;c.points=b;c.alpha=a.fillAlpha;c.color=PIXI.hex2rgb(a.fillColor);for(var h=Infinity,l=-Infinity,f=Infinity,g=-Infinity,k,m,n=0;n<b.length;n+=2)k=b[n],m=b[n+1],h=k<h?k:h,l=k>l?k:l,f=m<f?m:f,g=m>g?m:g;b.push(h,f,l,f,l,g,h,g);b=b.length/2;for(n=0;n<b;n++)e.push(n)}};PIXI.WebGLGraphics.buildPoly=function(a,c){var b=a.points;if(!(6>b.length)){var e=c.points,h=c.indices,l=b.length/2,f=PIXI.hex2rgb(a.fillColor),g=a.fillAlpha,k=f[0]*g,m=f[1]*g,f=
f[2]*g,n=PIXI.EarCut.Triangulate(b,null,2);if(!n)return!1;var p=e.length/6,u;for(u=0;u<n.length;u+=3)h.push(n[u]+p),h.push(n[u]+p),h.push(n[u+1]+p),h.push(n[u+2]+p),h.push(n[u+2]+p);for(u=0;u<l;u++)e.push(b[2*u],b[2*u+1],k,m,f,g);return!0}};PIXI.WebGLGraphics.graphicsDataPool=[];PIXI.WebGLGraphicsData=function(a){this.gl=a;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=a.createBuffer();this.indexBuffer=a.createBuffer();this.alpha=this.mode=1;this.dirty=!0};PIXI.WebGLGraphicsData.prototype.reset=
function(){this.points=[];this.indices=[]};PIXI.WebGLGraphicsData.prototype.upload=function(){var a=this.gl;this.glPoints=new PIXI.Float32Array(this.points);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);a.bufferData(a.ARRAY_BUFFER,this.glPoints,a.STATIC_DRAW);this.glIndicies=new PIXI.Uint16Array(this.indices);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.glIndicies,a.STATIC_DRAW);this.dirty=!1};PIXI.CanvasGraphics=function(){};PIXI.CanvasGraphics.renderGraphics=
function(a,c){var b=a.worldAlpha;a.dirty&&(this.updateGraphicsTint(a),a.dirty=!1);for(var e=0;e<a.graphicsData.length;e++){var h=a.graphicsData[e],l=h.shape,f=h._fillTint,g=h._lineTint;c.lineWidth=h.lineWidth;if(h.type===PIXI.Graphics.POLY){c.beginPath();var k=l.points;c.moveTo(k[0],k[1]);for(var m=1;m<k.length/2;m++)c.lineTo(k[2*m],k[2*m+1]);l.closed&&c.lineTo(k[0],k[1]);k[0]===k[k.length-2]&&k[1]===k[k.length-1]&&c.closePath();h.fill&&(c.globalAlpha=h.fillAlpha*b,c.fillStyle="#"+("00000"+(f|0).toString(16)).substr(-6),
c.fill());h.lineWidth&&(c.globalAlpha=h.lineAlpha*b,c.strokeStyle="#"+("00000"+(g|0).toString(16)).substr(-6),c.stroke())}else if(h.type===PIXI.Graphics.RECT){if(h.fillColor||0===h.fillColor)c.globalAlpha=h.fillAlpha*b,c.fillStyle="#"+("00000"+(f|0).toString(16)).substr(-6),c.fillRect(l.x,l.y,l.width,l.height);h.lineWidth&&(c.globalAlpha=h.lineAlpha*b,c.strokeStyle="#"+("00000"+(g|0).toString(16)).substr(-6),c.strokeRect(l.x,l.y,l.width,l.height))}else if(h.type===PIXI.Graphics.CIRC)c.beginPath(),
c.arc(l.x,l.y,l.radius,0,2*Math.PI),c.closePath(),h.fill&&(c.globalAlpha=h.fillAlpha*b,c.fillStyle="#"+("00000"+(f|0).toString(16)).substr(-6),c.fill()),h.lineWidth&&(c.globalAlpha=h.lineAlpha*b,c.strokeStyle="#"+("00000"+(g|0).toString(16)).substr(-6),c.stroke());else if(h.type===PIXI.Graphics.ELIP){var n=2*l.width,m=2*l.height,k=l.x-n/2,l=l.y-m/2;c.beginPath();var p=n/2*.5522848,u=m/2*.5522848,x=k+n,z=l+m,n=k+n/2,m=l+m/2;c.moveTo(k,m);c.bezierCurveTo(k,m-u,n-p,l,n,l);c.bezierCurveTo(n+p,l,x,m-u,
x,m);c.bezierCurveTo(x,m+u,n+p,z,n,z);c.bezierCurveTo(n-p,z,k,m+u,k,m);c.closePath();h.fill&&(c.globalAlpha=h.fillAlpha*b,c.fillStyle="#"+("00000"+(f|0).toString(16)).substr(-6),c.fill());h.lineWidth&&(c.globalAlpha=h.lineAlpha*b,c.strokeStyle="#"+("00000"+(g|0).toString(16)).substr(-6),c.stroke())}else if(h.type===PIXI.Graphics.RREC){k=l.x;m=l.y;p=l.width;u=l.height;l=l.radius;x=Math.min(p,u)/2|0;l=l>x?x:l;c.beginPath();c.moveTo(k,m+l);c.lineTo(k,m+u-l);c.quadraticCurveTo(k,m+u,k+l,m+u);c.lineTo(k+
p-l,m+u);c.quadraticCurveTo(k+p,m+u,k+p,m+u-l);c.lineTo(k+p,m+l);c.quadraticCurveTo(k+p,m,k+p-l,m);c.lineTo(k+l,m);c.quadraticCurveTo(k,m,k,m+l);c.closePath();if(h.fillColor||0===h.fillColor)c.globalAlpha=h.fillAlpha*b,c.fillStyle="#"+("00000"+(f|0).toString(16)).substr(-6),c.fill();h.lineWidth&&(c.globalAlpha=h.lineAlpha*b,c.strokeStyle="#"+("00000"+(g|0).toString(16)).substr(-6),c.stroke())}}};PIXI.CanvasGraphics.renderGraphicsMask=function(a,c){var b=a.graphicsData.length;if(0!==b){c.beginPath();
for(var e=0;e<b;e++){var h=a.graphicsData[e],l=h.shape;if(h.type===PIXI.Graphics.POLY){h=l.points;c.moveTo(h[0],h[1]);for(var f=1;f<h.length/2;f++)c.lineTo(h[2*f],h[2*f+1]);h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&c.closePath()}else if(h.type===PIXI.Graphics.RECT)c.rect(l.x,l.y,l.width,l.height),c.closePath();else if(h.type===PIXI.Graphics.CIRC)c.arc(l.x,l.y,l.radius,0,2*Math.PI),c.closePath();else if(h.type===PIXI.Graphics.ELIP){var g=2*l.width,f=2*l.height,h=l.x-g/2,l=l.y-f/2,k=g/2*.5522848,
m=f/2*.5522848,n=h+g,p=l+f,g=h+g/2,f=l+f/2;c.moveTo(h,f);c.bezierCurveTo(h,f-m,g-k,l,g,l);c.bezierCurveTo(g+k,l,n,f-m,n,f);c.bezierCurveTo(n,f+m,g+k,p,g,p);c.bezierCurveTo(g-k,p,h,f+m,h,f);c.closePath()}else h.type===PIXI.Graphics.RREC&&(h=l.x,f=l.y,k=l.width,m=l.height,l=l.radius,n=Math.min(k,m)/2|0,l=l>n?n:l,c.moveTo(h,f+l),c.lineTo(h,f+m-l),c.quadraticCurveTo(h,f+m,h+l,f+m),c.lineTo(h+k-l,f+m),c.quadraticCurveTo(h+k,f+m,h+k,f+m-l),c.lineTo(h+k,f+l),c.quadraticCurveTo(h+k,f,h+k-l,f),c.lineTo(h+
l,f),c.quadraticCurveTo(h,f,h,f+l),c.closePath())}}};PIXI.CanvasGraphics.updateGraphicsTint=function(a){if(16777215!==a.tint)for(var c=(a.tint>>16&255)/255,b=(a.tint>>8&255)/255,e=(a.tint&255)/255,h=0;h<a.graphicsData.length;h++){var l=a.graphicsData[h],f=l.fillColor|0,g=l.lineColor|0;l._fillTint=((f>>16&255)/255*c*255<<16)+((f>>8&255)/255*b*255<<8)+(f&255)/255*e*255;l._lineTint=((g>>16&255)/255*c*255<<16)+((g>>8&255)/255*b*255<<8)+(g&255)/255*e*255}};b.Graphics=function(a,c,d){void 0===c&&(c=0);
void 0===d&&(d=0);this.type=b.GRAPHICS;this.physicsType=b.SPRITE;this.anchor=new b.Point;PIXI.Graphics.call(this);b.Component.Core.init.call(this,a,c,d,"",null)};b.Graphics.prototype=Object.create(PIXI.Graphics.prototype);b.Graphics.prototype.constructor=b.Graphics;b.Component.Core.install.call(b.Graphics.prototype,"Angle AutoCull Bounds Destroy FixedToCamera InputEnabled InWorld LifeSpan PhysicsBody Reset".split(" "));b.Graphics.prototype.preUpdatePhysics=b.Component.PhysicsBody.preUpdate;b.Graphics.prototype.preUpdateLifeSpan=
b.Component.LifeSpan.preUpdate;b.Graphics.prototype.preUpdateInWorld=b.Component.InWorld.preUpdate;b.Graphics.prototype.preUpdateCore=b.Component.Core.preUpdate;b.Graphics.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1};b.Graphics.prototype.postUpdate=function(){b.Component.PhysicsBody.postUpdate.call(this);b.Component.FixedToCamera.postUpdate.call(this);this._boundsDirty&&(this.updateLocalBounds(),this._boundsDirty=
!1);for(var a=0;a<this.children.length;a++)this.children[a].postUpdate()};b.Graphics.prototype.destroy=function(a){this.clear();b.Component.Destroy.prototype.destroy.call(this,a)};b.Graphics.prototype.drawTriangle=function(a,c){void 0===c&&(c=!1);var d=new b.Polygon(a);if(c){var e=new b.Point(this.game.camera.x-a[0].x,this.game.camera.y-a[0].y),h=new b.Point(a[1].x-a[0].x,a[1].y-a[0].y),h=(new b.Point(a[1].x-a[2].x,a[1].y-a[2].y)).cross(h);0<e.dot(h)&&this.drawPolygon(d)}else this.drawPolygon(d)};
b.Graphics.prototype.drawTriangles=function(a,c,d){void 0===d&&(d=!1);var e=new b.Point,h=new b.Point,l=new b.Point,f=[],g;if(c)if(a[0]instanceof b.Point)for(g=0;g<c.length/3;g++)f.push(a[c[3*g]]),f.push(a[c[3*g+1]]),f.push(a[c[3*g+2]]),3===f.length&&(this.drawTriangle(f,d),f=[]);else for(g=0;g<c.length;g++)e.x=a[2*c[g]],e.y=a[2*c[g]+1],f.push(e.copyTo({})),3===f.length&&(this.drawTriangle(f,d),f=[]);else if(a[0]instanceof b.Point)for(g=0;g<a.length/3;g++)this.drawTriangle([a[3*g],a[3*g+1],a[3*g+
2]],d);else for(g=0;g<a.length/6;g++)e.x=a[6*g+0],e.y=a[6*g+1],h.x=a[6*g+2],h.y=a[6*g+3],l.x=a[6*g+4],l.y=a[6*g+5],this.drawTriangle([e,h,l],d)};b.RenderTexture=function(a,c,d,e,h,f){void 0===e&&(e="");void 0===h&&(h=b.scaleModes.DEFAULT);void 0===f&&(f=1);this.game=a;this.key=e;this.type=b.RENDERTEXTURE;this._tempMatrix=new PIXI.Matrix;PIXI.RenderTexture.call(this,c,d,this.game.renderer,h,f);this.render=b.RenderTexture.prototype.render};b.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype);
b.RenderTexture.prototype.constructor=b.RenderTexture;b.RenderTexture.prototype.renderXY=function(a,c,b,e){a.updateTransform();this._tempMatrix.copyFrom(a.worldTransform);this._tempMatrix.tx=c;this._tempMatrix.ty=b;this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(a,this._tempMatrix,e):this.renderCanvas(a,this._tempMatrix,e)};b.RenderTexture.prototype.renderRawXY=function(a,c,b,e){this._tempMatrix.identity().translate(c,b);this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(a,this._tempMatrix,
e):this.renderCanvas(a,this._tempMatrix,e)};b.RenderTexture.prototype.render=function(a,c,b){void 0===c||null===c?this._tempMatrix.copyFrom(a.worldTransform):this._tempMatrix.copyFrom(c);this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(a,this._tempMatrix,b):this.renderCanvas(a,this._tempMatrix,b)};b.Text=function(a,c,d,e,h){c=c||0;d=d||0;e=void 0===e||null===e?"":e.toString();h=b.Utils.extend({},h);this.type=b.TEXT;this.physicsType=b.SPRITE;this.padding=new b.Point;this.textBounds=null;this.canvas=
PIXI.CanvasPool.create(this);this.context=this.canvas.getContext("2d");this.colors=[];this.strokeColors=[];this.fontStyles=[];this.fontWeights=[];this.useAdvancedWrap=this.autoRound=!1;this._res=a.renderer.resolution;this._text=e;this._fontComponents=null;this._height=this._width=this._charCount=this._lineSpacing=0;b.Sprite.call(this,a,c,d,PIXI.Texture.fromCanvas(this.canvas));this.setStyle(h);""!==e&&this.updateText()};b.Text.prototype=Object.create(b.Sprite.prototype);b.Text.prototype.constructor=
b.Text;b.Text.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1};b.Text.prototype.update=function(){};b.Text.prototype.destroy=function(a){this.texture.destroy(!0);b.Component.Destroy.prototype.destroy.call(this,a)};b.Text.prototype.setShadow=function(a,c,b,e,h,f){void 0===a&&(a=0);void 0===c&&(c=0);void 0===b&&(b="rgba(0, 0, 0, 1)");void 0===e&&(e=0);void 0===h&&(h=!0);void 0===f&&(f=!0);this.style.shadowOffsetX=
a;this.style.shadowOffsetY=c;this.style.shadowColor=b;this.style.shadowBlur=e;this.style.shadowStroke=h;this.style.shadowFill=f;this.dirty=!0;return this};b.Text.prototype.setStyle=function(a,c){void 0===c&&(c=!1);a=a||{};a.font=a.font||"bold 20pt Arial";a.backgroundColor=a.backgroundColor||null;a.fill=a.fill||"black";a.align=a.align||"left";a.boundsAlignH=a.boundsAlignH||"left";a.boundsAlignV=a.boundsAlignV||"top";a.stroke=a.stroke||"black";a.strokeThickness=a.strokeThickness||0;a.wordWrap=a.wordWrap||
!1;a.wordWrapWidth=a.wordWrapWidth||100;a.maxLines=a.maxLines||0;a.shadowOffsetX=a.shadowOffsetX||0;a.shadowOffsetY=a.shadowOffsetY||0;a.shadowColor=a.shadowColor||"rgba(0,0,0,0)";a.shadowBlur=a.shadowBlur||0;a.tabs=a.tabs||0;var b=this.fontToComponents(a.font);a.fontStyle&&(b.fontStyle=a.fontStyle);a.fontVariant&&(b.fontVariant=a.fontVariant);a.fontWeight&&(b.fontWeight=a.fontWeight);a.fontSize&&("number"===typeof a.fontSize&&(a.fontSize+="px"),b.fontSize=a.fontSize);this._fontComponents=b;a.font=
this.componentsToFont(this._fontComponents);this.style=a;this.dirty=!0;c&&this.updateText();return this};b.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res;this.context.font=this.style.font;var a=this.text;this.style.wordWrap&&(a=this.runWordWrap(this.text));var a=a.split(/(?:\r\n|\r|\n)/),c=this.style.tabs,b=[],e=0,h=this.determineFontProperties(this.style.font),f=a.length;0<this.style.maxLines&&this.style.maxLines<a.length&&(f=this.style.maxLines);for(var g=this._charCount=
0;g<f;g++){if(0===c){var k=this.style.strokeThickness+this.padding.x,k=0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?k+this.measureLine(a[g]):k+this.context.measureText(a[g]).width;this.style.wordWrap&&(k-=this.context.measureText(" ").width)}else{var m=a[g].split(/(?:\t)/),k=this.padding.x+this.style.strokeThickness;if(Array.isArray(c))for(var n=0,p=0;p<m.length;p++)k=0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||
0<this.fontStyles.length?this.measureLine(m[p]):Math.ceil(this.context.measureText(m[p]).width),0<p&&(n+=c[p-1]),k=n+k;else for(p=0;p<m.length;p++)k=0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?k+this.measureLine(m[p]):k+Math.ceil(this.context.measureText(m[p]).width),n=this.game.math.snapToCeil(k,c)-k,k+=n}b[g]=Math.ceil(k);e=Math.max(e,b[g])}this.canvas.width=e*this._res;m=h.fontSize+this.style.strokeThickness+this.padding.y;g=m*f;p=this._lineSpacing;
0>p&&Math.abs(p)>m&&(p=-m);0!==p&&(g+=0<p?p*a.length:p*(a.length-1));this.canvas.height=g*this._res;this.context.scale(this._res,this._res);navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height));this.context.fillStyle=this.style.fill;this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.textBaseline=
"alphabetic";this.context.lineWidth=this.style.strokeThickness;this.context.lineCap="round";this.context.lineJoin="round";for(g=this._charCount=0;g<f;g++)k=this.style.strokeThickness/2,n=this.style.strokeThickness/2+g*m+h.ascent,0<g&&(n+=p*g),"right"===this.style.align?k+=e-b[g]:"center"===this.style.align&&(k+=(e-b[g])/2),this.autoRound&&(k=Math.round(k),n=Math.round(n)),0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?this.updateLine(a[g],k,n):
(this.style.stroke&&this.style.strokeThickness&&(this.updateShadow(this.style.shadowStroke),0===c?this.context.strokeText(a[g],k,n):this.renderTabLine(a[g],k,n,!1)),this.style.fill&&(this.updateShadow(this.style.shadowFill),0===c?this.context.fillText(a[g],k,n):this.renderTabLine(a[g],k,n,!0)));this.updateTexture();this.dirty=!1};b.Text.prototype.renderTabLine=function(a,c,b,e){a=a.split(/(?:\t)/);var d=this.style.tabs,f;if(Array.isArray(d))for(var g=0,k=0;k<a.length;k++)0<k&&(g+=d[k-1]),f=c+g,e?
this.context.fillText(a[k],f,b):this.context.strokeText(a[k],f,b);else for(k=0;k<a.length;k++)g=Math.ceil(this.context.measureText(a[k]).width),f=this.game.math.snapToCeil(c,d),e?this.context.fillText(a[k],f,b):this.context.strokeText(a[k],f,b),c=f+g};b.Text.prototype.updateShadow=function(a){a?(this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur):(this.context.shadowOffsetX=
0,this.context.shadowOffsetY=0,this.context.shadowColor=0,this.context.shadowBlur=0)};b.Text.prototype.measureLine=function(a){for(var c=0,b=0;b<a.length;b++){var e=a[b];if(0<this.fontWeights.length||0<this.fontStyles.length){var h=this.fontToComponents(this.context.font);this.fontStyles[this._charCount]&&(h.fontStyle=this.fontStyles[this._charCount]);this.fontWeights[this._charCount]&&(h.fontWeight=this.fontWeights[this._charCount]);this.context.font=this.componentsToFont(h)}this.style.stroke&&this.style.strokeThickness&&
(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(this.style.shadowStroke));this.style.fill&&(this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill));c+=this.context.measureText(e).width;this._charCount++}return Math.ceil(c)};b.Text.prototype.updateLine=function(a,c,b){for(var d=0;d<a.length;d++){var h=a[d];if(0<this.fontWeights.length||0<this.fontStyles.length){var f=
this.fontToComponents(this.context.font);this.fontStyles[this._charCount]&&(f.fontStyle=this.fontStyles[this._charCount]);this.fontWeights[this._charCount]&&(f.fontWeight=this.fontWeights[this._charCount]);this.context.font=this.componentsToFont(f)}this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(this.style.shadowStroke),this.context.strokeText(h,c,b));this.style.fill&&(this.colors[this._charCount]&&
(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill),this.context.fillText(h,c,b));c+=this.context.measureText(h).width;this._charCount++}};b.Text.prototype.clearColors=function(){this.colors=[];this.strokeColors=[];this.dirty=!0;return this};b.Text.prototype.clearFontValues=function(){this.fontStyles=[];this.fontWeights=[];this.dirty=!0;return this};b.Text.prototype.addColor=function(a,c){this.colors[c]=a;this.dirty=!0;return this};b.Text.prototype.addStrokeColor=
function(a,c){this.strokeColors[c]=a;this.dirty=!0;return this};b.Text.prototype.addFontStyle=function(a,c){this.fontStyles[c]=a;this.dirty=!0;return this};b.Text.prototype.addFontWeight=function(a,c){this.fontWeights[c]=a;this.dirty=!0;return this};b.Text.prototype.precalculateWordWrap=function(a){this.texture.baseTexture.resolution=this._res;this.context.font=this.style.font;return this.runWordWrap(a).split(/(?:\r\n|\r|\n)/)};b.Text.prototype.runWordWrap=function(a){return this.useAdvancedWrap?
this.advancedWordWrap(a):this.basicWordWrap(a)};b.Text.prototype.advancedWordWrap=function(a){var c=this.context,b=this.style.wordWrapWidth,e="";a=a.replace(/ +/gi," ").split(/\r?\n/gi);for(var h=a.length,f=0;f<h;f++){var g=a[f],k="",g=g.replace(/^ *|\s*$/gi,"");if(c.measureText(g).width<b)e+=g+"\n";else{for(var m=b,g=g.split(" "),n=0;n<g.length;n++){var p=g[n],w=p+" ",u=c.measureText(w).width;if(u>m){if(0===n){for(h=w;h.length&&!(h=h.slice(0,-1),u=c.measureText(h).width,u<=m););if(!h.length)throw Error("This text's wordWrapWidth setting is less than a single character!");
m=p.substr(h.length);g[n]=m;k+=h}m=g.slice(g[n].length?n:n+1).join(" ").replace(/[ \n]*$/gi,"");a[f+1]=m+" "+(a[f+1]||"");h=a.length;break}else k+=w,m-=u}e+=k.replace(/[ \n]*$/gi,"")+"\n"}}return e=e.replace(/[\s|\n]*$/gi,"")};b.Text.prototype.basicWordWrap=function(a){var c="";a=a.split("\n");for(var b=0;b<a.length;b++){for(var e=this.style.wordWrapWidth,h=a[b].split(" "),f=0;f<h.length;f++){var g=this.context.measureText(h[f]).width,k=g+this.context.measureText(" ").width;k>e?(0<f&&(c+="\n"),c+=
h[f]+" ",e=this.style.wordWrapWidth-g):(e-=k,c+=h[f]+" ")}b<a.length-1&&(c+="\n")}return c};b.Text.prototype.updateFont=function(a){a=this.componentsToFont(a);this.style.font!==a&&(this.style.font=a,this.dirty=!0,this.parent&&this.updateTransform())};b.Text.prototype.fontToComponents=function(a){var c=a.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);
if(c){var b=c[5].trim();/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(b)||/['",]/.exec(b)||(b="'"+b+"'");return{font:a,fontStyle:c[1]||"normal",fontVariant:c[2]||"normal",fontWeight:c[3]||"normal",fontSize:c[4]||"medium",fontFamily:b}}console.warn("Phaser.Text - unparsable CSS font: "+a);return{font:a}};b.Text.prototype.componentsToFont=function(a){var c=[],b;(b=a.fontStyle)&&"normal"!==b&&c.push(b);(b=a.fontVariant)&&"normal"!==b&&c.push(b);(b=a.fontWeight)&&"normal"!==b&&c.push(b);
(b=a.fontSize)&&"medium"!==b&&c.push(b);(b=a.fontFamily)&&c.push(b);c.length||c.push(a.font);return c.join(" ")};b.Text.prototype.setText=function(a,c){void 0===c&&(c=!1);this.text=a.toString()||"";c?this.updateText():this.dirty=!0;return this};b.Text.prototype.parseList=function(a){if(Array.isArray(a))for(var c="",b=0;b<a.length;b++)Array.isArray(a[b])?(c+=a[b].join("\t"),b<a.length-1&&(c+="\n")):(c+=a[b],b<a.length-1&&(c+="\t"));else return this;this.text=c;this.dirty=!0;return this};b.Text.prototype.setTextBounds=
function(a,c,d,e){void 0===a?this.textBounds=null:(this.textBounds?this.textBounds.setTo(a,c,d,e):this.textBounds=new b.Rectangle(a,c,d,e),this.style.wordWrapWidth>d&&(this.style.wordWrapWidth=d));this.updateTexture();return this};b.Text.prototype.updateTexture=function(){var a=this.texture.baseTexture,c=this.texture.crop,b=this.texture.frame,e=this.canvas.width,h=this.canvas.height;a.width=e;a.height=h;c.width=e;c.height=h;b.width=e;b.height=h;this.texture.width=e;this.texture.height=h;this._width=
e;this._height=h;this.textBounds&&(a=this.textBounds.x,c=this.textBounds.y,"right"===this.style.boundsAlignH?a+=this.textBounds.width-this.canvas.width/this.resolution:"center"===this.style.boundsAlignH&&(a+=this.textBounds.halfWidth-this.canvas.width/this.resolution/2),"bottom"===this.style.boundsAlignV?c+=this.textBounds.height-this.canvas.height/this.resolution:"middle"===this.style.boundsAlignV&&(c+=this.textBounds.halfHeight-this.canvas.height/this.resolution/2),this.pivot.x=-a,this.pivot.y=
-c);this.renderable=0!==e&&0!==h;this.texture.requiresReTint=!0;this.texture.baseTexture.dirty()};b.Text.prototype._renderWebGL=function(a){this.dirty&&(this.updateText(),this.dirty=!1);PIXI.Sprite.prototype._renderWebGL.call(this,a)};b.Text.prototype._renderCanvas=function(a){this.dirty&&(this.updateText(),this.dirty=!1);PIXI.Sprite.prototype._renderCanvas.call(this,a)};b.Text.prototype.determineFontProperties=function(a){var c=b.Text.fontPropertiesCache[a];if(!c){var c={},d=b.Text.fontPropertiesCanvas,
e=b.Text.fontPropertiesContext;e.font=a;var h=Math.ceil(e.measureText("|M\u00c9q").width),f=Math.ceil(e.measureText("|M\u00c9q").width),g=2*f,f=1.4*f|0;d.width=h;d.height=g;e.fillStyle="#f00";e.fillRect(0,0,h,g);e.font=a;e.textBaseline="alphabetic";e.fillStyle="#000";e.fillText("|M\u00c9q",0,f);if(!e.getImageData(0,0,h,g))return c.ascent=f,c.descent=f+6,c.fontSize=c.ascent+c.descent,b.Text.fontPropertiesCache[a]=c;var d=e.getImageData(0,0,h,g).data,e=d.length,h=4*h,k,m,n=0,p=!1;for(k=0;k<f;k++){for(m=
0;m<h;m+=4)if(255!==d[n+m]){p=!0;break}if(p)break;else n+=h}c.ascent=f-k;n=e-h;p=!1;for(k=g;k>f;k--){for(m=0;m<h;m+=4)if(255!==d[n+m]){p=!0;break}if(p)break;else n-=h}c.descent=k-f;c.descent+=6;c.fontSize=c.ascent+c.descent;b.Text.fontPropertiesCache[a]=c}return c};b.Text.prototype.getBounds=function(a){this.dirty&&(this.updateText(),this.dirty=!1);return PIXI.Sprite.prototype.getBounds.call(this,a)};Object.defineProperty(b.Text.prototype,"text",{get:function(){return this._text},set:function(a){a!==
this._text&&(this._text=a.toString()||"",this.dirty=!0,this.parent&&this.updateTransform())}});Object.defineProperty(b.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(a){this._fontComponents=this.fontToComponents(a||"bold 20pt Arial");this.updateFont(this._fontComponents)}});Object.defineProperty(b.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(a){a=(a||"Arial").trim();/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(a)||
/['",]/.exec(a)||(a="'"+a+"'");this._fontComponents.fontFamily=a;this.updateFont(this._fontComponents)}});Object.defineProperty(b.Text.prototype,"fontSize",{get:function(){var a=this._fontComponents.fontSize;return a&&/(?:^0$|px$)/.exec(a)?parseInt(a,10):a},set:function(a){a=a||"0";"number"===typeof a&&(a+="px");this._fontComponents.fontSize=a;this.updateFont(this._fontComponents)}});Object.defineProperty(b.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},
set:function(a){this._fontComponents.fontWeight=a||"normal";this.updateFont(this._fontComponents)}});Object.defineProperty(b.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(a){this._fontComponents.fontStyle=a||"normal";this.updateFont(this._fontComponents)}});Object.defineProperty(b.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(a){this._fontComponents.fontVariant=a||"normal";this.updateFont(this._fontComponents)}});
Object.defineProperty(b.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(a){a!==this.style.fill&&(this.style.fill=a,this.dirty=!0)}});Object.defineProperty(b.Text.prototype,"align",{get:function(){return this.style.align},set:function(a){a!==this.style.align&&(this.style.align=a,this.dirty=!0)}});Object.defineProperty(b.Text.prototype,"resolution",{get:function(){return this._res},set:function(a){a!==this._res&&(this._res=a,this.dirty=!0)}});Object.defineProperty(b.Text.prototype,
"tabs",{get:function(){return this.style.tabs},set:function(a){a!==this.style.tabs&&(this.style.tabs=a,this.dirty=!0)}});Object.defineProperty(b.Text.prototype,"boundsAlignH",{get:function(){return this.style.boundsAlignH},set:function(a){a!==this.style.boundsAlignH&&(this.style.boundsAlignH=a,this.dirty=!0)}});Object.defineProperty(b.Text.prototype,"boundsAlignV",{get:function(){return this.style.boundsAlignV},set:function(a){a!==this.style.boundsAlignV&&(this.style.boundsAlignV=a,this.dirty=!0)}});
Object.defineProperty(b.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(a){a!==this.style.stroke&&(this.style.stroke=a,this.dirty=!0)}});Object.defineProperty(b.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(a){a!==this.style.strokeThickness&&(this.style.strokeThickness=a,this.dirty=!0)}});Object.defineProperty(b.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(a){a!==this.style.wordWrap&&
(this.style.wordWrap=a,this.dirty=!0)}});Object.defineProperty(b.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(a){a!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=a,this.dirty=!0)}});Object.defineProperty(b.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(a){a!==this._lineSpacing&&(this._lineSpacing=parseFloat(a),this.dirty=!0,this.parent&&this.updateTransform())}});Object.defineProperty(b.Text.prototype,"shadowOffsetX",
{get:function(){return this.style.shadowOffsetX},set:function(a){a!==this.style.shadowOffsetX&&(this.style.shadowOffsetX=a,this.dirty=!0)}});Object.defineProperty(b.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(a){a!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=a,this.dirty=!0)}});Object.defineProperty(b.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(a){a!==this.style.shadowColor&&(this.style.shadowColor=
a,this.dirty=!0)}});Object.defineProperty(b.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(a){a!==this.style.shadowBlur&&(this.style.shadowBlur=a,this.dirty=!0)}});Object.defineProperty(b.Text.prototype,"shadowStroke",{get:function(){return this.style.shadowStroke},set:function(a){a!==this.style.shadowStroke&&(this.style.shadowStroke=a,this.dirty=!0)}});Object.defineProperty(b.Text.prototype,"shadowFill",{get:function(){return this.style.shadowFill},set:function(a){a!==
this.style.shadowFill&&(this.style.shadowFill=a,this.dirty=!0)}});Object.defineProperty(b.Text.prototype,"width",{get:function(){this.dirty&&(this.updateText(),this.dirty=!1);return this.scale.x*this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width;this._width=a}});Object.defineProperty(b.Text.prototype,"height",{get:function(){this.dirty&&(this.updateText(),this.dirty=!1);return this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height;
this._height=a}});b.Text.fontPropertiesCache={};b.Text.fontPropertiesCanvas=document.createElement("canvas");b.Text.fontPropertiesContext=b.Text.fontPropertiesCanvas.getContext("2d");b.BitmapText=function(a,c,d,e,h,f,g){c=c||0;d=d||0;e=e||"";h=h||"";f=f||32;g=g||"left";PIXI.DisplayObjectContainer.call(this);this.type=b.BITMAPTEXT;this.physicsType=b.SPRITE;this.textHeight=this.textWidth=0;this.anchor=new b.Point;this._prevAnchor=new b.Point;this._glyphs=[];this._maxWidth=0;this._text=h.toString()||
"";this._data=a.cache.getBitmapFont(e);this._font=e;this._fontSize=f;this._align=g;this._tint=16777215;this.updateText();this.dirty=!1;b.Component.Core.init.call(this,a,c,d,"",null)};b.BitmapText.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);b.BitmapText.prototype.constructor=b.BitmapText;b.Component.Core.install.call(b.BitmapText.prototype,"Angle AutoCull Bounds Destroy FixedToCamera InputEnabled InWorld LifeSpan PhysicsBody Reset".split(" "));b.BitmapText.prototype.preUpdatePhysics=
b.Component.PhysicsBody.preUpdate;b.BitmapText.prototype.preUpdateLifeSpan=b.Component.LifeSpan.preUpdate;b.BitmapText.prototype.preUpdateInWorld=b.Component.InWorld.preUpdate;b.BitmapText.prototype.preUpdateCore=b.Component.Core.preUpdate;b.BitmapText.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1};b.BitmapText.prototype.postUpdate=function(){b.Component.PhysicsBody.postUpdate.call(this);b.Component.FixedToCamera.postUpdate.call(this);
this.body&&this.body.type===b.Physics.ARCADE&&(this.textWidth===this.body.sourceWidth&&this.textHeight===this.body.sourceHeight||this.body.setSize(this.textWidth,this.textHeight))};b.BitmapText.prototype.setText=function(a){this.text=a};b.BitmapText.prototype.scanLine=function(a,c,b){for(var d=0,h=0,f=-1,g=0,k=null,m=0<this._maxWidth?this._maxWidth:null,n=[],p=0;p<b.length;p++){var w=p===b.length-1?!0:!1;if(/(?:\r\n|\r|\n)/.test(b.charAt(p)))return{width:h,text:b.substr(0,p),end:w,chars:n};var u=
b.charCodeAt(p),x=a.chars[u];void 0===x&&(u=32,x=a.chars[u]);var z=k&&x.kerning[k]?x.kerning[k]:0;/(\s)/.test(b.charAt(p))&&(f=p,g=h);k=(z+x.texture.width+x.xOffset)*c;if(m&&h+k>=m&&-1<f)return{width:g||h,text:b.substr(0,p-(p-f)),end:w,chars:n};h+=(x.xAdvance+z)*c;n.push(d+(x.xOffset+z)*c);d+=(x.xAdvance+z)*c;k=u}return{width:h,text:b,end:w,chars:n}};b.BitmapText.prototype.cleanText=function(a,c){void 0===c&&(c="");var b=this._data.font;if(!b)return"";for(var e=a.replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),
h=0;h<e.length;h++){for(var f="",g=e[h],k=0;k<g.length;k++)f=b.chars[g.charCodeAt(k)]?f.concat(g[k]):f.concat(c);e[h]=f}return e.join("\n")};b.BitmapText.prototype.updateText=function(){var a=this._data.font;if(a){var c=this.text,b=this._fontSize/a.size,e=[],h=0;this.textWidth=0;do{var f=this.scanLine(a,b,c);f.y=h;e.push(f);f.width>this.textWidth&&(this.textWidth=f.width);h+=a.lineHeight*b;c=c.substr(f.text.length+1)}while(!1===f.end);this.textHeight=h;for(var h=c=0,g=this.textWidth*this.anchor.x,
k=this.textHeight*this.anchor.y,m=0;m<e.length;m++){f=e[m];"right"===this._align?h=this.textWidth-f.width:"center"===this._align&&(h=(this.textWidth-f.width)/2);for(var n=0;n<f.text.length;n++){var p=f.text.charCodeAt(n),p=a.chars[p];void 0===p&&(p=32,p=a.chars[p]);var w=this._glyphs[c];w?w.texture=p.texture:(w=new PIXI.Sprite(p.texture),w.name=f.text[n],this._glyphs.push(w));w.position.x=f.chars[n]+h-g;w.position.y=f.y+p.yOffset*b-k;w.scale.set(b);w.tint=this.tint;w.texture.requiresReTint=!0;w.parent||
this.addChild(w);c++}}for(m=c;m<this._glyphs.length;m++)this.removeChild(this._glyphs[m])}};b.BitmapText.prototype.purgeGlyphs=function(){for(var a=this._glyphs.length,c=[],b=0;b<this._glyphs.length;b++)this._glyphs[b].parent!==this?this._glyphs[b].destroy():c.push(this._glyphs[b]);this._glyphs=[];this._glyphs=c;this.updateText();return a-c.length};b.BitmapText.prototype.updateTransform=function(){if(this.dirty||!this.anchor.equals(this._prevAnchor))this.updateText(),this.dirty=!1,this._prevAnchor.copyFrom(this.anchor);
PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)};Object.defineProperty(b.BitmapText.prototype,"align",{get:function(){return this._align},set:function(a){a===this._align||"left"!==a&&"center"!==a&&"right"!==a||(this._align=a,this.updateText())}});Object.defineProperty(b.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(a){a!==this._tint&&(this._tint=a,this.updateText())}});Object.defineProperty(b.BitmapText.prototype,"font",{get:function(){return this._font},
set:function(a){a!==this._font&&(this._font=a.trim(),this._data=this.game.cache.getBitmapFont(this._font),this.updateText())}});Object.defineProperty(b.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(a){a=parseInt(a,10);a!==this._fontSize&&0<a&&(this._fontSize=a,this.updateText())}});Object.defineProperty(b.BitmapText.prototype,"text",{get:function(){return this._text},set:function(a){a!==this._text&&(this._text=a.toString()||"",this.updateText())}});Object.defineProperty(b.BitmapText.prototype,
"maxWidth",{get:function(){return this._maxWidth},set:function(a){a!==this._maxWidth&&(this._maxWidth=a,this.updateText())}});Object.defineProperty(b.BitmapText.prototype,"smoothed",{get:function(){return!this._data.base.scaleMode},set:function(a){this._data.base.scaleMode=a?0:1}});b.RetroFont=function(a,c,d,e,h,f,g,k,m,n){if(!a.cache.checkImageKey(c))return!1;if(void 0===f||null===f)f=a.cache.getImage(c).width/d;this.characterWidth=d;this.characterHeight=e;this.characterSpacingX=g||0;this.characterSpacingY=
k||0;this.characterPerRow=f;this.offsetX=m||0;this.offsetY=n||0;this.align="left";this.multiLine=!1;this.autoUpperCase=!0;this.fixedWidth=this.customSpacingY=this.customSpacingX=0;this.fontSet=a.cache.getImage(c);this._text="";this.grabData=[];this.frameData=new b.FrameData;d=this.offsetX;e=this.offsetY;for(g=f=0;g<h.length;g++)k=this.frameData.addFrame(new b.Frame(g,d,e,this.characterWidth,this.characterHeight)),this.grabData[h.charCodeAt(g)]=k.index,f++,f===this.characterPerRow?(f=0,d=this.offsetX,
e+=this.characterHeight+this.characterSpacingY):d+=this.characterWidth+this.characterSpacingX;a.cache.updateFrameData(c,this.frameData);this.stamp=new b.Image(a,0,0,c,0);b.RenderTexture.call(this,a,100,100,"",b.scaleModes.NEAREST);this.type=b.RETROFONT};b.RetroFont.prototype=Object.create(b.RenderTexture.prototype);b.RetroFont.prototype.constructor=b.RetroFont;b.RetroFont.ALIGN_LEFT="left";b.RetroFont.ALIGN_RIGHT="right";b.RetroFont.ALIGN_CENTER="center";b.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";
b.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ";b.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";b.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789";b.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789";b.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ";b.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39";b.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ";b.RetroFont.TEXT_SET9=
"ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!";b.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ";b.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789";b.RetroFont.prototype.setFixedWidth=function(a,c){void 0===c&&(c="left");this.fixedWidth=a;this.align=c};b.RetroFont.prototype.setText=function(a,c,b,e,h,f){this.multiLine=c||!1;this.customSpacingX=b||0;this.customSpacingY=e||0;this.align=h||"left";this.autoUpperCase=f?!1:!0;0<a.length&&(this.text=a)};b.RetroFont.prototype.buildRetroFontText=
function(){var a,c=0;this.clear();if(this.multiLine){var d=this._text.split("\n");0<this.fixedWidth?this.resize(this.fixedWidth,d.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0):this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),d.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0);for(var e=0;e<d.length;e++)a=0,this.align===b.RetroFont.ALIGN_RIGHT?a=this.width-d[e].length*(this.characterWidth+this.customSpacingX):this.align===
b.RetroFont.ALIGN_CENTER&&(a=this.width/2-d[e].length*(this.characterWidth+this.customSpacingX)/2,a+=this.customSpacingX/2),0>a&&(a=0),this.pasteLine(d[e],a,c,this.customSpacingX),c+=this.characterHeight+this.customSpacingY}else 0<this.fixedWidth?this.resize(this.fixedWidth,this.characterHeight,!0):this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,!0),a=0,this.align===b.RetroFont.ALIGN_RIGHT?a=this.width-this._text.length*(this.characterWidth+this.customSpacingX):
this.align===b.RetroFont.ALIGN_CENTER&&(a=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2,a+=this.customSpacingX/2),0>a&&(a=0),this.pasteLine(this._text,a,0,this.customSpacingX);this.requiresReTint=!0};b.RetroFont.prototype.pasteLine=function(a,c,b,e){for(var d=0;d<a.length;d++)if(" "===a.charAt(d))c+=this.characterWidth+e;else if(0<=this.grabData[a.charCodeAt(d)]&&(this.stamp.frame=this.grabData[a.charCodeAt(d)],this.renderXY(this.stamp,c,b,!1),c+=this.characterWidth+e,
c>this.width))break};b.RetroFont.prototype.getLongestLine=function(){var a=0;if(0<this._text.length)for(var c=this._text.split("\n"),b=0;b<c.length;b++)c[b].length>a&&(a=c[b].length);return a};b.RetroFont.prototype.removeUnsupportedCharacters=function(a){for(var c="",b=0;b<this._text.length;b++){var e=this._text[b],h=e.charCodeAt(0);if(0<=this.grabData[h]||!a&&"\n"===e)c=c.concat(e)}return c};b.RetroFont.prototype.updateOffset=function(a,c){if(this.offsetX!==a||this.offsetY!==c){for(var b=a-this.offsetX,
e=c-this.offsetY,h=this.game.cache.getFrameData(this.stamp.key).getFrames(),f=h.length;f--;)h[f].x+=b,h[f].y+=e;this.buildRetroFontText()}};Object.defineProperty(b.RetroFont.prototype,"text",{get:function(){return this._text},set:function(a){a=this.autoUpperCase?a.toUpperCase():a;a!==this._text&&(this._text=a,this.removeUnsupportedCharacters(this.multiLine),this.buildRetroFontText())}});Object.defineProperty(b.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(a){this.stamp.smoothed=
a;this.buildRetroFontText()}});b.Rope=function(a,c,d,e,h,f){this.points=[];this.points=f;this._hasUpdateAnimation=!1;this._updateAnimationCallback=null;c=c||0;d=d||0;e=e||null;h=h||null;this.type=b.ROPE;PIXI.Rope.call(this,b.Cache.DEFAULT,this.points);b.Component.Core.init.call(this,a,c,d,e,h)};b.Rope.prototype=Object.create(PIXI.Rope.prototype);b.Rope.prototype.constructor=b.Rope;b.Component.Core.install.call(b.Rope.prototype,"Angle Animation AutoCull Bounds BringToTop Crop Delta Destroy FixedToCamera InWorld LifeSpan LoadTexture Overlap PhysicsBody Reset ScaleMinMax Smoothed".split(" "));
b.Rope.prototype.preUpdatePhysics=b.Component.PhysicsBody.preUpdate;b.Rope.prototype.preUpdateLifeSpan=b.Component.LifeSpan.preUpdate;b.Rope.prototype.preUpdateInWorld=b.Component.InWorld.preUpdate;b.Rope.prototype.preUpdateCore=b.Component.Core.preUpdate;b.Rope.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1};b.Rope.prototype.update=function(){this._hasUpdateAnimation&&this.updateAnimation.call(this)};b.Rope.prototype.reset=
function(a,c){b.Component.Reset.prototype.reset.call(this,a,c);return this};Object.defineProperty(b.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(a){a&&"function"===typeof a?(this._hasUpdateAnimation=!0,this._updateAnimation=a):(this._hasUpdateAnimation=!1,this._updateAnimation=null)}});Object.defineProperty(b.Rope.prototype,"segments",{get:function(){for(var a=[],c,d,e,h,f=0;f<this.points.length;f++)c=4*f,d=this.vertices[c]*this.scale.x,e=this.vertices[c+
1]*this.scale.y,h=this.vertices[c+4]*this.scale.x,c=this.vertices[c+3]*this.scale.y,h=b.Math.difference(d,h),c=b.Math.difference(e,c),d+=this.world.x,e+=this.world.y,d=new b.Rectangle(d,e,h,c),a.push(d);return a}});b.TileSprite=function(a,c,d,e,h,f,g){c=c||0;d=d||0;e=e||256;h=h||256;f=f||null;g=g||null;this.type=b.TILESPRITE;this.physicsType=b.SPRITE;this._scroll=new b.Point;var l=a.cache.getImage("__default",!0);PIXI.TilingSprite.call(this,new PIXI.Texture(l.base),e,h);b.Component.Core.init.call(this,
a,c,d,f,g)};b.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype);b.TileSprite.prototype.constructor=b.TileSprite;b.Component.Core.install.call(b.TileSprite.prototype,"Angle Animation AutoCull Bounds BringToTop Destroy FixedToCamera Health InCamera InputEnabled InWorld LifeSpan LoadTexture Overlap PhysicsBody Reset Smoothed".split(" "));b.TileSprite.prototype.preUpdatePhysics=b.Component.PhysicsBody.preUpdate;b.TileSprite.prototype.preUpdateLifeSpan=b.Component.LifeSpan.preUpdate;b.TileSprite.prototype.preUpdateInWorld=
b.Component.InWorld.preUpdate;b.TileSprite.prototype.preUpdateCore=b.Component.Core.preUpdate;b.TileSprite.prototype.preUpdate=function(){0!==this._scroll.x&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed);0!==this._scroll.y&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed);return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1};b.TileSprite.prototype.autoScroll=function(a,c){this._scroll.set(a,c)};b.TileSprite.prototype.stopScroll=
function(){this._scroll.set(0,0)};b.TileSprite.prototype.destroy=function(a){b.Component.Destroy.prototype.destroy.call(this,a);PIXI.TilingSprite.prototype.destroy.call(this)};b.TileSprite.prototype.reset=function(a,c){b.Component.Reset.prototype.reset.call(this,a,c);this.tilePosition.x=0;this.tilePosition.y=0;return this};b.Device=function(){this.deviceReadyAt=0;this.iOS=this.desktop=this.initialized=!1;this.iOSVersion=0;this.canvas=this.windowsPhone=this.windows=this.macOS=this.linux=this.chromeOS=
this.android=this.crosswalk=this.ejecta=this.electron=this.nodeWebkit=this.node=this.cordova=this.cocoonJSApp=this.cocoonJS=!1;this.canvasBitBltShift=null;this.vibration=this.typedArray=this.pointerLock=this.css3D=this.worker=this.localStorage=this.fileSystem=this.file=this.webGL=!1;this.getUserMedia=!0;this.mspointer=this.touch=this.quirksMode=!1;this.wheelEvent=null;this.chrome=this.arora=!1;this.chromeVersion=0;this.firefox=this.epiphany=!1;this.firefoxVersion=0;this.ie=!1;this.ieVersion=0;this.trident=
!1;this.tridentVersion=0;this.safari=this.opera=this.midori=this.mobileSafari=this.edge=!1;this.safariVersion=0;this.iPad=this.iPhone4=this.iPhone=this.hlsVideo=this.vp9Video=this.webmVideo=this.mp4Video=this.h264Video=this.oggVideo=this.dolby=this.webm=this.m4a=this.wav=this.mp3=this.opus=this.ogg=this.webAudio=this.audioData=this.silk=this.webApp=!1;this.pixelRatio=0;this.fullscreen=this.support32bit=this.LITTLE_ENDIAN=this.littleEndian=!1;this.cancelFullscreen=this.requestFullscreen="";this.fullscreenKeyboard=
!1};b.Device=new b.Device;b.Device.onInitialized=new b.Signal;b.Device.whenReady=function(a,c,b){var d=this._readyCheck;this.deviceReadyAt||!d?a.call(c,this):d._monitor||b?(d._queue=d._queue||[],d._queue.push([a,c])):(d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,c]),a="undefined"!==typeof window.cordova,c=navigator.isCocoonJS,"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):a&&!c?document.addEventListener("deviceready",d._monitor,
!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1)))};b.Device._readyCheck=function(){var a=this._readyCheck;if(!document.body)window.setTimeout(a._monitor,20);else if(!this.deviceReadyAt){this.deviceReadyAt=Date.now();document.removeEventListener("deviceready",a._monitor);document.removeEventListener("DOMContentLoaded",a._monitor);window.removeEventListener("load",a._monitor);this._initialize();this.initialized=!0;this.onInitialized.dispatch(this);
for(var c;c=a._queue.shift();)c[0].call(c[1],this);this.onInitialized=this._initialize=this._readyCheck=null}};b.Device._initialize=function(){function a(){var a=new ArrayBuffer(4),c=new Uint8Array(a),a=new Uint32Array(a);c[0]=161;c[1]=178;c[2]=195;c[3]=212;return 3569595041===a[0]?!0:2712847316===a[0]?!1:null}function c(){if(void 0===Uint8ClampedArray)return!1;var a=PIXI.CanvasPool.create(this,1,1).getContext("2d");if(!a)return!1;a=a.createImageData(1,1);PIXI.CanvasPool.remove(this);return a.data instanceof
Uint8ClampedArray}var b=this;(function(){var a=navigator.userAgent;/Playstation Vita/.test(a)?b.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?b.kindle=!0:/Android/.test(a)?b.android=!0:/CrOS/.test(a)?b.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?(b.iOS=!0,navigator.appVersion.match(/OS (\d+)/),b.iOSVersion=parseInt(RegExp.$1,10)):/Linux/.test(a)?b.linux=!0:/Mac OS/.test(a)?b.macOS=!0:/Windows/.test(a)&&(b.windows=!0);if(/Windows Phone/i.test(a)||/IEMobile/i.test(a))b.android=
!1,b.iOS=!1,b.macOS=!1,b.windows=!0,b.windowsPhone=!0;var c=/Silk/.test(a);if(b.windows||b.macOS||b.linux&&!c||b.chromeOS)b.desktop=!0;if(b.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))b.desktop=!1})();(function(){var a=navigator.userAgent;/Arora/.test(a)?b.arora=!0:/Edge\/\d+/.test(a)?b.edge=!0:/Chrome\/(\d+)/.test(a)&&!b.windowsPhone?(b.chrome=!0,b.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?b.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(b.firefox=!0,b.firefoxVersion=parseInt(RegExp.$1,
10)):/AppleWebKit/.test(a)&&b.iOS?b.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(b.ie=!0,b.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?b.midori=!0:/Opera/.test(a)?b.opera=!0:/Safari\/(\d+)/.test(a)&&!b.windowsPhone?(b.safari=!0,/Version\/(\d+)\./.test(a)&&(b.safariVersion=parseInt(RegExp.$1,10))):/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(b.ie=!0,b.trident=!0,b.tridentVersion=parseInt(RegExp.$1,10),b.ieVersion=parseInt(RegExp.$3,10));/Silk/.test(a)&&(b.silk=!0);navigator.standalone&&(b.webApp=
!0);"undefined"!==typeof window.cordova&&(b.cordova=!0);"undefined"!==typeof process&&"undefined"!==typeof require&&(b.node=!0);b.node&&"object"===typeof process.versions&&(b.nodeWebkit=!!process.versions["node-webkit"],b.electron=!!process.versions.electron);navigator.isCocoonJS&&(b.cocoonJS=!0);if(b.cocoonJS)try{b.cocoonJSApp="undefined"!==typeof CocoonJS}catch(h){b.cocoonJSApp=!1}"undefined"!==typeof window.ejecta&&(b.ejecta=!0);/Crosswalk/.test(a)&&(b.crosswalk=!0)})();(function(){b.audioData=
!!window.Audio;b.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio");try{if(a.canPlayType){a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(b.ogg=!0);if(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))b.opus=!0;a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(b.mp3=!0);a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(b.wav=!0);if(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,
""))b.m4a=!0;a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(b.webm=!0);if(""!==a.canPlayType('audio/mp4;codecs="ec-3"'))if(b.edge)b.dolby=!0;else if(b.safari&&9<=b.safariVersion&&/Mac OS X (\d+)_(\d+)/.test(navigator.userAgent)){var c=parseInt(RegExp.$1,10),d=parseInt(RegExp.$2,10);if(10===c&&11<=d||10<c)b.dolby=!0}}}catch(q){}})();(function(){var a=document.createElement("video");try{a.canPlayType&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(b.oggVideo=!0),
a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(b.h264Video=!0,b.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(b.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(b.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(b.hlsVideo=!0))}catch(h){}})();(function(){var a=document.createElement("p"),c,d={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",
MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(a,null);for(var f in d)void 0!==a.style[f]&&(a.style[f]="translate3d(1px,1px,1px)",c=window.getComputedStyle(a).getPropertyValue(d[f]));document.body.removeChild(a);b.css3D=void 0!==c&&0<c.length&&"none"!==c})();b.pixelRatio=window.devicePixelRatio||1;b.iPhone=-1!==navigator.userAgent.toLowerCase().indexOf("iphone");b.iPhone4=2===b.pixelRatio&&b.iPhone;b.iPad=-1!==navigator.userAgent.toLowerCase().indexOf("ipad");b.typedArray=
"undefined"!==typeof Int8Array?!0:!1;"undefined"!==typeof ArrayBuffer&&"undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint32Array&&(b.littleEndian=a(),b.LITTLE_ENDIAN=b.littleEndian);b.support32bit="undefined"!==typeof ArrayBuffer&&"undefined"!==typeof Uint8ClampedArray&&"undefined"!==typeof Int32Array&&null!==b.littleEndian&&c();navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;navigator.vibrate&&(b.vibration=!0);(function(){b.canvas=!!window.CanvasRenderingContext2D||
b.cocoonJS;try{b.localStorage=!!localStorage.getItem}catch(l){b.localStorage=!1}b.file=!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob;b.fileSystem=!!window.requestFileSystem;var a;try{var c=document.createElement("canvas");c.screencanvas=!1;a=!!window.WebGLRenderingContext&&(c.getContext("webgl")||c.getContext("experimental-webgl"))}catch(l){a=!1}b.webGL=a;b.webGL=!!b.webGL;b.worker=!!window.Worker;b.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||
"webkitPointerLockElement"in document;b.quirksMode="CSS1Compat"===document.compatMode?!1:!0;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;b.getUserMedia=b.getUserMedia&&!!navigator.getUserMedia&&!!window.URL;b.firefox&&21>b.firefoxVersion&&(b.getUserMedia=!1);!b.iOS&&(b.ie||b.firefox||b.chrome)&&(b.canvasBitBltShift=!0);if(b.safari||
b.mobileSafari)b.canvasBitBltShift=!1})();(function(){for(var a="requestFullscreen requestFullScreen webkitRequestFullscreen webkitRequestFullScreen msRequestFullscreen msRequestFullScreen mozRequestFullScreen mozRequestFullscreen".split(" "),c=document.createElement("div"),d=0;d<a.length;d++)if(c[a[d]]){b.fullscreen=!0;b.requestFullscreen=a[d];break}a="cancelFullScreen exitFullscreen webkitCancelFullScreen webkitExitFullscreen msCancelFullScreen msExitFullscreen mozCancelFullScreen mozExitFullscreen".split(" ");
if(b.fullscreen)for(d=0;d<a.length;d++)if(document[a[d]]){b.cancelFullscreen=a[d];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(b.fullscreenKeyboard=!0)})();if("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&1<=window.navigator.maxTouchPoints)b.touch=!0;if(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)b.mspointer=!0;b.cocoonJS||("onwheel"in window||b.ie&&"WheelEvent"in window?b.wheelEvent="wheel":"onmousewheel"in window?b.wheelEvent="mousewheel":
b.firefox&&"MouseScrollEvent"in window&&(b.wheelEvent="DOMMouseScroll"))};b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3||"ogg"===a&&(this.ogg||this.opus)||"m4a"===a&&this.m4a||"opus"===a&&this.opus||"wav"===a&&this.wav||"webm"===a&&this.webm||"mp4"===a&&this.dolby?!0:!1};b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)||"mp4"===a&&(this.mp4Video||this.h264Video)||("ogg"===a||"ogv"===a)&&this.oggVideo||"mpeg"===a&&this.hlsVideo?!0:!1};b.Device.isConsoleOpen=
function(){return window.console&&window.console.firebug?!0:window.console&&(console.profile(),console.profileEnd(),console.clear&&console.clear(),console.profiles)?0<console.profiles.length:!1};b.Device.isAndroidStockBrowser=function(){var a=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return a&&537>a[1]};b.Canvas={create:function(a,c,b,e,h){c=c||256;b=b||256;a=h?document.createElement("canvas"):PIXI.CanvasPool.create(a,c,b);"string"===typeof e&&""!==e&&(a.id=e);a.width=c;a.height=
b;a.style.display="block";return a},setBackgroundColor:function(a,c){a.style.backgroundColor=c||"rgb(0,0,0)";return a},setTouchAction:function(a,c){c=c||"none";a.style.msTouchAction=c;a.style["ms-touch-action"]=c;a.style["touch-action"]=c;return a},setUserSelect:function(a,c){c=c||"none";a.style["-webkit-touch-callout"]=c;a.style["-webkit-user-select"]=c;a.style["-khtml-user-select"]=c;a.style["-moz-user-select"]=c;a.style["-ms-user-select"]=c;a.style["user-select"]=c;a.style["-webkit-tap-highlight-color"]=
"rgba(0, 0, 0, 0)";return a},addToDOM:function(a,c,b){var d;void 0===b&&(b=!0);c&&("string"===typeof c?d=document.getElementById(c):"object"===typeof c&&1===c.nodeType&&(d=c));d||(d=document.body);b&&d.style&&(d.style.overflow="hidden");d.appendChild(a);return a},removeFromDOM:function(a){a.parentNode&&a.parentNode.removeChild(a)},setTransform:function(a,c,b,e,h,f,g){a.setTransform(e,f,g,h,c,b);return a},setSmoothingEnabled:function(a,c){var d=b.Canvas.getSmoothingPrefix(a);d&&(a[d]=c);return a},
getSmoothingPrefix:function(a){var c=["i","webkitI","msI","mozI","oI"],b;for(b in c){var e=c[b]+"mageSmoothingEnabled";if(e in a)return e}return null},getSmoothingEnabled:function(a){var c=b.Canvas.getSmoothingPrefix(a);if(c)return a[c]},setImageRenderingCrisp:function(a){for(var c="optimizeSpeed crisp-edges -moz-crisp-edges -webkit-optimize-contrast optimize-contrast pixelated".split(" "),b=0;b<c.length;b++)a.style["image-rendering"]=c[b];a.style.msInterpolationMode="nearest-neighbor";return a},
setImageRenderingBicubic:function(a){a.style["image-rendering"]="auto";a.style.msInterpolationMode="bicubic";return a}};b.RequestAnimationFrame=function(a,c){void 0===c&&(c=!1);this.game=a;this.isRunning=!1;this.forceSetTimeOut=c;for(var b=["ms","moz","webkit","o"],e=0;e<b.length&&!window.requestAnimationFrame;e++)window.requestAnimationFrame=window[b[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[e]+"CancelAnimationFrame"];this._isSetTimeOut=!1;this._timeOutID=this._onLoop=null};
b.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var a=this;!window.requestAnimationFrame||this.forceSetTimeOut?(this._isSetTimeOut=!0,this._onLoop=function(){return a.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0)):(this._isSetTimeOut=!1,this._onLoop=function(c){return a.updateRAF(c)},this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateRAF:function(a){this.isRunning&&(this.game.update(Math.floor(a)),this._timeOutID=window.requestAnimationFrame(this._onLoop))},
updateSetTimeout:function(){this.isRunning&&(this.game.update(Date.now()),this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall))},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID);this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return!1===this._isSetTimeOut}};b.RequestAnimationFrame.prototype.constructor=b.RequestAnimationFrame;b.Math={PI2:2*Math.PI,between:function(a,c){return Math.floor(Math.random()*
(c-a+1)+a)},fuzzyEqual:function(a,c,b){void 0===b&&(b=1E-4);return Math.abs(a-c)<b},fuzzyLessThan:function(a,c,b){void 0===b&&(b=1E-4);return a<c+b},fuzzyGreaterThan:function(a,c,b){void 0===b&&(b=1E-4);return a>c-b},fuzzyCeil:function(a,c){void 0===c&&(c=1E-4);return Math.ceil(a-c)},fuzzyFloor:function(a,c){void 0===c&&(c=1E-4);return Math.floor(a+c)},average:function(){for(var a=0,c=arguments.length,b=0;b<c;b++)a+=+arguments[b];return a/c},shear:function(a){return a%1},snapTo:function(a,c,b){void 0===
b&&(b=0);if(0===c)return a;a=c*Math.round((a-b)/c);return b+a},snapToFloor:function(a,c,b){void 0===b&&(b=0);if(0===c)return a;a=c*Math.floor((a-b)/c);return b+a},snapToCeil:function(a,c,b){void 0===b&&(b=0);if(0===c)return a;a=c*Math.ceil((a-b)/c);return b+a},roundTo:function(a,c,b){void 0===c&&(c=0);void 0===b&&(b=10);c=Math.pow(b,-c);return Math.round(a*c)/c},floorTo:function(a,c,b){void 0===c&&(c=0);void 0===b&&(b=10);c=Math.pow(b,-c);return Math.floor(a*c)/c},ceilTo:function(a,c,b){void 0===
c&&(c=0);void 0===b&&(b=10);c=Math.pow(b,-c);return Math.ceil(a*c)/c},rotateToAngle:function(a,c,d){void 0===d&&(d=.05);if(a===c)return a;Math.abs(c-a)<=d||Math.abs(c-a)>=b.Math.PI2-d?a=c:(Math.abs(c-a)>Math.PI&&(c=c<a?c+b.Math.PI2:c-b.Math.PI2),c>a?a+=d:c<a&&(a-=d));return a},getShortestAngle:function(a,c){var b=c-a;return 0===b?0:b-360*Math.floor((b- -180)/360)},angleBetween:function(a,c,b,e){return Math.atan2(e-c,b-a)},angleBetweenY:function(a,c,b,e){return Math.atan2(b-a,e-c)},angleBetweenPoints:function(a,
c){return Math.atan2(c.y-a.y,c.x-a.x)},angleBetweenPointsY:function(a,c){return Math.atan2(c.x-a.x,c.y-a.y)},reverseAngle:function(a){return this.normalizeAngle(a+Math.PI,!0)},normalizeAngle:function(a){a%=2*Math.PI;return 0<=a?a:a+2*Math.PI},maxAdd:function(a,c,b){return Math.min(a+c,b)},minSub:function(a,c,b){return Math.max(a-c,b)},wrap:function(a,c,b){b-=c;if(0>=b)return 0;a=(a-c)%b;0>a&&(a+=b);return a+c},wrapValue:function(a,c,b){a=Math.abs(a);c=Math.abs(c);b=Math.abs(b);return(a+c)%b},isOdd:function(a){return!!(a&
1)},isEven:function(a){return!(a&1)},min:function(){for(var a=1===arguments.length&&"object"===typeof arguments[0]?arguments[0]:arguments,c=1,b=0,e=a.length;c<e;c++)a[c]<a[b]&&(b=c);return a[b]},max:function(){for(var a=1===arguments.length&&"object"===typeof arguments[0]?arguments[0]:arguments,c=1,b=0,e=a.length;c<e;c++)a[c]>a[b]&&(b=c);return a[b]},minProperty:function(a){for(var c=2===arguments.length&&"object"===typeof arguments[1]?arguments[1]:arguments.slice(1),b=1,e=0,h=c.length;b<h;b++)c[b][a]<
c[e][a]&&(e=b);return c[e][a]},maxProperty:function(a){for(var c=2===arguments.length&&"object"===typeof arguments[1]?arguments[1]:arguments.slice(1),b=1,e=0,h=c.length;b<h;b++)c[b][a]>c[e][a]&&(e=b);return c[e][a]},wrapAngle:function(a,c){return c?this.wrap(a,-Math.PI,Math.PI):this.wrap(a,-180,180)},linearInterpolation:function(a,c){var b=a.length-1,e=b*c,h=Math.floor(e);return 0>c?this.linear(a[0],a[1],e):1<c?this.linear(a[b],a[b-1],b-e):this.linear(a[h],a[h+1>b?b:h+1],e-h)},bezierInterpolation:function(a,
c){for(var b=0,e=a.length-1,h=0;h<=e;h++)b+=Math.pow(1-c,e-h)*Math.pow(c,h)*a[h]*this.bernstein(e,h);return b},catmullRomInterpolation:function(a,c){var b=a.length-1,e=b*c,h=Math.floor(e);return a[0]===a[b]?(0>c&&(h=Math.floor(e=b*(1+c))),this.catmullRom(a[(h-1+b)%b],a[h],a[(h+1)%b],a[(h+2)%b],e-h)):0>c?a[0]-(this.catmullRom(a[0],a[0],a[1],a[1],-e)-a[0]):1<c?a[b]-(this.catmullRom(a[b],a[b],a[b-1],a[b-1],e-b)-a[b]):this.catmullRom(a[h?h-1:0],a[h],a[b<h+1?b:h+1],a[b<h+2?b:h+2],e-h)},linear:function(a,
c,b){return(c-a)*b+a},bernstein:function(a,c){return this.factorial(a)/this.factorial(c)/this.factorial(a-c)},factorial:function(a){if(0===a)return 1;for(var c=a;--a;)c*=a;return c},catmullRom:function(a,c,b,e,h){a=.5*(b-a);e=.5*(e-c);var d=h*h;return(2*c-2*b+a+e)*h*d+(-3*c+3*b-2*a-e)*d+a*h+c},difference:function(a,c){return Math.abs(a-c)},roundAwayFromZero:function(a){return 0<a?Math.ceil(a):Math.floor(a)},sinCosGenerator:function(a,c,b,e){void 0===c&&(c=1);void 0===b&&(b=1);void 0===e&&(e=1);e=
e*Math.PI/a;for(var d=[],f=[],g=0;g<a;g++)b-=c*e,c+=b*e,d[g]=b,f[g]=c;return{sin:f,cos:d,length:a}},distance:function(a,c,b,e){a-=b;c-=e;return Math.sqrt(a*a+c*c)},distanceSq:function(a,c,b,e){a-=b;c-=e;return a*a+c*c},distancePow:function(a,c,b,e,h){void 0===h&&(h=2);return Math.sqrt(Math.pow(b-a,h)+Math.pow(e-c,h))},clamp:function(a,c,b){return a<c?c:b<a?b:a},clampBottom:function(a,c){return a<c?c:a},within:function(a,c,b){return Math.abs(a-c)<=b},mapLinear:function(a,c,b,e,h){return e+(a-c)*(h-
e)/(b-c)},smoothstep:function(a,c,b){a=Math.max(0,Math.min(1,(a-c)/(b-c)));return a*a*(3-2*a)},smootherstep:function(a,c,b){a=Math.max(0,Math.min(1,(a-c)/(b-c)));return a*a*a*(a*(6*a-15)+10)},sign:function(a){return 0>a?-1:0<a?1:0},percent:function(a,c,b){void 0===b&&(b=0);return a>c||b>c?1:a<b||b>a?0:(a-b)/c}};var m=Math.PI/180,n=180/Math.PI;b.Math.degToRad=function(a){return a*m};b.Math.radToDeg=function(a){return a*n};b.RandomDataGenerator=function(a){void 0===a&&(a=[]);this.c=1;this.s2=this.s1=
this.s0=0;"string"===typeof a?this.state(a):this.sow(a)};b.RandomDataGenerator.prototype={rnd:function(){var a=2091639*this.s0+2.3283064365386963E-10*this.c;this.c=a|0;this.s0=this.s1;this.s1=this.s2;return this.s2=a-this.c},sow:function(a){this.s0=this.hash(" ");this.s1=this.hash(this.s0);this.s2=this.hash(this.s1);this.c=1;if(a)for(var c=0;c<a.length&&null!=a[c];c++){var b=a[c];this.s0-=this.hash(b);this.s0+=~~(0>this.s0);this.s1-=this.hash(b);this.s1+=~~(0>this.s1);this.s2-=this.hash(b);this.s2+=
~~(0>this.s2)}},hash:function(a){var c,b,e;e=4022871197;a=a.toString();for(b=0;b<a.length;b++)e+=a.charCodeAt(b),c=.02519603282416938*e,e=c>>>0,c-=e,c*=e,e=c>>>0,c-=e,e+=4294967296*c;return 2.3283064365386963E-10*(e>>>0)},integer:function(){return 4294967296*this.rnd.apply(this)},frac:function(){return this.rnd.apply(this)+1.1102230246251565E-16*(2097152*this.rnd.apply(this)|0)},real:function(){return this.integer()+this.frac()},integerInRange:function(a,c){return Math.floor(this.realInRange(0,c-
a+1)+a)},between:function(a,c){return this.integerInRange(a,c)},realInRange:function(a,c){return this.frac()*(c-a)+a},normal:function(){return 1-2*this.frac()},uuid:function(){var a,c;for(c=a="";36>a++;c+=~a%5|3*a&4?(a^15?8^this.frac()*(a^20?16:4):4).toString(16):"-");return c},pick:function(a){return a[this.integerInRange(0,a.length-1)]},sign:function(){return this.pick([-1,1])},weightedPick:function(a){return a[~~(Math.pow(this.frac(),2)*(a.length-1)+.5)]},timestamp:function(a,c){return this.realInRange(a||
9466848E5,c||1577862E6)},angle:function(){return this.integerInRange(-180,180)},state:function(a){"string"===typeof a&&a.match(/^!rnd/)&&(a=a.split(","),this.c=parseFloat(a[1]),this.s0=parseFloat(a[2]),this.s1=parseFloat(a[3]),this.s2=parseFloat(a[4]));return["!rnd",this.c,this.s0,this.s1,this.s2].join()}};b.RandomDataGenerator.prototype.constructor=b.RandomDataGenerator;b.QuadTree=function(a,c,b,e,h,f,g){this.maxObjects=10;this.maxLevels=4;this.level=0;this.bounds={};this.objects=[];this.nodes=[];
this._empty=[];this.reset(a,c,b,e,h,f,g)};b.QuadTree.prototype={reset:function(a,c,b,e,h,f,g){this.maxObjects=h||10;this.maxLevels=f||4;this.level=g||0;this.bounds={x:Math.round(a),y:Math.round(c),width:b,height:e,subWidth:Math.floor(b/2),subHeight:Math.floor(e/2),right:Math.round(a)+Math.floor(b/2),bottom:Math.round(c)+Math.floor(e/2)};this.objects.length=0;this.nodes.length=0},populate:function(a){a.forEach(this.populateHandler,this,!0)},populateHandler:function(a){a.body&&a.exists&&this.insert(a.body)},
split:function(){this.nodes[0]=new b.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[1]=new b.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[2]=new b.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[3]=new b.QuadTree(this.bounds.right,
this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(a){var c=0,b;if(null!=this.nodes[0]&&(b=this.getIndex(a),-1!==b)){this.nodes[b].insert(a);return}this.objects.push(a);if(this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(null==this.nodes[0]&&this.split();c<this.objects.length;)b=this.getIndex(this.objects[c]),-1!==b?this.nodes[b].insert(this.objects.splice(c,1)[0]):c++},getIndex:function(a){var c=-1;a.x<this.bounds.right&&
a.right<this.bounds.right?a.y<this.bounds.bottom&&a.bottom<this.bounds.bottom?c=1:a.y>this.bounds.bottom&&(c=2):a.x>this.bounds.right&&(a.y<this.bounds.bottom&&a.bottom<this.bounds.bottom?c=0:a.y>this.bounds.bottom&&(c=3));return c},retrieve:function(a){if(a instanceof b.Rectangle)var c=this.objects,d=this.getIndex(a);else{if(!a.body)return this._empty;c=this.objects;d=this.getIndex(a.body)}this.nodes[0]&&(-1!==d?c=c.concat(this.nodes[d].retrieve(a)):(c=c.concat(this.nodes[0].retrieve(a)),c=c.concat(this.nodes[1].retrieve(a)),
c=c.concat(this.nodes[2].retrieve(a)),c=c.concat(this.nodes[3].retrieve(a))));return c},clear:function(){this.objects.length=0;for(var a=this.nodes.length;a--;)this.nodes[a].clear(),this.nodes.splice(a,1);this.nodes.length=0}};b.QuadTree.prototype.constructor=b.QuadTree;b.Net=function(a){this.game=a};b.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(a){return-1!==window.location.hostname.indexOf(a)},updateQueryString:function(a,
c,b,e){void 0===b&&(b=!1);if(void 0===e||""===e)e=window.location.href;var d=new RegExp("([?|&])"+a+"=.*?(&|#|$)(.*)","gi");if(d.test(e))a="undefined"!==typeof c&&null!==c?e.replace(d,"$1"+a+"="+c+"$2$3"):e.replace(d,"$1$3").replace(/(&|\?)$/,"");else{if("undefined"!==typeof c&&null!==c){var d=-1!==e.indexOf("?")?"&":"?",f=e.split("#");e=f[0]+d+a+"="+c;f[1]&&(e+="#"+f[1])}a=e}if(b)window.location.href=a;else return a},getQueryString:function(a){void 0===a&&(a="");var c={},b=location.search.substring(1).split("&"),
e;for(e in b){var h=b[e].split("=");if(1<h.length){if(a&&a===this.decodeURI(h[0]))return this.decodeURI(h[1]);c[this.decodeURI(h[0])]=this.decodeURI(h[1])}}return c},decodeURI:function(a){return decodeURIComponent(a.replace(/\+/g," "))}};b.Net.prototype.constructor=b.Net;b.TweenManager=function(a){this.game=a;this.frameBased=!1;this._tweens=[];this._add=[];this.easeMap={Power0:b.Easing.Power0,Power1:b.Easing.Power1,Power2:b.Easing.Power2,Power3:b.Easing.Power3,Power4:b.Easing.Power4,Linear:b.Easing.Linear.None,
Quad:b.Easing.Quadratic.Out,Cubic:b.Easing.Cubic.Out,Quart:b.Easing.Quartic.Out,Quint:b.Easing.Quintic.Out,Sine:b.Easing.Sinusoidal.Out,Expo:b.Easing.Exponential.Out,Circ:b.Easing.Circular.Out,Elastic:b.Easing.Elastic.Out,Back:b.Easing.Back.Out,Bounce:b.Easing.Bounce.Out,"Quad.easeIn":b.Easing.Quadratic.In,"Cubic.easeIn":b.Easing.Cubic.In,"Quart.easeIn":b.Easing.Quartic.In,"Quint.easeIn":b.Easing.Quintic.In,"Sine.easeIn":b.Easing.Sinusoidal.In,"Expo.easeIn":b.Easing.Exponential.In,"Circ.easeIn":b.Easing.Circular.In,
"Elastic.easeIn":b.Easing.Elastic.In,"Back.easeIn":b.Easing.Back.In,"Bounce.easeIn":b.Easing.Bounce.In,"Quad.easeOut":b.Easing.Quadratic.Out,"Cubic.easeOut":b.Easing.Cubic.Out,"Quart.easeOut":b.Easing.Quartic.Out,"Quint.easeOut":b.Easing.Quintic.Out,"Sine.easeOut":b.Easing.Sinusoidal.Out,"Expo.easeOut":b.Easing.Exponential.Out,"Circ.easeOut":b.Easing.Circular.Out,"Elastic.easeOut":b.Easing.Elastic.Out,"Back.easeOut":b.Easing.Back.Out,"Bounce.easeOut":b.Easing.Bounce.Out,"Quad.easeInOut":b.Easing.Quadratic.InOut,
"Cubic.easeInOut":b.Easing.Cubic.InOut,"Quart.easeInOut":b.Easing.Quartic.InOut,"Quint.easeInOut":b.Easing.Quintic.InOut,"Sine.easeInOut":b.Easing.Sinusoidal.InOut,"Expo.easeInOut":b.Easing.Exponential.InOut,"Circ.easeInOut":b.Easing.Circular.InOut,"Elastic.easeInOut":b.Easing.Elastic.InOut,"Back.easeInOut":b.Easing.Back.InOut,"Bounce.easeInOut":b.Easing.Bounce.InOut};this.game.onPause.add(this._pauseAll,this);this.game.onResume.add(this._resumeAll,this)};b.TweenManager.prototype={getAll:function(){return this._tweens},
removeAll:function(){for(var a=0;a<this._tweens.length;a++)this._tweens[a].pendingDelete=!0;this._add=[]},removeFrom:function(a,c){void 0===c&&(c=!0);var d,e;if(Array.isArray(a))for(d=0,e=a.length;d<e;d++)this.removeFrom(a[d]);else if(a.type===b.GROUP&&c)for(d=0,e=a.children.length;d<e;d++)this.removeFrom(a.children[d]);else{d=0;for(e=this._tweens.length;d<e;d++)a===this._tweens[d].target&&this.remove(this._tweens[d]);d=0;for(e=this._add.length;d<e;d++)a===this._add[d].target&&this.remove(this._add[d])}},
add:function(a){a._manager=this;this._add.push(a)},create:function(a){return new b.Tween(a,this.game,this)},remove:function(a){var c=this._tweens.indexOf(a);-1!==c?this._tweens[c].pendingDelete=!0:(c=this._add.indexOf(a),-1!==c&&(this._add[c].pendingDelete=!0))},update:function(){var a=this._add.length,c=this._tweens.length;if(0===c&&0===a)return!1;for(var b=0;b<c;)this._tweens[b].update(this.game.time.time)?b++:(this._tweens.splice(b,1),c--);0<a&&(this._tweens=this._tweens.concat(this._add),this._add.length=
0);return!0},isTweening:function(a){return this._tweens.some(function(c){return c.target===a})},_pauseAll:function(){for(var a=this._tweens.length-1;0<=a;a--)this._tweens[a]._pause()},_resumeAll:function(){for(var a=this._tweens.length-1;0<=a;a--)this._tweens[a]._resume()},pauseAll:function(){for(var a=this._tweens.length-1;0<=a;a--)this._tweens[a].pause()},resumeAll:function(){for(var a=this._tweens.length-1;0<=a;a--)this._tweens[a].resume(!0)}};b.TweenManager.prototype.constructor=b.TweenManager;
b.Tween=function(a,c,d){this.game=c;this.target=a;this.manager=d;this.timeline=[];this.reverse=!1;this.timeScale=1;this.repeatCounter=0;this.pendingDelete=!1;this.onStart=new b.Signal;this.onLoop=new b.Signal;this.onRepeat=new b.Signal;this.onChildComplete=new b.Signal;this.onComplete=new b.Signal;this.isRunning=!1;this.current=0;this.properties={};this.chainedTween=null;this.isPaused=!1;this.frameBased=d.frameBased;this._onUpdateCallbackContext=this._onUpdateCallback=null;this._pausedTime=0;this._hasStarted=
this._codePaused=!1};b.Tween.prototype={to:function(a,c,d,e,h,f,g){if(void 0===c||0>=c)c=1E3;if(void 0===d||null===d)d=b.Easing.Default;void 0===e&&(e=!1);void 0===h&&(h=0);void 0===f&&(f=0);void 0===g&&(g=!1);"string"===typeof d&&this.manager.easeMap[d]&&(d=this.manager.easeMap[d]);if(this.isRunning)return console.warn("Phaser.Tween.to cannot be called after Tween.start"),this;this.timeline.push((new b.TweenData(this)).to(a,c,d,h,f,g));e&&this.start();return this},from:function(a,c,d,e,h,f,g){void 0===
c&&(c=1E3);if(void 0===d||null===d)d=b.Easing.Default;void 0===e&&(e=!1);void 0===h&&(h=0);void 0===f&&(f=0);void 0===g&&(g=!1);"string"===typeof d&&this.manager.easeMap[d]&&(d=this.manager.easeMap[d]);if(this.isRunning)return console.warn("Phaser.Tween.from cannot be called after Tween.start"),this;this.timeline.push((new b.TweenData(this)).from(a,c,d,h,f,g));e&&this.start();return this},start:function(a){void 0===a&&(a=0);if(null===this.game||null===this.target||0===this.timeline.length||this.isRunning)return this;
for(var c=0;c<this.timeline.length;c++)for(var b in this.timeline[c].vEnd)this.properties[b]=this.target[b]||0,Array.isArray(this.properties[b])||(this.properties[b]*=1);for(c=0;c<this.timeline.length;c++)this.timeline[c].loadValues();this.manager.add(this);this.isRunning=!0;if(0>a||a>this.timeline.length-1)a=0;this.current=a;this.timeline[this.current].start();return this},stop:function(a){void 0===a&&(a=!1);this.isRunning=!1;this._onUpdateCallbackContext=this._onUpdateCallback=null;a&&(this.onComplete.dispatch(this.target,
this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start());this.manager.remove(this);return this},updateTweenData:function(a,c,b){if(0===this.timeline.length)return this;void 0===b&&(b=0);if(-1===b)for(b=0;b<this.timeline.length;b++)this.timeline[b][a]=c;else this.timeline[b][a]=c;return this},delay:function(a,c){return this.updateTweenData("delay",a,c)},repeat:function(a,c,b){void 0===c&&(c=0);this.updateTweenData("repeatCounter",a,b);return this.updateTweenData("repeatDelay",c,b)},
repeatDelay:function(a,c){return this.updateTweenData("repeatDelay",a,c)},yoyo:function(a,c,b){void 0===c&&(c=0);this.updateTweenData("yoyo",a,b);return this.updateTweenData("yoyoDelay",c,b)},yoyoDelay:function(a,c){return this.updateTweenData("yoyoDelay",a,c)},easing:function(a,c){"string"===typeof a&&this.manager.easeMap[a]&&(a=this.manager.easeMap[a]);return this.updateTweenData("easingFunction",a,c)},interpolation:function(a,c,d){void 0===c&&(c=b.Math);this.updateTweenData("interpolationFunction",
a,d);return this.updateTweenData("interpolationContext",c,d)},repeatAll:function(a){void 0===a&&(a=0);this.repeatCounter=a;return this},chain:function(){for(var a=arguments.length;a--;)0<a?arguments[a-1].chainedTween=arguments[a]:this.chainedTween=arguments[a];return this},loop:function(a){void 0===a&&(a=!0);this.repeatCounter=a?-1:0;return this},onUpdateCallback:function(a,c){this._onUpdateCallback=a;this._onUpdateCallbackContext=c;return this},pause:function(){this._codePaused=this.isPaused=!0;
this._pausedTime=this.game.time.time},_pause:function(){this._codePaused||(this.isPaused=!0,this._pausedTime=this.game.time.time)},resume:function(){if(this.isPaused){this._codePaused=this.isPaused=!1;for(var a=0;a<this.timeline.length;a++)this.timeline[a].isRunning||(this.timeline[a].startTime+=this.game.time.time-this._pausedTime)}},_resume:function(){this._codePaused||this.resume()},update:function(a){if(this.pendingDelete||!this.target)return!1;if(this.isPaused)return!0;a=this.timeline[this.current].update(a);
if(a===b.TweenData.PENDING)return!0;if(a===b.TweenData.RUNNING)return this._hasStarted||(this.onStart.dispatch(this.target,this),this._hasStarted=!0),null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current]),this.isRunning;if(a===b.TweenData.LOOPED)return-1===this.timeline[this.current].repeatCounter?this.onLoop.dispatch(this.target,this):this.onRepeat.dispatch(this.target,this),!0;if(a===b.TweenData.COMPLETE){a=
!1;this.reverse?(this.current--,0>this.current&&(this.current=this.timeline.length-1,a=!0)):(this.current++,this.current===this.timeline.length&&(this.current=0,a=!0));if(a){if(-1===this.repeatCounter)return this.timeline[this.current].start(),this.onLoop.dispatch(this.target,this),!0;if(0<this.repeatCounter)return this.repeatCounter--,this.timeline[this.current].start(),this.onRepeat.dispatch(this.target,this),!0;this.isRunning=!1;this.onComplete.dispatch(this.target,this);this._hasStarted=!1;this.chainedTween&&
this.chainedTween.start();return!1}this.onChildComplete.dispatch(this.target,this);this.timeline[this.current].start();return!0}},generateData:function(a,c){if(null===this.game||null===this.target)return null;void 0===a&&(a=60);void 0===c&&(c=[]);for(var b=0;b<this.timeline.length;b++)for(var e in this.timeline[b].vEnd)this.properties[e]=this.target[e]||0,Array.isArray(this.properties[e])||(this.properties[e]*=1);for(b=0;b<this.timeline.length;b++)this.timeline[b].loadValues();for(b=0;b<this.timeline.length;b++)c=
c.concat(this.timeline[b].generateData(a));return c}};Object.defineProperty(b.Tween.prototype,"totalDuration",{get:function(){for(var a=0,c=0;c<this.timeline.length;c++)a+=this.timeline[c].duration;return a}});b.Tween.prototype.constructor=b.Tween;b.TweenData=function(a){this.parent=a;this.game=a.game;this.vStart={};this.vStartCache={};this.vEnd={};this.vEndCache={};this.duration=1E3;this.repeatTotal=this.repeatDelay=this.repeatCounter=this.value=this.percent=0;this.yoyo=this.interpolate=!1;this.yoyoDelay=
0;this.inReverse=!1;this.dt=this.delay=0;this.startTime=null;this.easingFunction=b.Easing.Default;this.interpolationFunction=b.Math.linearInterpolation;this.interpolationContext=b.Math;this.isFrom=this.isRunning=!1};b.TweenData.PENDING=0;b.TweenData.RUNNING=1;b.TweenData.LOOPED=2;b.TweenData.COMPLETE=3;b.TweenData.prototype={to:function(a,c,b,e,h,f){this.vEnd=a;this.duration=c;this.easingFunction=b;this.delay=e;this.repeatTotal=h;this.yoyo=f;this.isFrom=!1;return this},from:function(a,c,b,e,h,f){this.vEnd=
a;this.duration=c;this.easingFunction=b;this.delay=e;this.repeatTotal=h;this.yoyo=f;this.isFrom=!0;return this},start:function(){this.startTime=this.game.time.time+this.delay;this.dt=this.parent.reverse?this.duration:0;this.isRunning=0<this.delay?!1:!0;if(this.isFrom)for(var a in this.vStartCache)this.vStart[a]=this.vEndCache[a],this.vEnd[a]=this.vStartCache[a],this.parent.target[a]=this.vStart[a];this.yoyoCounter=this.value=0;this.repeatCounter=this.repeatTotal;return this},loadValues:function(){for(var a in this.parent.properties){this.vStart[a]=
this.parent.properties[a];if(Array.isArray(this.vEnd[a])){if(0===this.vEnd[a].length)continue;0===this.percent&&(this.vEnd[a]=[this.vStart[a]].concat(this.vEnd[a]))}"undefined"!==typeof this.vEnd[a]?("string"===typeof this.vEnd[a]&&(this.vEnd[a]=this.vStart[a]+parseFloat(this.vEnd[a],10)),this.parent.properties[a]=this.vEnd[a]):this.vEnd[a]=this.vStart[a];this.vStartCache[a]=this.vStart[a];this.vEndCache[a]=this.vEnd[a]}return this},update:function(a){if(!this.isRunning)if(a>=this.startTime)this.isRunning=
!0;else return b.TweenData.PENDING;else if(a<this.startTime)return b.TweenData.RUNNING;a=this.parent.frameBased?this.game.time.physicsElapsedMS:this.game.time.elapsedMS;this.parent.reverse?(this.dt-=a*this.parent.timeScale,this.dt=Math.max(this.dt,0)):(this.dt+=a*this.parent.timeScale,this.dt=Math.min(this.dt,this.duration));this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);for(var c in this.vEnd){a=this.vStart[c];var d=this.vEnd[c];Array.isArray(d)?this.parent.target[c]=
this.interpolationFunction.call(this.interpolationContext,d,this.value):this.parent.target[c]=a+(d-a)*this.value}return!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent?this.repeat():b.TweenData.RUNNING},generateData:function(a){this.dt=this.parent.reverse?this.duration:0;var c=[],b=!1;a=1/a*1E3;do{this.parent.reverse?(this.dt-=a,this.dt=Math.max(this.dt,0)):(this.dt+=a,this.dt=Math.min(this.dt,this.duration));this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);
var e={},h;for(h in this.vEnd){var f=this.vStart[h],g=this.vEnd[h];Array.isArray(g)?e[h]=this.interpolationFunction(g,this.value):e[h]=f+(g-f)*this.value}c.push(e);if(!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent)b=!0}while(!b);this.yoyo&&(b=c.slice(),b.reverse(),c=c.concat(b));return c},repeat:function(){if(this.yoyo){if(this.inReverse&&0===this.repeatCounter){for(var a in this.vStartCache)this.vStart[a]=this.vStartCache[a],this.vEnd[a]=this.vEndCache[a];this.inReverse=
!1;return b.TweenData.COMPLETE}this.inReverse=!this.inReverse}else if(0===this.repeatCounter)return b.TweenData.COMPLETE;if(this.inReverse)for(a in this.vStartCache)this.vStart[a]=this.vEndCache[a],this.vEnd[a]=this.vStartCache[a];else{for(a in this.vStartCache)this.vStart[a]=this.vStartCache[a],this.vEnd[a]=this.vEndCache[a];0<this.repeatCounter&&this.repeatCounter--}this.startTime=this.game.time.time;this.yoyo&&this.inReverse?this.startTime+=this.yoyoDelay:this.inReverse||(this.startTime+=this.repeatDelay);
this.dt=this.parent.reverse?this.duration:0;return b.TweenData.LOOPED}};b.TweenData.prototype.constructor=b.TweenData;b.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*
a},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 0===a?0:1===a?1:1-Math.cos(a*Math.PI/2)},Out:function(a){return 0===a?0:1===a?1:Math.sin(a*Math.PI/2)},InOut:function(a){return 0===a?0:1===a?1:.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===
a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){var c,b=.1;if(0===a)return 0;if(1===a)return 1;!b||1>b?(b=1,c=.1):c=.4*Math.asin(1/b)/(2*Math.PI);return-(b*Math.pow(2,10*--a)*Math.sin(2*(a-c)*Math.PI/.4))},Out:function(a){var c,
b=.1;if(0===a)return 0;if(1===a)return 1;!b||1>b?(b=1,c=.1):c=.4*Math.asin(1/b)/(2*Math.PI);return b*Math.pow(2,-10*a)*Math.sin(2*(a-c)*Math.PI/.4)+1},InOut:function(a){var c,b=.1;if(0===a)return 0;if(1===a)return 1;!b||1>b?(b=1,c=.1):c=.4*Math.asin(1/b)/(2*Math.PI);return 1>(a*=2)?-.5*b*Math.pow(2,10*--a)*Math.sin(2*(a-c)*Math.PI/.4):b*Math.pow(2,-10*--a)*Math.sin(2*(a-c)*Math.PI/.4)*.5+1}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>
(a*=2)?.5*a*a*(3.5949095*a-2.5949095):.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)}},Bounce:{In:function(a){return 1-b.Easing.Bounce.Out(1-a)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*b.Easing.Bounce.In(2*a):.5*b.Easing.Bounce.Out(2*a-1)+.5}}};b.Easing.Default=b.Easing.Linear.None;b.Easing.Power0=b.Easing.Linear.None;b.Easing.Power1=b.Easing.Quadratic.Out;b.Easing.Power2=
b.Easing.Cubic.Out;b.Easing.Power3=b.Easing.Quartic.Out;b.Easing.Power4=b.Easing.Quintic.Out;b.Time=function(a){this.game=a;this.elapsedMS=this.elapsed=this.now=this.prevTime=this.time=0;this.physicsElapsed=1/60;this.physicsElapsedMS=1/60*1E3;this.desiredFpsMult=1/60;this._desiredFps=60;this.suggestedFps=this.desiredFps;this.slowMotion=1;this.advancedTiming=!1;this.fps=this.frames=0;this.fpsMin=1E3;this.fpsMax=0;this.msMin=1E3;this.timeExpected=this.timeToCall=this.pauseDuration=this.msMax=0;this.events=
new b.Timer(this.game,!1);this._pauseStarted=this._timeLastSecond=this._started=this._elapsedAccumulator=this._frameCount=0;this._justResumed=!1;this._timers=[]};b.Time.prototype={boot:function(){this._started=Date.now();this.time=Date.now();this.events.start();this.timeExpected=this.time},add:function(a){this._timers.push(a);return a},create:function(a){void 0===a&&(a=!0);a=new b.Timer(this.game,a);this._timers.push(a);return a},removeAll:function(){for(var a=0;a<this._timers.length;a++)this._timers[a].destroy();
this._timers=[];this.events.removeAll()},refresh:function(){var a=this.time;this.time=Date.now();this.elapsedMS=this.time-a},update:function(a){var c=this.time;this.time=Date.now();this.elapsedMS=this.time-c;this.prevTime=this.now;this.now=a;this.elapsed=this.now-this.prevTime;this.game.raf._isSetTimeOut&&(this.timeToCall=Math.floor(Math.max(0,1E3/this._desiredFps-(this.timeExpected-a))),this.timeExpected=a+this.timeToCall);this.advancedTiming&&this.updateAdvancedTiming();this.game.paused||(this.events.update(this.time),
this._timers.length&&this.updateTimers())},updateTimers:function(){for(var a=0,c=this._timers.length;a<c;)this._timers[a].update(this.time)?a++:(this._timers.splice(a,1),c--)},updateAdvancedTiming:function(){this._frameCount++;this._elapsedAccumulator+=this.elapsed;this._frameCount>=2*this._desiredFps&&(this.suggestedFps=5*Math.floor(200/(this._elapsedAccumulator/this._frameCount)),this._elapsedAccumulator=this._frameCount=0);this.msMin=Math.min(this.msMin,this.elapsed);this.msMax=Math.max(this.msMax,
this.elapsed);this.frames++;this.now>this._timeLastSecond+1E3&&(this.fps=Math.round(1E3*this.frames/(this.now-this._timeLastSecond)),this.fpsMin=Math.min(this.fpsMin,this.fps),this.fpsMax=Math.max(this.fpsMax,this.fps),this._timeLastSecond=this.now,this.frames=0)},gamePaused:function(){this._pauseStarted=Date.now();this.events.pause();for(var a=this._timers.length;a--;)this._timers[a]._pause()},gameResumed:function(){this.time=Date.now();this.pauseDuration=this.time-this._pauseStarted;this.events.resume();
for(var a=this._timers.length;a--;)this._timers[a]._resume()},totalElapsedSeconds:function(){return.001*(this.time-this._started)},elapsedSince:function(a){return this.time-a},elapsedSecondsSince:function(a){return.001*(this.time-a)},reset:function(){this._started=this.time;this.removeAll()}};Object.defineProperty(b.Time.prototype,"desiredFps",{get:function(){return this._desiredFps},set:function(a){this._desiredFps=a;this.physicsElapsed=1/a;this.physicsElapsedMS=1E3*this.physicsElapsed;this.desiredFpsMult=
1/a}});b.Time.prototype.constructor=b.Time;b.Timer=function(a,c){void 0===c&&(c=!0);this.game=a;this.running=!1;this.autoDestroy=c;this.expired=!1;this.elapsed=0;this.events=[];this.onComplete=new b.Signal;this.nextTick=0;this.timeCap=1E3;this._codePaused=this.paused=!1;this._pauseTotal=this._pauseStarted=this._started=0;this._now=Date.now();this._newTick=this._diff=this._i=this._marked=this._len=0};b.Timer.MINUTE=6E4;b.Timer.SECOND=1E3;b.Timer.HALF=500;b.Timer.QUARTER=250;b.Timer.prototype={create:function(a,
c,d,e,h,f){var l=a=Math.round(a),l=0===this._now?l+this.game.time.time:l+this._now;a=new b.TimerEvent(this,a,l,d,c,e,h,f);this.events.push(a);this.order();this.expired=!1;return a},add:function(a,c,b){return this.create(a,!1,0,c,b,Array.prototype.slice.call(arguments,3))},repeat:function(a,c,b,e){return this.create(a,!1,c,b,e,Array.prototype.slice.call(arguments,4))},loop:function(a,c,b){return this.create(a,!0,0,c,b,Array.prototype.slice.call(arguments,3))},start:function(a){if(!this.running)for(this._started=
this.game.time.time+(a||0),this.running=!0,a=0;a<this.events.length;a++)this.events[a].tick=this.events[a].delay+this._started},stop:function(a){this.running=!1;void 0===a&&(a=!0);a&&(this.events.length=0)},remove:function(a){for(var c=0;c<this.events.length;c++)if(this.events[c]===a)return this.events[c].pendingDelete=!0;return!1},order:function(){0<this.events.length&&(this.events.sort(this.sortHandler),this.nextTick=this.events[0].tick)},sortHandler:function(a,c){return a.tick<c.tick?-1:a.tick>
c.tick?1:0},clearPendingEvents:function(){for(this._i=this.events.length;this._i--;)this.events[this._i].pendingDelete&&this.events.splice(this._i,1);this._len=this.events.length;this._i=0},update:function(a){if(this.paused)return!0;this.elapsed=a-this._now;this._now=a;this.elapsed>this.timeCap&&this.adjustEvents(a-this.elapsed);this._marked=0;this.clearPendingEvents();if(this.running&&this._now>=this.nextTick&&0<this._len){for(;this._i<this._len&&this.running;)if(this._now>=this.events[this._i].tick&&
!this.events[this._i].pendingDelete)this._newTick=this._now+this.events[this._i].delay-(this._now-this.events[this._i].tick),0>this._newTick&&(this._newTick=this._now+this.events[this._i].delay),!0===this.events[this._i].loop?this.events[this._i].tick=this._newTick:0<this.events[this._i].repeatCount?(this.events[this._i].repeatCount--,this.events[this._i].tick=this._newTick):(this._marked++,this.events[this._i].pendingDelete=!0),this.events[this._i].callback.apply(this.events[this._i].callbackContext,
this.events[this._i].args),this._i++;else break;this.events.length>this._marked?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return this.expired&&this.autoDestroy?!1:!0},pause:function(){this.running&&(this._codePaused=!0,this.paused||(this._pauseStarted=this.game.time.time,this.paused=!0))},_pause:function(){!this.paused&&this.running&&(this._pauseStarted=this.game.time.time,this.paused=!0)},adjustEvents:function(a){for(var c=0;c<this.events.length;c++)if(!this.events[c].pendingDelete){var b=
this.events[c].tick-a;0>b&&(b=0);this.events[c].tick=this._now+b}a=this.nextTick-a;this.nextTick=0>a?this._now:this._now+a},resume:function(){if(this.paused){var a=this.game.time.time;this._pauseTotal+=a-this._now;this._now=a;this.adjustEvents(this._pauseStarted);this._codePaused=this.paused=!1}},_resume:function(){this._codePaused||this.resume()},removeAll:function(){this.onComplete.removeAll();this._i=this._len=this.events.length=0},destroy:function(){this.onComplete.removeAll();this.running=!1;
this.events=[];this._i=this._len=0}};Object.defineProperty(b.Timer.prototype,"next",{get:function(){return this.nextTick}});Object.defineProperty(b.Timer.prototype,"duration",{get:function(){return this.running&&this.nextTick>this._now?this.nextTick-this._now:0}});Object.defineProperty(b.Timer.prototype,"length",{get:function(){return this.events.length}});Object.defineProperty(b.Timer.prototype,"ms",{get:function(){return this.running?this._now-this._started-this._pauseTotal:0}});Object.defineProperty(b.Timer.prototype,
"seconds",{get:function(){return this.running?.001*this.ms:0}});b.Timer.prototype.constructor=b.Timer;b.TimerEvent=function(a,c,b,e,h,f,g,k){this.timer=a;this.delay=c;this.tick=b;this.repeatCount=e-1;this.loop=h;this.callback=f;this.callbackContext=g;this.args=k;this.pendingDelete=!1};b.TimerEvent.prototype.constructor=b.TimerEvent;b.AnimationManager=function(a){this.sprite=a;this.game=a.game;this.currentAnim=this.currentFrame=null;this.updateIfVisible=!0;this.isLoaded=!1;this._frameData=null;this._anims=
{};this._outputFrames=[]};b.AnimationManager.prototype={loadFrameData:function(a,c){if(void 0===a)return!1;if(this.isLoaded)for(var b in this._anims)this._anims[b].updateFrameData(a);this._frameData=a;void 0===c||null===c?this.frame=0:"string"===typeof c?this.frameName=c:this.frame=c;return this.isLoaded=!0},copyFrameData:function(a,c){this._frameData=a.clone();if(this.isLoaded)for(var b in this._anims)this._anims[b].updateFrameData(this._frameData);void 0===c||null===c?this.frame=0:"string"===typeof c?
this.frameName=c:this.frame=c;return this.isLoaded=!0},add:function(a,c,d,e,h){c=c||[];d=d||60;void 0===e&&(e=!1);void 0===h&&(h=c&&"number"===typeof c[0]?!0:!1);this._outputFrames=[];this._frameData.getFrameIndexes(c,h,this._outputFrames);this._anims[a]=new b.Animation(this.game,this.sprite,a,this._frameData,this._outputFrames,d,e);this.currentAnim=this._anims[a];this.sprite.tilingTexture&&(this.sprite.refreshTexture=!0);return this._anims[a]},validateFrames:function(a,c){void 0===c&&(c=!0);for(var b=
0;b<a.length;b++)if(!0===c){if(a[b]>this._frameData.total)return!1}else if(!1===this._frameData.checkFrameName(a[b]))return!1;return!0},play:function(a,c,b,e){if(this._anims[a]){if(this.currentAnim===this._anims[a])return!1===this.currentAnim.isPlaying?(this.currentAnim.paused=!1,this.currentAnim.play(c,b,e)):this.currentAnim;this.currentAnim&&this.currentAnim.isPlaying&&this.currentAnim.stop();this.currentAnim=this._anims[a];this.currentAnim.paused=!1;this.currentFrame=this.currentAnim.currentFrame;
return this.currentAnim.play(c,b,e)}},stop:function(a,c){void 0===c&&(c=!1);!this.currentAnim||"string"===typeof a&&a!==this.currentAnim.name||this.currentAnim.stop(c)},update:function(){return this.updateIfVisible&&!this.sprite.visible?!1:this.currentAnim&&this.currentAnim.update()?(this.currentFrame=this.currentAnim.currentFrame,!0):!1},next:function(a){this.currentAnim&&(this.currentAnim.next(a),this.currentFrame=this.currentAnim.currentFrame)},previous:function(a){this.currentAnim&&(this.currentAnim.previous(a),
this.currentFrame=this.currentAnim.currentFrame)},getAnimation:function(a){return"string"===typeof a&&this._anims[a]?this._anims[a]:null},refreshFrame:function(){},destroy:function(){var a=null;for(a in this._anims)this._anims.hasOwnProperty(a)&&this._anims[a].destroy();this._anims={};this._outputFrames=[];this.game=this.sprite=this.currentFrame=this.currentAnim=this._frameData=null}};b.AnimationManager.prototype.constructor=b.AnimationManager;Object.defineProperty(b.AnimationManager.prototype,"frameData",
{get:function(){return this._frameData}});Object.defineProperty(b.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}});Object.defineProperty(b.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(a){this.currentAnim.paused=a}});Object.defineProperty(b.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim)return this.currentAnim.name}});Object.defineProperty(b.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame)return this.currentFrame.index},
set:function(a){"number"===typeof a&&this._frameData&&null!==this._frameData.getFrame(a)&&(this.currentFrame=this._frameData.getFrame(a))&&this.sprite.setFrame(this.currentFrame)}});Object.defineProperty(b.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame)return this.currentFrame.name},set:function(a){if("string"===typeof a&&this._frameData&&null!==this._frameData.getFrameByName(a)){if(this.currentFrame=this._frameData.getFrameByName(a))this._frameIndex=this.currentFrame.index,
this.sprite.setFrame(this.currentFrame)}else console.warn("Cannot set frameName: "+a)}});b.Animation=function(a,c,d,e,h,f,g){void 0===g&&(g=!1);this.game=a;this._parent=c;this._frameData=e;this.name=d;this._frames=[];this._frames=this._frames.concat(h);this.delay=1E3/f;this.loop=g;this.loopCount=0;this.isPaused=this.isPlaying=this.isFinished=this.killOnComplete=!1;this._frameDiff=this._frameIndex=this._pauseStartTime=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);
this.onStart=new b.Signal;this.onUpdate=null;this.onComplete=new b.Signal;this.onLoop=new b.Signal;this.isReversed=!1;this.game.onPause.add(this.onPause,this);this.game.onResume.add(this.onResume,this)};b.Animation.prototype={play:function(a,c,b){"number"===typeof a&&(this.delay=1E3/a);"boolean"===typeof c&&(this.loop=c);"undefined"!==typeof b&&(this.killOnComplete=b);this.isPlaying=!0;this.paused=this.isFinished=!1;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+
this.delay;this._frameIndex=this.isReversed?this._frames.length-1:0;this.updateCurrentFrame(!1,!0);this._parent.events.onAnimationStart$dispatch(this._parent,this);this.onStart.dispatch(this._parent,this);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;return this},restart:function(){this.isPlaying=!0;this.paused=this.isFinished=!1;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=
0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setFrame(this.currentFrame);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;this.onStart.dispatch(this._parent,this)},reverse:function(){this.reversed=!this.reversed;return this},reverseOnce:function(){this.onComplete.addOnce(this.reverse,this);return this.reverse()},setFrame:function(a,c){var b;void 0===c&&(c=!1);if("string"===typeof a)for(var e=0;e<this._frames.length;e++)this._frameData.getFrame(this._frames[e]).name===
a&&(b=e);else if("number"===typeof a)if(c)b=a;else for(e=0;e<this._frames.length;e++)this._frames[e]===a&&(b=e);b&&(this._frameIndex=b-1,this._timeNextFrame=this.game.time.time,this.update())},stop:function(a,c){void 0===a&&(a=!1);void 0===c&&(c=!1);this.isPlaying=!1;this.isFinished=!0;this.paused=!1;a&&(this.currentFrame=this._frameData.getFrame(this._frames[0]),this._parent.setFrame(this.currentFrame));c&&(this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,
this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.time)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.time+this._frameDiff)},update:function(){if(this.isPaused)return!1;if(this.isPlaying&&this.game.time.time>=this._timeNextFrame)if(this._frameSkip=1,this._frameDiff=this.game.time.time-this._timeNextFrame,this._timeLastFrame=this.game.time.time,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),
this._frameDiff-=this._frameSkip*this.delay),this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff),this._frameIndex=this.isReversed?this._frameIndex-this._frameSkip:this._frameIndex+this._frameSkip,!this.isReversed&&this._frameIndex>=this._frames.length||this.isReversed&&-1>=this._frameIndex){if(this.loop)return this._frameIndex=Math.abs(this._frameIndex)%this._frames.length,this.isReversed&&(this._frameIndex=this._frames.length-1-this._frameIndex),(this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]))&&
this._parent.setFrame(this.currentFrame),this.loopCount++,this._parent.events.onAnimationLoop$dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this),this.onUpdate?(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData):!0;this.complete()}else return this.updateCurrentFrame(!0);return!1},updateCurrentFrame:function(a,c){void 0===c&&(c=!1);if(!this._frameData)return!1;var b=this.currentFrame.index;(this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]))&&
(c||!c&&b!==this.currentFrame.index)&&this._parent.setFrame(this.currentFrame);return this.onUpdate&&a?(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData):!0},next:function(a){void 0===a&&(a=1);a=this._frameIndex+a;a>=this._frames.length&&(a=this.loop?a%this._frames.length:this._frames.length-1);a!==this._frameIndex&&(this._frameIndex=a,this.updateCurrentFrame(!0))},previous:function(a){void 0===a&&(a=1);a=this._frameIndex-a;0>a&&(this.loop?a=this._frames.length+a:a++);a!==this._frameIndex&&
(this._frameIndex=a,this.updateCurrentFrame(!0))},updateFrameData:function(a){this.currentFrame=(this._frameData=a)?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){this._frameData&&(this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.currentFrame=this._frameData=this._frames=this._parent=this.game=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&
this.onUpdate.dispose())},complete:function(){this._frameIndex=this._frames.length-1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.isPlaying=!1;this.isFinished=!0;this.paused=!1;this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this);this.killOnComplete&&this._parent.kill()}};b.Animation.prototype.constructor=b.Animation;Object.defineProperty(b.Animation.prototype,"paused",{get:function(){return this.isPaused},
set:function(a){(this.isPaused=a)?this._pauseStartTime=this.game.time.time:this.isPlaying&&(this._timeNextFrame=this.game.time.time+this.delay)}});Object.defineProperty(b.Animation.prototype,"reversed",{get:function(){return this.isReversed},set:function(a){this.isReversed=a}});Object.defineProperty(b.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}});Object.defineProperty(b.Animation.prototype,"frame",{get:function(){return null!==this.currentFrame?this.currentFrame.index:
this._frameIndex},set:function(a){this.currentFrame=this._frameData.getFrame(this._frames[a]);null!==this.currentFrame&&(this._frameIndex=a,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}});Object.defineProperty(b.Animation.prototype,"speed",{get:function(){return 1E3/this.delay},set:function(a){0<a&&(this.delay=1E3/a)}});Object.defineProperty(b.Animation.prototype,"enableUpdate",{get:function(){return null!==this.onUpdate},set:function(a){a&&
null===this.onUpdate?this.onUpdate=new b.Signal:a||null===this.onUpdate||(this.onUpdate.dispose(),this.onUpdate=null)}});b.Animation.generateFrameNames=function(a,c,d,e,h){void 0===e&&(e="");var f=[];if(c<d)for(var g=c;g<=d;g++)c="number"===typeof h?b.Utils.pad(g.toString(),h,"0",1):g.toString(),c=a+c+e,f.push(c);else for(g=c;g>=d;g--)c="number"===typeof h?b.Utils.pad(g.toString(),h,"0",1):g.toString(),c=a+c+e,f.push(c);return f};b.Frame=function(a,c,d,e,h,f){this.index=a;this.x=c;this.y=d;this.width=
e;this.height=h;this.name=f;this.centerX=Math.floor(e/2);this.centerY=Math.floor(h/2);this.distance=b.Math.distance(0,0,e,h);this.rotated=!1;this.rotationDirection="cw";this.trimmed=!1;this.sourceSizeW=e;this.sourceSizeH=h;this.spriteSourceSizeH=this.spriteSourceSizeW=this.spriteSourceSizeY=this.spriteSourceSizeX=0;this.right=this.x+this.width;this.bottom=this.y+this.height};b.Frame.prototype={resize:function(a,c){this.width=a;this.height=c;this.centerX=Math.floor(a/2);this.centerY=Math.floor(c/2);
this.distance=b.Math.distance(0,0,a,c);this.sourceSizeW=a;this.sourceSizeH=c;this.right=this.x+a;this.bottom=this.y+c},setTrim:function(a,c,b,e,h,f,g){if(this.trimmed=a)this.sourceSizeW=c,this.sourceSizeH=b,this.centerX=Math.floor(c/2),this.centerY=Math.floor(b/2),this.spriteSourceSizeX=e,this.spriteSourceSizeY=h,this.spriteSourceSizeW=f,this.spriteSourceSizeH=g},clone:function(){var a=new b.Frame(this.index,this.x,this.y,this.width,this.height,this.name),c;for(c in this)this.hasOwnProperty(c)&&(a[c]=
this[c]);return a},getRect:function(a){void 0===a?a=new b.Rectangle(this.x,this.y,this.width,this.height):a.setTo(this.x,this.y,this.width,this.height);return a}};b.Frame.prototype.constructor=b.Frame;b.FrameData=function(){this._frames=[];this._frameNames=[]};b.FrameData.prototype={addFrame:function(a){a.index=this._frames.length;this._frames.push(a);""!==a.name&&(this._frameNames[a.name]=a.index);return a},getFrame:function(a){a>=this._frames.length&&(a=0);return this._frames[a]},getFrameByName:function(a){return"number"===
typeof this._frameNames[a]?this._frames[this._frameNames[a]]:null},checkFrameName:function(a){return null==this._frameNames[a]?!1:!0},clone:function(){for(var a=new b.FrameData,c=0;c<this._frames.length;c++)a._frames.push(this._frames[c].clone());for(var d in this._frameNames)this._frameNames.hasOwnProperty(d)&&a._frameNames.push(this._frameNames[d]);return a},getFrameRange:function(a,c,b){for(void 0===b&&(b=[]);a<=c;a++)b.push(this._frames[a]);return b},getFrames:function(a,c,b){void 0===c&&(c=!0);
void 0===b&&(b=[]);if(void 0===a||0===a.length)for(var d=0;d<this._frames.length;d++)b.push(this._frames[d]);else for(d=0;d<a.length;d++)c?b.push(this.getFrame(a[d])):b.push(this.getFrameByName(a[d]));return b},getFrameIndexes:function(a,c,b){void 0===c&&(c=!0);void 0===b&&(b=[]);if(void 0===a||0===a.length)for(var d=0;d<this._frames.length;d++)b.push(this._frames[d].index);else for(d=0;d<a.length;d++)c&&this._frames[a[d]]?b.push(this._frames[a[d]].index):this.getFrameByName(a[d])&&b.push(this.getFrameByName(a[d]).index);
return b},destroy:function(){this._frameNames=this._frames=null}};b.FrameData.prototype.constructor=b.FrameData;Object.defineProperty(b.FrameData.prototype,"total",{get:function(){return this._frames.length}});b.AnimationParser={spriteSheet:function(a,c,d,e,h,f,g){var l=c;"string"===typeof c&&(l=a.cache.getImage(c));if(null===l)return null;a=l.width;var k=l.height;0>=d&&(d=Math.floor(-a/Math.min(-1,d)));0>=e&&(e=Math.floor(-k/Math.min(-1,e)));l=Math.floor((a-f)/(d+g))*Math.floor((k-f)/(e+g));-1!==
h&&(l=h);if(0===a||0===k||a<d||k<e||0===l)return console.warn("Phaser.AnimationParser.spriteSheet: '"+c+"'s width/height zero or width/height < given frameWidth/frameHeight"),null;c=new b.FrameData;for(var k=h=f,m=0;m<l;m++)c.addFrame(new b.Frame(m,h,k,d,e,"")),h+=d+g,h+d>a&&(h=f,k+=e+g);return c},JSONData:function(a,c){if(c.frames){for(var d=new b.FrameData,e=c.frames,h,f=0;f<e.length;f++)h=d.addFrame(new b.Frame(f,e[f].frame.x,e[f].frame.y,e[f].frame.w,e[f].frame.h,e[f].filename)),e[f].trimmed&&
h.setTrim(e[f].trimmed,e[f].sourceSize.w,e[f].sourceSize.h,e[f].spriteSourceSize.x,e[f].spriteSourceSize.y,e[f].spriteSourceSize.w,e[f].spriteSourceSize.h);return d}console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array");console.log(c)},JSONDataPyxel:function(a,c){["layers","tilewidth","tileheight","tileswide","tileshigh"].forEach(function(a){c[a]||(console.warn('Phaser.AnimationParser.JSONDataPyxel: Invalid Pyxel Tilemap JSON given, missing "'+a+
'" key.'),console.log(c))});if(1!==c.layers.length)console.warn("Phaser.AnimationParser.JSONDataPyxel: Too many layers, this parser only supports flat Tilemaps."),console.log(c);else{for(var d=new b.FrameData,e=c.tileheight,h=c.tilewidth,f=c.layers[0].tiles,g,k=0;k<f.length;k++)g=d.addFrame(new b.Frame(k,f[k].x,f[k].y,h,e,"frame_"+k)),g.setTrim(!1);return d}},JSONDataHash:function(a,c){if(c.frames){var d=new b.FrameData,e=c.frames,h,f=0,g;for(g in e)h=d.addFrame(new b.Frame(f,e[g].frame.x,e[g].frame.y,
e[g].frame.w,e[g].frame.h,g)),e[g].trimmed&&h.setTrim(e[g].trimmed,e[g].sourceSize.w,e[g].sourceSize.h,e[g].spriteSourceSize.x,e[g].spriteSourceSize.y,e[g].spriteSourceSize.w,e[g].spriteSourceSize.h),f++;return d}console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object");console.log(c)},XMLData:function(a,c){if(c.getElementsByTagName("TextureAtlas")){for(var d=new b.FrameData,e=c.getElementsByTagName("SubTexture"),h,f,g,k,m,n,p,w,u,x,z=0;z<e.length;z++)f=
e[z].attributes,h=f.name.value,g=parseInt(f.x.value,10),k=parseInt(f.y.value,10),m=parseInt(f.width.value,10),n=parseInt(f.height.value,10),w=p=null,f.frameX&&(p=Math.abs(parseInt(f.frameX.value,10)),w=Math.abs(parseInt(f.frameY.value,10)),u=parseInt(f.frameWidth.value,10),x=parseInt(f.frameHeight.value,10)),h=d.addFrame(new b.Frame(z,g,k,m,n,h)),null===p&&null===w||h.setTrim(!0,m,n,p,w,u,x);return d}console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag")}};
b.Cache=function(a){this.game=a;this.autoResolveURL=!1;this._cache={canvas:{},image:{},texture:{},sound:{},video:{},text:{},json:{},xml:{},physics:{},tilemap:{},binary:{},bitmapData:{},bitmapFont:{},shader:{},renderTexture:{}};this._urlMap={};this._urlResolver=new Image;this._urlTemp=null;this.onSoundUnlock=new b.Signal;this._cacheMap=[];this._cacheMap[b.Cache.CANVAS]=this._cache.canvas;this._cacheMap[b.Cache.IMAGE]=this._cache.image;this._cacheMap[b.Cache.TEXTURE]=this._cache.texture;this._cacheMap[b.Cache.SOUND]=
this._cache.sound;this._cacheMap[b.Cache.TEXT]=this._cache.text;this._cacheMap[b.Cache.PHYSICS]=this._cache.physics;this._cacheMap[b.Cache.TILEMAP]=this._cache.tilemap;this._cacheMap[b.Cache.BINARY]=this._cache.binary;this._cacheMap[b.Cache.BITMAPDATA]=this._cache.bitmapData;this._cacheMap[b.Cache.BITMAPFONT]=this._cache.bitmapFont;this._cacheMap[b.Cache.JSON]=this._cache.json;this._cacheMap[b.Cache.XML]=this._cache.xml;this._cacheMap[b.Cache.VIDEO]=this._cache.video;this._cacheMap[b.Cache.SHADER]=
this._cache.shader;this._cacheMap[b.Cache.RENDER_TEXTURE]=this._cache.renderTexture;this.addDefaultImage();this.addMissingImage()};b.Cache.CANVAS=1;b.Cache.IMAGE=2;b.Cache.TEXTURE=3;b.Cache.SOUND=4;b.Cache.TEXT=5;b.Cache.PHYSICS=6;b.Cache.TILEMAP=7;b.Cache.BINARY=8;b.Cache.BITMAPDATA=9;b.Cache.BITMAPFONT=10;b.Cache.JSON=11;b.Cache.XML=12;b.Cache.VIDEO=13;b.Cache.SHADER=14;b.Cache.RENDER_TEXTURE=15;b.Cache.DEFAULT=null;b.Cache.MISSING=null;b.Cache.prototype={addCanvas:function(a,c,b){void 0===b&&(b=
c.getContext("2d"));this._cache.canvas[a]={canvas:c,context:b}},addImage:function(a,c,d){this.checkImageKey(a)&&this.removeImage(a);var e={key:a,url:c,data:d,base:new PIXI.BaseTexture(d),frame:new b.Frame(0,0,0,d.width,d.height,a),frameData:new b.FrameData};e.frameData.addFrame(new b.Frame(0,0,0,d.width,d.height,c));this._cache.image[a]=e;this._resolveURL(c,e);"__default"===a?b.Cache.DEFAULT=new PIXI.Texture(e.base):"__missing"===a&&(b.Cache.MISSING=new PIXI.Texture(e.base));return e},addDefaultImage:function(){var a=
new Image;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";a=this.addImage("__default",null,a);a.base.skipRender=!0;b.Cache.DEFAULT=new PIXI.Texture(a.base)},addMissingImage:function(){var a=new Image;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";
a=this.addImage("__missing",null,a);b.Cache.MISSING=new PIXI.Texture(a.base)},addSound:function(a,c,b,e,h){void 0===e&&(e=!0,h=!1);void 0===h&&(e=!1,h=!0);var d=!1;h&&(d=!0);this._cache.sound[a]={url:c,data:b,isDecoding:!1,decoded:d,webAudio:e,audioTag:h,locked:this.game.sound.touchLocked};this._resolveURL(c,this._cache.sound[a])},addText:function(a,c,b){this._cache.text[a]={url:c,data:b};this._resolveURL(c,this._cache.text[a])},addPhysicsData:function(a,c,b,e){this._cache.physics[a]={url:c,data:b,
format:e};this._resolveURL(c,this._cache.physics[a])},addTilemap:function(a,c,b,e){this._cache.tilemap[a]={url:c,data:b,format:e};this._resolveURL(c,this._cache.tilemap[a])},addBinary:function(a,c){this._cache.binary[a]=c},addBitmapData:function(a,c,d){c.key=a;void 0===d&&(d=new b.FrameData,d.addFrame(c.textureFrame));this._cache.bitmapData[a]={data:c,frameData:d};return c},addBitmapFont:function(a,c,d,e,h,f,g){d={url:c,data:d,font:null,base:new PIXI.BaseTexture(d)};void 0===f&&(f=0);void 0===g&&
(g=0);d.font="json"===h?b.LoaderParser.jsonBitmapFont(e,d.base,f,g):b.LoaderParser.xmlBitmapFont(e,d.base,f,g);this._cache.bitmapFont[a]=d;this._resolveURL(c,d)},addJSON:function(a,c,b){this._cache.json[a]={url:c,data:b};this._resolveURL(c,this._cache.json[a])},addXML:function(a,c,b){this._cache.xml[a]={url:c,data:b};this._resolveURL(c,this._cache.xml[a])},addVideo:function(a,c,b,e){this._cache.video[a]={url:c,data:b,isBlob:e,locked:!0};this._resolveURL(c,this._cache.video[a])},addShader:function(a,
c,b){this._cache.shader[a]={url:c,data:b};this._resolveURL(c,this._cache.shader[a])},addRenderTexture:function(a,c){this._cache.renderTexture[a]={texture:c,frame:new b.Frame(0,0,0,c.width,c.height,"","")}},addSpriteSheet:function(a,c,d,e,h,f,g,k){void 0===f&&(f=-1);void 0===g&&(g=0);void 0===k&&(k=0);d={key:a,url:c,data:d,frameWidth:e,frameHeight:h,margin:g,spacing:k,base:new PIXI.BaseTexture(d),frameData:b.AnimationParser.spriteSheet(this.game,d,e,h,f,g,k)};this._cache.image[a]=d;this._resolveURL(c,
d)},addTextureAtlas:function(a,c,d,e,h){d={key:a,url:c,data:d,base:new PIXI.BaseTexture(d)};h===b.Loader.TEXTURE_ATLAS_XML_STARLING?d.frameData=b.AnimationParser.XMLData(this.game,e,a):h===b.Loader.TEXTURE_ATLAS_JSON_PYXEL?d.frameData=b.AnimationParser.JSONDataPyxel(this.game,e,a):Array.isArray(e.frames)?d.frameData=b.AnimationParser.JSONData(this.game,e,a):d.frameData=b.AnimationParser.JSONDataHash(this.game,e,a);this._cache.image[a]=d;this._resolveURL(c,d)},reloadSound:function(a){var c=this,b=
this.getSound(a);b&&(b.data.src=b.url,b.data.addEventListener("canplaythrough",function(){return c.reloadSoundComplete(a)},!1),b.data.load())},reloadSoundComplete:function(a){var c=this.getSound(a);c&&(c.locked=!1,this.onSoundUnlock.dispatch(a))},updateSound:function(a,c,b){(a=this.getSound(a))&&(a[c]=b)},decodedSound:function(a,c){var b=this.getSound(a);b.data=c;b.decoded=!0;b.isDecoding=!1},isSoundDecoded:function(a){if(a=this.getItem(a,b.Cache.SOUND,"isSoundDecoded"))return a.decoded},isSoundReady:function(a){if(a=
this.getItem(a,b.Cache.SOUND,"isSoundDecoded"))return a.decoded&&!this.game.sound.touchLocked},checkKey:function(a,c){return this._cacheMap[a][c]?!0:!1},checkURL:function(a){return this._urlMap[this._resolveURL(a)]?!0:!1},checkCanvasKey:function(a){return this.checkKey(b.Cache.CANVAS,a)},checkImageKey:function(a){return this.checkKey(b.Cache.IMAGE,a)},checkTextureKey:function(a){return this.checkKey(b.Cache.TEXTURE,a)},checkSoundKey:function(a){return this.checkKey(b.Cache.SOUND,a)},checkTextKey:function(a){return this.checkKey(b.Cache.TEXT,
a)},checkPhysicsKey:function(a){return this.checkKey(b.Cache.PHYSICS,a)},checkTilemapKey:function(a){return this.checkKey(b.Cache.TILEMAP,a)},checkBinaryKey:function(a){return this.checkKey(b.Cache.BINARY,a)},checkBitmapDataKey:function(a){return this.checkKey(b.Cache.BITMAPDATA,a)},checkBitmapFontKey:function(a){return this.checkKey(b.Cache.BITMAPFONT,a)},checkJSONKey:function(a){return this.checkKey(b.Cache.JSON,a)},checkXMLKey:function(a){return this.checkKey(b.Cache.XML,a)},checkVideoKey:function(a){return this.checkKey(b.Cache.VIDEO,
a)},checkShaderKey:function(a){return this.checkKey(b.Cache.SHADER,a)},checkRenderTextureKey:function(a){return this.checkKey(b.Cache.RENDER_TEXTURE,a)},getItem:function(a,c,b,e){if(this.checkKey(c,a))return void 0===e?this._cacheMap[c][a]:this._cacheMap[c][a][e];b&&console.warn("Phaser.Cache."+b+': Key "'+a+'" not found in Cache.');return null},getCanvas:function(a){return this.getItem(a,b.Cache.CANVAS,"getCanvas","canvas")},getImage:function(a,c){if(void 0===a||null===a)a="__default";void 0===c&&
(c=!1);var d=this.getItem(a,b.Cache.IMAGE,"getImage");null===d&&(d=this.getItem("__missing",b.Cache.IMAGE,"getImage"));return c?d:d.data},getTextureFrame:function(a){return this.getItem(a,b.Cache.TEXTURE,"getTextureFrame","frame")},getSound:function(a){return this.getItem(a,b.Cache.SOUND,"getSound")},getSoundData:function(a){return this.getItem(a,b.Cache.SOUND,"getSoundData","data")},getText:function(a){return this.getItem(a,b.Cache.TEXT,"getText","data")},getPhysicsData:function(a,c,d){var e=this.getItem(a,
b.Cache.PHYSICS,"getPhysicsData","data");if(null===e||void 0===c||null===c)return e;if(e[c])if((c=e[c])&&d){for(var h in c)if(h=c[h],h.fixtureKey===d)return h;console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+d+" in "+a+'"')}else return c;else console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+a+" / "+c+'"');return null},getTilemapData:function(a){return this.getItem(a,b.Cache.TILEMAP,"getTilemapData")},getBinary:function(a){return this.getItem(a,b.Cache.BINARY,
"getBinary")},getBitmapData:function(a){return this.getItem(a,b.Cache.BITMAPDATA,"getBitmapData","data")},getBitmapFont:function(a){return this.getItem(a,b.Cache.BITMAPFONT,"getBitmapFont")},getJSON:function(a,c){var d=this.getItem(a,b.Cache.JSON,"getJSON","data");return d?c?b.Utils.extend(!0,Array.isArray(d)?[]:{},d):d:null},getXML:function(a){return this.getItem(a,b.Cache.XML,"getXML","data")},getVideo:function(a){return this.getItem(a,b.Cache.VIDEO,"getVideo")},getShader:function(a){return this.getItem(a,
b.Cache.SHADER,"getShader","data")},getRenderTexture:function(a){return this.getItem(a,b.Cache.RENDER_TEXTURE,"getRenderTexture")},getBaseTexture:function(a,c){void 0===c&&(c=b.Cache.IMAGE);return this.getItem(a,c,"getBaseTexture","base")},getFrame:function(a,c){void 0===c&&(c=b.Cache.IMAGE);return this.getItem(a,c,"getFrame","frame")},getFrameCount:function(a,c){var b=this.getFrameData(a,c);return b?b.total:0},getFrameData:function(a,c){void 0===c&&(c=b.Cache.IMAGE);return this.getItem(a,c,"getFrameData",
"frameData")},hasFrameData:function(a,c){void 0===c&&(c=b.Cache.IMAGE);return null!==this.getItem(a,c,"","frameData")},updateFrameData:function(a,c,d){void 0===d&&(d=b.Cache.IMAGE);this._cacheMap[d][a]&&(this._cacheMap[d][a].frameData=c)},getFrameByIndex:function(a,c,b){return(a=this.getFrameData(a,b))?a.getFrame(c):null},getFrameByName:function(a,c,b){return(a=this.getFrameData(a,b))?a.getFrameByName(c):null},getURL:function(a){if(a=this._resolveURL(a))return this._urlMap[a];console.warn('Phaser.Cache.getUrl: Invalid url: "'+
a+'" or Cache.autoResolveURL was false');return null},getKeys:function(a){void 0===a&&(a=b.Cache.IMAGE);var c=[];if(this._cacheMap[a])for(var d in this._cacheMap[a])"__default"!==d&&"__missing"!==d&&c.push(d);return c},removeCanvas:function(a){delete this._cache.canvas[a]},removeImage:function(a,c){void 0===c&&(c=!0);var b=this.getImage(a,!0);c&&b.base&&b.base.destroy();delete this._cache.image[a]},removeSound:function(a){delete this._cache.sound[a]},removeText:function(a){delete this._cache.text[a]},
removePhysics:function(a){delete this._cache.physics[a]},removeTilemap:function(a){delete this._cache.tilemap[a]},removeBinary:function(a){delete this._cache.binary[a]},removeBitmapData:function(a){delete this._cache.bitmapData[a]},removeBitmapFont:function(a){delete this._cache.bitmapFont[a]},removeJSON:function(a){delete this._cache.json[a]},removeXML:function(a){delete this._cache.xml[a]},removeVideo:function(a){delete this._cache.video[a]},removeShader:function(a){delete this._cache.shader[a]},
removeRenderTexture:function(a){delete this._cache.renderTexture[a]},removeSpriteSheet:function(a){delete this._cache.spriteSheet[a]},removeTextureAtlas:function(a){delete this._cache.atlas[a]},clearGLTextures:function(){for(var a in this._cache.image)this._cache.image[a].base._glTextures=[]},_resolveURL:function(a,c){if(!this.autoResolveURL)return null;this._urlResolver.src=this.game.load.baseURL+a;this._urlTemp=this._urlResolver.src;this._urlResolver.src="";c&&(this._urlMap[this._urlTemp]=c);return this._urlTemp},
destroy:function(){for(var a=0;a<this._cacheMap.length;a++){var c=this._cacheMap[a],b;for(b in c)"__default"!==b&&"__missing"!==b&&(c[b].destroy&&c[b].destroy(),delete c[b])}this._urlTemp=this._urlResolver=this._urlMap=null}};b.Cache.prototype.constructor=b.Cache;b.Loader=function(a){this.game=a;this.cache=a.cache;this.hasLoaded=this.isLoading=this.resetLocked=!1;this.preloadSprite=null;this.crossOrigin=!1;this.path=this.baseURL="";this.headers={requestedWith:!1,json:"application/json",xml:"application/xml"};
this.onLoadStart=new b.Signal;this.onLoadComplete=new b.Signal;this.onPackComplete=new b.Signal;this.onFileStart=new b.Signal;this.onFileComplete=new b.Signal;this.onFileError=new b.Signal;this._warnedAboutXDomainRequest=this.useXDomainRequest=!1;this.enableParallel=!0;this.maxParallelDownloads=4;this._withSyncPointDepth=0;this._fileList=[];this._flightQueue=[];this._processingHead=0;this._fileLoadStarted=!1;this._loadedFileCount=this._loadedPackCount=this._totalFileCount=this._totalPackCount=0};
b.Loader.TEXTURE_ATLAS_JSON_ARRAY=0;b.Loader.TEXTURE_ATLAS_JSON_HASH=1;b.Loader.TEXTURE_ATLAS_XML_STARLING=2;b.Loader.PHYSICS_LIME_CORONA_JSON=3;b.Loader.PHYSICS_PHASER_JSON=4;b.Loader.TEXTURE_ATLAS_JSON_PYXEL=5;b.Loader.prototype={setPreloadSprite:function(a,c){c=c||0;this.preloadSprite={sprite:a,direction:c,width:a.width,height:a.height,rect:null};this.preloadSprite.rect=0===c?new b.Rectangle(0,0,1,a.height):new b.Rectangle(0,0,a.width,1);a.crop(this.preloadSprite.rect);a.visible=!0},resize:function(){this.preloadSprite&&
this.preloadSprite.height!==this.preloadSprite.sprite.height&&(this.preloadSprite.rect.height=this.preloadSprite.sprite.height)},checkKeyExists:function(a,c){return-1<this.getAssetIndex(a,c)},getAssetIndex:function(a,c){for(var b=-1,e=0;e<this._fileList.length;e++){var h=this._fileList[e];if(h.type===a&&h.key===c&&(b=e,!h.loaded&&!h.loading))break}return b},getAsset:function(a,c){var b=this.getAssetIndex(a,c);return-1<b?{index:b,file:this._fileList[b]}:!1},reset:function(a,c){void 0===c&&(c=!1);this.resetLocked||
(a&&(this.preloadSprite=null),this.isLoading=!1,this._processingHead=0,this._fileList.length=0,this._flightQueue.length=0,this._fileLoadStarted=!1,this._loadedFileCount=this._loadedPackCount=this._totalPackCount=this._totalFileCount=0,c&&(this.onLoadStart.removeAll(),this.onLoadComplete.removeAll(),this.onPackComplete.removeAll(),this.onFileStart.removeAll(),this.onFileComplete.removeAll(),this.onFileError.removeAll()))},addToFileList:function(a,c,b,e,h,f){void 0===h&&(h=!1);if(void 0===c||""===c)return console.warn("Phaser.Loader: Invalid or no key given of type "+
a),this;if(void 0===b||null===b)if(f)b=c+f;else return console.warn("Phaser.Loader: No URL given for file type: "+a+" key: "+c),this;b={type:a,key:c,path:this.path,url:b,syncPoint:0<this._withSyncPointDepth,data:null,loading:!1,loaded:!1,error:!1};if(e)for(var d in e)b[d]=e[d];a=this.getAssetIndex(a,c);h&&-1<a?(h=this._fileList[a],h.loading||h.loaded?(this._fileList.push(b),this._totalFileCount++):this._fileList[a]=b):-1===a&&(this._fileList.push(b),this._totalFileCount++);return this},replaceInFileList:function(a,
c,b,e){return this.addToFileList(a,c,b,e,!0)},pack:function(a,c,b,e){void 0===c&&(c=null);void 0===b&&(b=null);void 0===e&&(e=null);if(!c&&!b)return console.warn("Phaser.Loader.pack - Both url and data are null. One must be set."),this;a={type:"packfile",key:a,url:c,path:this.path,syncPoint:!0,data:null,loading:!1,loaded:!1,error:!1,callbackContext:e};b&&("string"===typeof b&&(b=JSON.parse(b)),a.data=b||{},a.loaded=!0);for(b=0;b<this._fileList.length+1;b++)if(c=this._fileList[b],!c||!c.loaded&&!c.loading&&
"packfile"!==c.type){this._fileList.splice(b,0,a);this._totalPackCount++;break}return this},image:function(a,c,b){return this.addToFileList("image",a,c,void 0,b,".png")},images:function(a,b){if(Array.isArray(b))for(var c=0;c<a.length;c++)this.image(a[c],b[c]);else for(c=0;c<a.length;c++)this.image(a[c]);return this},text:function(a,c,b){return this.addToFileList("text",a,c,void 0,b,".txt")},json:function(a,c,b){return this.addToFileList("json",a,c,void 0,b,".json")},shader:function(a,b,d){return this.addToFileList("shader",
a,b,void 0,d,".frag")},xml:function(a,b,d){return this.addToFileList("xml",a,b,void 0,d,".xml")},script:function(a,b,d,e){void 0===d&&(d=!1);!1!==d&&void 0===e&&(e=this);return this.addToFileList("script",a,b,{syncPoint:!0,callback:d,callbackContext:e},!1,".js")},binary:function(a,b,d,e){void 0===d&&(d=!1);!1!==d&&void 0===e&&(e=d);return this.addToFileList("binary",a,b,{callback:d,callbackContext:e},!1,".bin")},spritesheet:function(a,b,d,e,h,f,g){void 0===h&&(h=-1);void 0===f&&(f=0);void 0===g&&
(g=0);return this.addToFileList("spritesheet",a,b,{frameWidth:d,frameHeight:e,frameMax:h,margin:f,spacing:g},!1,".png")},audio:function(a,b,d){if(this.game.sound.noAudio)return this;void 0===d&&(d=!0);"string"===typeof b&&(b=[b]);return this.addToFileList("audio",a,b,{buffer:null,autoDecode:d})},audioSprite:function(a,b,d,e,h){if(this.game.sound.noAudio)return this;void 0===d&&(d=null);void 0===e&&(e=null);void 0===h&&(h=!0);this.audio(a,b,h);d?this.json(a+"-audioatlas",d):e?("string"===typeof e&&
(e=JSON.parse(e)),this.cache.addJSON(a+"-audioatlas","",e)):console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object");return this},audiosprite:function(a,b,d,e,h){return this.audioSprite(a,b,d,e,h)},video:function(a,b,d,e){void 0===d&&(d=this.game.device.firefox?"loadeddata":"canplaythrough");void 0===e&&(e=!1);"string"===typeof b&&(b=[b]);return this.addToFileList("video",a,b,{buffer:null,asBlob:e,loadEvent:d})},tilemap:function(a,c,d,e){void 0===
c&&(c=null);void 0===d&&(d=null);void 0===e&&(e=b.Tilemap.CSV);c||d||(c=e===b.Tilemap.CSV?a+".csv":a+".json");if(d){switch(e){case b.Tilemap.TILED_JSON:"string"===typeof d&&(d=JSON.parse(d))}this.cache.addTilemap(a,null,d,e)}else this.addToFileList("tilemap",a,c,{format:e});return this},physics:function(a,c,d,e){void 0===c&&(c=null);void 0===d&&(d=null);void 0===e&&(e=b.Physics.LIME_CORONA_JSON);c||d||(c=a+".json");d?("string"===typeof d&&(d=JSON.parse(d)),this.cache.addPhysicsData(a,null,d,e)):this.addToFileList("physics",
a,c,{format:e});return this},bitmapFont:function(a,b,d,e,h,f){if(void 0===b||null===b)b=a+".png";void 0===d&&(d=null);void 0===e&&(e=null);null===d&&null===e&&(d=a+".xml");void 0===h&&(h=0);void 0===f&&(f=0);if(d)this.addToFileList("bitmapfont",a,b,{atlasURL:d,xSpacing:h,ySpacing:f});else if("string"===typeof e){var c,g;try{c=JSON.parse(e)}catch(v){g=this.parseXml(e)}if(!g&&!c)throw Error("Phaser.Loader. Invalid Bitmap Font atlas given");this.addToFileList("bitmapfont",a,b,{atlasURL:null,atlasData:c||
g,atlasType:c?"json":"xml",xSpacing:h,ySpacing:f})}return this},atlasJSONArray:function(a,c,d,e){return this.atlas(a,c,d,e,b.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(a,c,d,e){return this.atlas(a,c,d,e,b.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(a,c,d,e){void 0===d&&(d=null);void 0===e&&(e=null);d||e||(d=a+".xml");return this.atlas(a,c,d,e,b.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(a,c,d,e,h){if(void 0===c||null===c)c=a+".png";void 0===d&&(d=null);void 0===e&&(e=
null);void 0===h&&(h=b.Loader.TEXTURE_ATLAS_JSON_ARRAY);d||e||(d=h===b.Loader.TEXTURE_ATLAS_XML_STARLING?a+".xml":a+".json");if(d)this.addToFileList("textureatlas",a,c,{atlasURL:d,format:h});else{switch(h){case b.Loader.TEXTURE_ATLAS_JSON_ARRAY:"string"===typeof e&&(e=JSON.parse(e));break;case b.Loader.TEXTURE_ATLAS_XML_STARLING:if("string"===typeof e){d=this.parseXml(e);if(!d)throw Error("Phaser.Loader. Invalid Texture Atlas XML given");e=d}}this.addToFileList("textureatlas",a,c,{atlasURL:null,atlasData:e,
format:h})}return this},withSyncPoint:function(a,b){this._withSyncPointDepth++;try{a.call(b||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(a,b){var c=this.getAsset(a,b);c&&(c.file.syncPoint=!0);return this},removeFile:function(a,b){var c=this.getAsset(a,b);c&&(c.loaded||c.loading||this._fileList.splice(c.index,1))},removeAll:function(){this._fileList.length=0;this._flightQueue.length=0},start:function(){this.isLoading||(this.hasLoaded=!1,this.isLoading=!0,this.updateProgress(),
this.processLoadQueue())},processLoadQueue:function(){if(this.isLoading){for(var a=0;a<this._flightQueue.length;a++){var c=this._flightQueue[a];if(c.loaded||c.error)this._flightQueue.splice(a,1),a--,c.loading=!1,c.requestUrl=null,c.requestObject=null,c.error&&this.onFileError.dispatch(c.key,c),"packfile"!==c.type?(this._loadedFileCount++,this.onFileComplete.dispatch(this.progress,c.key,!c.error,this._loadedFileCount,this._totalFileCount)):"packfile"===c.type&&c.error&&(this._loadedPackCount++,this.onPackComplete.dispatch(c.key,
!c.error,this._loadedPackCount,this._totalPackCount))}for(var d=!1,e=this.enableParallel?b.Math.clamp(this.maxParallelDownloads,1,12):1,a=this._processingHead;a<this._fileList.length&&!(c=this._fileList[a],"packfile"===c.type&&!c.error&&c.loaded&&a===this._processingHead&&(this.processPack(c),this._loadedPackCount++,this.onPackComplete.dispatch(c.key,!c.error,this._loadedPackCount,this._totalPackCount)),c.loaded||c.error?a===this._processingHead&&(this._processingHead=a+1):!c.loading&&this._flightQueue.length<
e&&("packfile"!==c.type||c.data?d||(this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this._flightQueue.push(c),c.loading=!0,this.onFileStart.dispatch(this.progress,c.key,c.url),this.loadFile(c)):(this._flightQueue.push(c),c.loading=!0,this.loadFile(c))),!c.loaded&&c.syncPoint&&(d=!0),this._flightQueue.length>=e||d&&this._loadedPackCount===this._totalPackCount);a++);this.updateProgress();if(this._processingHead>=this._fileList.length)this.finishedLoading();else if(!this._flightQueue.length){console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled");
var h=this;setTimeout(function(){h.finishedLoading(!0)},2E3)}}else console.warn("Phaser.Loader - active loading canceled / reset"),this.finishedLoading(!0)},finishedLoading:function(a){this.hasLoaded||(this.hasLoaded=!0,this.isLoading=!1,a||this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this.onLoadComplete.dispatch(),this.game.state.loadComplete(),this.reset())},asyncComplete:function(a,b){void 0===b&&(b="");a.loaded=!0;a.error=!!b;b&&(a.errorMessage=b,console.warn("Phaser.Loader - "+
a.type+"["+a.key+"]: "+b));this.processLoadQueue()},processPack:function(a){var c=a.data[a.key];if(c)for(var d=0;d<c.length;d++){var e=c[d];switch(e.type){case "image":this.image(e.key,e.url,e.overwrite);break;case "text":this.text(e.key,e.url,e.overwrite);break;case "json":this.json(e.key,e.url,e.overwrite);break;case "xml":this.xml(e.key,e.url,e.overwrite);break;case "script":this.script(e.key,e.url,e.callback,a.callbackContext||this);break;case "binary":this.binary(e.key,e.url,e.callback,a.callbackContext||
this);break;case "spritesheet":this.spritesheet(e.key,e.url,e.frameWidth,e.frameHeight,e.frameMax,e.margin,e.spacing);break;case "video":this.video(e.key,e.urls);break;case "audio":this.audio(e.key,e.urls,e.autoDecode);break;case "audiosprite":this.audiosprite(e.key,e.urls,e.jsonURL,e.jsonData,e.autoDecode);break;case "tilemap":this.tilemap(e.key,e.url,e.data,b.Tilemap[e.format]);break;case "physics":this.physics(e.key,e.url,e.data,b.Loader[e.format]);break;case "bitmapFont":this.bitmapFont(e.key,
e.textureURL,e.atlasURL,e.atlasData,e.xSpacing,e.ySpacing);break;case "atlasJSONArray":this.atlasJSONArray(e.key,e.textureURL,e.atlasURL,e.atlasData);break;case "atlasJSONHash":this.atlasJSONHash(e.key,e.textureURL,e.atlasURL,e.atlasData);break;case "atlasXML":this.atlasXML(e.key,e.textureURL,e.atlasURL,e.atlasData);break;case "atlas":this.atlas(e.key,e.textureURL,e.atlasURL,e.atlasData,b.Loader[e.format]);break;case "shader":this.shader(e.key,e.url,e.overwrite)}}else console.warn("Phaser.Loader - "+
a.key+": pack has data, but not for pack key")},transformUrl:function(a,b){return a?a.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)?a:this.baseURL+b.path+a:!1},loadFile:function(a){switch(a.type){case "packfile":this.xhrLoad(a,this.transformUrl(a.url,a),"text",this.fileComplete);break;case "image":case "spritesheet":case "textureatlas":case "bitmapfont":this.loadImageTag(a);break;case "audio":a.url=this.getAudioURL(a.url);a.url?this.game.sound.usingWebAudio?this.xhrLoad(a,this.transformUrl(a.url,
a),"arraybuffer",this.fileComplete):this.game.sound.usingAudioTag&&this.loadAudioTag(a):this.fileError(a,null,"No supported audio URL specified or device does not have audio playback support");break;case "video":a.url=this.getVideoURL(a.url);a.url?a.asBlob?this.xhrLoad(a,this.transformUrl(a.url,a),"blob",this.fileComplete):this.loadVideoTag(a):this.fileError(a,null,"No supported video URL specified or device does not have video playback support");break;case "json":this.xhrLoad(a,this.transformUrl(a.url,
a),"text",this.jsonLoadComplete);break;case "xml":this.xhrLoad(a,this.transformUrl(a.url,a),"text",this.xmlLoadComplete);break;case "tilemap":a.format===b.Tilemap.TILED_JSON?this.xhrLoad(a,this.transformUrl(a.url,a),"text",this.jsonLoadComplete):a.format===b.Tilemap.CSV?this.xhrLoad(a,this.transformUrl(a.url,a),"text",this.csvLoadComplete):this.asyncComplete(a,"invalid Tilemap format: "+a.format);break;case "text":case "script":case "shader":case "physics":this.xhrLoad(a,this.transformUrl(a.url,a),
"text",this.fileComplete);break;case "binary":this.xhrLoad(a,this.transformUrl(a.url,a),"arraybuffer",this.fileComplete)}},loadImageTag:function(a){var b=this;a.data=new Image;a.data.name=a.key;this.crossOrigin&&(a.data.crossOrigin=this.crossOrigin);a.data.onload=function(){a.data.onload&&(a.data.onload=null,a.data.onerror=null,b.fileComplete(a))};a.data.onerror=function(){a.data.onload&&(a.data.onload=null,a.data.onerror=null,b.fileError(a))};a.data.src=this.transformUrl(a.url,a);a.data.complete&&
a.data.width&&a.data.height&&(a.data.onload=null,a.data.onerror=null,this.fileComplete(a))},loadVideoTag:function(a){var c=this;a.data=document.createElement("video");a.data.name=a.key;a.data.controls=!1;a.data.autoplay=!1;var d=function(){a.data.removeEventListener(a.loadEvent,d,!1);a.data.onerror=null;a.data.canplay=!0;b.GAMES[c.game.id].load.fileComplete(a)};a.data.onerror=function(){a.data.removeEventListener(a.loadEvent,d,!1);a.data.onerror=null;a.data.canplay=!1;c.fileError(a)};a.data.addEventListener(a.loadEvent,
d,!1);a.data.src=this.transformUrl(a.url,a);a.data.load()},loadAudioTag:function(a){var b=this;if(this.game.sound.touchLocked)a.data=new Audio,a.data.name=a.key,a.data.preload="auto",a.data.src=this.transformUrl(a.url,a),this.fileComplete(a);else{a.data=new Audio;a.data.name=a.key;var d=function(){a.data.removeEventListener("canplaythrough",d,!1);a.data.onerror=null;b.fileComplete(a)};a.data.onerror=function(){a.data.removeEventListener("canplaythrough",d,!1);a.data.onerror=null;b.fileError(a)};a.data.preload=
"auto";a.data.src=this.transformUrl(a.url,a);a.data.addEventListener("canplaythrough",d,!1);a.data.load()}},xhrLoad:function(a,b,d,e,h){if(this.useXDomainRequest&&window.XDomainRequest)this.xhrLoadWithXDR(a,b,d,e,h);else{var c=new XMLHttpRequest;c.open("GET",b,!0);c.responseType=d;!1!==this.headers.requestedWith&&c.setRequestHeader("X-Requested-With",this.headers.requestedWith);this.headers[a.type]&&c.setRequestHeader("Accept",this.headers[a.type]);h=h||this.fileError;var f=this;c.onload=function(){try{return 4===
c.readyState&&400<=c.status&&599>=c.status?h.call(f,a,c):e.call(f,a,c)}catch(t){f.hasLoaded?window.console&&console.error(t):f.asyncComplete(a,t.message||"Exception")}};c.onerror=function(){try{return h.call(f,a,c)}catch(t){f.hasLoaded?window.console&&console.error(t):f.asyncComplete(a,t.message||"Exception")}};a.requestObject=c;a.requestUrl=b;c.send()}},xhrLoadWithXDR:function(a,b,d,e,h){this._warnedAboutXDomainRequest||this.game.device.ie&&!(10<=this.game.device.ieVersion)||(this._warnedAboutXDomainRequest=
!0,console.warn("Phaser.Loader - using XDomainRequest outside of IE 9"));var c=new window.XDomainRequest;c.open("GET",b,!0);c.responseType=d;c.timeout=3E3;h=h||this.fileError;var f=this;c.onerror=function(){try{return h.call(f,a,c)}catch(t){f.asyncComplete(a,t.message||"Exception")}};c.ontimeout=function(){try{return h.call(f,a,c)}catch(t){f.asyncComplete(a,t.message||"Exception")}};c.onprogress=function(){};c.onload=function(){try{return 4===c.readyState&&400<=c.status&&599>=c.status?h.call(f,a,
c):e.call(f,a,c)}catch(t){f.asyncComplete(a,t.message||"Exception")}};a.requestObject=c;a.requestUrl=b;setTimeout(function(){c.send()},0)},getVideoURL:function(a){for(var b=0;b<a.length;b++){var d=a[b],e;if(d.uri){if(e=d.type,d=d.uri,this.game.device.canPlayVideo(e))return d}else{if(0===d.indexOf("blob:")||0===d.indexOf("data:"))return d;0<=d.indexOf("?")&&(d=d.substr(0,d.indexOf("?")));e=d.substr((Math.max(0,d.lastIndexOf("."))||Infinity)+1).toLowerCase();if(this.game.device.canPlayVideo(e))return a[b]}}return null},
getAudioURL:function(a){if(this.game.sound.noAudio)return null;for(var b=0;b<a.length;b++){var d=a[b],e;if(d.uri){if(e=d.type,d=d.uri,this.game.device.canPlayAudio(e))return d}else{if(0===d.indexOf("blob:")||0===d.indexOf("data:"))return d;0<=d.indexOf("?")&&(d=d.substr(0,d.indexOf("?")));e=d.substr((Math.max(0,d.lastIndexOf("."))||Infinity)+1).toLowerCase();if(this.game.device.canPlayAudio(e))return a[b]}}return null},fileError:function(a,b,d){var c="error loading asset from URL "+(a.requestUrl||
this.transformUrl(a.url,a));!d&&b&&(d=b.status);d&&(c=c+" ("+d+")");this.asyncComplete(a,c)},fileComplete:function(a,c){var d=!0;switch(a.type){case "packfile":var e=JSON.parse(c.responseText);a.data=e||{};break;case "image":this.cache.addImage(a.key,a.url,a.data);break;case "spritesheet":this.cache.addSpriteSheet(a.key,a.url,a.data,a.frameWidth,a.frameHeight,a.frameMax,a.margin,a.spacing);break;case "textureatlas":if(null==a.atlasURL)this.cache.addTextureAtlas(a.key,a.url,a.data,a.atlasData,a.format);
else if(d=!1,a.format===b.Loader.TEXTURE_ATLAS_JSON_ARRAY||a.format===b.Loader.TEXTURE_ATLAS_JSON_HASH||a.format===b.Loader.TEXTURE_ATLAS_JSON_PYXEL)this.xhrLoad(a,this.transformUrl(a.atlasURL,a),"text",this.jsonLoadComplete);else if(a.format===b.Loader.TEXTURE_ATLAS_XML_STARLING)this.xhrLoad(a,this.transformUrl(a.atlasURL,a),"text",this.xmlLoadComplete);else throw Error("Phaser.Loader. Invalid Texture Atlas format: "+a.format);break;case "bitmapfont":a.atlasURL?(d=!1,this.xhrLoad(a,this.transformUrl(a.atlasURL,
a),"text",function(a,b){var c;try{c=JSON.parse(b.responseText)}catch(t){}c?(a.atlasType="json",this.jsonLoadComplete(a,b)):(a.atlasType="xml",this.xmlLoadComplete(a,b))})):this.cache.addBitmapFont(a.key,a.url,a.data,a.atlasData,a.atlasType,a.xSpacing,a.ySpacing);break;case "video":if(a.asBlob)try{a.data=c.response}catch(h){throw Error("Phaser.Loader. Unable to parse video file as Blob: "+a.key);}this.cache.addVideo(a.key,a.url,a.data,a.asBlob);break;case "audio":this.game.sound.usingWebAudio?(a.data=
c.response,this.cache.addSound(a.key,a.url,a.data,!0,!1),a.autoDecode&&this.game.sound.decode(a.key)):this.cache.addSound(a.key,a.url,a.data,!1,!0);break;case "text":a.data=c.responseText;this.cache.addText(a.key,a.url,a.data);break;case "shader":a.data=c.responseText;this.cache.addShader(a.key,a.url,a.data);break;case "physics":e=JSON.parse(c.responseText);this.cache.addPhysicsData(a.key,a.url,e,a.format);break;case "script":a.data=document.createElement("script");a.data.language="javascript";a.data.type=
"text/javascript";a.data.defer=!1;a.data.text=c.responseText;document.head.appendChild(a.data);a.callback&&(a.data=a.callback.call(a.callbackContext,a.key,c.responseText));break;case "binary":a.data=a.callback?a.callback.call(a.callbackContext,a.key,c.response):c.response,this.cache.addBinary(a.key,a.data)}d&&this.asyncComplete(a)},jsonLoadComplete:function(a,b){var c=JSON.parse(b.responseText);"tilemap"===a.type?this.cache.addTilemap(a.key,a.url,c,a.format):"bitmapfont"===a.type?this.cache.addBitmapFont(a.key,
a.url,a.data,c,a.atlasType,a.xSpacing,a.ySpacing):"json"===a.type?this.cache.addJSON(a.key,a.url,c):this.cache.addTextureAtlas(a.key,a.url,a.data,c,a.format);this.asyncComplete(a)},csvLoadComplete:function(a,b){this.cache.addTilemap(a.key,a.url,b.responseText,a.format);this.asyncComplete(a)},xmlLoadComplete:function(a,b){var c=this.parseXml(b.responseText);c?("bitmapfont"===a.type?this.cache.addBitmapFont(a.key,a.url,a.data,c,a.atlasType,a.xSpacing,a.ySpacing):"textureatlas"===a.type?this.cache.addTextureAtlas(a.key,
a.url,a.data,c,a.format):"xml"===a.type&&this.cache.addXML(a.key,a.url,c),this.asyncComplete(a)):(console.warn("Phaser.Loader - "+a.key+": invalid XML ("+(b.responseType||b.contentType)+")"),this.asyncComplete(a,"invalid XML"))},parseXml:function(a){var b;try{window.DOMParser?b=(new DOMParser).parseFromString(a,"text/xml"):(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a))}catch(d){b=null}return b&&b.documentElement&&!b.getElementsByTagName("parsererror").length?b:null},updateProgress:function(){this.preloadSprite&&
(0===this.preloadSprite.direction?this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress):this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite?this.preloadSprite.sprite.updateCrop():this.preloadSprite=null)},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-
this._loadedPackCount}};Object.defineProperty(b.Loader.prototype,"progressFloat",{get:function(){return b.Math.clamp(this._loadedFileCount/this._totalFileCount*100||0,0,100)}});Object.defineProperty(b.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}});b.Loader.prototype.constructor=b.Loader;b.LoaderParser={bitmapFont:function(a,b,d,e){return this.xmlBitmapFont(a,b,d,e)},xmlBitmapFont:function(a,b,d,e){var c={},f=a.getElementsByTagName("info")[0],g=a.getElementsByTagName("common")[0];
c.font=f.getAttribute("face");c.size=parseInt(f.getAttribute("size"),10);c.lineHeight=parseInt(g.getAttribute("lineHeight"),10)+e;c.chars={};f=a.getElementsByTagName("char");for(e=0;e<f.length;e++)g=parseInt(f[e].getAttribute("id"),10),c.chars[g]={x:parseInt(f[e].getAttribute("x"),10),y:parseInt(f[e].getAttribute("y"),10),width:parseInt(f[e].getAttribute("width"),10),height:parseInt(f[e].getAttribute("height"),10),xOffset:parseInt(f[e].getAttribute("xoffset"),10),yOffset:parseInt(f[e].getAttribute("yoffset"),
10),xAdvance:parseInt(f[e].getAttribute("xadvance"),10)+d,kerning:{}};a=a.getElementsByTagName("kerning");for(e=0;e<a.length;e++)d=parseInt(a[e].getAttribute("first"),10),f=parseInt(a[e].getAttribute("second"),10),g=parseInt(a[e].getAttribute("amount"),10),c.chars[f].kerning[d]=g;return this.finalizeBitmapFont(b,c)},jsonBitmapFont:function(a,b,d,e){var c={font:a.font.info._face,size:parseInt(a.font.info._size,10),lineHeight:parseInt(a.font.common._lineHeight,10)+e,chars:{}};a.font.chars["char"].forEach(function(a){var b=
parseInt(a._id,10);c.chars[b]={x:parseInt(a._x,10),y:parseInt(a._y,10),width:parseInt(a._width,10),height:parseInt(a._height,10),xOffset:parseInt(a._xoffset,10),yOffset:parseInt(a._yoffset,10),xAdvance:parseInt(a._xadvance,10)+d,kerning:{}}});a.font.kernings&&a.font.kernings.kerning&&a.font.kernings.kerning.forEach(function(a){c.chars[a._second].kerning[a._first]=parseInt(a._amount,10)});return this.finalizeBitmapFont(b,c)},finalizeBitmapFont:function(a,c){Object.keys(c.chars).forEach(function(d){d=
c.chars[d];d.texture=new PIXI.Texture(a,new b.Rectangle(d.x,d.y,d.width,d.height))});return c}};b.AudioSprite=function(a,b){this.game=a;this.key=b;this.config=this.game.cache.getJSON(b+"-audioatlas");this.autoplayKey=null;this.autoplay=!1;this.sounds={};for(var c in this.config.spritemap){var e=this.config.spritemap[c],h=this.game.add.sound(this.key);h.addMarker(c,e.start,e.end-e.start,null,e.loop);this.sounds[c]=h}this.config.autoplay&&(this.autoplayKey=this.config.autoplay,this.play(this.autoplayKey),
this.autoplay=this.sounds[this.autoplayKey])};b.AudioSprite.prototype={play:function(a,b){void 0===b&&(b=1);return this.sounds[a].play(a,null,b)},stop:function(a){if(a)this.sounds[a].stop();else for(var b in this.sounds)this.sounds[b].stop()},get:function(a){return this.sounds[a]}};b.AudioSprite.prototype.constructor=b.AudioSprite;b.Sound=function(a,c,d,e,h){void 0===d&&(d=1);void 0===e&&(e=!1);void 0===h&&(h=a.sound.connectToMaster);this.game=a;this.key=this.name=c;this.loop=e;this.markers={};this.context=
null;this.autoplay=!1;this.stopTime=this.position=this.durationMS=this.duration=this.currentTime=this.startTime=this.totalDuration=0;this.paused=!1;this.pausedTime=this.pausedPosition=0;this.isPlaying=!1;this.currentMarker="";this.fadeTween=null;this.allowMultiple=this.override=this.pendingPlayback=!1;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this._sound=this.gainNode=this.masterGainNode=this.externalNode=null;this.usingWebAudio?(this.context=
this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,this.gainNode=void 0===this.context.createGain?this.context.createGainNode():this.context.createGain(),this.gainNode.gain.value=d*this.game.sound.volume,h&&this.gainNode.connect(this.masterGainNode)):this.usingAudioTag&&(this.game.cache.getSound(c)&&this.game.cache.isSoundReady(c)?(this._sound=this.game.cache.getSoundData(c),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,
this));this.onDecoded=new b.Signal;this.onPlay=new b.Signal;this.onPause=new b.Signal;this.onResume=new b.Signal;this.onLoop=new b.Signal;this.onStop=new b.Signal;this.onMute=new b.Signal;this.onMarkerComplete=new b.Signal;this.onFadeComplete=new b.Signal;this._volume=d;this._buffer=null;this._muted=!1;this._tempLoop=this._muteVolume=this._tempPause=this._tempVolume=this._tempPosition=this._tempMarker=0;this._onDecodedEventDispatched=this._paused=!1};b.Sound.prototype={soundHasUnlocked:function(a){a===
this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},addMarker:function(a,b,d,e,h){if(void 0===d||null===d)d=1;if(void 0===e||null===e)e=1;void 0===h&&(h=!1);this.markers[a]={name:a,start:b,stop:b+d,volume:e,duration:d,durationMS:1E3*d,loop:h}},removeMarker:function(a){delete this.markers[a]},onEndedHandler:function(){this._sound.onended=null;this.isPlaying=!1;this.currentTime=this.durationMS;this.stop()},update:function(){this.game.cache.checkSoundKey(this.key)?
(this.isDecoded&&!this._onDecodedEventDispatched&&(this.onDecoded.dispatch(this),this._onDecodedEventDispatched=!0),this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)),this.isPlaying&&(this.currentTime=this.game.time.time-this.startTime,this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),this.isPlaying=!1,""===this.currentMarker?(this.currentTime=
0,this.startTime=this.game.time.time,this.isPlaying=!0):(this.onMarkerComplete.dispatch(this.currentMarker,this),this.play(this.currentMarker,0,this.volume,!0,!0))):""!==this.currentMarker&&this.stop():this.loop?(this.onLoop.dispatch(this),""===this.currentMarker&&(this.currentTime=0,this.startTime=this.game.time.time),this.isPlaying=!1,this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop()))):this.destroy()},loopFull:function(a){return this.play(null,0,a,!0)},play:function(a,b,d,e,h){if(void 0===
a||!1===a||null===a)a="";void 0===h&&(h=!0);if(this.isPlaying&&!this.allowMultiple&&!h&&!this.override)return this;if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||h)){if(this.usingWebAudio){if(void 0===this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(l){}this.externalNode?this._sound.disconnect(this.externalNode):this.gainNode&&this._sound.disconnect(this.gainNode)}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);this.isPlaying=
!1}if(""===a&&0<Object.keys(this.markers).length)return this;if(""!==a)if(this.markers[a])this.currentMarker=a,this.position=this.markers[a].start,this.volume=this.markers[a].volume,this.loop=this.markers[a].loop,this.duration=this.markers[a].duration,this.durationMS=this.markers[a].durationMS,"undefined"!==typeof d&&(this.volume=d),"undefined"!==typeof e&&(this.loop=e),this._tempMarker=a,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop;else return console.warn("Phaser.Sound.play: audio marker "+
a+" doesn't exist"),this;else b=b||0,void 0===d&&(d=this._volume),void 0===e&&(e=this.loop),this.position=Math.max(0,b),this.volume=d,this.loop=e,this.durationMS=this.duration=0,this._tempMarker=a,this._tempPosition=b,this._tempVolume=d,this._tempLoop=e;this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(this._sound=this.context.createBufferSource(),this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this._buffer=this.game.cache.getSoundData(this.key),
this._sound.buffer=this._buffer,this.loop&&""===a&&(this._sound.loop=!0),this.loop||""!==a||(this._sound.onended=this.onEndedHandler.bind(this)),this.totalDuration=this._sound.buffer.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=Math.ceil(1E3*this.totalDuration)),void 0===this._sound.start?this._sound.noteGrainOn(0,this.position,this.duration):this.loop&&""===a?this._sound.start(0,0):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=
this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&!1===this.game.cache.getSound(this.key).isDecoding&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||4===this._sound.readyState)?(this._sound.play(),this.totalDuration=
this._sound.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1E3*this.totalDuration),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._sound.volume=this._muted||this.game.sound.mute?0:this._volume,this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0;return this},restart:function(a,b,d,e){void 0===e&&(e=!1);this.play(a||"",b||0,d||
1,e,!0)},pause:function(){this.isPlaying&&this._sound&&(this.paused=!0,this.pausedPosition=this.currentTime,this.pausedTime=this.game.time.time,this._tempPause=this._sound.currentTime,this.onPause.dispatch(this),this.stop())},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var a=Math.max(0,this.position+this.pausedPosition/1E3);this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode);
this.loop&&(this._sound.loop=!0);this.loop||""!==this.currentMarker||(this._sound.onended=this.onEndedHandler.bind(this));var b=this.duration-this.pausedPosition/1E3;void 0===this._sound.start?this._sound.noteGrainOn(0,a,b):this.loop&&this.game.device.chrome?42===this.game.device.chromeVersion?this._sound.start(0):this._sound.start(0,a):this._sound.start(0,a,b)}else this._sound.currentTime=this._tempPause,this._sound.play();this.isPlaying=!0;this.paused=!1;this.startTime+=this.game.time.time-this.pausedTime;
this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound)if(this.usingWebAudio){if(void 0===this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(c){}this.externalNode?this._sound.disconnect(this.externalNode):this.gainNode&&this._sound.disconnect(this.gainNode)}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);this.isPlaying=this.pendingPlayback=!1;if(!this.paused){var a=this.currentMarker;""!==this.currentMarker&&this.onMarkerComplete.dispatch(this.currentMarker,
this);this.currentMarker="";null!==this.fadeTween&&this.fadeTween.stop();this.onStop.dispatch(this,a)}},fadeIn:function(a,b,d){void 0===b&&(b=!1);void 0===d&&(d=this.currentMarker);this.paused||(this.play(d,0,0,b),this.fadeTo(a,1))},fadeOut:function(a){this.fadeTo(a,0)},fadeTo:function(a,c){this.isPlaying&&!this.paused&&c!==this.volume&&(void 0===a&&(a=1E3),void 0===c?console.warn("Phaser.Sound.fadeTo: No Volume Specified."):(this.fadeTween=this.game.add.tween(this).to({volume:c},a,b.Easing.Linear.None,
!0),this.fadeTween.onComplete.add(this.fadeComplete,this)))},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume);0===this.volume&&this.stop()},updateGlobalVolume:function(a){this.usingAudioTag&&this._sound&&(this._sound.volume=a*this._volume)},destroy:function(a){void 0===a&&(a=!0);this.stop();a?this.game.sound.remove(this):(this.markers={},this.externalNode=this._buffer=this.context=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),
this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())}};b.Sound.prototype.constructor=b.Sound;Object.defineProperty(b.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}});Object.defineProperty(b.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}});Object.defineProperty(b.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(a){a=
a||!1;a!==this._muted&&(a?(this._muted=!0,this._muteVolume=this._tempVolume,this.usingWebAudio?this.gainNode.gain.value=0:this.usingAudioTag&&this._sound&&(this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume)),this.onMute.dispatch(this))}});Object.defineProperty(b.Sound.prototype,"volume",{get:function(){return this._volume},set:function(a){this.game.device.firefox&&this.usingAudioTag&&
(a=this.game.math.clamp(a,0,1));this._muted?this._muteVolume=a:(this._volume=this._tempVolume=a,this.usingWebAudio?this.gainNode.gain.value=a:this.usingAudioTag&&this._sound&&(this._sound.volume=a))}});b.SoundManager=function(a){this.game=a;this.onSoundDecode=new b.Signal;this.onVolumeChange=new b.Signal;this.onMute=new b.Signal;this.onUnMute=new b.Signal;this.context=null;this.noAudio=this.usingAudioTag=this.usingWebAudio=!1;this.connectToMaster=!0;this.touchLocked=!1;this.channels=32;this.muteOnPause=
!0;this._muted=this._codeMuted=!1;this._unlockSource=null;this._volume=1;this._sounds=[];this._watchList=new b.ArraySet;this._watching=!1;this._watchContext=this._watchCallback=null};b.SoundManager.prototype={boot:function(){this.game.device.iOS&&!1===this.game.device.webAudio&&(this.channels=1);if(window.PhaserGlobal){if(!0===window.PhaserGlobal.disableAudio){this.noAudio=!0;this.touchLocked=!1;return}if(!0===window.PhaserGlobal.disableWebAudio){this.usingAudioTag=!0;this.touchLocked=!1;return}}if(window.PhaserGlobal&&
window.PhaserGlobal.audioContext)this.context=window.PhaserGlobal.audioContext;else if(window.AudioContext)try{this.context=new window.AudioContext}catch(a){this.context=null,this.touchLocked=this.usingWebAudio=!1}else if(window.webkitAudioContext)try{this.context=new window.webkitAudioContext}catch(a){this.context=null,this.touchLocked=this.usingWebAudio=!1}if(null===this.context){if(void 0===window.Audio){this.noAudio=!0;return}this.usingAudioTag=!0}else this.usingWebAudio=!0,this.masterGain=void 0===
this.context.createGain?this.context.createGainNode():this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination);this.noAudio||(!this.game.device.cocoonJS&&this.game.device.iOS||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock)&&this.setTouchLock()},setTouchLock:function(){this.noAudio||window.PhaserGlobal&&!0===window.PhaserGlobal.disableAudio||(8<this.game.device.iOSVersion?this.game.input.touch.addTouchLockCallback(this.unlock,this,!0):this.game.input.touch.addTouchLockCallback(this.unlock,
this),this.touchLocked=!0)},unlock:function(){if(this.noAudio||!this.touchLocked||null!==this._unlockSource)return!0;if(this.usingAudioTag)this.touchLocked=!1,this._unlockSource=null;else if(this.usingWebAudio){var a=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource();this._unlockSource.buffer=a;this._unlockSource.connect(this.context.destination);void 0===this._unlockSource.start?this._unlockSource.noteOn(0):this._unlockSource.start(0)}return!0},stopAll:function(){if(!this.noAudio)for(var a=
0;a<this._sounds.length;a++)this._sounds[a]&&this._sounds[a].stop()},pauseAll:function(){if(!this.noAudio)for(var a=0;a<this._sounds.length;a++)this._sounds[a]&&this._sounds[a].pause()},resumeAll:function(){if(!this.noAudio)for(var a=0;a<this._sounds.length;a++)this._sounds[a]&&this._sounds[a].resume()},decode:function(a,b){b=b||null;var c=this.game.cache.getSoundData(a);if(c&&!1===this.game.cache.isSoundDecoded(a)){this.game.cache.updateSound(a,"isDecoding",!0);var e=this;try{this.context.decodeAudioData(c,
function(c){c&&(e.game.cache.decodedSound(a,c),e.onSoundDecode.dispatch(a,b))})}catch(h){}}},setDecodedCallback:function(a,c,d){"string"===typeof a&&(a=[a]);this._watchList.reset();for(var e=0;e<a.length;e++)a[e]instanceof b.Sound?this.game.cache.isSoundDecoded(a[e].key)||this._watchList.add(a[e].key):this.game.cache.isSoundDecoded(a[e])||this._watchList.add(a[e]);0===this._watchList.total?(this._watching=!1,c.call(d)):(this._watching=!0,this._watchCallback=c,this._watchContext=d)},update:function(){if(!this.noAudio){!this.touchLocked||
null===this._unlockSource||this._unlockSource.playbackState!==this._unlockSource.PLAYING_STATE&&this._unlockSource.playbackState!==this._unlockSource.FINISHED_STATE||(this.touchLocked=!1,this._unlockSource=null);for(var a=0;a<this._sounds.length;a++)this._sounds[a].update();if(this._watching){for(a=this._watchList.first;a;)this.game.cache.isSoundDecoded(a)&&this._watchList.remove(a),a=this._watchList.next;0===this._watchList.total&&(this._watching=!1,this._watchCallback.call(this._watchContext))}}},
add:function(a,c,d,e){void 0===c&&(c=1);void 0===d&&(d=!1);void 0===e&&(e=this.connectToMaster);a=new b.Sound(this.game,a,c,d,e);this._sounds.push(a);return a},addSprite:function(a){return new b.AudioSprite(this.game,a)},remove:function(a){for(var b=this._sounds.length;b--;)if(this._sounds[b]===a)return this._sounds[b].destroy(!1),this._sounds.splice(b,1),!0;return!1},removeByKey:function(a){for(var b=this._sounds.length,d=0;b--;)this._sounds[b].key===a&&(this._sounds[b].destroy(!1),this._sounds.splice(b,
1),d++);return d},play:function(a,b,d){if(!this.noAudio)return a=this.add(a,b,d),a.play(),a},setMute:function(){if(!this._muted){this._muted=!0;this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0);for(var a=0;a<this._sounds.length;a++)this._sounds[a].usingAudioTag&&(this._sounds[a].mute=!0);this.onMute.dispatch()}},unsetMute:function(){if(this._muted&&!this._codeMuted){this._muted=!1;this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var a=
0;a<this._sounds.length;a++)this._sounds[a].usingAudioTag&&(this._sounds[a].mute=!1);this.onUnMute.dispatch()}},destroy:function(){this.stopAll();for(var a=0;a<this._sounds.length;a++)this._sounds[a]&&this._sounds[a].destroy();this._sounds=[];this.onSoundDecode.dispose();this.context&&(window.PhaserGlobal?window.PhaserGlobal.audioContext=this.context:this.context.close&&this.context.close())}};b.SoundManager.prototype.constructor=b.SoundManager;Object.defineProperty(b.SoundManager.prototype,"mute",
{get:function(){return this._muted},set:function(a){a?this._muted||(this._codeMuted=!0,this.setMute()):this._muted&&(this._codeMuted=!1,this.unsetMute())}});Object.defineProperty(b.SoundManager.prototype,"volume",{get:function(){return this._volume},set:function(a){0>a?a=0:1<a&&(a=1);if(this._volume!==a){this._volume=a;if(this.usingWebAudio)this.masterGain.gain.value=a;else for(var b=0;b<this._sounds.length;b++)this._sounds[b].usingAudioTag&&this._sounds[b].updateGlobalVolume(a);this.onVolumeChange.dispatch(a)}}});
b.ScaleManager=function(a,c,d){this.game=a;this.dom=b.DOM;this.grid=null;this.height=this.width=0;this.maxHeight=this.minHeight=this.maxWidth=this.minWidth=null;this.offset=new b.Point;this._pageAlignVertically=this._pageAlignHorizontally=this.incorrectOrientation=this.forcePortrait=this.forceLandscape=!1;this.onOrientationChange=new b.Signal;this.enterIncorrectOrientation=new b.Signal;this.leaveIncorrectOrientation=new b.Signal;this.hasPhaserSetFullScreen=!1;this._createdFullScreenTarget=this.fullScreenTarget=
null;this.onFullScreenInit=new b.Signal;this.onFullScreenChange=new b.Signal;this.onFullScreenError=new b.Signal;this.screenOrientation=this.dom.getScreenOrientation();this.scaleFactor=new b.Point(1,1);this.scaleFactorInversed=new b.Point(1,1);this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0};this.bounds=new b.Rectangle;this.sourceAspectRatio=this.aspectRatio=0;this.event=null;this.windowConstraints={right:"layout",bottom:""};this.compatibility={supportsFullScreen:!1,orientationFallback:null,noMargins:!1,
scrollTo:null,forceMinimumDocumentHeight:!1,canExpandParent:!0,clickTrampoline:""};this._fullScreenScaleMode=this._scaleMode=b.ScaleManager.NO_SCALE;this.parentIsWindow=!1;this.parentNode=null;this.parentScaleFactor=new b.Point(1,1);this.trackParentInterval=2E3;this.onSizeChange=new b.Signal;this._fullScreenRestore=this._pendingScaleMode=this.onResizeContext=this.onResize=null;this._gameSize=new b.Rectangle;this._userScaleFactor=new b.Point(1,1);this._userScaleTrim=new b.Point(0,0);this._updateThrottle=
this._lastUpdate=0;this._updateThrottleReset=100;this._parentBounds=new b.Rectangle;this._tempBounds=new b.Rectangle;this._lastReportedCanvasSize=new b.Rectangle;this._lastReportedGameSize=new b.Rectangle;this._booted=!1;a.config&&this.parseConfig(a.config);this.setupScale(c,d)};b.ScaleManager.EXACT_FIT=0;b.ScaleManager.NO_SCALE=1;b.ScaleManager.SHOW_ALL=2;b.ScaleManager.RESIZE=3;b.ScaleManager.USER_SCALE=4;b.ScaleManager.prototype={boot:function(){var a=this.compatibility;a.supportsFullScreen=this.game.device.fullscreen&&
!this.game.device.cocoonJS;this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(a.scrollTo=this.game.device.android&&!this.game.device.chrome?new b.Point(0,1):new b.Point(0,0));this.game.device.desktop?(a.orientationFallback="screen",a.clickTrampoline="when-not-mouse"):(a.orientationFallback="",a.clickTrampoline="");var c=this;this._orientationChange=function(a){return c.orientationChange(a)};this._windowResize=function(a){return c.windowResize(a)};window.addEventListener("orientationchange",
this._orientationChange,!1);window.addEventListener("resize",this._windowResize,!1);this.compatibility.supportsFullScreen&&(this._fullScreenChange=function(a){return c.fullScreenChange(a)},this._fullScreenError=function(a){return c.fullScreenError(a)},document.addEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.addEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.addEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.addEventListener("fullscreenchange",
this._fullScreenChange,!1),document.addEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.addEventListener("mozfullscreenerror",this._fullScreenError,!1),document.addEventListener("MSFullscreenError",this._fullScreenError,!1),document.addEventListener("fullscreenerror",this._fullScreenError,!1));this.game.onResume.add(this._gameResumed,this);this.dom.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.setGameSize(this.game.width,
this.game.height);this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);b.FlexGrid&&(this.grid=new b.FlexGrid(this,this.width,this.height));this._booted=!0;null!==this._pendingScaleMode&&(this.scaleMode=this._pendingScaleMode,this._pendingScaleMode=null)},parseConfig:function(a){void 0!==a.scaleMode&&(this._booted?this.scaleMode=a.scaleMode:this._pendingScaleMode=a.scaleMode);void 0!==a.fullScreenScaleMode&&(this.fullScreenScaleMode=a.fullScreenScaleMode);a.fullScreenTarget&&
(this.fullScreenTarget=a.fullScreenTarget)},setupScale:function(a,c){var d,e=new b.Rectangle;""!==this.game.parent&&("string"===typeof this.game.parent?d=document.getElementById(this.game.parent):this.game.parent&&1===this.game.parent.nodeType&&(d=this.game.parent));d?(this.parentNode=d,this.parentIsWindow=!1,this.getParentBounds(this._parentBounds),e.width=this._parentBounds.width,e.height=this._parentBounds.height,this.offset.set(this._parentBounds.x,this._parentBounds.y)):(this.parentNode=null,
this.parentIsWindow=!0,e.width=this.dom.visualBounds.width,e.height=this.dom.visualBounds.height,this.offset.set(0,0));"number"===typeof a?d=a:(this.parentScaleFactor.x=parseInt(a,10)/100,d=e.width*this.parentScaleFactor.x);"number"===typeof c?e=c:(this.parentScaleFactor.y=parseInt(c,10)/100,e=e.height*this.parentScaleFactor.y);d=Math.floor(d);e=Math.floor(e);this._gameSize.setTo(0,0,d,e);this.updateDimensions(d,e,!1)},_gameResumed:function(){this.queueUpdate(!0)},setGameSize:function(a,c){this._gameSize.setTo(0,
0,a,c);this.currentScaleMode!==b.ScaleManager.RESIZE&&this.updateDimensions(a,c,!0);this.queueUpdate(!0)},setUserScale:function(a,b,d,e){this._userScaleFactor.setTo(a,b);this._userScaleTrim.setTo(d|0,e|0);this.queueUpdate(!0)},setResizeCallback:function(a,b){this.onResize=a;this.onResizeContext=b},signalSizeChange:function(){if(!b.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)||!b.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var a=this.width,c=this.height;this._lastReportedCanvasSize.setTo(0,
0,a,c);this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height);if(this.grid)this.grid.onResize(a,c);this.onSizeChange.dispatch(this,a,c);this.currentScaleMode===b.ScaleManager.RESIZE&&(this.game.state.resize(a,c),this.game.load.resize(a,c))}},setMinMax:function(a,b,d,e){this.minWidth=a;this.minHeight=b;"undefined"!==typeof d&&(this.maxWidth=d);"undefined"!==typeof e&&(this.maxHeight=e)},preUpdate:function(){if(!(this.game.time.time<this._lastUpdate+this._updateThrottle)){var a=this._updateThrottle;
this._updateThrottleReset=400<=a?0:100;this.dom.getOffset(this.game.canvas,this.offset);var c=this._parentBounds.width,d=this._parentBounds.height,e=this.getParentBounds(this._parentBounds),c=e.width!==c||e.height!==d,d=this.updateOrientationState();if(c||d)this.onResize&&this.onResize.call(this.onResizeContext,this,e),this.updateLayout(),this.signalSizeChange();e=2*this._updateThrottle;this._updateThrottle<a&&(e=Math.min(a,this._updateThrottleReset));this._updateThrottle=b.Math.clamp(e,25,this.trackParentInterval);
this._lastUpdate=this.game.time.time}},pauseUpdate:function(){this.preUpdate();this._updateThrottle=this.trackParentInterval},updateDimensions:function(a,b,d){this.width=a*this.parentScaleFactor.x;this.height=b*this.parentScaleFactor.y;this.game.width=this.width;this.game.height=this.height;this.sourceAspectRatio=this.width/this.height;this.updateScalingAndBounds();d&&(this.game.renderer.resize(this.width,this.height),this.game.camera.setSize(this.width,this.height),this.game.world.resize(this.width,
this.height))},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/this.game.height;this.aspectRatio=this.width/this.height;this.game.canvas&&this.dom.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.game.input&&this.game.input.scale&&this.game.input.scale.setTo(this.scaleFactor.x,
this.scaleFactor.y)},forceOrientation:function(a,b){void 0===b&&(b=!1);this.forceLandscape=a;this.forcePortrait=b;this.queueUpdate(!0)},classifyOrientation:function(a){return"portrait-primary"===a||"portrait-secondary"===a?"portrait":"landscape-primary"===a||"landscape-secondary"===a?"landscape":null},updateOrientationState:function(){var a=this.screenOrientation,b=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);this.incorrectOrientation=
this.forceLandscape&&!this.isLandscape||this.forcePortrait&&!this.isPortrait;var d=a!==this.screenOrientation,e=b!==this.incorrectOrientation;e&&(this.incorrectOrientation?this.enterIncorrectOrientation.dispatch():this.leaveIncorrectOrientation.dispatch());(d||e)&&this.onOrientationChange.dispatch(this,a,b);return d||e},orientationChange:function(a){this.event=a;this.queueUpdate(!0)},windowResize:function(a){this.event=a;this.queueUpdate(!0)},scrollTop:function(){var a=this.compatibility.scrollTo;
a&&window.scrollTo(a.x,a.y)},refresh:function(){this.scrollTop();this.queueUpdate(!0)},updateLayout:function(){var a=this.currentScaleMode;a===b.ScaleManager.RESIZE?this.reflowGame():(this.scrollTop(),this.compatibility.forceMinimumDocumentHeight&&(document.documentElement.style.minHeight=window.innerHeight+"px"),this.incorrectOrientation?this.setMaximum():a===b.ScaleManager.EXACT_FIT?this.setExactFit():a===b.ScaleManager.SHOW_ALL?(!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent&&
(this.setShowAll(!0),this.resetCanvas()),this.setShowAll()):a===b.ScaleManager.NO_SCALE?(this.width=this.game.width,this.height=this.game.height):a===b.ScaleManager.USER_SCALE&&(this.width=this.game.width*this._userScaleFactor.x-this._userScaleTrim.x,this.height=this.game.height*this._userScaleFactor.y-this._userScaleTrim.y),this.compatibility.canExpandParent||a!==b.ScaleManager.SHOW_ALL&&a!==b.ScaleManager.USER_SCALE||(a=this.getParentBounds(this._tempBounds),this.width=Math.min(this.width,a.width),
this.height=Math.min(this.height,a.height)),this.width|=0,this.height|=0,this.reflowCanvas())},getParentBounds:function(a){a=a||new b.Rectangle;var c=this.boundingParent,d=this.dom.visualBounds,e=this.dom.layoutBounds;if(c){var h=c.getBoundingClientRect(),c=c.offsetParent?c.offsetParent.getBoundingClientRect():c.getBoundingClientRect();a.setTo(h.left-c.left,h.top-c.top,h.width,h.height);h=this.windowConstraints;h.right&&(c="layout"===h.right?e:d,a.right=Math.min(a.right,c.width));h.bottom&&(c="layout"===
h.bottom?e:d,a.bottom=Math.min(a.bottom,c.height))}else a.setTo(0,0,d.width,d.height);a.setTo(Math.round(a.x),Math.round(a.y),Math.round(a.width),Math.round(a.height));return a},alignCanvas:function(a,b){var c=this.getParentBounds(this._tempBounds),e=this.game.canvas,h=this.margin;if(a){h.left=h.right=0;var f=e.getBoundingClientRect();if(this.width<c.width&&!this.incorrectOrientation){var g=f.left-c.x,k=c.width/2-this.width/2,k=Math.max(k,0);h.left=Math.round(k-g)}e.style.marginLeft=h.left+"px";0!==
h.left&&(h.right=-(c.width-f.width-h.left),e.style.marginRight=h.right+"px")}b&&(h.top=h.bottom=0,f=e.getBoundingClientRect(),this.height<c.height&&!this.incorrectOrientation&&(g=f.top-c.y,k=c.height/2-this.height/2,k=Math.max(k,0),h.top=Math.round(k-g)),e.style.marginTop=h.top+"px",0!==h.top&&(h.bottom=-(c.height-f.height-h.top),e.style.marginBottom=h.bottom+"px"));h.x=h.left;h.y=h.top},reflowGame:function(){this.resetCanvas("","");var a=this.getParentBounds(this._tempBounds);this.updateDimensions(a.width,
a.height,!0)},reflowCanvas:function(){this.incorrectOrientation||(this.width=b.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width),this.height=b.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height));this.resetCanvas();this.compatibility.noMargins||(this.isFullScreen&&this._createdFullScreenTarget?this.alignCanvas(!0,!0):this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically));this.updateScalingAndBounds()},resetCanvas:function(a,b){void 0===a&&(a=this.width+
"px");void 0===b&&(b=this.height+"px");var c=this.game.canvas;this.compatibility.noMargins||(c.style.marginLeft="",c.style.marginTop="",c.style.marginRight="",c.style.marginBottom="");c.style.width=a;c.style.height=b},queueUpdate:function(a){a&&(this._parentBounds.width=0,this._parentBounds.height=0);this._updateThrottle=this._updateThrottleReset},reset:function(a){a&&this.grid&&this.grid.reset()},setMaximum:function(){this.width=this.dom.visualBounds.width;this.height=this.dom.visualBounds.height},
setShowAll:function(a){var b=this.getParentBounds(this._tempBounds),d=b.width,b=b.height;a=a?Math.max(b/this.game.height,d/this.game.width):Math.min(b/this.game.height,d/this.game.width);this.width=Math.round(this.game.width*a);this.height=Math.round(this.game.height*a)},setExactFit:function(){var a=this.getParentBounds(this._tempBounds);this.width=a.width;this.height=a.height;this.isFullScreen||(this.maxWidth&&(this.width=Math.min(this.width,this.maxWidth)),this.maxHeight&&(this.height=Math.min(this.height,
this.maxHeight)))},createFullScreenTarget:function(){var a=document.createElement("div");a.style.margin="0";a.style.padding="0";a.style.background="#000";return a},startFullScreen:function(a,c){if(this.isFullScreen)return!1;if(this.compatibility.supportsFullScreen){if("when-not-mouse"===this.compatibility.clickTrampoline){var d=this.game.input;if(d.activePointer&&d.activePointer!==d.mousePointer&&(c||!1!==c)){d.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[a,!1]);return}}void 0!==
a&&this.game.renderType===b.CANVAS&&(this.game.stage.smoothed=a);d=this.fullScreenTarget;d||(this.cleanupCreatedTarget(),d=this._createdFullScreenTarget=this.createFullScreenTarget());var e={targetElement:d};this.hasPhaserSetFullScreen=!0;this.onFullScreenInit.dispatch(this,e);this._createdFullScreenTarget&&(e=this.game.canvas,e.parentNode.insertBefore(d,e),d.appendChild(e));if(this.game.device.fullscreenKeyboard)d[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT);else d[this.game.device.requestFullscreen]();
return!0}var h=this;setTimeout(function(){h.fullScreenError()},10)},stopFullScreen:function(){if(!this.isFullScreen||!this.compatibility.supportsFullScreen)return!1;this.hasPhaserSetFullScreen=!1;document[this.game.device.cancelFullscreen]();return!0},cleanupCreatedTarget:function(){var a=this._createdFullScreenTarget;if(a&&a.parentNode){var b=a.parentNode;b.insertBefore(this.game.canvas,a);b.removeChild(a)}this._createdFullScreenTarget=null},prepScreenMode:function(a){var c=!!this._createdFullScreenTarget,
d=this._createdFullScreenTarget||this.fullScreenTarget;a?!c&&this.fullScreenScaleMode!==b.ScaleManager.EXACT_FIT||d===this.game.canvas||(this._fullScreenRestore={targetWidth:d.style.width,targetHeight:d.style.height},d.style.width="100%",d.style.height="100%"):(this._fullScreenRestore&&(d.style.width=this._fullScreenRestore.targetWidth,d.style.height=this._fullScreenRestore.targetHeight,this._fullScreenRestore=null),this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.resetCanvas())},
fullScreenChange:function(a){this.event=a;this.isFullScreen?this.prepScreenMode(!0):(this.prepScreenMode(!1),this.cleanupCreatedTarget());this.updateLayout();this.queueUpdate(!0);this.onFullScreenChange.dispatch(this,this.width,this.height)},fullScreenError:function(a){this.event=a;this.cleanupCreatedTarget();console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API");this.onFullScreenError.dispatch(this)},scaleSprite:function(a,b,d,e){void 0===b&&(b=
this.width);void 0===d&&(d=this.height);void 0===e&&(e=!1);if(!a||!a.scale)return a;a.scale.x=1;a.scale.y=1;if(0>=a.width||0>=a.height||0>=b||0>=d)return a;var c=a.height*b/a.width,f=a.width*d/a.height;(f>b?e:!e)?(a.width=Math.floor(b),a.height=Math.floor(c)):(a.width=Math.floor(f),a.height=Math.floor(d));return a},destroy:function(){this.game.onResume.remove(this._gameResumed,this);window.removeEventListener("orientationchange",this._orientationChange,!1);window.removeEventListener("resize",this._windowResize,
!1);this.compatibility.supportsFullScreen&&(document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.removeEventListener("fullscreenchange",this._fullScreenChange,!1),document.removeEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.removeEventListener("mozfullscreenerror",this._fullScreenError,
!1),document.removeEventListener("MSFullscreenError",this._fullScreenError,!1),document.removeEventListener("fullscreenerror",this._fullScreenError,!1))}};b.ScaleManager.prototype.constructor=b.ScaleManager;Object.defineProperty(b.ScaleManager.prototype,"boundingParent",{get:function(){return this.parentIsWindow||this.isFullScreen&&this.hasPhaserSetFullScreen&&!this._createdFullScreenTarget?null:this.game.canvas&&this.game.canvas.parentNode||null}});Object.defineProperty(b.ScaleManager.prototype,
"scaleMode",{get:function(){return this._scaleMode},set:function(a){a!==this._scaleMode&&(this.isFullScreen||(this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.queueUpdate(!0)),this._scaleMode=a);return this._scaleMode}});Object.defineProperty(b.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(a){a!==this._fullScreenScaleMode&&(this.isFullScreen?(this.prepScreenMode(!1),this._fullScreenScaleMode=a,this.prepScreenMode(!0),
this.queueUpdate(!0)):this._fullScreenScaleMode=a);return this._fullScreenScaleMode}});Object.defineProperty(b.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}});Object.defineProperty(b.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(a){a!==this._pageAlignHorizontally&&(this._pageAlignHorizontally=a,this.queueUpdate(!0))}});Object.defineProperty(b.ScaleManager.prototype,
"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(a){a!==this._pageAlignVertically&&(this._pageAlignVertically=a,this.queueUpdate(!0))}});Object.defineProperty(b.ScaleManager.prototype,"isFullScreen",{get:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}});Object.defineProperty(b.ScaleManager.prototype,"isPortrait",{get:function(){return"portrait"===this.classifyOrientation(this.screenOrientation)}});
Object.defineProperty(b.ScaleManager.prototype,"isLandscape",{get:function(){return"landscape"===this.classifyOrientation(this.screenOrientation)}});Object.defineProperty(b.ScaleManager.prototype,"isGamePortrait",{get:function(){return this.height>this.width}});Object.defineProperty(b.ScaleManager.prototype,"isGameLandscape",{get:function(){return this.width>this.height}});b.Utils.Debug=function(a){this.game=a;this.context=this.canvas=this.bmd=this.sprite=null;this.font="14px Courier";this.columnWidth=
100;this.lineHeight=16;this.renderShadow=!0;this.currentY=this.currentX=0;this.currentAlpha=1;this.dirty=!1};b.Utils.Debug.prototype={boot:function(){this.game.renderType===b.CANVAS?this.context=this.game.context:(this.bmd=new b.BitmapData(this.game,"__DEBUG",this.game.width,this.game.height,!0),this.sprite=this.game.make.image(0,0,this.bmd),this.game.stage.addChild(this.sprite),this.game.scale.onSizeChange.add(this.resize,this),this.canvas=PIXI.CanvasPool.create(this,this.game.width,this.game.height),
this.context=this.canvas.getContext("2d"))},resize:function(a,b,d){this.bmd.resize(b,d);this.canvas.width=b;this.canvas.height=d},preUpdate:function(){this.dirty&&this.sprite&&(this.bmd.clear(),this.bmd.draw(this.canvas,0,0),this.context.clearRect(0,0,this.game.width,this.game.height),this.dirty=!1)},reset:function(){this.context&&this.context.clearRect(0,0,this.game.width,this.game.height);this.sprite&&this.bmd.clear()},start:function(a,b,d,e){"number"!==typeof a&&(a=0);"number"!==typeof b&&(b=0);
d=d||"rgb(255,255,255)";void 0===e&&(e=0);this.currentX=a;this.currentY=b;this.currentColor=d;this.columnWidth=e;this.dirty=!0;this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=d;this.context.fillStyle=d;this.context.font=this.font;this.context.globalAlpha=this.currentAlpha},stop:function(){this.context.restore()},line:function(){for(var a=this.currentX,b=0;b<arguments.length;b++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[b],
a+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[b],a,this.currentY),a+=this.columnWidth;this.currentY+=this.lineHeight},soundInfo:function(a,b,d,e){this.start(b,d,e);this.line("Sound: "+a.key+" Locked: "+a.game.sound.touchLocked);this.line("Is Ready?: "+this.game.cache.isSoundReady(a.key)+" Pending Playback: "+a.pendingPlayback);this.line("Decoded: "+a.isDecoded+" Decoding: "+a.isDecoding);this.line("Total Duration: "+a.totalDuration+" Playing: "+a.isPlaying);
this.line("Time: "+a.currentTime);this.line("Volume: "+a.volume+" Muted: "+a.mute);this.line("WebAudio: "+a.usingWebAudio+" Audio: "+a.usingAudioTag);""!==a.currentMarker&&(this.line("Marker: "+a.currentMarker+" Duration: "+a.duration+" (ms: "+a.durationMS+")"),this.line("Start: "+a.markers[a.currentMarker].start+" Stop: "+a.markers[a.currentMarker].stop),this.line("Position: "+a.position));this.stop()},cameraInfo:function(a,b,d,e){this.start(b,d,e);this.line("Camera ("+a.width+" x "+a.height+")");
this.line("X: "+a.x+" Y: "+a.y);a.bounds&&this.line("Bounds x: "+a.bounds.x+" Y: "+a.bounds.y+" w: "+a.bounds.width+" h: "+a.bounds.height);this.line("View x: "+a.view.x+" Y: "+a.view.y+" w: "+a.view.width+" h: "+a.view.height);this.line("Total in view: "+a.totalInView);this.stop()},timer:function(a,b,d,e){this.start(b,d,e);this.line("Timer (running: "+a.running+" expired: "+a.expired+")");this.line("Next Tick: "+a.next+" Duration: "+a.duration);this.line("Paused: "+a.paused+" Length: "+a.length);
this.stop()},pointer:function(a,b,d,e,h){null!=a&&(void 0===b&&(b=!1),d=d||"rgba(0,255,0,0.5)",e=e||"rgba(255,0,0,0.5)",!0!==b||!0!==a.isUp)&&(this.start(a.x,a.y-100,h),this.context.beginPath(),this.context.arc(a.x,a.y,a.circle.radius,0,2*Math.PI),this.context.fillStyle=a.active?d:e,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(a.positionDown.x,a.positionDown.y),this.context.lineTo(a.position.x,a.position.y),this.context.lineWidth=2,this.context.stroke(),
this.context.closePath(),this.line("ID: "+a.id+" Active: "+a.active),this.line("World X: "+a.worldX+" World Y: "+a.worldY),this.line("Screen X: "+a.x+" Screen Y: "+a.y+" In: "+a.withinGame),this.line("Duration: "+a.duration+" ms"),this.line("is Down: "+a.isDown+" is Up: "+a.isUp),this.stop())},spriteInputInfo:function(a,b,d,e){this.start(b,d,e);this.line("Sprite Input: ("+a.width+" x "+a.height+")");this.line("x: "+a.input.pointerX().toFixed(1)+" y: "+a.input.pointerY().toFixed(1));this.line("over: "+
a.input.pointerOver()+" duration: "+a.input.overDuration().toFixed(0));this.line("down: "+a.input.pointerDown()+" duration: "+a.input.downDuration().toFixed(0));this.line("just over: "+a.input.justOver()+" just out: "+a.input.justOut());this.stop()},key:function(a,b,d,e){this.start(b,d,e,150);this.line("Key:",a.keyCode,"isDown:",a.isDown);this.line("justDown:",a.justDown,"justUp:",a.justUp);this.line("Time Down:",a.timeDown.toFixed(0),"duration:",a.duration.toFixed(0));this.stop()},inputInfo:function(a,
b,d){this.start(a,b,d);this.line("Input");this.line("X: "+this.game.input.x+" Y: "+this.game.input.y);this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY);this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1));this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY);this.stop()},spriteBounds:function(a,b,d){a=a.getBounds();a.x+=this.game.camera.x;a.y+=this.game.camera.y;
this.rectangle(a,b,d)},ropeSegments:function(a,b,d){var c=this;a.segments.forEach(function(a){c.rectangle(a,b,d)},this)},spriteInfo:function(a,b,d,e){this.start(b,d,e);this.line("Sprite:  ("+a.width+" x "+a.height+") anchor: "+a.anchor.x+" x "+a.anchor.y);this.line("x: "+a.x.toFixed(1)+" y: "+a.y.toFixed(1));this.line("angle: "+a.angle.toFixed(1)+" rotation: "+a.rotation.toFixed(1));this.line("visible: "+a.visible+" in camera: "+a.inCamera);this.line("bounds x: "+a._bounds.x.toFixed(1)+" y: "+a._bounds.y.toFixed(1)+
" w: "+a._bounds.width.toFixed(1)+" h: "+a._bounds.height.toFixed(1));this.stop()},spriteCoords:function(a,b,d,e){this.start(b,d,e,100);a.name&&this.line(a.name);this.line("x:",a.x.toFixed(2),"y:",a.y.toFixed(2));this.line("pos x:",a.position.x.toFixed(2),"pos y:",a.position.y.toFixed(2));this.line("world x:",a.world.x.toFixed(2),"world y:",a.world.y.toFixed(2));this.stop()},lineInfo:function(a,b,d,e){this.start(b,d,e,80);this.line("start.x:",a.start.x.toFixed(2),"start.y:",a.start.y.toFixed(2));
this.line("end.x:",a.end.x.toFixed(2),"end.y:",a.end.y.toFixed(2));this.line("length:",a.length.toFixed(2),"angle:",a.angle);this.stop()},pixel:function(a,b,d,e){e=e||2;this.start();this.context.fillStyle=d;this.context.fillRect(a,b,e,e);this.stop()},geom:function(a,c,d,e){void 0===d&&(d=!0);void 0===e&&(e=0);c=c||"rgba(0,255,0,0.4)";this.start();this.context.fillStyle=c;this.context.strokeStyle=c;if(a instanceof b.Rectangle||1===e)d?this.context.fillRect(a.x-this.game.camera.x,a.y-this.game.camera.y,
a.width,a.height):this.context.strokeRect(a.x-this.game.camera.x,a.y-this.game.camera.y,a.width,a.height);else if(a instanceof b.Circle||2===e)this.context.beginPath(),this.context.arc(a.x-this.game.camera.x,a.y-this.game.camera.y,a.radius,0,2*Math.PI,!1),this.context.closePath(),d?this.context.fill():this.context.stroke();else if(a instanceof b.Point||3===e)this.context.fillRect(a.x-this.game.camera.x,a.y-this.game.camera.y,4,4);else if(a instanceof b.Line||4===e)this.context.lineWidth=1,this.context.beginPath(),
this.context.moveTo(a.start.x+.5-this.game.camera.x,a.start.y+.5-this.game.camera.y),this.context.lineTo(a.end.x+.5-this.game.camera.x,a.end.y+.5-this.game.camera.y),this.context.closePath(),this.context.stroke();this.stop()},rectangle:function(a,b,d){void 0===d&&(d=!0);b=b||"rgba(0, 255, 0, 0.4)";this.start();d?(this.context.fillStyle=b,this.context.fillRect(a.x-this.game.camera.x,a.y-this.game.camera.y,a.width,a.height)):(this.context.strokeStyle=b,this.context.strokeRect(a.x-this.game.camera.x,
a.y-this.game.camera.y,a.width,a.height));this.stop()},text:function(a,b,d,e,h){e=e||"rgb(255,255,255)";h=h||"16px Courier";this.start();this.context.font=h;this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(a,b+1,d+1));this.context.fillStyle=e;this.context.fillText(a,b,d);this.stop()},quadTree:function(a,b){b=b||"rgba(255,0,0,0.3)";this.start();var c=a.bounds;if(0===a.nodes.length)for(this.context.strokeStyle=b,this.context.strokeRect(c.x,c.y,c.width,c.height),this.text("size: "+
a.objects.length,c.x+4,c.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)",c=0;c<a.objects.length;c++)this.context.strokeRect(a.objects[c].x,a.objects[c].y,a.objects[c].width,a.objects[c].height);else for(c=0;c<a.nodes.length;c++)this.quadTree(a.nodes[c]);this.stop()},body:function(a,c,d){a.body&&(this.start(),a.body.type===b.Physics.ARCADE?b.Physics.Arcade.Body.render(this.context,a.body,c,d):a.body.type===b.Physics.NINJA?b.Physics.Ninja.Body.render(this.context,a.body,
c,d):a.body.type===b.Physics.BOX2D&&b.Physics.Box2D.renderBody(this.context,a.body,c),this.stop())},bodyInfo:function(a,c,d,e){a.body&&(this.start(c,d,e,210),a.body.type===b.Physics.ARCADE?b.Physics.Arcade.Body.renderBodyInfo(this,a.body):a.body.type===b.Physics.BOX2D&&this.game.physics.box2d.renderBodyInfo(this,a.body),this.stop())},box2dWorld:function(){this.start();this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0);this.game.physics.box2d.renderDebugDraw(this.context);
this.stop()},box2dBody:function(a,c){this.start();b.Physics.Box2D.renderBody(this.context,a,c);this.stop()},displayList:function(a){void 0===a&&(a=this.game.world);a.hasOwnProperty("renderOrderID")?console.log("["+a.renderOrderID+"]",a):console.log("[]",a);if(a.children&&0<a.children.length)for(var b=0;b<a.children.length;b++)this.game.debug.displayList(a.children[b])},destroy:function(){PIXI.CanvasPool.remove(this)}};b.Utils.Debug.prototype.constructor=b.Utils.Debug;b.DOM={getOffset:function(a,c){c=
c||new b.Point;var d=a.getBoundingClientRect(),e=b.DOM.scrollY,h=document.documentElement.clientTop;c.x=d.left+b.DOM.scrollX-document.documentElement.clientLeft;c.y=d.top+e-h;return c},getBounds:function(a,b){void 0===b&&(b=0);return(a=a&&!a.nodeType?a[0]:a)&&1===a.nodeType?this.calibrate(a.getBoundingClientRect(),b):!1},calibrate:function(a,b){b=+b||0;var c={width:0,height:0,left:0,right:0,top:0,bottom:0};c.width=(c.right=a.right+b)-(c.left=a.left-b);c.height=(c.bottom=a.bottom+b)-(c.top=a.top-b);
return c},getAspectRatio:function(a){a=null==a?this.visualBounds:1===a.nodeType?this.getBounds(a):a;var b=a.width,d=a.height;"function"===typeof b&&(b=b.call(a));"function"===typeof d&&(d=d.call(a));return b/d},inLayoutViewport:function(a,b){var c=this.getBounds(a,b);return!!c&&0<=c.bottom&&0<=c.right&&c.top<=this.layoutBounds.width&&c.left<=this.layoutBounds.height},getScreenOrientation:function(a){var b=window.screen,d=b.orientation||b.mozOrientation||b.msOrientation;if(d&&"string"===typeof d.type)return d.type;
if("string"===typeof d)return d;if("screen"===a)return b.height>b.width?"portrait-primary":"landscape-primary";if("viewport"!==a){if("window.orientation"===a&&"number"===typeof window.orientation)return 0===window.orientation||180===window.orientation?"portrait-primary":"landscape-primary";if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches)return"portrait-primary";if(window.matchMedia("(orientation: landscape)").matches)return"landscape-primary"}}return this.visualBounds.height>
this.visualBounds.width?"portrait-primary":"landscape-primary"},visualBounds:new b.Rectangle,layoutBounds:new b.Rectangle,documentBounds:new b.Rectangle};b.Device.whenReady(function(a){var c=window&&"pageXOffset"in window?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft},d=window&&"pageYOffset"in window?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};Object.defineProperty(b.DOM,"scrollX",{get:c});Object.defineProperty(b.DOM,
"scrollY",{get:d});Object.defineProperty(b.DOM.visualBounds,"x",{get:c});Object.defineProperty(b.DOM.visualBounds,"y",{get:d});Object.defineProperty(b.DOM.layoutBounds,"x",{value:0});Object.defineProperty(b.DOM.layoutBounds,"y",{value:0});a.desktop&&document.documentElement.clientWidth<=window.innerWidth&&document.documentElement.clientHeight<=window.innerHeight?(a=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)},c=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)},
Object.defineProperty(b.DOM.visualBounds,"width",{get:a}),Object.defineProperty(b.DOM.visualBounds,"height",{get:c}),Object.defineProperty(b.DOM.layoutBounds,"width",{get:a}),Object.defineProperty(b.DOM.layoutBounds,"height",{get:c})):(Object.defineProperty(b.DOM.visualBounds,"width",{get:function(){return window.innerWidth}}),Object.defineProperty(b.DOM.visualBounds,"height",{get:function(){return window.innerHeight}}),Object.defineProperty(b.DOM.layoutBounds,"width",{get:function(){var a=document.documentElement.clientWidth,
b=window.innerWidth;return a<b?b:a}}),Object.defineProperty(b.DOM.layoutBounds,"height",{get:function(){var a=document.documentElement.clientHeight,b=window.innerHeight;return a<b?b:a}}));Object.defineProperty(b.DOM.documentBounds,"x",{value:0});Object.defineProperty(b.DOM.documentBounds,"y",{value:0});Object.defineProperty(b.DOM.documentBounds,"width",{get:function(){var a=document.documentElement;return Math.max(a.clientWidth,a.offsetWidth,a.scrollWidth)}});Object.defineProperty(b.DOM.documentBounds,
"height",{get:function(){var a=document.documentElement;return Math.max(a.clientHeight,a.offsetHeight,a.scrollHeight)}})},null,!0);b.ArraySet=function(a){this.position=0;this.list=a||[]};b.ArraySet.prototype={add:function(a){this.exists(a)||this.list.push(a);return a},getIndex:function(a){return this.list.indexOf(a)},getByKey:function(a,b){for(var c=this.list.length;c--;)if(this.list[c][a]===b)return this.list[c];return null},exists:function(a){return-1<this.list.indexOf(a)},reset:function(){this.list.length=
0},remove:function(a){var b=this.list.indexOf(a);if(-1<b)return this.list.splice(b,1),a},setAll:function(a,b){for(var c=this.list.length;c--;)this.list[c]&&(this.list[c][a]=b)},callAll:function(a){for(var b=Array.prototype.slice.call(arguments,1),d=this.list.length;d--;)this.list[d]&&this.list[d][a]&&this.list[d][a].apply(this.list[d],b)},removeAll:function(a){void 0===a&&(a=!1);for(var b=this.list.length;b--;)if(this.list[b]){var d=this.remove(this.list[b]);a&&d.destroy()}this.position=0;this.list=
[]}};Object.defineProperty(b.ArraySet.prototype,"total",{get:function(){return this.list.length}});Object.defineProperty(b.ArraySet.prototype,"first",{get:function(){this.position=0;return 0<this.list.length?this.list[0]:null}});Object.defineProperty(b.ArraySet.prototype,"next",{get:function(){return this.position<this.list.length?(this.position++,this.list[this.position]):null}});b.ArraySet.prototype.constructor=b.ArraySet;b.ArrayUtils={getRandomItem:function(a,b,d){if(null===a)return null;void 0===
b&&(b=0);void 0===d&&(d=a.length);b+=Math.floor(Math.random()*d);return void 0===a[b]?null:a[b]},removeRandomItem:function(a,b,d){if(null==a)return null;void 0===b&&(b=0);void 0===d&&(d=a.length);b+=Math.floor(Math.random()*d);return b<a.length?(a=a.splice(b,1),void 0===a[0]?null:a[0]):null},shuffle:function(a){for(var b=a.length-1;0<b;b--){var d=Math.floor(Math.random()*(b+1)),e=a[b];a[b]=a[d];a[d]=e}return a},transposeMatrix:function(a){for(var b=a.length,d=a[0].length,e=Array(d),h=0;h<d;h++){e[h]=
Array(b);for(var f=b-1;-1<f;f--)e[h][f]=a[f][h]}return e},rotateMatrix:function(a,c){"string"!==typeof c&&(c=(c%360+360)%360);if(90===c||-270===c||"rotateLeft"===c)a=b.ArrayUtils.transposeMatrix(a),a=a.reverse();else if(-90===c||270===c||"rotateRight"===c)a=a.reverse(),a=b.ArrayUtils.transposeMatrix(a);else if(180===Math.abs(c)||"rotate180"===c){for(var d=0;d<a.length;d++)a[d].reverse();a=a.reverse()}return a},findClosest:function(a,b){if(!b.length)return NaN;if(1===b.length||a<b[0])return b[0];for(var c=
1;b[c]<a;)c++;var e=b[c-1],c=c<b.length?b[c]:Number.POSITIVE_INFINITY;return c-a<=a-e?c:e},rotateRight:function(a){var b=a.pop();a.unshift(b);return b},rotateLeft:function(a){var b=a.shift();a.push(b);return b},rotate:function(a){var b=a.shift();a.push(b);return b},numberArray:function(a,b){for(var c=[],e=a;e<=b;e++)c.push(e);return c},numberArrayStep:function(a,c,d){if(void 0===a||null===a)a=0;if(void 0===c||null===c)c=a,a=0;void 0===d&&(d=1);var e=[];c=Math.max(b.Math.roundAwayFromZero((c-a)/(d||
1)),0);for(var h=0;h<c;h++)e.push(a),a+=d;return e}};b.LinkedList=function(){this.last=this.first=this.prev=this.next=null;this.total=0};b.LinkedList.prototype={add:function(a){if(0===this.total&&null===this.first&&null===this.last)return this.next=this.last=this.first=a,a.prev=this,this.total++,a;this.last.next=a;a.prev=this.last;this.last=a;this.total++;return a},reset:function(){this.prev=this.next=this.last=this.first=null;this.total=0},remove:function(a){1===this.total?(this.reset(),a.next=a.prev=
null):(a===this.first?this.first=this.first.next:a===this.last&&(this.last=this.last.prev),a.prev&&(a.prev.next=a.next),a.next&&(a.next.prev=a.prev),a.next=a.prev=null,null===this.first&&(this.last=null),this.total--)},callAll:function(a){if(this.first&&this.last){var b=this.first;do b&&b[a]&&b[a].call(b),b=b.next;while(b!==this.last.next)}}};b.LinkedList.prototype.constructor=b.LinkedList;b.Create=function(a){this.game=a;this.ctx=this.canvas=this.bmd=null;this.palettes=[{0:"#000",1:"#9D9D9D",2:"#FFF",
3:"#BE2633",4:"#E06F8B",5:"#493C2B",6:"#A46422",7:"#EB8931",8:"#F7E26B",9:"#2F484E",A:"#44891A",B:"#A3CE27",C:"#1B2632",D:"#005784",E:"#31A2F2",F:"#B2DCEF"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#f5f4eb"},{0:"#000",1:"#2234d1",2:"#0c7e45",3:"#44aacc",4:"#8a3622",5:"#5c2e78",6:"#aa5c3d",7:"#b5b5b5",8:"#5e606e",9:"#4c81fb",A:"#6cd947",B:"#7be2f9",C:"#eb8a60",
D:"#e23d69",E:"#ffd93f",F:"#fff"},{0:"#000",1:"#fff",2:"#8b4131",3:"#7bbdc5",4:"#8b41ac",5:"#6aac41",6:"#3931a4",7:"#d5de73",8:"#945a20",9:"#5a4100",A:"#bd736a",B:"#525252",C:"#838383",D:"#acee8b",E:"#7b73de",F:"#acacac"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#fff"}]};b.Create.PALETTE_ARNE=0;b.Create.PALETTE_JMP=1;b.Create.PALETTE_CGA=2;b.Create.PALETTE_C64=
3;b.Create.PALETTE_JAPANESE_MACHINE=4;b.Create.prototype={texture:function(a,b,d,e,h){void 0===d&&(d=8);void 0===e&&(e=d);void 0===h&&(h=0);var c=b[0].length*d,f=b.length*e;null===this.bmd&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context);this.bmd.resize(c,f);this.bmd.clear();for(c=0;c<b.length;c++)for(var f=b[c],g=0;g<f.length;g++){var k=f[g];"."!==k&&" "!==k&&(this.ctx.fillStyle=this.palettes[h][k],this.ctx.fillRect(g*d,c*e,d,e))}return this.bmd.generateTexture(a)},
grid:function(a,b,d,e,h,f){null===this.bmd&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context);this.bmd.resize(b,d);this.ctx.fillStyle=f;for(f=0;f<d;f+=h)this.ctx.fillRect(0,f,b,1);for(h=0;h<b;h+=e)this.ctx.fillRect(h,0,1,d);return this.bmd.generateTexture(a)}};b.Create.prototype.constructor=b.Create;b.FlexGrid=function(a,c,d){this.game=a.game;this.manager=a;this.width=c;this.height=d;this.boundsCustom=new b.Rectangle(0,0,c,d);this.boundsFluid=new b.Rectangle(0,
0,c,d);this.boundsFull=new b.Rectangle(0,0,c,d);this.boundsNone=new b.Rectangle(0,0,c,d);this.positionCustom=new b.Point(0,0);this.positionFluid=new b.Point(0,0);this.positionFull=new b.Point(0,0);this.positionNone=new b.Point(0,0);this.scaleCustom=new b.Point(1,1);this.scaleFluid=new b.Point(1,1);this.scaleFluidInversed=new b.Point(1,1);this.scaleFull=new b.Point(1,1);this.scaleNone=new b.Point(1,1);this.customOffsetY=this.customOffsetX=this.customHeight=this.customWidth=0;this.ratioH=c/d;this.ratioV=
d/c;this.multiplier=0;this.layers=[]};b.FlexGrid.prototype={setSize:function(a,c){this.width=a;this.height=c;this.ratioH=a/c;this.ratioV=c/a;this.scaleNone=new b.Point(1,1);this.boundsNone.width=this.width;this.boundsNone.height=this.height;this.refresh()},createCustomLayer:function(a,c,d,e){void 0===e&&(e=!0);this.customWidth=a;this.customHeight=c;this.boundsCustom.width=a;this.boundsCustom.height=c;a=new b.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);e&&this.game.world.add(a);
this.layers.push(a);"undefined"!==typeof d&&a.addMultiple(d);return a},createFluidLayer:function(a,c){void 0===c&&(c=!0);var d=new b.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);c&&this.game.world.add(d);this.layers.push(d);"undefined"!==typeof a&&d.addMultiple(a);return d},createFullLayer:function(a){var c=new b.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);this.game.world.add(c);this.layers.push(c);"undefined"!==typeof a&&c.addMultiple(a);return c},createFixedLayer:function(a){var c=
new b.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);this.game.world.add(c);this.layers.push(c);"undefined"!==typeof a&&c.addMultiple(a);return c},reset:function(){for(var a=this.layers.length;a--;)this.layers[a].persist||(this.layers[a].position=null,this.layers[a].scale=null,this.layers.slice(a,1))},onResize:function(a,b){this.ratioH=a/b;this.ratioV=b/a;this.refresh(a,b)},refresh:function(){this.multiplier=Math.min(this.manager.height/this.height,this.manager.width/this.width);
this.boundsFluid.width=Math.round(this.width*this.multiplier);this.boundsFluid.height=Math.round(this.height*this.multiplier);this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height);this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height);this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height);this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x);this.boundsFull.height=
Math.round(this.manager.height*this.scaleFluidInversed.y);this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y);this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(a){this.manager.scaleSprite(a);a.x=this.manager.bounds.centerX;a.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+
" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16);this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",!1)}};b.FlexGrid.prototype.constructor=b.FlexGrid;b.FlexLayer=function(a,c,d,e){b.Group.call(this,a.game,null,"__flexLayer"+a.game.rnd.uuid(),!1);this.manager=a.manager;this.grid=a;this.persist=!1;this.position=c;this.bounds=d;this.scale=e;this.topLeft=d.topLeft;this.topMiddle=new b.Point(d.halfWidth,0);this.topRight=d.topRight;this.bottomLeft=d.bottomLeft;this.bottomMiddle=
new b.Point(d.halfWidth,d.bottom);this.bottomRight=d.bottomRight};b.FlexLayer.prototype=Object.create(b.Group.prototype);b.FlexLayer.prototype.constructor=b.FlexLayer;b.FlexLayer.prototype.resize=function(){};b.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16);this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",!1);this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9");this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9");
this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")};b.Color={packPixel:function(a,c,d,e){return b.Device.LITTLE_ENDIAN?(e<<24|d<<16|c<<8|a)>>>0:(a<<24|c<<16|d<<8|e)>>>0},unpackPixel:function(a,c,d,e){if(void 0===c||null===c)c=b.Color.createColor();if(void 0===d||null===d)d=!1;if(void 0===e||null===e)e=!1;b.Device.LITTLE_ENDIAN?(c.a=(a&4278190080)>>>24,c.b=(a&16711680)>>>16,c.g=(a&65280)>>>8,c.r=a&255):(c.r=(a&4278190080)>>>24,c.g=(a&16711680)>>>16,c.b=(a&65280)>>>8,c.a=a&255);c.color=a;c.rgba=
"rgba("+c.r+","+c.g+","+c.b+","+c.a/255+")";d&&b.Color.RGBtoHSL(c.r,c.g,c.b,c);e&&b.Color.RGBtoHSV(c.r,c.g,c.b,c);return c},fromRGBA:function(a,c){c||(c=b.Color.createColor());c.r=(a&4278190080)>>>24;c.g=(a&16711680)>>>16;c.b=(a&65280)>>>8;c.a=a&255;c.rgba="rgba("+c.r+","+c.g+","+c.b+","+c.a+")";return c},toRGBA:function(a,b,d,e){return a<<24|b<<16|d<<8|e},toABGR:function(a,b,d,e){return(e<<24|d<<16|b<<8|a)>>>0},RGBtoHSL:function(a,c,d,e){e||(e=b.Color.createColor(a,c,d,1));a/=255;c/=255;d/=255;var h=
Math.min(a,c,d),f=Math.max(a,c,d);e.h=0;e.s=0;e.l=(f+h)/2;if(f!==h){var g=f-h;e.s=.5<e.l?g/(2-f-h):g/(f+h);f===a?e.h=(c-d)/g+(c<d?6:0):f===c?e.h=(d-a)/g+2:f===d&&(e.h=(a-c)/g+4);e.h/=6}return e},HSLtoRGB:function(a,c,d,e){e?(e.r=d,e.g=d,e.b=d):e=b.Color.createColor(d,d,d);0!==c&&(c=.5>d?d*(1+c):d+c-d*c,d=2*d-c,e.r=b.Color.hueToColor(d,c,a+1/3),e.g=b.Color.hueToColor(d,c,a),e.b=b.Color.hueToColor(d,c,a-1/3));e.r=Math.floor(255*e.r|0);e.g=Math.floor(255*e.g|0);e.b=Math.floor(255*e.b|0);b.Color.updateColor(e);
return e},RGBtoHSV:function(a,c,d,e){e||(e=b.Color.createColor(a,c,d,255));a/=255;c/=255;d/=255;var h=Math.min(a,c,d),f=Math.max(a,c,d),g=f-h;e.h=0;e.s=0===f?0:g/f;e.v=f;f!==h&&(f===a?e.h=(c-d)/g+(c<d?6:0):f===c?e.h=(d-a)/g+2:f===d&&(e.h=(a-c)/g+4),e.h/=6);return e},HSVtoRGB:function(a,c,d,e){void 0===e&&(e=b.Color.createColor(0,0,0,1,a,c,0,d));var h,f,g,k=Math.floor(6*a),m=6*a-k;a=d*(1-c);var n=d*(1-m*c);c=d*(1-(1-m)*c);switch(k%6){case 0:h=d;f=c;g=a;break;case 1:h=n;f=d;g=a;break;case 2:h=a;f=d;
g=c;break;case 3:h=a;f=n;g=d;break;case 4:h=c;f=a;g=d;break;case 5:h=d,f=a,g=n}e.r=Math.floor(255*h);e.g=Math.floor(255*f);e.b=Math.floor(255*g);b.Color.updateColor(e);return e},hueToColor:function(a,b,d){0>d&&(d+=1);1<d&&--d;return d<1/6?a+6*(b-a)*d:.5>d?b:d<2/3?a+(b-a)*(2/3-d)*6:a},createColor:function(a,c,d,e,h,f,g,k){return b.Color.updateColor({r:a||0,g:c||0,b:d||0,a:e||1,h:h||0,s:f||0,l:g||0,v:k||0,color:0,color32:0,rgba:""})},updateColor:function(a){a.rgba="rgba("+a.r.toString()+","+a.g.toString()+
","+a.b.toString()+","+a.a.toString()+")";a.color=b.Color.getColor(a.r,a.g,a.b);a.color32=b.Color.getColor32(255*a.a,a.r,a.g,a.b);return a},getColor32:function(a,b,d,e){return a<<24|b<<16|d<<8|e},getColor:function(a,b,d){return a<<16|b<<8|d},RGBtoString:function(a,c,d,e,h){void 0===e&&(e=255);void 0===h&&(h="#");return"#"===h?"#"+(16777216+(a<<16)+(c<<8)+d).toString(16).slice(1):"0x"+b.Color.componentToHex(e)+b.Color.componentToHex(a)+b.Color.componentToHex(c)+b.Color.componentToHex(d)},hexToRGB:function(a){if(a=
b.Color.hexToColor(a))return b.Color.getColor32(a.a,a.r,a.g,a.b)},hexToColor:function(a,c){a=a.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,b,c,d){return b+b+c+c+d+d});var d=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);if(d){var e=parseInt(d[1],16),h=parseInt(d[2],16),d=parseInt(d[3],16);c?(c.r=e,c.g=h,c.b=d):c=b.Color.createColor(e,h,d)}return c},webToColor:function(a,c){c||(c=b.Color.createColor());var d=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(a);
d&&(c.r=parseInt(d[1],10),c.g=parseInt(d[2],10),c.b=parseInt(d[3],10),c.a=void 0!==d[4]?parseFloat(d[4]):1,b.Color.updateColor(c));return c},valueToColor:function(a,c){c||(c=b.Color.createColor());if("string"===typeof a){if(0===a.indexOf("rgb"))return b.Color.webToColor(a,c);c.a=1;return b.Color.hexToColor(a,c)}if("number"===typeof a){var d=b.Color.getRGB(a);c.r=d.r;c.g=d.g;c.b=d.b;c.a=d.a/255}return c},componentToHex:function(a){a=a.toString(16);return 1===a.length?"0"+a:a},HSVColorWheel:function(a,
c){void 0===a&&(a=1);void 0===c&&(c=1);for(var d=[],e=0;359>=e;e++)d.push(b.Color.HSVtoRGB(e/359,a,c));return d},HSLColorWheel:function(a,c){void 0===a&&(a=.5);void 0===c&&(c=.5);for(var d=[],e=0;359>=e;e++)d.push(b.Color.HSLtoRGB(e/359,a,c));return d},interpolateColor:function(a,c,d,e,h){void 0===h&&(h=255);a=b.Color.getRGB(a);c=b.Color.getRGB(c);return b.Color.getColor32(h,(c.red-a.red)*e/d+a.red,(c.green-a.green)*e/d+a.green,(c.blue-a.blue)*e/d+a.blue)},interpolateColorWithRGB:function(a,c,d,e,
h,f){a=b.Color.getRGB(a);return b.Color.getColor((c-a.red)*f/h+a.red,(d-a.green)*f/h+a.green,(e-a.blue)*f/h+a.blue)},interpolateRGB:function(a,c,d,e,h,f,g,k){return b.Color.getColor((e-a)*k/g+a,(h-c)*k/g+c,(f-d)*k/g+d)},getRandomColor:function(a,c,d){void 0===a&&(a=0);void 0===c&&(c=255);void 0===d&&(d=255);return 255<c||a>c?b.Color.getColor(255,255,255):b.Color.getColor32(d,a+Math.round(Math.random()*(c-a)),a+Math.round(Math.random()*(c-a)),a+Math.round(Math.random()*(c-a)))},getRGB:function(a){return 16777215<
a?{alpha:a>>>24,red:a>>16&255,green:a>>8&255,blue:a&255,a:a>>>24,r:a>>16&255,g:a>>8&255,b:a&255}:{alpha:255,red:a>>16&255,green:a>>8&255,blue:a&255,a:255,r:a>>16&255,g:a>>8&255,b:a&255}},getWebRGB:function(a){if("object"===typeof a)return"rgba("+a.r.toString()+","+a.g.toString()+","+a.b.toString()+","+(a.a/255).toString()+")";a=b.Color.getRGB(a);return"rgba("+a.r.toString()+","+a.g.toString()+","+a.b.toString()+","+(a.a/255).toString()+")"},getAlpha:function(a){return a>>>24},getAlphaFloat:function(a){return(a>>>
24)/255},getRed:function(a){return a>>16&255},getGreen:function(a){return a>>8&255},getBlue:function(a){return a&255},blendNormal:function(a){return a},blendLighten:function(a,b){return b>a?b:a},blendDarken:function(a,b){return b>a?a:b},blendMultiply:function(a,b){return a*b/255},blendAverage:function(a,b){return(a+b)/2},blendAdd:function(a,b){return Math.min(255,a+b)},blendSubtract:function(a,b){return Math.max(0,a+b-255)},blendDifference:function(a,b){return Math.abs(a-b)},blendNegation:function(a,
b){return 255-Math.abs(255-a-b)},blendScreen:function(a,b){return 255-((255-a)*(255-b)>>8)},blendExclusion:function(a,b){return a+b-2*a*b/255},blendOverlay:function(a,b){return 128>b?2*a*b/255:255-2*(255-a)*(255-b)/255},blendSoftLight:function(a,b){return 128>b?b/255*((a>>1)+64)*2:255-2*(255-((a>>1)+64))*(255-b)/255},blendHardLight:function(a,c){return b.Color.blendOverlay(c,a)},blendColorDodge:function(a,b){return 255===b?b:Math.min(255,(a<<8)/(255-b))},blendColorBurn:function(a,b){return 0===b?
b:Math.max(0,255-(255-a<<8)/b)},blendLinearDodge:function(a,c){return b.Color.blendAdd(a,c)},blendLinearBurn:function(a,c){return b.Color.blendSubtract(a,c)},blendLinearLight:function(a,c){return 128>c?b.Color.blendLinearBurn(a,2*c):b.Color.blendLinearDodge(a,2*(c-128))},blendVividLight:function(a,c){return 128>c?b.Color.blendColorBurn(a,2*c):b.Color.blendColorDodge(a,2*(c-128))},blendPinLight:function(a,c){return 128>c?b.Color.blendDarken(a,2*c):b.Color.blendLighten(a,2*(c-128))},blendHardMix:function(a,
c){return 128>b.Color.blendVividLight(a,c)?0:255},blendReflect:function(a,b){return 255===b?b:Math.min(255,a*a/(255-b))},blendGlow:function(a,c){return b.Color.blendReflect(c,a)},blendPhoenix:function(a,b){return Math.min(a,b)-Math.max(a,b)+255}};b.Physics=function(a,b){b=b||{};this.game=a;this.config=b;this.matter=this.chipmunk=this.box2d=this.ninja=this.p2=this.arcade=null;this.parseConfig()};b.Physics.ARCADE=0;b.Physics.P2JS=1;b.Physics.NINJA=2;b.Physics.BOX2D=3;b.Physics.CHIPMUNK=4;b.Physics.MATTERJS=
5;b.Physics.prototype={parseConfig:function(){this.config.hasOwnProperty("arcade")&&!0!==this.config.arcade||!b.Physics.hasOwnProperty("Arcade")||(this.arcade=new b.Physics.Arcade(this.game));this.config.hasOwnProperty("ninja")&&!0===this.config.ninja&&b.Physics.hasOwnProperty("Ninja")&&(this.ninja=new b.Physics.Ninja(this.game));this.config.hasOwnProperty("p2")&&!0===this.config.p2&&b.Physics.hasOwnProperty("P2")&&(this.p2=new b.Physics.P2(this.game,this.config));this.config.hasOwnProperty("box2d")&&
!0===this.config.box2d&&b.Physics.hasOwnProperty("BOX2D")&&(this.box2d=new b.Physics.BOX2D(this.game,this.config));this.config.hasOwnProperty("matter")&&!0===this.config.matter&&b.Physics.hasOwnProperty("Matter")&&(this.matter=new b.Physics.Matter(this.game,this.config))},startSystem:function(a){a===b.Physics.ARCADE?this.arcade=new b.Physics.Arcade(this.game):a===b.Physics.P2JS?null===this.p2?this.p2=new b.Physics.P2(this.game,this.config):this.p2.reset():a===b.Physics.NINJA?this.ninja=new b.Physics.Ninja(this.game):
a===b.Physics.BOX2D?null===this.box2d?this.box2d=new b.Physics.Box2D(this.game,this.config):this.box2d.reset():a===b.Physics.MATTERJS&&(null===this.matter?this.matter=new b.Physics.Matter(this.game,this.config):this.matter.reset())},enable:function(a,c,d){void 0===c&&(c=b.Physics.ARCADE);void 0===d&&(d=!1);c===b.Physics.ARCADE?this.arcade.enable(a):c===b.Physics.P2JS&&this.p2?this.p2.enable(a,d):c===b.Physics.NINJA&&this.ninja?this.ninja.enableAABB(a):c===b.Physics.BOX2D&&this.box2d?this.box2d.enable(a):
c===b.Physics.MATTERJS&&this.matter?this.matter.enable(a):console.warn(a.key+" is attempting to enable a physics body using an unknown physics system.")},preUpdate:function(){this.p2&&this.p2.preUpdate();this.box2d&&this.box2d.preUpdate();this.matter&&this.matter.preUpdate()},update:function(){this.p2&&this.p2.update();this.box2d&&this.box2d.update();this.matter&&this.matter.update()},setBoundsToWorld:function(){this.arcade&&this.arcade.setBoundsToWorld();this.ninja&&this.ninja.setBoundsToWorld();
this.p2&&this.p2.setBoundsToWorld();this.box2d&&this.box2d.setBoundsToWorld();this.matter&&this.matter.setBoundsToWorld()},clear:function(){this.p2&&this.p2.clear();this.box2d&&this.box2d.clear();this.matter&&this.matter.clear()},reset:function(){this.p2&&this.p2.reset();this.box2d&&this.box2d.reset();this.matter&&this.matter.reset()},destroy:function(){this.p2&&this.p2.destroy();this.box2d&&this.box2d.destroy();this.matter&&this.matter.destroy();this.matter=this.box2d=this.p2=this.ninja=this.arcade=
null}};b.Physics.prototype.constructor=b.Physics;b.Physics.Arcade=function(a){this.game=a;this.gravity=new b.Point;this.bounds=new b.Rectangle(0,0,a.world.width,a.world.height);this.checkCollision={up:!0,down:!0,left:!0,right:!0};this.maxObjects=10;this.OVERLAP_BIAS=this.maxLevels=4;this.forceX=!1;this.sortDirection=b.Physics.Arcade.LEFT_RIGHT;this.skipQuadTree=!0;this.isPaused=!1;this.quadTree=new b.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,
this.maxObjects,this.maxLevels);this._total=0;this.setBoundsToWorld()};b.Physics.Arcade.prototype.constructor=b.Physics.Arcade;b.Physics.Arcade.SORT_NONE=0;b.Physics.Arcade.LEFT_RIGHT=1;b.Physics.Arcade.RIGHT_LEFT=2;b.Physics.Arcade.TOP_BOTTOM=3;b.Physics.Arcade.BOTTOM_TOP=4;b.Physics.Arcade.prototype={setBounds:function(a,b,d,e){this.bounds.setTo(a,b,d,e)},setBoundsToWorld:function(){this.bounds.copyFrom(this.game.world.bounds)},enable:function(a,c){void 0===c&&(c=!0);var d;if(Array.isArray(a))for(d=
a.length;d--;)a[d]instanceof b.Group?this.enable(a[d].children,c):(this.enableBody(a[d]),c&&a[d].hasOwnProperty("children")&&0<a[d].children.length&&this.enable(a[d],!0));else a instanceof b.Group?this.enable(a.children,c):(this.enableBody(a),c&&a.hasOwnProperty("children")&&0<a.children.length&&this.enable(a.children,!0))},enableBody:function(a){a.hasOwnProperty("body")&&null===a.body&&(a.body=new b.Physics.Arcade.Body(a),a.parent&&a.parent instanceof b.Group&&a.parent.addToHash(a))},updateMotion:function(a){var b=
this.computeVelocity(0,a,a.angularVelocity,a.angularAcceleration,a.angularDrag,a.maxAngular)-a.angularVelocity;a.angularVelocity+=b;a.rotation+=a.angularVelocity*this.game.time.physicsElapsed;a.velocity.x=this.computeVelocity(1,a,a.velocity.x,a.acceleration.x,a.drag.x,a.maxVelocity.x);a.velocity.y=this.computeVelocity(2,a,a.velocity.y,a.acceleration.y,a.drag.y,a.maxVelocity.y)},computeVelocity:function(a,b,d,e,h,f){void 0===f&&(f=1E4);1===a&&b.allowGravity?d+=(this.gravity.x+b.gravity.x)*this.game.time.physicsElapsed:
2===a&&b.allowGravity&&(d+=(this.gravity.y+b.gravity.y)*this.game.time.physicsElapsed);e?d+=e*this.game.time.physicsElapsed:h&&(h*=this.game.time.physicsElapsed,d=0<d-h?d-h:0>d+h?d+h:0);d>f?d=f:d<-f&&(d=-f);return d},overlap:function(a,b,d,e,h){d=d||null;e=e||null;h=h||d;this._total=0;if(!Array.isArray(a)&&Array.isArray(b))for(var c=0;c<b.length;c++)this.collideHandler(a,b[c],d,e,h,!0);else if(Array.isArray(a)&&!Array.isArray(b))for(c=0;c<a.length;c++)this.collideHandler(a[c],b,d,e,h,!0);else if(Array.isArray(a)&&
Array.isArray(b))for(c=0;c<a.length;c++)for(var f=0;f<b.length;f++)this.collideHandler(a[c],b[f],d,e,h,!0);else this.collideHandler(a,b,d,e,h,!0);return 0<this._total},collide:function(a,b,d,e,h){d=d||null;e=e||null;h=h||d;this._total=0;if(!Array.isArray(a)&&Array.isArray(b))for(var c=0;c<b.length;c++)this.collideHandler(a,b[c],d,e,h,!1);else if(Array.isArray(a)&&!Array.isArray(b))for(c=0;c<a.length;c++)this.collideHandler(a[c],b,d,e,h,!1);else if(Array.isArray(a)&&Array.isArray(b))for(c=0;c<a.length;c++)for(var f=
0;f<b.length;f++)this.collideHandler(a[c],b[f],d,e,h,!1);else this.collideHandler(a,b,d,e,h,!1);return 0<this._total},sortLeftRight:function(a,b){return a.body&&b.body?a.body.x-b.body.x:0},sortRightLeft:function(a,b){return a.body&&b.body?b.body.x-a.body.x:0},sortTopBottom:function(a,b){return a.body&&b.body?a.body.y-b.body.y:0},sortBottomTop:function(a,b){return a.body&&b.body?b.body.y-a.body.y:0},sort:function(a,c){null!==a.physicsSortDirection?c=a.physicsSortDirection:void 0===c&&(c=this.sortDirection);
c===b.Physics.Arcade.LEFT_RIGHT?a.hash.sort(this.sortLeftRight):c===b.Physics.Arcade.RIGHT_LEFT?a.hash.sort(this.sortRightLeft):c===b.Physics.Arcade.TOP_BOTTOM?a.hash.sort(this.sortTopBottom):c===b.Physics.Arcade.BOTTOM_TOP&&a.hash.sort(this.sortBottomTop)},collideHandler:function(a,c,d,e,h,f){void 0===c&&a.physicsType===b.GROUP?(this.sort(a),this.collideGroupVsSelf(a,d,e,h,f)):a&&c&&a.exists&&c.exists&&(this.sortDirection!==b.Physics.Arcade.SORT_NONE&&(a.physicsType===b.GROUP&&this.sort(a),c.physicsType===
b.GROUP&&this.sort(c)),a.physicsType===b.SPRITE?c.physicsType===b.SPRITE?this.collideSpriteVsSprite(a,c,d,e,h,f):c.physicsType===b.GROUP?this.collideSpriteVsGroup(a,c,d,e,h,f):c.physicsType===b.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(a,c,d,e,h,f):a.physicsType===b.GROUP?c.physicsType===b.SPRITE?this.collideSpriteVsGroup(c,a,d,e,h,f):c.physicsType===b.GROUP?this.collideGroupVsGroup(a,c,d,e,h,f):c.physicsType===b.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(a,c,d,e,h,f):a.physicsType===b.TILEMAPLAYER&&
(c.physicsType===b.SPRITE?this.collideSpriteVsTilemapLayer(c,a,d,e,h,f):c.physicsType===b.GROUP&&this.collideGroupVsTilemapLayer(c,a,d,e,h,f)))},collideSpriteVsSprite:function(a,b,d,e,h,f){if(!a.body||!b.body)return!1;this.separate(a.body,b.body,e,h,f)&&(d&&d.call(h,a,b),this._total++);return!0},collideSpriteVsGroup:function(a,c,d,e,h,f){if(0!==c.length&&a.body)if(this.skipQuadTree||a.body.skipQuadTree)for(var g={},l=0;l<c.hash.length;l++){var k=c.hash[l];if(k&&k.exists&&k.body){g=k.body.getBounds(g);
if(this.sortDirection===b.Physics.Arcade.LEFT_RIGHT)if(a.body.right<g.x)break;else{if(g.right<a.body.x)continue}else if(this.sortDirection===b.Physics.Arcade.RIGHT_LEFT)if(a.body.x>g.right)break;else{if(g.x>a.body.right)continue}else if(this.sortDirection===b.Physics.Arcade.TOP_BOTTOM)if(a.body.bottom<g.y)break;else{if(g.bottom<a.body.y)continue}else if(this.sortDirection===b.Physics.Arcade.BOTTOM_TOP)if(a.body.y>g.bottom)break;else if(g.y>a.body.bottom)continue;this.collideSpriteVsSprite(a,k,d,e,
h,f)}}else for(this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(c),c=this.quadTree.retrieve(a),l=0;l<c.length;l++)this.separate(a.body,c[l],e,h,f)&&(d&&d.call(h,a,c[l].sprite),this._total++)},collideGroupVsSelf:function(a,c,d,e,h){if(0!==a.length)for(var f=0;f<a.hash.length;f++){var g={},k=a.hash[f];if(k&&k.exists&&k.body)for(var g=k.body.getBounds(g),
m=f+1;m<a.hash.length;m++){var n={},p=a.hash[m];if(p&&p.exists&&p.body){n=p.body.getBounds(n);if(this.sortDirection===b.Physics.Arcade.LEFT_RIGHT)if(g.right<n.x)break;else{if(n.right<g.x)continue}else if(this.sortDirection===b.Physics.Arcade.RIGHT_LEFT)if(g.x>n.right)continue;else{if(n.x>g.right)break}else if(this.sortDirection===b.Physics.Arcade.TOP_BOTTOM)if(g.bottom<n.y)continue;else{if(n.bottom<g.y)break}else if(this.sortDirection===b.Physics.Arcade.BOTTOM_TOP)if(g.y>n.bottom)continue;else if(n.y>
k.body.bottom)break;this.collideSpriteVsSprite(k,p,c,d,e,h)}}}},collideGroupVsGroup:function(a,c,d,e,h,f){if(0!==a.length&&0!==c.length)for(var g=0;g<a.children.length;g++)a.children[g].exists&&(a.children[g].physicsType===b.GROUP?this.collideGroupVsGroup(a.children[g],c,d,e,h,f):this.collideSpriteVsGroup(a.children[g],c,d,e,h,f))},separate:function(a,b,d,e,h){if(!a.enable||!b.enable||a.checkCollision.none||b.checkCollision.none||!this.intersects(a,b)||d&&!1===d.call(e,a.sprite,b.sprite))return!1;
if(a.isCircle&&b.isCircle)return this.separateCircle(a,b,h);if(a.isCircle!==b.isCircle){d=a.isCircle?b:a;var c=a.isCircle?a:b;e=d.x;var f=d.right,g=d.bottom,k=c.x+c.radius,c=c.y+c.radius;if(c<d.y||c>g)if(k<e||k>f)return this.separateCircle(a,b,h)}e=d=!1;this.forceX||Math.abs(this.gravity.y+a.gravity.y)<Math.abs(this.gravity.x+a.gravity.x)?(d=this.separateX(a,b,h),this.intersects(a,b)&&(e=this.separateY(a,b,h))):(e=this.separateY(a,b,h),this.intersects(a,b)&&(d=this.separateX(a,b,h)));if(d=d||e)h?
(a.onOverlap&&a.onOverlap.dispatch(a.sprite,b.sprite),b.onOverlap&&b.onOverlap.dispatch(b.sprite,a.sprite)):(a.onCollide&&a.onCollide.dispatch(a.sprite,b.sprite),b.onCollide&&b.onCollide.dispatch(b.sprite,a.sprite));return d},intersects:function(a,c){return a===c?!1:a.isCircle?c.isCircle?b.Math.distance(a.center.x,a.center.y,c.center.x,c.center.y)<=a.radius+c.radius:this.circleBodyIntersects(a,c):c.isCircle?this.circleBodyIntersects(c,a):a.right<=c.position.x||a.bottom<=c.position.y||a.position.x>=
c.right||a.position.y>=c.bottom?!1:!0},circleBodyIntersects:function(a,c){var d=b.Math.clamp(a.center.x,c.left,c.right),e=b.Math.clamp(a.center.y,c.top,c.bottom);return(a.center.x-d)*(a.center.x-d)+(a.center.y-e)*(a.center.y-e)<=a.radius*a.radius},separateCircle:function(a,c,d){this.getOverlapX(a,c);this.getOverlapY(a,c);var e=Math.atan2(c.center.y-a.center.y,c.center.x-a.center.x),h=0;if(a.isCircle!==c.isCircle){var f=c.isCircle?a.position.x:c.position.x,g=c.isCircle?a.position.y:c.position.y,k=
c.isCircle?a.right:c.right,m=c.isCircle?a.bottom:c.bottom,n=a.isCircle?a.position.x+a.radius:c.position.x+c.radius,p=a.isCircle?a.position.y+a.radius:c.position.y+c.radius,w=a.isCircle?a.radius:c.radius;p<g?n<f?h=b.Math.distance(n,p,f,g)-w:n>k&&(h=b.Math.distance(n,p,k,g)-w):p>m&&(n<f?h=b.Math.distance(n,p,f,m)-w:n>k&&(h=b.Math.distance(n,p,k,m)-w));h*=-1}else h=a.radius+c.radius-b.Math.distance(a.center.x,a.center.y,c.center.x,c.center.y);if(d||0===h||a.immovable&&c.immovable||a.customSeparateX||
c.customSeparateX)return 0!==h&&(a.onOverlap&&a.onOverlap.dispatch(a.sprite,c.sprite),c.onOverlap&&c.onOverlap.dispatch(c.sprite,a.sprite)),0!==h;k=a.velocity.x*Math.cos(e)+a.velocity.y*Math.sin(e);d=a.velocity.x*Math.sin(e)-a.velocity.y*Math.cos(e);m=c.velocity.x*Math.cos(e)+c.velocity.y*Math.sin(e);f=c.velocity.x*Math.sin(e)-c.velocity.y*Math.cos(e);g=((a.mass-c.mass)*k+2*c.mass*m)/(a.mass+c.mass);k=(2*a.mass*k+(c.mass-a.mass)*m)/(a.mass+c.mass);a.immovable||(a.velocity.x=(g*Math.cos(e)-d*Math.sin(e))*
a.bounce.x,a.velocity.y=(d*Math.cos(e)+g*Math.sin(e))*a.bounce.y);c.immovable||(c.velocity.x=(k*Math.cos(e)-f*Math.sin(e))*c.bounce.x,c.velocity.y=(f*Math.cos(e)+k*Math.sin(e))*c.bounce.y);Math.abs(e)<Math.PI/2?0<a.velocity.x&&!a.immovable&&c.velocity.x>a.velocity.x?a.velocity.x*=-1:0>c.velocity.x&&!c.immovable&&a.velocity.x<c.velocity.x?c.velocity.x*=-1:0<a.velocity.y&&!a.immovable&&c.velocity.y>a.velocity.y?a.velocity.y*=-1:0>c.velocity.y&&!c.immovable&&a.velocity.y<c.velocity.y&&(c.velocity.y*=
-1):Math.abs(e)>Math.PI/2&&(0>a.velocity.x&&!a.immovable&&c.velocity.x<a.velocity.x?a.velocity.x*=-1:0<c.velocity.x&&!c.immovable&&a.velocity.x>c.velocity.x?c.velocity.x*=-1:0>a.velocity.y&&!a.immovable&&c.velocity.y<a.velocity.y?a.velocity.y*=-1:0<c.velocity.y&&!c.immovable&&a.velocity.x>c.velocity.y&&(c.velocity.y*=-1));a.immovable||(a.x+=a.velocity.x*this.game.time.physicsElapsed-h*Math.cos(e),a.y+=a.velocity.y*this.game.time.physicsElapsed-h*Math.sin(e));c.immovable||(c.x+=c.velocity.x*this.game.time.physicsElapsed+
h*Math.cos(e),c.y+=c.velocity.y*this.game.time.physicsElapsed+h*Math.sin(e));a.onCollide&&a.onCollide.dispatch(a.sprite,c.sprite);c.onCollide&&c.onCollide.dispatch(c.sprite,a.sprite);return!0},getOverlapX:function(a,b,d){var c=0,h=a.deltaAbsX()+b.deltaAbsX()+this.OVERLAP_BIAS;0===a.deltaX()&&0===b.deltaX()?(a.embedded=!0,b.embedded=!0):a.deltaX()>b.deltaX()?(c=a.right-b.x,c>h&&!d||!1===a.checkCollision.right||!1===b.checkCollision.left?c=0:(a.touching.none=!1,a.touching.right=!0,b.touching.none=!1,
b.touching.left=!0)):a.deltaX()<b.deltaX()&&(c=a.x-b.width-b.x,-c>h&&!d||!1===a.checkCollision.left||!1===b.checkCollision.right?c=0:(a.touching.none=!1,a.touching.left=!0,b.touching.none=!1,b.touching.right=!0));a.overlapX=c;return b.overlapX=c},getOverlapY:function(a,b,d){var c=0,h=a.deltaAbsY()+b.deltaAbsY()+this.OVERLAP_BIAS;0===a.deltaY()&&0===b.deltaY()?(a.embedded=!0,b.embedded=!0):a.deltaY()>b.deltaY()?(c=a.bottom-b.y,c>h&&!d||!1===a.checkCollision.down||!1===b.checkCollision.up?c=0:(a.touching.none=
!1,a.touching.down=!0,b.touching.none=!1,b.touching.up=!0)):a.deltaY()<b.deltaY()&&(c=a.y-b.bottom,-c>h&&!d||!1===a.checkCollision.up||!1===b.checkCollision.down?c=0:(a.touching.none=!1,a.touching.up=!0,b.touching.none=!1,b.touching.down=!0));a.overlapY=c;return b.overlapY=c},separateX:function(a,b,d){var c=this.getOverlapX(a,b,d);if(d||0===c||a.immovable&&b.immovable||a.customSeparateX||b.customSeparateX)return 0!==c||a.embedded&&b.embedded;d=a.velocity.x;var h=b.velocity.x;a.immovable||b.immovable?
a.immovable?(b.x+=c,b.velocity.x=d-h*b.bounce.x,a.moves&&(b.y+=(a.y-a.prev.y)*a.friction.y)):(a.x-=c,a.velocity.x=h-d*a.bounce.x,b.moves&&(a.y+=(b.y-b.prev.y)*b.friction.y)):(c*=.5,a.x-=c,b.x+=c,c=Math.sqrt(h*h*b.mass/a.mass)*(0<h?1:-1),d=Math.sqrt(d*d*a.mass/b.mass)*(0<d?1:-1),h=.5*(c+d),a.velocity.x=h+(c-h)*a.bounce.x,b.velocity.x=h+(d-h)*b.bounce.x);return!0},separateY:function(a,b,d){var c=this.getOverlapY(a,b,d);if(d||0===c||a.immovable&&b.immovable||a.customSeparateY||b.customSeparateY)return 0!==
c||a.embedded&&b.embedded;d=a.velocity.y;var h=b.velocity.y;a.immovable||b.immovable?a.immovable?(b.y+=c,b.velocity.y=d-h*b.bounce.y,a.moves&&(b.x+=(a.x-a.prev.x)*a.friction.x)):(a.y-=c,a.velocity.y=h-d*a.bounce.y,b.moves&&(a.x+=(b.x-b.prev.x)*b.friction.x)):(c*=.5,a.y-=c,b.y+=c,c=Math.sqrt(h*h*b.mass/a.mass)*(0<h?1:-1),d=Math.sqrt(d*d*a.mass/b.mass)*(0<d?1:-1),h=.5*(c+d),a.velocity.y=h+(c-h)*a.bounce.y,b.velocity.y=h+(d-h)*b.bounce.y);return!0},getObjectsUnderPointer:function(a,b,d,e){if(0!==b.length&&
a.exists)return this.getObjectsAtLocation(a.x,a.y,b,d,e,a)},getObjectsAtLocation:function(a,c,d,e,h,f){this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(d);var g=new b.Rectangle(a,c,1,1);d=[];for(var g=this.quadTree.retrieve(g),l=0;l<g.length;l++)g[l].hitTest(a,c)&&(e&&e.call(h,f,g[l].sprite),d.push(g[l].sprite));return d},moveToObject:function(a,
b,d,e){void 0===d&&(d=60);void 0===e&&(e=0);var c=Math.atan2(b.y-a.y,b.x-a.x);0<e&&(d=this.distanceBetween(a,b)/(e/1E3));a.body.velocity.x=Math.cos(c)*d;a.body.velocity.y=Math.sin(c)*d;return c},moveToPointer:function(a,b,d,e){void 0===b&&(b=60);d=d||this.game.input.activePointer;void 0===e&&(e=0);var c=this.angleToPointer(a,d);0<e&&(b=this.distanceToPointer(a,d)/(e/1E3));a.body.velocity.x=Math.cos(c)*b;a.body.velocity.y=Math.sin(c)*b;return c},moveToXY:function(a,b,d,e,h){void 0===e&&(e=60);void 0===
h&&(h=0);var c=Math.atan2(d-a.y,b-a.x);0<h&&(e=this.distanceToXY(a,b,d)/(h/1E3));a.body.velocity.x=Math.cos(c)*e;a.body.velocity.y=Math.sin(c)*e;return c},velocityFromAngle:function(a,c,d){void 0===c&&(c=60);d=d||new b.Point;return d.setTo(Math.cos(this.game.math.degToRad(a))*c,Math.sin(this.game.math.degToRad(a))*c)},velocityFromRotation:function(a,c,d){void 0===c&&(c=60);d=d||new b.Point;return d.setTo(Math.cos(a)*c,Math.sin(a)*c)},accelerationFromRotation:function(a,c,d){void 0===c&&(c=60);d=d||
new b.Point;return d.setTo(Math.cos(a)*c,Math.sin(a)*c)},accelerateToObject:function(a,b,d,e,h){void 0===d&&(d=60);void 0===e&&(e=1E3);void 0===h&&(h=1E3);b=this.angleBetween(a,b);a.body.acceleration.setTo(Math.cos(b)*d,Math.sin(b)*d);a.body.maxVelocity.setTo(e,h);return b},accelerateToPointer:function(a,b,d,e,h){void 0===d&&(d=60);void 0===b&&(b=this.game.input.activePointer);void 0===e&&(e=1E3);void 0===h&&(h=1E3);b=this.angleToPointer(a,b);a.body.acceleration.setTo(Math.cos(b)*d,Math.sin(b)*d);
a.body.maxVelocity.setTo(e,h);return b},accelerateToXY:function(a,b,d,e,h,f){void 0===e&&(e=60);void 0===h&&(h=1E3);void 0===f&&(f=1E3);b=this.angleToXY(a,b,d);a.body.acceleration.setTo(Math.cos(b)*e,Math.sin(b)*e);a.body.maxVelocity.setTo(h,f);return b},distanceBetween:function(a,b,d){void 0===d&&(d=!1);var c=d?a.world.x-b.world.x:a.x-b.x;a=d?a.world.y-b.world.y:a.y-b.y;return Math.sqrt(c*c+a*a)},distanceToXY:function(a,b,d,e){void 0===e&&(e=!1);b=e?a.world.x-b:a.x-b;a=e?a.world.y-d:a.y-d;return Math.sqrt(b*
b+a*a)},distanceToPointer:function(a,b,d){void 0===b&&(b=this.game.input.activePointer);void 0===d&&(d=!1);var c=d?a.world.x-b.worldX:a.x-b.worldX;a=d?a.world.y-b.worldY:a.y-b.worldY;return Math.sqrt(c*c+a*a)},angleBetween:function(a,b,d){void 0===d&&(d=!1);return d?Math.atan2(b.world.y-a.world.y,b.world.x-a.world.x):Math.atan2(b.y-a.y,b.x-a.x)},angleBetweenCenters:function(a,b){return Math.atan2(b.centerY-a.centerY,b.centerX-a.centerX)},angleToXY:function(a,b,d,e){void 0===e&&(e=!1);return e?Math.atan2(d-
a.world.y,b-a.world.x):Math.atan2(d-a.y,b-a.x)},angleToPointer:function(a,b,d){void 0===b&&(b=this.game.input.activePointer);void 0===d&&(d=!1);return d?Math.atan2(b.worldY-a.world.y,b.worldX-a.world.x):Math.atan2(b.worldY-a.y,b.worldX-a.x)},worldAngleToPointer:function(a,b){return this.angleToPointer(a,b,!0)}};b.Physics.Arcade.Body=function(a){this.sprite=a;this.game=a.game;this.type=b.Physics.ARCADE;this.enable=!0;this.isCircle=!1;this.radius=0;this.offset=new b.Point;this.position=new b.Point(a.x,
a.y);this.prev=new b.Point(this.position.x,this.position.y);this.allowRotation=!0;this.preRotation=this.rotation=a.angle;this.width=a.width;this.height=a.height;this.sourceWidth=a.width;this.sourceHeight=a.height;a.texture&&(this.sourceWidth=a.texture.frame.width,this.sourceHeight=a.texture.frame.height);this.halfWidth=Math.abs(a.width/2);this.halfHeight=Math.abs(a.height/2);this.center=new b.Point(a.x+this.halfWidth,a.y+this.halfHeight);this.velocity=new b.Point;this.newVelocity=new b.Point;this.deltaMax=
new b.Point;this.acceleration=new b.Point;this.drag=new b.Point;this.allowGravity=!0;this.gravity=new b.Point;this.bounce=new b.Point;this.onOverlap=this.onCollide=this.onWorldBounds=this.worldBounce=null;this.maxVelocity=new b.Point(1E4,1E4);this.friction=new b.Point(1,0);this.angularDrag=this.angularAcceleration=this.angularVelocity=0;this.maxAngular=1E3;this.mass=1;this.speed=this.angle=0;this.facing=b.NONE;this.immovable=!1;this.moves=!0;this.customSeparateY=this.customSeparateX=!1;this.overlapR=
this.overlapY=this.overlapX=0;this.collideWorldBounds=this.embedded=!1;this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0};this.touching={none:!0,up:!1,down:!1,left:!1,right:!1};this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1};this.blocked={up:!1,down:!1,left:!1,right:!1};this.tilePadding=new b.Point;this.isMoving=this.syncBounds=this.skipQuadTree=this.dirty=!1;this.stopVelocityOnCollide=!0;this.moveDuration=this.moveDistance=this.moveTimer=0;this.moveEnd=this.moveTarget=
null;this.onMoveComplete=new b.Signal;this.movementCallbackContext=this.movementCallback=null;this._reset=!0;this._sx=a.scale.x;this._sy=a.scale.y;this._dy=this._dx=0};b.Physics.Arcade.Body.prototype={updateBounds:function(){if(this.syncBounds){var a=this.sprite.getBounds();a.ceilAll();if(a.width!==this.width||a.height!==this.height)this.width=a.width,this.height=a.height,this._reset=!0}else{var a=Math.abs(this.sprite.scale.x),b=Math.abs(this.sprite.scale.y);if(a!==this._sx||b!==this._sy)this.width=
this.sourceWidth*a,this.height=this.sourceHeight*b,this._sx=a,this._sy=b,this._reset=!0}this._reset&&(this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight))},preUpdate:function(){if(this.enable&&!this.game.physics.arcade.isPaused){this.dirty=!0;this.wasTouching.none=this.touching.none;this.wasTouching.up=this.touching.up;this.wasTouching.down=this.touching.down;this.wasTouching.left=this.touching.left;
this.wasTouching.right=this.touching.right;this.touching.none=!0;this.touching.up=!1;this.touching.down=!1;this.touching.left=!1;this.touching.right=!1;this.blocked.up=!1;this.blocked.down=!1;this.blocked.left=!1;this.embedded=this.blocked.right=!1;this.updateBounds();this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x;this.position.x-=0>this.sprite.scale.x?this.width:0;this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.sprite.height+
this.sprite.scale.y*this.offset.y;this.position.y-=0>this.sprite.scale.y?this.height:0;this.preRotation=this.rotation=this.sprite.angle;if(this._reset||this.sprite.fresh)this.prev.x=this.position.x,this.prev.y=this.position.y;if(this.moves){this.game.physics.arcade.updateMotion(this);this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed);this.position.x+=this.newVelocity.x;this.position.y+=this.newVelocity.y;if(this.position.x!==this.prev.x||
this.position.y!==this.prev.y)this.angle=Math.atan2(this.velocity.y,this.velocity.x);this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y);this.collideWorldBounds&&this.checkWorldBounds()&&this.onWorldBounds&&this.onWorldBounds.dispatch(this.sprite,this.blocked.up,this.blocked.down,this.blocked.left,this.blocked.right)}this._dx=this.deltaX();this._dy=this.deltaY();this._reset=!1}},updateMovement:function(){var a,b=0!==this.overlapX||0!==this.overlapY;0<this.moveDuration?
(this.moveTimer+=this.game.time.elapsedMS,a=this.moveTimer/this.moveDuration):(this.moveTarget.end.set(this.position.x,this.position.y),a=this.moveTarget.length/this.moveDistance);if(this.movementCallback)var d=this.movementCallback.call(this.movementCallbackContext,this,this.velocity,a);return b||1<=a||void 0!==d&&!0!==d?(this.stopMovement(1<=a||this.stopVelocityOnCollide&&b),!1):!0},stopMovement:function(a){this.isMoving&&(this.isMoving=!1,a&&this.velocity.set(0),this.onMoveComplete.dispatch(this.sprite,
0!==this.overlapX||0!==this.overlapY))},postUpdate:function(){this.enable&&this.dirty&&(this.isMoving&&this.updateMovement(),this.dirty=!1,0>this.deltaX()?this.facing=b.LEFT:0<this.deltaX()&&(this.facing=b.RIGHT),0>this.deltaY()?this.facing=b.UP:0<this.deltaY()&&(this.facing=b.DOWN),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),0!==this.deltaMax.x&&0!==this._dx&&(0>this._dx&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:0<this._dx&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),
0!==this.deltaMax.y&&0!==this._dy&&(0>this._dy&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:0<this._dy&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.position.x+=this._dx,this.sprite.position.y+=this._dy,this._reset=!0),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.allowRotation&&(this.sprite.angle+=this.deltaZ()),this.prev.x=this.position.x,this.prev.y=this.position.y)},checkWorldBounds:function(){var a=this.position,b=this.game.physics.arcade.bounds,
d=this.game.physics.arcade.checkCollision,e=this.worldBounce?-this.worldBounce.x:-this.bounce.x,h=this.worldBounce?-this.worldBounce.y:-this.bounce.y;if(this.isCircle){var f=this.center.y-this.radius,g=this.center.x+this.radius,k=this.center.y+this.radius;this.center.x-this.radius<b.x&&d.left?(a.x=b.x-this.halfWidth+this.radius,this.velocity.x*=e,this.blocked.left=!0):g>b.right&&d.right&&(a.x=b.right-this.halfWidth-this.radius,this.velocity.x*=e,this.blocked.right=!0);f<b.y&&d.up?(a.y=b.y-this.halfHeight+
this.radius,this.velocity.y*=h,this.blocked.up=!0):k>b.bottom&&d.down&&(a.y=b.bottom-this.halfHeight-this.radius,this.velocity.y*=h,this.blocked.down=!0)}else a.x<b.x&&d.left?(a.x=b.x,this.velocity.x*=e,this.blocked.left=!0):this.right>b.right&&d.right&&(a.x=b.right-this.width,this.velocity.x*=e,this.blocked.right=!0),a.y<b.y&&d.up?(a.y=b.y,this.velocity.y*=h,this.blocked.up=!0):this.bottom>b.bottom&&d.down&&(a.y=b.bottom-this.height,this.velocity.y*=h,this.blocked.down=!0);return this.blocked.up||
this.blocked.down||this.blocked.left||this.blocked.right},moveFrom:function(a,b,d){void 0===b&&(b=this.speed);if(0===b)return!1;var c;void 0===d?(c=this.angle,d=this.game.math.radToDeg(c)):c=this.game.math.degToRad(d);this.moveTimer=0;this.moveDuration=a;0===d||180===d?this.velocity.set(Math.cos(c)*b,0):90===d||270===d?this.velocity.set(0,Math.sin(c)*b):this.velocity.set(Math.cos(c)*b,Math.sin(c)*b);return this.isMoving=!0},moveTo:function(a,c,d){a=c/(a/1E3);if(0===a)return!1;var e;void 0===d?(e=
this.angle,d=this.game.math.radToDeg(e)):e=this.game.math.degToRad(d);c=Math.abs(c);this.moveDuration=0;this.moveDistance=c;null===this.moveTarget&&(this.moveTarget=new b.Line,this.moveEnd=new b.Point);this.moveTarget.fromAngle(this.x,this.y,e,c);this.moveEnd.set(this.moveTarget.end.x,this.moveTarget.end.y);this.moveTarget.setTo(this.x,this.y,this.x,this.y);0===d||180===d?this.velocity.set(Math.cos(e)*a,0):90===d||270===d?this.velocity.set(0,Math.sin(e)*a):this.velocity.set(Math.cos(e)*a,Math.sin(e)*
a);return this.isMoving=!0},setSize:function(a,b,d,e){void 0===d&&(d=this.offset.x);void 0===e&&(e=this.offset.y);this.sourceWidth=a;this.sourceHeight=b;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(d,e);this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight);this.isCircle=!1;this.radius=0},setCircle:function(a,b,d){void 0===b&&(b=this.offset.x);
void 0===d&&(d=this.offset.y);0<a?(this.isCircle=!0,this.radius=a,this.sourceWidth=2*a,this.sourceHeight=2*a,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(b,d),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)):this.isCircle=!1},reset:function(a,b){this.velocity.set(0);this.acceleration.set(0);this.angularAcceleration=this.angularVelocity=
this.speed=0;this.position.x=a-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x;this.position.x-=0>this.sprite.scale.x?this.width:0;this.position.y=b-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y;this.position.y-=0>this.sprite.scale.y?this.height:0;this.prev.x=this.position.x;this.prev.y=this.position.y;this.preRotation=this.rotation=this.sprite.angle;this._sx=this.sprite.scale.x;this._sy=this.sprite.scale.y;this.center.setTo(this.position.x+this.halfWidth,
this.position.y+this.halfHeight)},getBounds:function(a){this.isCircle?(a.x=this.center.x-this.radius,a.y=this.center.y-this.radius,a.right=this.center.x+this.radius,a.bottom=this.center.y+this.radius):(a.x=this.x,a.y=this.y,a.right=this.right,a.bottom=this.bottom);return a},hitTest:function(a,c){return this.isCircle?b.Circle.contains(this,a,c):b.Rectangle.contains(this,a,c)},onFloor:function(){return this.blocked.down},onCeiling:function(){return this.blocked.up},onWall:function(){return this.blocked.left||
this.blocked.right},deltaAbsX:function(){return 0<this.deltaX()?this.deltaX():-this.deltaX()},deltaAbsY:function(){return 0<this.deltaY()?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation},destroy:function(){this.sprite.parent&&this.sprite.parent instanceof b.Group&&this.sprite.parent.removeFromHash(this.sprite);this.sprite=this.sprite.body=null}};Object.defineProperty(b.Physics.Arcade.Body.prototype,
"left",{get:function(){return this.position.x}});Object.defineProperty(b.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}});Object.defineProperty(b.Physics.Arcade.Body.prototype,"top",{get:function(){return this.position.y}});Object.defineProperty(b.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}});Object.defineProperty(b.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=
a}});Object.defineProperty(b.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=a}});b.Physics.Arcade.Body.render=function(a,b,d,e){void 0===e&&(e=!0);d=d||"rgba(0,255,0,0.4)";a.fillStyle=d;a.strokeStyle=d;b.isCircle?(a.beginPath(),a.arc(b.center.x-b.game.camera.x,b.center.y-b.game.camera.y,b.radius,0,2*Math.PI),e?a.fill():a.stroke()):e?a.fillRect(b.position.x-b.game.camera.x,b.position.y-b.game.camera.y,b.width,b.height):a.strokeRect(b.position.x-
b.game.camera.x,b.position.y-b.game.camera.y,b.width,b.height)};b.Physics.Arcade.Body.renderBodyInfo=function(a,b){a.line("x: "+b.x.toFixed(2),"y: "+b.y.toFixed(2),"width: "+b.width,"height: "+b.height);a.line("velocity x: "+b.velocity.x.toFixed(2),"y: "+b.velocity.y.toFixed(2),"deltaX: "+b._dx.toFixed(2),"deltaY: "+b._dy.toFixed(2));a.line("acceleration x: "+b.acceleration.x.toFixed(2),"y: "+b.acceleration.y.toFixed(2),"speed: "+b.speed.toFixed(2),"angle: "+b.angle.toFixed(2));a.line("gravity x: "+
b.gravity.x,"y: "+b.gravity.y,"bounce x: "+b.bounce.x.toFixed(2),"y: "+b.bounce.y.toFixed(2));a.line("touching left: "+b.touching.left,"right: "+b.touching.right,"up: "+b.touching.up,"down: "+b.touching.down);a.line("blocked left: "+b.blocked.left,"right: "+b.blocked.right,"up: "+b.blocked.up,"down: "+b.blocked.down)};b.Physics.Arcade.Body.prototype.constructor=b.Physics.Arcade.Body;b.Physics.Arcade.TilemapCollision=function(){};b.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(a,
b,d,e,h,f){if(a.body){var c=b.getTiles(a.body.position.x-a.body.tilePadding.x,a.body.position.y-a.body.tilePadding.y,a.body.width+a.body.tilePadding.x,a.body.height+a.body.tilePadding.y,!1,!1);if(0!==c.length)for(var g=0;g<c.length;g++)e?e.call(h,a,c[g])&&this.separateTile(g,a.body,c[g],b,f)&&(this._total++,d&&d.call(h,a,c[g])):this.separateTile(g,a.body,c[g],b,f)&&(this._total++,d&&d.call(h,a,c[g]))}},collideGroupVsTilemapLayer:function(a,b,d,e,h,f){if(0!==a.length)for(var c=0;c<a.children.length;c++)a.children[c].exists&&
this.collideSpriteVsTilemapLayer(a.children[c],b,d,e,h,f)},separateTile:function(a,b,d,e,h){if(!b.enable)return!1;a=e.fixedToCamera?0:e.position.x;var c=e.fixedToCamera?0:e.position.y;if(!d.intersects(b.position.x-a,b.position.y-c,b.right-a,b.bottom-c))return!1;if(h)return!0;if(d.collisionCallback&&!d.collisionCallback.call(d.collisionCallbackContext,b.sprite,d)||"undefined"!==typeof d.layer.callbacks&&d.layer.callbacks[d.index]&&!d.layer.callbacks[d.index].callback.call(d.layer.callbacks[d.index].callbackContext,
b.sprite,d)||!(d.faceLeft||d.faceRight||d.faceTop||d.faceBottom))return!1;var f=h=0,g=0,k=1;b.deltaAbsX()>b.deltaAbsY()?g=-1:b.deltaAbsX()<b.deltaAbsY()&&(k=-1);0!==b.deltaX()&&0!==b.deltaY()&&(d.faceLeft||d.faceRight)&&(d.faceTop||d.faceBottom)&&(g=Math.min(Math.abs(b.position.x-a-d.right),Math.abs(b.right-a-d.left)),k=Math.min(Math.abs(b.position.y-c-d.bottom),Math.abs(b.bottom-c-d.top)));if(g<k){if(d.faceLeft||d.faceRight)if(h=this.tileCheckX(b,d,e),0!==h&&!d.intersects(b.position.x-a,b.position.y-
c,b.right-a,b.bottom-c))return!0;if(d.faceTop||d.faceBottom)f=this.tileCheckY(b,d,e)}else{if(d.faceTop||d.faceBottom)if(f=this.tileCheckY(b,d,e),0!==f&&!d.intersects(b.position.x-a,b.position.y-c,b.right-a,b.bottom-c))return!0;if(d.faceLeft||d.faceRight)h=this.tileCheckX(b,d,e)}return 0!==h||0!==f},tileCheckX:function(a,b,d){var c=0;d=d.fixedToCamera?0:d.position.x;0>a.deltaX()&&!a.blocked.left&&b.collideRight&&a.checkCollision.left?b.faceRight&&a.x-d<b.right&&(c=a.x-d-b.right,c<-this.TILE_BIAS&&
(c=0)):0<a.deltaX()&&!a.blocked.right&&b.collideLeft&&a.checkCollision.right&&b.faceLeft&&a.right-d>b.left&&(c=a.right-d-b.left,c>this.TILE_BIAS&&(c=0));0!==c&&(a.customSeparateX?a.overlapX=c:this.processTileSeparationX(a,c));return c},tileCheckY:function(a,b,d){var c=0;d=d.fixedToCamera?0:d.position.y;0>a.deltaY()&&!a.blocked.up&&b.collideDown&&a.checkCollision.up?b.faceBottom&&a.y-d<b.bottom&&(c=a.y-d-b.bottom,c<-this.TILE_BIAS&&(c=0)):0<a.deltaY()&&!a.blocked.down&&b.collideUp&&a.checkCollision.down&&
b.faceTop&&a.bottom-d>b.top&&(c=a.bottom-d-b.top,c>this.TILE_BIAS&&(c=0));0!==c&&(a.customSeparateY?a.overlapY=c:this.processTileSeparationY(a,c));return c},processTileSeparationX:function(a,b){0>b?a.blocked.left=!0:0<b&&(a.blocked.right=!0);a.position.x-=b;a.velocity.x=0===a.bounce.x?0:-a.velocity.x*a.bounce.x},processTileSeparationY:function(a,b){0>b?a.blocked.up=!0:0<b&&(a.blocked.down=!0);a.position.y-=b;a.velocity.y=0===a.bounce.y?0:-a.velocity.y*a.bounce.y}};b.Utils.mixinPrototype(b.Physics.Arcade.prototype,
b.Physics.Arcade.TilemapCollision.prototype);p2.Body.prototype.parent=null;p2.Spring.prototype.parent=null;b.Physics.P2=function(a,c){this.game=a;void 0===c?c={gravity:[0,0],broadphase:new p2.SAPBroadphase}:(c.hasOwnProperty("gravity")||(c.gravity=[0,0]),c.hasOwnProperty("broadphase")||(c.broadphase=new p2.SAPBroadphase));this.config=c;this.world=new p2.World(this.config);this.frameRate=1/60;this.paused=this.useElapsedTime=!1;this.materials=[];this.gravity=new b.Physics.P2.InversePointProxy(this,
this.world.gravity);this.walls={left:null,right:null,top:null,bottom:null};this.onBodyAdded=new b.Signal;this.onBodyRemoved=new b.Signal;this.onSpringAdded=new b.Signal;this.onSpringRemoved=new b.Signal;this.onConstraintAdded=new b.Signal;this.onConstraintRemoved=new b.Signal;this.onContactMaterialAdded=new b.Signal;this.onContactMaterialRemoved=new b.Signal;this.callbackContext=this.postBroadphaseCallback=null;this.onBeginContact=new b.Signal;this.onEndContact=new b.Signal;c.hasOwnProperty("mpx")&&
c.hasOwnProperty("pxm")&&c.hasOwnProperty("mpxi")&&c.hasOwnProperty("pxmi")&&(this.mpx=c.mpx,this.mpxi=c.mpxi,this.pxm=c.pxm,this.pxmi=c.pxmi);this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.collisionGroups=[];this.nothingCollisionGroup=new b.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new b.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new b.Physics.P2.CollisionGroup(2147483648);this.boundsCollidesWith=
[];this._toRemove=[];this._collisionGroupID=2;this._boundsBottom=this._boundsTop=this._boundsRight=this._boundsLeft=!0;this._boundsOwnGroup=!1;this.setBoundsToWorld(!0,!0,!0,!0,!1)};b.Physics.P2.prototype={removeBodyNextStep:function(a){this._toRemove.push(a)},preUpdate:function(){for(var a=this._toRemove.length;a--;)this.removeBody(this._toRemove[a]);this._toRemove.length=0},enable:function(a,c,d){void 0===c&&(c=!1);void 0===d&&(d=!0);var e;if(Array.isArray(a))for(e=a.length;e--;)a[e]instanceof b.Group?
this.enable(a[e].children,c,d):(this.enableBody(a[e],c),d&&a[e].hasOwnProperty("children")&&0<a[e].children.length&&this.enable(a[e],c,!0));else a instanceof b.Group?this.enable(a.children,c,d):(this.enableBody(a,c),d&&a.hasOwnProperty("children")&&0<a.children.length&&this.enable(a.children,c,!0))},enableBody:function(a,c){a.hasOwnProperty("body")&&null===a.body&&(a.body=new b.Physics.P2.Body(this.game,a,a.x,a.y,1),a.body.debug=c,"undefined"!==typeof a.anchor&&a.anchor.set(.5))},setImpactEvents:function(a){if(a)this.world.on("impact",
this.impactHandler,this);else this.world.off("impact",this.impactHandler,this)},setPostBroadphaseCallback:function(a,b){this.postBroadphaseCallback=a;this.callbackContext=b;if(null!==a)this.world.on("postBroadphase",this.postBroadphaseHandler,this);else this.world.off("postBroadphase",this.postBroadphaseHandler,this)},postBroadphaseHandler:function(a){if(this.postBroadphaseCallback&&0!==a.pairs.length)for(var b=a.pairs.length-2;0<=b;b-=2)a.pairs[b].parent&&a.pairs[b+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,
a.pairs[b].parent,a.pairs[b+1].parent)&&a.pairs.splice(b,2)},impactHandler:function(a){if(a.bodyA.parent&&a.bodyB.parent){var b=a.bodyA.parent,d=a.bodyB.parent;b._bodyCallbacks[a.bodyB.id]&&b._bodyCallbacks[a.bodyB.id].call(b._bodyCallbackContext[a.bodyB.id],b,d,a.shapeA,a.shapeB);d._bodyCallbacks[a.bodyA.id]&&d._bodyCallbacks[a.bodyA.id].call(d._bodyCallbackContext[a.bodyA.id],d,b,a.shapeB,a.shapeA);b._groupCallbacks[a.shapeB.collisionGroup]&&b._groupCallbacks[a.shapeB.collisionGroup].call(b._groupCallbackContext[a.shapeB.collisionGroup],
b,d,a.shapeA,a.shapeB);d._groupCallbacks[a.shapeA.collisionGroup]&&d._groupCallbacks[a.shapeA.collisionGroup].call(d._groupCallbackContext[a.shapeA.collisionGroup],d,b,a.shapeB,a.shapeA)}},beginContactHandler:function(a){a.bodyA&&a.bodyB&&(this.onBeginContact.dispatch(a.bodyA,a.bodyB,a.shapeA,a.shapeB,a.contactEquations),a.bodyA.parent&&a.bodyA.parent.onBeginContact.dispatch(a.bodyB.parent,a.bodyB,a.shapeA,a.shapeB,a.contactEquations),a.bodyB.parent&&a.bodyB.parent.onBeginContact.dispatch(a.bodyA.parent,
a.bodyA,a.shapeB,a.shapeA,a.contactEquations))},endContactHandler:function(a){a.bodyA&&a.bodyB&&(this.onEndContact.dispatch(a.bodyA,a.bodyB,a.shapeA,a.shapeB),a.bodyA.parent&&a.bodyA.parent.onEndContact.dispatch(a.bodyB.parent,a.bodyB,a.shapeA,a.shapeB),a.bodyB.parent&&a.bodyB.parent.onEndContact.dispatch(a.bodyA.parent,a.bodyA,a.shapeB,a.shapeA))},setBoundsToWorld:function(a,b,d,e,h){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,
a,b,d,e,h)},setWorldMaterial:function(a,b,d,e,h){void 0===b&&(b=!0);void 0===d&&(d=!0);void 0===e&&(e=!0);void 0===h&&(h=!0);b&&this.walls.left&&(this.walls.left.shapes[0].material=a);d&&this.walls.right&&(this.walls.right.shapes[0].material=a);e&&this.walls.top&&(this.walls.top.shapes[0].material=a);h&&this.walls.bottom&&(this.walls.bottom.shapes[0].material=a)},updateBoundsCollisionGroup:function(a){void 0===a&&(a=!0);var b=a?this.boundsCollisionGroup.mask:this.everythingCollisionGroup.mask;this.walls.left&&
(this.walls.left.shapes[0].collisionGroup=b);this.walls.right&&(this.walls.right.shapes[0].collisionGroup=b);this.walls.top&&(this.walls.top.shapes[0].collisionGroup=b);this.walls.bottom&&(this.walls.bottom.shapes[0].collisionGroup=b);this._boundsOwnGroup=a},setBounds:function(a,b,d,e,h,f,g,k,m){void 0===h&&(h=this._boundsLeft);void 0===f&&(f=this._boundsRight);void 0===g&&(g=this._boundsTop);void 0===k&&(k=this._boundsBottom);void 0===m&&(m=this._boundsOwnGroup);this.setupWall(h,"left",a,b,1.5707963267948966,
m);this.setupWall(f,"right",a+d,b,-1.5707963267948966,m);this.setupWall(g,"top",a,b,-3.141592653589793,m);this.setupWall(k,"bottom",a,b+e,0,m);this._boundsLeft=h;this._boundsRight=f;this._boundsTop=g;this._boundsBottom=k;this._boundsOwnGroup=m},setupWall:function(a,b,d,e,h,f){a?(this.walls[b]?this.walls[b].position=[this.pxmi(d),this.pxmi(e)]:(this.walls[b]=new p2.Body({mass:0,position:[this.pxmi(d),this.pxmi(e)],angle:h}),this.walls[b].addShape(new p2.Plane),this.world.addBody(this.walls[b])),f&&
(this.walls[b].shapes[0].collisionGroup=this.boundsCollisionGroup.mask)):this.walls[b]&&(this.world.removeBody(this.walls[b]),this.walls[b]=null)},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(){this.paused||(this.useElapsedTime?this.world.step(this.game.time.physicsElapsed):this.world.step(this.frameRate))},reset:function(){this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.nothingCollisionGroup=
new b.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new b.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new b.Physics.P2.CollisionGroup(2147483648);this._collisionGroupID=2;this.setBoundsToWorld(!0,!0,!0,!0,!1)},clear:function(){this.world.time=0;this.world.fixedStepTime=0;this.world.solver&&this.world.solver.equations.length&&this.world.solver.removeAllEquations();for(var a=this.world.constraints,b=a.length-1;0<=b;b--)this.world.removeConstraint(a[b]);a=this.world.bodies;for(b=
a.length-1;0<=b;b--)this.world.removeBody(a[b]);a=this.world.springs;for(b=a.length-1;0<=b;b--)this.world.removeSpring(a[b]);a=this.world.contactMaterials;for(b=a.length-1;0<=b;b--)this.world.removeContactMaterial(a[b]);this.world.off("beginContact",this.beginContactHandler,this);this.world.off("endContact",this.endContactHandler,this);this.impactCallback=this.callbackContext=this.postBroadphaseCallback=null;this.collisionGroups=[];this._toRemove=[];this.boundsCollidesWith=[];this.walls={left:null,
right:null,top:null,bottom:null}},destroy:function(){this.clear();this.game=null},addBody:function(a){if(a.data.world)return!1;this.world.addBody(a.data);this.onBodyAdded.dispatch(a);return!0},removeBody:function(a){a.data.world===this.world&&(this.world.removeBody(a.data),this.onBodyRemoved.dispatch(a));return a},addSpring:function(a){a instanceof b.Physics.P2.Spring||a instanceof b.Physics.P2.RotationalSpring?this.world.addSpring(a.data):this.world.addSpring(a);this.onSpringAdded.dispatch(a);return a},
removeSpring:function(a){a instanceof b.Physics.P2.Spring||a instanceof b.Physics.P2.RotationalSpring?this.world.removeSpring(a.data):this.world.removeSpring(a);this.onSpringRemoved.dispatch(a);return a},createDistanceConstraint:function(a,c,d,e,h,f){a=this.getBody(a);c=this.getBody(c);if(a&&c)return this.addConstraint(new b.Physics.P2.DistanceConstraint(this,a,c,d,e,h,f));console.warn("Cannot create Constraint, invalid body objects given")},createGearConstraint:function(a,c,d,e){a=this.getBody(a);
c=this.getBody(c);if(a&&c)return this.addConstraint(new b.Physics.P2.GearConstraint(this,a,c,d,e));console.warn("Cannot create Constraint, invalid body objects given")},createRevoluteConstraint:function(a,c,d,e,h,f){a=this.getBody(a);d=this.getBody(d);if(a&&d)return this.addConstraint(new b.Physics.P2.RevoluteConstraint(this,a,c,d,e,h,f));console.warn("Cannot create Constraint, invalid body objects given")},createLockConstraint:function(a,c,d,e,h){a=this.getBody(a);c=this.getBody(c);if(a&&c)return this.addConstraint(new b.Physics.P2.LockConstraint(this,
a,c,d,e,h));console.warn("Cannot create Constraint, invalid body objects given")},createPrismaticConstraint:function(a,c,d,e,h,f,g){a=this.getBody(a);c=this.getBody(c);if(a&&c)return this.addConstraint(new b.Physics.P2.PrismaticConstraint(this,a,c,d,e,h,f,g));console.warn("Cannot create Constraint, invalid body objects given")},addConstraint:function(a){this.world.addConstraint(a);this.onConstraintAdded.dispatch(a);return a},removeConstraint:function(a){this.world.removeConstraint(a);this.onConstraintRemoved.dispatch(a);
return a},addContactMaterial:function(a){this.world.addContactMaterial(a);this.onContactMaterialAdded.dispatch(a);return a},removeContactMaterial:function(a){this.world.removeContactMaterial(a);this.onContactMaterialRemoved.dispatch(a);return a},getContactMaterial:function(a,b){return this.world.getContactMaterial(a,b)},setMaterial:function(a,b){for(var c=b.length;c--;)b[c].setMaterial(a)},createMaterial:function(a,c){var d=new b.Physics.P2.Material(a||"");this.materials.push(d);"undefined"!==typeof c&&
c.setMaterial(d);return d},createContactMaterial:function(a,c,d){void 0===a&&(a=this.createMaterial());void 0===c&&(c=this.createMaterial());a=new b.Physics.P2.ContactMaterial(a,c,d);return this.addContactMaterial(a)},getBodies:function(){for(var a=[],b=this.world.bodies.length;b--;)a.push(this.world.bodies[b].parent);return a},getBody:function(a){return a instanceof p2.Body?a:a instanceof b.Physics.P2.Body?a.data:a.body&&a.body.type===b.Physics.P2JS?a.body.data:null},getSprings:function(){for(var a=
[],b=this.world.springs.length;b--;)a.push(this.world.springs[b].parent);return a},getConstraints:function(){for(var a=[],b=this.world.constraints.length;b--;)a.push(this.world.constraints[b]);return a},hitTest:function(a,c,d,e){void 0===c&&(c=this.world.bodies);void 0===d&&(d=5);void 0===e&&(e=!1);a=[this.pxmi(a.x),this.pxmi(a.y)];for(var h=[],f=c.length;f--;)c[f]instanceof b.Physics.P2.Body&&(!e||c[f].data.type!==p2.Body.STATIC)?h.push(c[f].data):c[f]instanceof p2.Body&&c[f].parent&&(!e||c[f].type!==
p2.Body.STATIC)?h.push(c[f]):c[f]instanceof b.Sprite&&c[f].hasOwnProperty("body")&&(!e||c[f].body.data.type!==p2.Body.STATIC)&&h.push(c[f].body.data);return this.world.hitTest(a,h,d)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(a){var c=Math.pow(2,this._collisionGroupID);this.walls.left&&(this.walls.left.shapes[0].collisionMask|=c);this.walls.right&&(this.walls.right.shapes[0].collisionMask|=c);this.walls.top&&(this.walls.top.shapes[0].collisionMask|=c);this.walls.bottom&&
(this.walls.bottom.shapes[0].collisionMask|=c);this._collisionGroupID++;c=new b.Physics.P2.CollisionGroup(c);this.collisionGroups.push(c);a&&this.setCollisionGroup(a,c);return c},setCollisionGroup:function(a,c){if(a instanceof b.Group)for(var d=0;d<a.total;d++)a.children[d].body&&a.children[d].body.type===b.Physics.P2JS&&a.children[d].body.setCollisionGroup(c);else a.body.setCollisionGroup(c)},createSpring:function(a,c,d,e,h,f,g,k,m){a=this.getBody(a);c=this.getBody(c);if(a&&c)return this.addSpring(new b.Physics.P2.Spring(this,
a,c,d,e,h,f,g,k,m));console.warn("Cannot create Spring, invalid body objects given")},createRotationalSpring:function(a,c,d,e,h){a=this.getBody(a);c=this.getBody(c);if(a&&c)return this.addSpring(new b.Physics.P2.RotationalSpring(this,a,c,d,e,h));console.warn("Cannot create Rotational Spring, invalid body objects given")},createBody:function(a,c,d,e,h,f){void 0===e&&(e=!1);a=new b.Physics.P2.Body(this.game,null,a,c,d);if(f&&!a.addPolygon(h,f))return!1;e&&this.world.addBody(a.data);return a},createParticle:function(a,
c,d,e,h,f){void 0===e&&(e=!1);a=new b.Physics.P2.Body(this.game,null,a,c,d);if(f&&!a.addPolygon(h,f))return!1;e&&this.world.addBody(a.data);return a},convertCollisionObjects:function(a,b,d){void 0===d&&(d=!0);for(var c=[],h=0,f=a.collision[b].length;h<f;h++){var g=a.collision[b][h];(g=this.createBody(g.x,g.y,0,d,{},g.polyline))&&c.push(g)}return c},clearTilemapLayerBodies:function(a,b){b=a.getLayer(b);for(var c=a.layers[b].bodies.length;c--;)a.layers[b].bodies[c].destroy();a.layers[b].bodies.length=
0},convertTilemap:function(a,b,d,e){b=a.getLayer(b);void 0===d&&(d=!0);void 0===e&&(e=!0);this.clearTilemapLayerBodies(a,b);for(var c,f=0,g=0,k=0,m=a.layers[b].height;k<m;k++)for(var n=c=0,p=a.layers[b].width;n<p;n++){var w=a.layers[b].data[k][n];if(w&&-1<w.index&&w.collides)if(e){var u=a.getTileRight(b,n,k);0===c&&(f=w.x*w.width,g=w.y*w.height,c=w.width);u&&u.collides?c+=w.width:(u=this.createBody(f,g,0,!1),u.addRectangle(c,w.height,c/2,w.height/2,0),d&&this.addBody(u),a.layers[b].bodies.push(u),
c=0)}else u=this.createBody(w.x*w.width,w.y*w.height,0,!1),u.addRectangle(w.width,w.height,w.width/2,w.height/2,0),d&&this.addBody(u),a.layers[b].bodies.push(u)}return a.layers[b].bodies},mpx:function(a){return 20*a},pxm:function(a){return.05*a},mpxi:function(a){return-20*a},pxmi:function(a){return-.05*a}};Object.defineProperty(b.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(a){this.world.defaultContactMaterial.friction=a}});Object.defineProperty(b.Physics.P2.prototype,
"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(a){this.world.defaultContactMaterial.restitution=a}});Object.defineProperty(b.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(a){this.world.defaultContactMaterial=a}});Object.defineProperty(b.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(a){this.world.applySpringForces=a}});Object.defineProperty(b.Physics.P2.prototype,
"applyDamping",{get:function(){return this.world.applyDamping},set:function(a){this.world.applyDamping=a}});Object.defineProperty(b.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(a){this.world.applyGravity=a}});Object.defineProperty(b.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(a){this.world.solveConstraints=a}});Object.defineProperty(b.Physics.P2.prototype,"time",{get:function(){return this.world.time}});
Object.defineProperty(b.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(a){this.world.emitImpactEvent=a}});Object.defineProperty(b.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(a){this.world.sleepMode=a}});Object.defineProperty(b.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}});b.Physics.P2.FixtureList=function(a){Array.isArray(a)||(a=[a]);this.rawList=a;this.init();this.parse(this.rawList)};
b.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={};this.groupedFixtures=[];this.allFixtures=[]},setCategory:function(a,b){this.getFixtures(b).forEach(function(b){b.collisionGroup=a})},setMask:function(a,b){this.getFixtures(b).forEach(function(b){b.collisionMask=a})},setSensor:function(a,b){this.getFixtures(b).forEach(function(b){b.sensor=a})},setMaterial:function(a,b){this.getFixtures(b).forEach(function(b){b.material=a})},getFixtures:function(a){var b=[];if(a){a instanceof
Array||(a=[a]);var d=this;a.forEach(function(a){d.namedFixtures[a]&&b.push(d.namedFixtures[a])});return this.flatten(b)}return this.allFixtures},getFixtureByKey:function(a){return this.namedFixtures[a]},getGroup:function(a){return this.groupedFixtures[a]},parse:function(){var a,b,d,e;d=this.rawList;e=[];for(a in d)b=d[a],isNaN(a-0)?this.namedFixtures[a]=this.flatten(b):(this.groupedFixtures[a]=this.groupedFixtures[a]||[],this.groupedFixtures[a]=this.groupedFixtures[a].concat(b)),e.push(this.allFixtures=
this.flatten(this.groupedFixtures))},flatten:function(a){var b,d;b=[];d=arguments.callee;a.forEach(function(a){return Array.prototype.push.apply(b,Array.isArray(a)?d(a):[a])});return b}};b.Physics.P2.PointProxy=function(a,b){this.world=a;this.destination=b};b.Physics.P2.PointProxy.prototype.constructor=b.Physics.P2.PointProxy;Object.defineProperty(b.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},set:function(a){this.destination[0]=this.world.pxm(a)}});
Object.defineProperty(b.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(a){this.destination[1]=this.world.pxm(a)}});Object.defineProperty(b.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(a){this.destination[0]=a}});Object.defineProperty(b.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(a){this.destination[1]=a}});b.Physics.P2.InversePointProxy=function(a,
b){this.world=a;this.destination=b};b.Physics.P2.InversePointProxy.prototype.constructor=b.Physics.P2.InversePointProxy;Object.defineProperty(b.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(a){this.destination[0]=this.world.pxmi(a)}});Object.defineProperty(b.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(a){this.destination[1]=this.world.pxmi(a)}});Object.defineProperty(b.Physics.P2.InversePointProxy.prototype,
"mx",{get:function(){return this.destination[0]},set:function(a){this.destination[0]=-a}});Object.defineProperty(b.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(a){this.destination[1]=-a}});b.Physics.P2.Body=function(a,c,d,e,h){c=c||null;d=d||0;e=e||0;void 0===h&&(h=1);this.game=a;this.world=a.physics.p2;this.sprite=c;this.type=b.Physics.P2JS;this.offset=new b.Point;this.data=new p2.Body({position:[this.world.pxmi(d),this.world.pxmi(e)],mass:h});
this.data.parent=this;this.velocity=new b.Physics.P2.InversePointProxy(this.world,this.data.velocity);this.force=new b.Physics.P2.InversePointProxy(this.world,this.data.force);this.gravity=new b.Point;this.onBeginContact=new b.Signal;this.onEndContact=new b.Signal;this.collidesWith=[];this.removeNextStep=!1;this.debugBody=null;this.dirty=!1;this._collideWorldBounds=!0;this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};this._reset=!1;c&&(this.setRectangleFromSprite(c),
c.exists&&this.game.physics.p2.addBody(this))};b.Physics.P2.Body.prototype={createBodyCallback:function(a,b,d){var c=-1;a.id?c=a.id:a.body&&(c=a.body.id);-1<c&&(null===b?(delete this._bodyCallbacks[c],delete this._bodyCallbackContext[c]):(this._bodyCallbacks[c]=b,this._bodyCallbackContext[c]=d))},createGroupCallback:function(a,b,d){null===b?(delete this._groupCallbacks[a.mask],delete this._groupCallbackContext[a.mask]):(this._groupCallbacks[a.mask]=b,this._groupCallbackContext[a.mask]=d)},getCollisionMask:function(){var a=
0;this._collideWorldBounds&&(a=this.game.physics.p2.boundsCollisionGroup.mask);for(var b=0;b<this.collidesWith.length;b++)a|=this.collidesWith[b].mask;return a},updateCollisionMask:function(a){var b=this.getCollisionMask();if(void 0===a)for(a=this.data.shapes.length-1;0<=a;a--)this.data.shapes[a].collisionMask=b;else a.collisionMask=b},setCollisionGroup:function(a,b){var c=this.getCollisionMask();if(void 0===b)for(var e=this.data.shapes.length-1;0<=e;e--)this.data.shapes[e].collisionGroup=a.mask,
this.data.shapes[e].collisionMask=c;else b.collisionGroup=a.mask,b.collisionMask=c},clearCollision:function(a,b,d){void 0===a&&(a=!0);void 0===b&&(b=!0);if(void 0===d)for(d=this.data.shapes.length-1;0<=d;d--)a&&(this.data.shapes[d].collisionGroup=null),b&&(this.data.shapes[d].collisionMask=null);else a&&(d.collisionGroup=null),b&&(d.collisionMask=null);a&&(this.collidesWith.length=0)},removeCollisionGroup:function(a,b,d){void 0===b&&(b=!0);var c;if(Array.isArray(a))for(var h=0;h<a.length;h++)c=this.collidesWith.indexOf(a[h]),
-1<c&&(this.collidesWith.splice(c,1),b&&(delete this._groupCallbacks[a.mask],delete this._groupCallbackContext[a.mask]));else c=this.collidesWith.indexOf(a),-1<c&&(this.collidesWith.splice(c,1),b&&(delete this._groupCallbacks[a.mask],delete this._groupCallbackContext[a.mask]));a=this.getCollisionMask();if(void 0===d)for(h=this.data.shapes.length-1;0<=h;h--)this.data.shapes[h].collisionMask=a;else d.collisionMask=a},collides:function(a,b,d,e){if(Array.isArray(a))for(var c=0;c<a.length;c++)-1===this.collidesWith.indexOf(a[c])&&
(this.collidesWith.push(a[c]),b&&this.createGroupCallback(a[c],b,d));else-1===this.collidesWith.indexOf(a)&&(this.collidesWith.push(a),b&&this.createGroupCallback(a,b,d));a=this.getCollisionMask();if(void 0===e)for(c=this.data.shapes.length-1;0<=c;c--)this.data.shapes[c].collisionMask=a;else e.collisionMask=a},adjustCenterOfMass:function(){this.data.adjustCenterOfMass();this.shapeChanged()},getVelocityAtPoint:function(a,b){return this.data.getVelocityAtPoint(a,b)},applyDamping:function(a){this.data.applyDamping(a)},
applyImpulse:function(a,b,d){this.data.applyImpulse(a,[this.world.pxmi(b),this.world.pxmi(d)])},applyImpulseLocal:function(a,b,d){this.data.applyImpulseLocal(a,[this.world.pxmi(b),this.world.pxmi(d)])},applyForce:function(a,b,d){this.data.applyForce(a,[this.world.pxmi(b),this.world.pxmi(d)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0;this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=
0;this.data.angularDamping=0},toLocalFrame:function(a,b){return this.data.toLocalFrame(a,b)},toWorldFrame:function(a,b){return this.data.toWorldFrame(a,b)},rotateLeft:function(a){this.data.angularVelocity=this.world.pxm(-a)},rotateRight:function(a){this.data.angularVelocity=this.world.pxm(a)},moveForward:function(a){a=this.world.pxmi(-a);var b=this.data.angle+Math.PI/2;this.data.velocity[0]=a*Math.cos(b);this.data.velocity[1]=a*Math.sin(b)},moveBackward:function(a){a=this.world.pxmi(-a);var b=this.data.angle+
Math.PI/2;this.data.velocity[0]=-(a*Math.cos(b));this.data.velocity[1]=-(a*Math.sin(b))},thrust:function(a){a=this.world.pxmi(-a);var b=this.data.angle+Math.PI/2;this.data.force[0]+=a*Math.cos(b);this.data.force[1]+=a*Math.sin(b)},thrustLeft:function(a){a=this.world.pxmi(-a);var b=this.data.angle;this.data.force[0]+=a*Math.cos(b);this.data.force[1]+=a*Math.sin(b)},thrustRight:function(a){a=this.world.pxmi(-a);var b=this.data.angle;this.data.force[0]-=a*Math.cos(b);this.data.force[1]-=a*Math.sin(b)},
reverse:function(a){a=this.world.pxmi(-a);var b=this.data.angle+Math.PI/2;this.data.force[0]-=a*Math.cos(b);this.data.force[1]-=a*Math.sin(b)},moveLeft:function(a){this.data.velocity[0]=this.world.pxmi(-a)},moveRight:function(a){this.data.velocity[0]=this.world.pxmi(a)},moveUp:function(a){this.data.velocity[1]=this.world.pxmi(-a)},moveDown:function(a){this.data.velocity[1]=this.world.pxmi(a)},preUpdate:function(){this.dirty=!0;this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)},
postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0])+this.offset.x;this.sprite.y=this.world.mpxi(this.data.position[1])+this.offset.y;this.fixedRotation||(this.sprite.rotation=this.data.angle);this.debugBody&&this.debugBody.updateSpriteTransform();this.dirty=!1},reset:function(a,b,d,e){void 0===d&&(d=!1);void 0===e&&(e=!1);this.setZeroForce();this.setZeroVelocity();this.setZeroRotation();d&&this.setZeroDamping();e&&(this.mass=1);this.x=a;this.y=b},addToWorld:function(){if(this.game.physics.p2._toRemove)for(var a=
0;a<this.game.physics.p2._toRemove.length;a++)this.game.physics.p2._toRemove[a]===this&&this.game.physics.p2._toRemove.splice(a,1);this.data.world!==this.game.physics.p2.world&&this.game.physics.p2.addBody(this)},removeFromWorld:function(){this.data.world===this.game.physics.p2.world&&this.game.physics.p2.removeBodyNextStep(this)},destroy:function(){this.removeFromWorld();this.clearShapes();this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};this.debugBody&&
this.debugBody.destroy(!0,!0);this.debugBody=null;this.sprite&&(this.sprite=this.sprite.body=null)},clearShapes:function(){for(var a=this.data.shapes.length;a--;)this.data.removeShape(this.data.shapes[a]);this.shapeChanged()},addShape:function(a,b,d,e){void 0===b&&(b=0);void 0===d&&(d=0);void 0===e&&(e=0);this.data.addShape(a,[this.world.pxmi(b),this.world.pxmi(d)],e);this.shapeChanged();return a},addCircle:function(a,b,d,e){a=new p2.Circle({radius:this.world.pxm(a)});return this.addShape(a,b,d,e)},
addRectangle:function(a,b,d,e,h){a=new p2.Box({width:this.world.pxm(a),height:this.world.pxm(b)});return this.addShape(a,d,e,h)},addPlane:function(a,b,d){var c=new p2.Plane;return this.addShape(c,a,b,d)},addParticle:function(a,b,d){var c=new p2.Particle;return this.addShape(c,a,b,d)},addLine:function(a,b,d,e){a=new p2.Line({length:this.world.pxm(a)});return this.addShape(a,b,d,e)},addCapsule:function(a,b,d,e,h){a=new p2.Capsule({length:this.world.pxm(a),radius:this.world.pxm(b)});return this.addShape(a,
d,e,h)},addPolygon:function(a,b){a=a||{};Array.isArray(b)||(b=Array.prototype.slice.call(arguments,1));var c=[];if(1===b.length&&Array.isArray(b[0]))c=b[0].slice(0);else if(Array.isArray(b[0]))c=b.slice();else if("number"===typeof b[0])for(var e=0,h=b.length;e<h;e+=2)c.push([b[e],b[e+1]]);e=c.length-1;c[e][0]===c[0][0]&&c[e][1]===c[0][1]&&c.pop();for(e=0;e<c.length;e++)c[e][0]=this.world.pxmi(c[e][0]),c[e][1]=this.world.pxmi(c[e][1]);c=this.data.fromPolygon(c,a);this.shapeChanged();return c},removeShape:function(a){a=
this.data.removeShape(a);this.shapeChanged();return a},setCircle:function(a,b,d,e){this.clearShapes();return this.addCircle(a,b,d,e)},setRectangle:function(a,b,d,e,h){void 0===a&&(a=16);void 0===b&&(b=16);this.clearShapes();return this.addRectangle(a,b,d,e,h)},setRectangleFromSprite:function(a){void 0===a&&(a=this.sprite);this.clearShapes();return this.addRectangle(a.width,a.height,0,0,a.rotation)},setMaterial:function(a,b){if(void 0===b)for(var c=this.data.shapes.length-1;0<=c;c--)this.data.shapes[c].material=
a;else b.material=a},shapeChanged:function(){this.debugBody&&this.debugBody.draw()},addPhaserPolygon:function(a,b){for(var c=this.game.cache.getPhysicsData(a,b),e=[],h=0;h<c.length;h++){var f=c[h],g=this.addFixture(f);e[f.filter.group]=e[f.filter.group]||[];e[f.filter.group]=e[f.filter.group].concat(g);f.fixtureKey&&(e[f.fixtureKey]=g)}this.data.aabbNeedsUpdate=!0;this.shapeChanged();return e},addFixture:function(a){var b=[];if(a.circle){var d=new p2.Circle({radius:this.world.pxm(a.circle.radius)});
d.collisionGroup=a.filter.categoryBits;d.collisionMask=a.filter.maskBits;d.sensor=a.isSensor;var e=p2.vec2.create();e[0]=this.world.pxmi(a.circle.position[0]-this.sprite.width/2);e[1]=this.world.pxmi(a.circle.position[1]-this.sprite.height/2);this.data.addShape(d,e);b.push(d)}else for(var e=a.polygons,h=p2.vec2.create(),f=0;f<e.length;f++){for(var d=e[f],g=[],k=0;k<d.length;k+=2)g.push([this.world.pxmi(d[k]),this.world.pxmi(d[k+1])]);d=new p2.Convex({vertices:g});for(g=0;g!==d.vertices.length;g++)k=
d.vertices[g],p2.vec2.sub(k,k,d.centerOfMass);p2.vec2.scale(h,d.centerOfMass,1);h[0]-=this.world.pxmi(this.sprite.width/2);h[1]-=this.world.pxmi(this.sprite.height/2);d.updateTriangles();d.updateCenterOfMass();d.updateBoundingRadius();d.collisionGroup=a.filter.categoryBits;d.collisionMask=a.filter.maskBits;d.sensor=a.isSensor;this.data.addShape(d,h);b.push(d)}return b},loadPolygon:function(a,b){for(var c=null===a?b:this.game.cache.getPhysicsData(a,b),e=p2.vec2.create(),h=0;h<c.length;h++){for(var f=
[],g=0;g<c[h].shape.length;g+=2)f.push([this.world.pxmi(c[h].shape[g]),this.world.pxmi(c[h].shape[g+1])]);f=new p2.Convex({vertices:f});for(g=0;g!==f.vertices.length;g++){var k=f.vertices[g];p2.vec2.sub(k,k,f.centerOfMass)}p2.vec2.scale(e,f.centerOfMass,1);e[0]-=this.world.pxmi(this.sprite.width/2);e[1]-=this.world.pxmi(this.sprite.height/2);f.updateTriangles();f.updateCenterOfMass();f.updateBoundingRadius();this.data.addShape(f,e)}this.data.aabbNeedsUpdate=!0;this.shapeChanged();return!0}};b.Physics.P2.Body.prototype.constructor=
b.Physics.P2.Body;b.Physics.P2.Body.DYNAMIC=1;b.Physics.P2.Body.STATIC=2;b.Physics.P2.Body.KINEMATIC=4;Object.defineProperty(b.Physics.P2.Body.prototype,"static",{get:function(){return this.data.type===b.Physics.P2.Body.STATIC},set:function(a){a&&this.data.type!==b.Physics.P2.Body.STATIC?(this.data.type=b.Physics.P2.Body.STATIC,this.mass=0):a||this.data.type!==b.Physics.P2.Body.STATIC||(this.data.type=b.Physics.P2.Body.DYNAMIC,this.mass=1)}});Object.defineProperty(b.Physics.P2.Body.prototype,"dynamic",
{get:function(){return this.data.type===b.Physics.P2.Body.DYNAMIC},set:function(a){a&&this.data.type!==b.Physics.P2.Body.DYNAMIC?(this.data.type=b.Physics.P2.Body.DYNAMIC,this.mass=1):a||this.data.type!==b.Physics.P2.Body.DYNAMIC||(this.data.type=b.Physics.P2.Body.STATIC,this.mass=0)}});Object.defineProperty(b.Physics.P2.Body.prototype,"kinematic",{get:function(){return this.data.type===b.Physics.P2.Body.KINEMATIC},set:function(a){a&&this.data.type!==b.Physics.P2.Body.KINEMATIC?(this.data.type=b.Physics.P2.Body.KINEMATIC,
this.mass=4):a||this.data.type!==b.Physics.P2.Body.KINEMATIC||(this.data.type=b.Physics.P2.Body.STATIC,this.mass=0)}});Object.defineProperty(b.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(a){a!==this.data.allowSleep&&(this.data.allowSleep=a)}});Object.defineProperty(b.Physics.P2.Body.prototype,"angle",{get:function(){return b.Math.wrapAngle(b.Math.radToDeg(this.data.angle))},set:function(a){this.data.angle=b.Math.degToRad(b.Math.wrapAngle(a))}});
Object.defineProperty(b.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(a){this.data.angularDamping=a}});Object.defineProperty(b.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(a){this.data.angularForce=a}});Object.defineProperty(b.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(a){this.data.angularVelocity=a}});Object.defineProperty(b.Physics.P2.Body.prototype,
"damping",{get:function(){return this.data.damping},set:function(a){this.data.damping=a}});Object.defineProperty(b.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(a){a!==this.data.fixedRotation&&(this.data.fixedRotation=a)}});Object.defineProperty(b.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(a){this.data.inertia=a}});Object.defineProperty(b.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},
set:function(a){a!==this.data.mass&&(this.data.mass=a,this.data.updateMassProperties())}});Object.defineProperty(b.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},set:function(a){a!==this.data.type&&(this.data.type=a)}});Object.defineProperty(b.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(a){this.data.angle=a}});Object.defineProperty(b.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},
set:function(a){this.data.sleepSpeedLimit=a}});Object.defineProperty(b.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(a){this.data.position[0]=this.world.pxmi(a)}});Object.defineProperty(b.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(a){this.data.position[1]=this.world.pxmi(a)}});Object.defineProperty(b.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}});Object.defineProperty(b.Physics.P2.Body.prototype,
"debug",{get:function(){return null!==this.debugBody},set:function(a){a&&!this.debugBody?this.debugBody=new b.Physics.P2.BodyDebug(this.game,this.data):!a&&this.debugBody&&(this.debugBody.destroy(),this.debugBody=null)}});Object.defineProperty(b.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(a){a&&!this._collideWorldBounds?(this._collideWorldBounds=!0,this.updateCollisionMask()):!a&&this._collideWorldBounds&&(this._collideWorldBounds=!1,
this.updateCollisionMask())}});b.Physics.P2.BodyDebug=function(a,c,d){b.Group.call(this,a);var e={pixelsPerLengthUnit:a.physics.p2.mpx(1),debugPolygons:!1,lineWidth:1,alpha:.5};this.settings=b.Utils.extend(e,d);this.ppu=this.settings.pixelsPerLengthUnit;this.ppu*=-1;this.body=c;this.canvas=new b.Graphics(a);this.canvas.alpha=this.settings.alpha;this.add(this.canvas);this.draw();this.updateSpriteTransform()};b.Physics.P2.BodyDebug.prototype=Object.create(b.Group.prototype);b.Physics.P2.BodyDebug.prototype.constructor=
b.Physics.P2.BodyDebug;b.Utils.extend(b.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu;this.position.y=this.body.position[1]*this.ppu;this.rotation=this.body.angle},draw:function(){var a,b,d,e,h,f,g,k,m,n,p,w,u;g=this.body;m=this.canvas;m.clear();d=parseInt(this.randomPastelHex(),16);f=this.lineWidth;if(g instanceof p2.Body&&g.shapes.length){var x=g.shapes.length;for(e=0;e!==x;){b=g.shapes[e];k=b.position||0;a=b.angle||0;if(b instanceof
p2.Circle)this.drawCircle(m,k[0]*this.ppu,k[1]*this.ppu,a,b.radius*this.ppu,d,f);else if(b instanceof p2.Capsule)this.drawCapsule(m,k[0]*this.ppu,k[1]*this.ppu,a,b.length*this.ppu,b.radius*this.ppu,16711680,d,f);else if(b instanceof p2.Plane)this.drawPlane(m,k[0]*this.ppu,-k[1]*this.ppu,d,16711680,5*f,10*f,10*f,100*this.ppu,a);else if(b instanceof p2.Line)this.drawLine(m,b.length*this.ppu,16711680,f);else if(b instanceof p2.Box)this.drawRectangle(m,k[0]*this.ppu,k[1]*this.ppu,a,b.width*this.ppu,b.height*
this.ppu,16711680,d,f);else if(b instanceof p2.Convex){n=[];p=p2.vec2.create();h=w=0;for(u=b.vertices.length;0<=u?w<u:w>u;h=0<=u?++w:--w)h=b.vertices[h],p2.vec2.rotate(p,h,a),n.push([(p[0]+k[0])*this.ppu,-(p[1]+k[1])*this.ppu]);this.drawConvex(m,n,b.triangles,16711680,d,f,this.settings.debugPolygons,[k[0]*this.ppu,-k[1]*this.ppu])}e++}}},drawRectangle:function(a,b,d,e,f,g,k,m,n){void 0===n&&(n=1);void 0===k&&(k=0);a.lineStyle(n,k,1);a.beginFill(m);a.drawRect(b-f/2,d-g/2,f,g)},drawCircle:function(a,
b,d,e,f,g,k){void 0===k&&(k=1);void 0===g&&(g=16777215);a.lineStyle(k,0,1);a.beginFill(g,1);a.drawCircle(b,d,2*-f);a.endFill();a.moveTo(b,d);a.lineTo(b+f*Math.cos(-e),d+f*Math.sin(-e))},drawLine:function(a,b,d,e){void 0===e&&(e=1);void 0===d&&(d=0);a.lineStyle(5*e,d,1);a.moveTo(-b/2,0);a.lineTo(b/2,0)},drawConvex:function(a,b,d,e,f,g,k,m){var c,h;void 0===g&&(g=1);void 0===e&&(e=0);if(k){e=[16711680,65280,255];for(d=0;d!==b.length+1;)c=b[d%b.length],k=b[(d+1)%b.length],f=c[0],h=c[1],c=k[0],k=k[1],
a.lineStyle(g,e[d%e.length],1),a.moveTo(f,-h),a.lineTo(c,-k),a.drawCircle(f,-h,2*g),d++;a.lineStyle(g,0,1);return a.drawCircle(m[0],m[1],2*g)}a.lineStyle(g,e,1);a.beginFill(f);for(d=0;d!==b.length;)m=b[d],g=m[0],m=m[1],0===d?a.moveTo(g,-m):a.lineTo(g,-m),d++;a.endFill();if(2<b.length)return a.moveTo(b[b.length-1][0],-b[b.length-1][1]),a.lineTo(b[0][0],-b[0][1])},drawPath:function(a,b,d,e,f){var c,h,g,k,m,n,p;void 0===f&&(f=1);void 0===d&&(d=0);a.lineStyle(f,d,1);"number"===typeof e&&a.beginFill(e);
h=c=null;for(d=0;d<b.length;){p=b[d];f=p[0];p=p[1];if(f!==c||p!==h)0===d?a.moveTo(f,p):(g=f,k=p,m=b[(d+1)%b.length][0],n=b[(d+1)%b.length][1],c=(g-c)*(n-h)-(m-c)*(k-h),0!==c&&a.lineTo(f,p)),c=f,h=p;d++}"number"===typeof e&&a.endFill();2<b.length&&"number"===typeof e&&(a.moveTo(b[b.length-1][0],b[b.length-1][1]),a.lineTo(b[0][0],b[0][1]))},drawPlane:function(a,b,d,e,f,g,k,m,n,p){void 0===g&&(g=1);void 0===e&&(e=16777215);a.lineStyle(g,f,11);a.beginFill(e);a.moveTo(b,-d);e=b+Math.cos(p)*this.game.width;
f=d+Math.sin(p)*this.game.height;a.lineTo(e,-f);a.moveTo(b,-d);e=b+Math.cos(p)*-this.game.width;f=d+Math.sin(p)*-this.game.height;a.lineTo(e,-f)},drawCapsule:function(a,b,d,e,f,g,k,m,n){void 0===n&&(n=1);void 0===k&&(k=0);a.lineStyle(n,k,1);var c=Math.cos(e);e=Math.sin(e);a.beginFill(m,1);a.drawCircle(-f/2*c+b,-f/2*e+d,2*-g);a.drawCircle(f/2*c+b,f/2*e+d,2*-g);a.endFill();a.lineStyle(n,k,0);a.beginFill(m,1);a.moveTo(-f/2*c+g*e+b,-f/2*e+g*c+d);a.lineTo(f/2*c+g*e+b,f/2*e+g*c+d);a.lineTo(f/2*c-g*e+b,
f/2*e-g*c+d);a.lineTo(-f/2*c-g*e+b,-f/2*e-g*c+d);a.endFill();a.lineStyle(n,k,1);a.moveTo(-f/2*c+g*e+b,-f/2*e+g*c+d);a.lineTo(f/2*c+g*e+b,f/2*e+g*c+d);a.moveTo(-f/2*c-g*e+b,-f/2*e-g*c+d);a.lineTo(f/2*c-g*e+b,f/2*e-g*c+d)},randomPastelHex:function(){var a,b,d,e;d=[255,255,255];e=Math.floor(256*Math.random());b=Math.floor(256*Math.random());a=Math.floor(256*Math.random());e=Math.floor((e+3*d[0])/4);b=Math.floor((b+3*d[1])/4);a=Math.floor((a+3*d[2])/4);return this.rgbToHex(e,b,a)},rgbToHex:function(a,
b,d){return this.componentToHex(a)+this.componentToHex(b)+this.componentToHex(d)},componentToHex:function(a){a=a.toString(16);return 2===a.length?a:a+"0"}});b.Physics.P2.Spring=function(a,b,d,e,f,g,k,m,n,p){this.game=a.game;this.world=a;void 0===e&&(e=1);void 0===f&&(f=100);void 0===g&&(g=1);e=a.pxm(e);e={restLength:e,stiffness:f,damping:g};"undefined"!==typeof k&&null!==k&&(e.worldAnchorA=[a.pxm(k[0]),a.pxm(k[1])]);"undefined"!==typeof m&&null!==m&&(e.worldAnchorB=[a.pxm(m[0]),a.pxm(m[1])]);"undefined"!==
typeof n&&null!==n&&(e.localAnchorA=[a.pxm(n[0]),a.pxm(n[1])]);"undefined"!==typeof p&&null!==p&&(e.localAnchorB=[a.pxm(p[0]),a.pxm(p[1])]);this.data=new p2.LinearSpring(b,d,e);this.data.parent=this};b.Physics.P2.Spring.prototype.constructor=b.Physics.P2.Spring;b.Physics.P2.RotationalSpring=function(a,b,d,e,f,g){this.game=a.game;this.world=a;void 0===e&&(e=null);void 0===f&&(f=100);void 0===g&&(g=1);e&&(e=a.pxm(e));this.data=new p2.RotationalSpring(b,d,{restAngle:e,stiffness:f,damping:g});this.data.parent=
this};b.Physics.P2.Spring.prototype.constructor=b.Physics.P2.Spring;b.Physics.P2.Material=function(a){this.name=a;p2.Material.call(this)};b.Physics.P2.Material.prototype=Object.create(p2.Material.prototype);b.Physics.P2.Material.prototype.constructor=b.Physics.P2.Material;b.Physics.P2.ContactMaterial=function(a,b,d){p2.ContactMaterial.call(this,a,b,d)};b.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype);b.Physics.P2.ContactMaterial.prototype.constructor=b.Physics.P2.ContactMaterial;
b.Physics.P2.CollisionGroup=function(a){this.mask=a};b.Physics.P2.DistanceConstraint=function(a,b,d,e,f,g,k){void 0===e&&(e=100);void 0===f&&(f=[0,0]);void 0===g&&(g=[0,0]);void 0===k&&(k=Number.MAX_VALUE);this.game=a.game;this.world=a;e=a.pxm(e);f=[a.pxmi(f[0]),a.pxmi(f[1])];g=[a.pxmi(g[0]),a.pxmi(g[1])];p2.DistanceConstraint.call(this,b,d,{distance:e,localAnchorA:f,localAnchorB:g,maxForce:k})};b.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype);b.Physics.P2.DistanceConstraint.prototype.constructor=
b.Physics.P2.DistanceConstraint;b.Physics.P2.GearConstraint=function(a,b,d,e,f){void 0===e&&(e=0);void 0===f&&(f=1);this.game=a.game;this.world=a;p2.GearConstraint.call(this,b,d,{angle:e,ratio:f})};b.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype);b.Physics.P2.GearConstraint.prototype.constructor=b.Physics.P2.GearConstraint;b.Physics.P2.LockConstraint=function(a,b,d,e,f,g){void 0===e&&(e=[0,0]);void 0===f&&(f=0);void 0===g&&(g=Number.MAX_VALUE);this.game=a.game;this.world=
a;e=[a.pxm(e[0]),a.pxm(e[1])];p2.LockConstraint.call(this,b,d,{localOffsetB:e,localAngleB:f,maxForce:g})};b.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype);b.Physics.P2.LockConstraint.prototype.constructor=b.Physics.P2.LockConstraint;b.Physics.P2.PrismaticConstraint=function(a,b,d,e,f,g,k,m){void 0===e&&(e=!0);void 0===f&&(f=[0,0]);void 0===g&&(g=[0,0]);void 0===k&&(k=[0,0]);void 0===m&&(m=Number.MAX_VALUE);this.game=a.game;this.world=a;f=[a.pxmi(f[0]),a.pxmi(f[1])];
g=[a.pxmi(g[0]),a.pxmi(g[1])];p2.PrismaticConstraint.call(this,b,d,{localAnchorA:f,localAnchorB:g,localAxisA:k,maxForce:m,disableRotationalLock:!e})};b.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype);b.Physics.P2.PrismaticConstraint.prototype.constructor=b.Physics.P2.PrismaticConstraint;b.Physics.P2.RevoluteConstraint=function(a,b,d,e,f,g,k){void 0===g&&(g=Number.MAX_VALUE);void 0===k&&(k=null);this.game=a.game;this.world=a;d=[a.pxmi(d[0]),a.pxmi(d[1])];f=
[a.pxmi(f[0]),a.pxmi(f[1])];k&&(k=[a.pxmi(k[0]),a.pxmi(k[1])]);p2.RevoluteConstraint.call(this,b,e,{worldPivot:k,localPivotA:d,localPivotB:f,maxForce:g})};b.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype);b.Physics.P2.RevoluteConstraint.prototype.constructor=b.Physics.P2.RevoluteConstraint;b.ImageCollection=function(a,b,d,e,f,g,k){if(void 0===d||0>=d)d=32;if(void 0===e||0>=e)e=32;void 0===f&&(f=0);void 0===g&&(g=0);this.name=a;this.firstgid=b|0;this.imageWidth=
d|0;this.imageHeight=e|0;this.imageMargin=f|0;this.imageSpacing=g|0;this.properties=k||{};this.images=[];this.total=0};b.ImageCollection.prototype={containsImageIndex:function(a){return a>=this.firstgid&&a<this.firstgid+this.total},addImage:function(a,b){this.images.push({gid:a,image:b});this.total++}};b.ImageCollection.prototype.constructor=b.ImageCollection;b.Tile=function(a,b,d,e,f,g){this.layer=a;this.index=b;this.x=d;this.y=e;this.rotation=0;this.flipped=!1;this.worldX=d*f;this.worldY=e*g;this.width=
f;this.height=g;this.centerX=Math.abs(f/2);this.centerY=Math.abs(g/2);this.alpha=1;this.properties={};this.collideDown=this.collideUp=this.collideRight=this.collideLeft=this.faceRight=this.faceLeft=this.faceBottom=this.faceTop=this.scanned=!1;this.collisionCallback=null;this.collisionCallbackContext=this};b.Tile.prototype={containsPoint:function(a,b){return!(a<this.worldX||b<this.worldY||a>this.right||b>this.bottom)},intersects:function(a,b,d,e){return d<=this.worldX||e<=this.worldY||a>=this.worldX+
this.width||b>=this.worldY+this.height?!1:!0},setCollisionCallback:function(a,b){this.collisionCallback=a;this.collisionCallbackContext=b},destroy:function(){this.properties=this.collisionCallbackContext=this.collisionCallback=null},setCollision:function(a,b,d,e){this.collideLeft=a;this.collideRight=b;this.collideUp=d;this.collideDown=e;this.faceLeft=a;this.faceRight=b;this.faceTop=d;this.faceBottom=e},resetCollision:function(){this.faceRight=this.faceLeft=this.faceBottom=this.faceTop=this.collideDown=
this.collideUp=this.collideRight=this.collideLeft=!1},isInteresting:function(a,b){return a&&b?this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback:a?this.collideLeft||this.collideRight||this.collideUp||this.collideDown:b?this.faceTop||this.faceBottom||this.faceLeft||this.faceRight:!1},copy:function(a){this.index=a.index;this.alpha=a.alpha;this.properties=a.properties;this.collideUp=a.collideUp;this.collideDown=
a.collideDown;this.collideLeft=a.collideLeft;this.collideRight=a.collideRight;this.collisionCallback=a.collisionCallback;this.collisionCallbackContext=a.collisionCallbackContext}};b.Tile.prototype.constructor=b.Tile;Object.defineProperty(b.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}});Object.defineProperty(b.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||
this.collisionCallback}});Object.defineProperty(b.Tile.prototype,"left",{get:function(){return this.worldX}});Object.defineProperty(b.Tile.prototype,"right",{get:function(){return this.worldX+this.width}});Object.defineProperty(b.Tile.prototype,"top",{get:function(){return this.worldY}});Object.defineProperty(b.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}});b.Tilemap=function(a,c,d,e,f,g){this.game=a;this.key=c;a=b.TilemapParser.parse(this.game,c,d,e,f,g);null!==a&&(this.width=
a.width,this.height=a.height,this.tileWidth=a.tileWidth,this.tileHeight=a.tileHeight,this.orientation=a.orientation,this.format=a.format,this.version=a.version,this.properties=a.properties,this.widthInPixels=a.widthInPixels,this.heightInPixels=a.heightInPixels,this.layers=a.layers,this.tilesets=a.tilesets,this.imagecollections=a.imagecollections,this.tiles=a.tiles,this.objects=a.objects,this.collideIndexes=[],this.collision=a.collision,this.images=a.images,this.enableDebug=!1,this.currentLayer=0,
this.debugMap=[],this._results=[],this._tempB=this._tempA=0)};b.Tilemap.CSV=0;b.Tilemap.TILED_JSON=1;b.Tilemap.NORTH=0;b.Tilemap.EAST=1;b.Tilemap.SOUTH=2;b.Tilemap.WEST=3;b.Tilemap.prototype={create:function(a,b,d,e,f,g){void 0===g&&(g=this.game.world);this.width=b;this.height=d;this.setTileSize(e,f);this.layers.length=0;return this.createBlankLayer(a,b,d,e,f,g)},setTileSize:function(a,b){this.tileWidth=a;this.tileHeight=b;this.widthInPixels=this.width*a;this.heightInPixels=this.height*b},addTilesetImage:function(a,
c,d,e,f,g,k){if(void 0===a)return null;void 0===d&&(d=this.tileWidth);void 0===e&&(e=this.tileHeight);void 0===f&&(f=0);void 0===g&&(g=0);void 0===k&&(k=0);0===d&&(d=32);0===e&&(e=32);if(void 0===c||null===c)c=a;if(c instanceof b.BitmapData)c=c.canvas;else{if(!this.game.cache.checkImageKey(c))return console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+c+'"'),null;c=this.game.cache.getImage(c)}var h=this.getTilesetIndex(a);if(null===h&&this.format===b.Tilemap.TILED_JSON)return console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+
a+'"'),null;if(this.tilesets[h])return this.tilesets[h].setImage(c),this.tilesets[h];a=new b.Tileset(a,k,d,e,f,g,{});a.setImage(c);this.tilesets.push(a);c=this.tilesets.length-1;for(var l=h=f,m=0,n=0,p=0,q=k;q<k+a.total;q++){this.tiles[q]=[h,l,c];h+=d+g;m++;if(m===a.total)break;n++;if(n===a.columns&&(h=f,l+=e+g,n=0,p++,p===a.rows))break}return a},createFromObjects:function(a,c,d,e,f,g,k,m,n){void 0===f&&(f=!0);void 0===g&&(g=!1);void 0===k&&(k=this.game.world);void 0===m&&(m=b.Sprite);void 0===n&&
(n=!0);if(this.objects[a])for(var h=0;h<this.objects[a].length;h++){var l=!1,p=this.objects[a][h];void 0!==p.gid&&"number"===typeof c&&p.gid===c?l=!0:void 0!==p.id&&"number"===typeof c&&p.id===c?l=!0:void 0!==p.name&&"string"===typeof c&&p.name===c&&(l=!0);if(l){l=new m(this.game,parseFloat(p.x,10),parseFloat(p.y,10),d,e);l.name=p.name;l.visible=p.visible;l.autoCull=g;l.exists=f;p.width&&(l.width=p.width);p.height&&(l.height=p.height);p.rotation&&(l.angle=p.rotation);n&&(l.y-=l.height);k.add(l);for(var q in p.properties)k.set(l,
q,p.properties[q],!1,!1,0,!0)}}else console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+a)},createFromTiles:function(a,c,d,e,f,g){"number"===typeof a&&(a=[a]);void 0===c||null===c?c=[]:"number"===typeof c&&(c=[c]);e=this.getLayer(e);void 0===f&&(f=this.game.world);void 0===g&&(g={});void 0===g.customClass&&(g.customClass=b.Sprite);void 0===g.adjustY&&(g.adjustY=!0);var h=this.layers[e].width,k=this.layers[e].height;this.copy(0,0,h,k,e);if(2>this._results.length)return 0;for(var l=
0,m,n=1,p=this._results.length;n<p;n++)if(-1!==a.indexOf(this._results[n].index)){m=new g.customClass(this.game,this._results[n].worldX,this._results[n].worldY,d);for(var u in g)m[u]=g[u];f.add(m);l++}if(1===c.length)for(n=0;n<a.length;n++)this.replace(a[n],c[0],0,0,h,k,e);else if(1<c.length)for(n=0;n<a.length;n++)this.replace(a[n],c[n],0,0,h,k,e);return l},createLayer:function(a,c,d,e){void 0===c&&(c=this.game.width);void 0===d&&(d=this.game.height);void 0===e&&(e=this.game.world);var f=a;"string"===
typeof a&&(f=this.getLayerIndex(a));if(null===f||f>this.layers.length)console.warn("Tilemap.createLayer: Invalid layer ID given: "+f);else return void 0===c||0>=c?c=Math.min(this.game.width,this.layers[f].widthInPixels):c>this.game.width&&(c=this.game.width),void 0===d||0>=d?d=Math.min(this.game.height,this.layers[f].heightInPixels):d>this.game.height&&(d=this.game.height),this.enableDebug&&(console.group("Tilemap.createLayer"),console.log("Name:",this.layers[f].name),console.log("Size:",c,"x",d),
console.log("Tileset:",this.tilesets[0].name,"index:",f)),a=e.add(new b.TilemapLayer(this.game,this,f,c,d)),this.enableDebug&&console.groupEnd(),a},createBlankLayer:function(a,c,d,e,f,g){void 0===g&&(g=this.game.world);if(null!==this.getLayerIndex(a))console.warn("Tilemap.createBlankLayer: Layer with matching name already exists: "+a);else{for(var h={name:a,x:0,y:0,width:c,height:d,widthInPixels:c*e,heightInPixels:d*f,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:null},k,
l=[],m=0;m<d;m++){k=[];for(var n=0;n<c;n++)k.push(new b.Tile(h,-1,n,m,e,f));l.push(k)}h.data=l;this.layers.push(h);this.currentLayer=this.layers.length-1;c=h.widthInPixels;h=h.heightInPixels;c>this.game.width&&(c=this.game.width);h>this.game.height&&(h=this.game.height);l=new b.TilemapLayer(this.game,this,this.layers.length-1,c,h);l.name=a;return g.add(l)}},getIndex:function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return c;return null},getLayerIndex:function(a){return this.getIndex(this.layers,
a)},getTilesetIndex:function(a){return this.getIndex(this.tilesets,a)},getImageIndex:function(a){return this.getIndex(this.images,a)},setTileIndexCallback:function(a,b,d,e){e=this.getLayer(e);if("number"===typeof a)this.layers[e].callbacks[a]={callback:b,callbackContext:d};else for(var c=0,f=a.length;c<f;c++)this.layers[e].callbacks[a[c]]={callback:b,callbackContext:d}},setTileLocationCallback:function(a,b,d,e,f,g,k){k=this.getLayer(k);this.copy(a,b,d,e,k);if(!(2>this._results.length))for(a=1;a<this._results.length;a++)this._results[a].setCollisionCallback(f,
g)},setCollision:function(a,b,d,e){void 0===b&&(b=!0);void 0===e&&(e=!0);d=this.getLayer(d);if("number"===typeof a)return this.setCollisionByIndex(a,b,d,!0);if(Array.isArray(a)){for(var c=0;c<a.length;c++)this.setCollisionByIndex(a[c],b,d,!1);e&&this.calculateFaces(d)}},setCollisionBetween:function(a,b,d,e,f){void 0===d&&(d=!0);void 0===f&&(f=!0);e=this.getLayer(e);if(!(a>b)){for(;a<=b;a++)this.setCollisionByIndex(a,d,e,!1);f&&this.calculateFaces(e)}},setCollisionByExclusion:function(a,b,d,e){void 0===
b&&(b=!0);void 0===e&&(e=!0);d=this.getLayer(d);for(var c=0,f=this.tiles.length;c<f;c++)-1===a.indexOf(c)&&this.setCollisionByIndex(c,b,d,!1);e&&this.calculateFaces(d)},setCollisionByIndex:function(a,b,d,e){void 0===b&&(b=!0);void 0===d&&(d=this.currentLayer);void 0===e&&(e=!0);if(b)this.collideIndexes.push(a);else{var c=this.collideIndexes.indexOf(a);-1<c&&this.collideIndexes.splice(c,1)}for(c=0;c<this.layers[d].height;c++)for(var f=0;f<this.layers[d].width;f++){var g=this.layers[d].data[c][f];g&&
g.index===a&&(b?g.setCollision(!0,!0,!0,!0):g.resetCollision(),g.faceTop=b,g.faceBottom=b,g.faceLeft=b,g.faceRight=b)}e&&this.calculateFaces(d);return d},getLayer:function(a){void 0===a?a=this.currentLayer:"string"===typeof a?a=this.getLayerIndex(a):a instanceof b.TilemapLayer&&(a=a.index);return a},setPreventRecalculate:function(a){!0===a&&!0!==this.preventingRecalculate&&(this.preventingRecalculate=!0,this.needToRecalculate={});if(!1===a&&!0===this.preventingRecalculate){this.preventingRecalculate=
!1;for(var b in this.needToRecalculate)this.calculateFaces(b);this.needToRecalculate=!1}},calculateFaces:function(a){if(this.preventingRecalculate)this.needToRecalculate[a]=!0;else for(var b,d,e,f,g=0,k=this.layers[a].height;g<k;g++)for(var m=0,n=this.layers[a].width;m<n;m++){var p=this.layers[a].data[g][m];p&&(b=this.getTileAbove(a,m,g),d=this.getTileBelow(a,m,g),e=this.getTileLeft(a,m,g),f=this.getTileRight(a,m,g),p.collides&&(p.faceTop=!0,p.faceBottom=!0,p.faceLeft=!0,p.faceRight=!0),b&&b.collides&&
(p.faceTop=!1),d&&d.collides&&(p.faceBottom=!1),e&&e.collides&&(p.faceLeft=!1),f&&f.collides&&(p.faceRight=!1))}},getTileAbove:function(a,b,d){return 0<d?this.layers[a].data[d-1][b]:null},getTileBelow:function(a,b,d){return d<this.layers[a].height-1?this.layers[a].data[d+1][b]:null},getTileLeft:function(a,b,d){return 0<b?this.layers[a].data[d][b-1]:null},getTileRight:function(a,b,d){return b<this.layers[a].width-1?this.layers[a].data[d][b+1]:null},setLayer:function(a){a=this.getLayer(a);this.layers[a]&&
(this.currentLayer=a)},hasTile:function(a,b,d){d=this.getLayer(d);return void 0===this.layers[d].data[b]||void 0===this.layers[d].data[b][a]?!1:-1<this.layers[d].data[b][a].index},removeTile:function(a,c,d){d=this.getLayer(d);if(0<=a&&a<this.layers[d].width&&0<=c&&c<this.layers[d].height&&this.hasTile(a,c,d)){var e=this.layers[d].data[c][a];this.layers[d].data[c][a]=new b.Tile(this.layers[d],-1,a,c,this.tileWidth,this.tileHeight);this.layers[d].dirty=!0;this.calculateFaces(d);return e}},removeTileWorldXY:function(a,
b,d,e,f){f=this.getLayer(f);a=this.game.math.snapToFloor(a,d)/d;b=this.game.math.snapToFloor(b,e)/e;return this.removeTile(a,b,f)},putTile:function(a,c,d,e){if(null===a)return this.removeTile(c,d,e);e=this.getLayer(e);if(0<=c&&c<this.layers[e].width&&0<=d&&d<this.layers[e].height){var f;a instanceof b.Tile?(f=a.index,this.hasTile(c,d,e)?this.layers[e].data[d][c].copy(a):this.layers[e].data[d][c]=new b.Tile(e,f,c,d,a.width,a.height)):(f=a,this.hasTile(c,d,e)?this.layers[e].data[d][c].index=f:this.layers[e].data[d][c]=
new b.Tile(this.layers[e],f,c,d,this.tileWidth,this.tileHeight));-1<this.collideIndexes.indexOf(f)?this.layers[e].data[d][c].setCollision(!0,!0,!0,!0):this.layers[e].data[d][c].resetCollision();this.layers[e].dirty=!0;this.calculateFaces(e);return this.layers[e].data[d][c]}return null},putTileWorldXY:function(a,b,d,e,f,g){g=this.getLayer(g);b=this.game.math.snapToFloor(b,e)/e;d=this.game.math.snapToFloor(d,f)/f;return this.putTile(a,b,d,g)},searchTileIndex:function(a,b,d,e){void 0===b&&(b=0);void 0===
d&&(d=!1);e=this.getLayer(e);var c=0;if(d)for(d=this.layers[e].height-1;0<=d;d--)for(var f=this.layers[e].width-1;0<=f;f--){if(this.layers[e].data[d][f].index===a){if(c===b)return this.layers[e].data[d][f];c++}}else for(d=0;d<this.layers[e].height;d++)for(f=0;f<this.layers[e].width;f++)if(this.layers[e].data[d][f].index===a){if(c===b)return this.layers[e].data[d][f];c++}return null},getTile:function(a,b,d,e){void 0===e&&(e=!1);d=this.getLayer(d);return 0<=a&&a<this.layers[d].width&&0<=b&&b<this.layers[d].height?
-1===this.layers[d].data[b][a].index?e?this.layers[d].data[b][a]:null:this.layers[d].data[b][a]:null},getTileWorldXY:function(a,b,d,e,f,g){void 0===d&&(d=this.tileWidth);void 0===e&&(e=this.tileHeight);f=this.getLayer(f);a=this.game.math.snapToFloor(a,d)/d;b=this.game.math.snapToFloor(b,e)/e;return this.getTile(a,b,f,g)},copy:function(a,b,d,e,f){f=this.getLayer(f);if(this.layers[f]){void 0===a&&(a=0);void 0===b&&(b=0);void 0===d&&(d=this.layers[f].width);void 0===e&&(e=this.layers[f].height);0>a&&
(a=0);0>b&&(b=0);d>this.layers[f].width&&(d=this.layers[f].width);e>this.layers[f].height&&(e=this.layers[f].height);this._results.length=0;this._results.push({x:a,y:b,width:d,height:e,layer:f});for(var c=b;c<b+e;c++)for(var h=a;h<a+d;h++)this._results.push(this.layers[f].data[c][h]);return this._results}this._results.length=0},paste:function(a,b,d,e){void 0===a&&(a=0);void 0===b&&(b=0);e=this.getLayer(e);if(d&&!(2>d.length)){a-=d[1].x;b-=d[1].y;for(var c=1;c<d.length;c++)this.layers[e].data[b+d[c].y][a+
d[c].x].copy(d[c]);this.layers[e].dirty=!0;this.calculateFaces(e)}},swap:function(a,b,d,e,f,g,k){k=this.getLayer(k);this.copy(d,e,f,g,k);2>this._results.length||(this._tempA=a,this._tempB=b,this._results.forEach(this.swapHandler,this),this.paste(d,e,this._results,k))},swapHandler:function(a){a.index===this._tempA?a.index=this._tempB:a.index===this._tempB&&(a.index=this._tempA)},forEach:function(a,b,d,e,f,g,k){k=this.getLayer(k);this.copy(d,e,f,g,k);2>this._results.length||(this._results.forEach(a,
b),this.paste(d,e,this._results,k))},replace:function(a,b,d,e,f,g,k){k=this.getLayer(k);this.copy(d,e,f,g,k);if(!(2>this._results.length)){for(f=1;f<this._results.length;f++)this._results[f].index===a&&(this._results[f].index=b);this.paste(d,e,this._results,k)}},random:function(a,b,d,e,f){f=this.getLayer(f);this.copy(a,b,d,e,f);if(!(2>this._results.length)){d=[];for(e=1;e<this._results.length;e++)if(this._results[e].index){var c=this._results[e].index;-1===d.indexOf(c)&&d.push(c)}for(e=1;e<this._results.length;e++)this._results[e].index=
this.game.rnd.pick(d);this.paste(a,b,this._results,f)}},shuffle:function(a,c,d,e,f){f=this.getLayer(f);this.copy(a,c,d,e,f);if(!(2>this._results.length)){d=[];for(e=1;e<this._results.length;e++)this._results[e].index&&d.push(this._results[e].index);b.ArrayUtils.shuffle(d);for(e=1;e<this._results.length;e++)this._results[e].index=d[e-1];this.paste(a,c,this._results,f)}},fill:function(a,b,d,e,f,g){g=this.getLayer(g);this.copy(b,d,e,f,g);if(!(2>this._results.length)){for(e=1;e<this._results.length;e++)this._results[e].index=
a;this.paste(b,d,this._results,g)}},removeAllLayers:function(){this.currentLayer=this.layers.length=0},dump:function(){for(var a="",b=[""],d=0;d<this.layers[this.currentLayer].height;d++){for(var e=0;e<this.layers[this.currentLayer].width;e++)a+="%c  ",1<this.layers[this.currentLayer].data[d][e]?this.debugMap[this.layers[this.currentLayer].data[d][e]]?b.push("background: "+this.debugMap[this.layers[this.currentLayer].data[d][e]]):b.push("background: #ffffff"):b.push("background: rgb(0, 0, 0)");a+=
"\n"}b[0]=a;console.log.apply(console,b)},destroy:function(){this.removeAllLayers();this.data=[];this.game=null}};b.Tilemap.prototype.constructor=b.Tilemap;Object.defineProperty(b.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(a){a!==this.currentLayer&&this.setLayer(a)}});b.TilemapLayer=function(a,c,d,e,f){e|=0;f|=0;b.Sprite.call(this,a,0,0);this.map=c;this.index=d;this.layer=c.layers[d];this.canvas=PIXI.CanvasPool.create(this,e,f);this.context=this.canvas.getContext("2d");
this.setTexture(new PIXI.Texture(new PIXI.BaseTexture(this.canvas)));this.physicsType=this.type=b.TILEMAPLAYER;this.renderSettings={enableScrollDelta:!1,overdrawRatio:.2,copyCanvas:null};this.debug=!1;this.exists=!0;this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:!0,debugAlpha:.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"};this.scrollFactorY=this.scrollFactorX=1;this.dirty=!0;this.rayStepRate=4;this._wrap=
!1;this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:c.tileWidth,tileHeight:c.tileHeight,cw:c.tileWidth,ch:c.tileHeight,tilesets:[]};this._scrollY=this._scrollX=0;this._results=[];a.device.canvasBitBltShift||(this.renderSettings.copyCanvas=b.TilemapLayer.ensureSharedCopyCanvas());this.fixedToCamera=!0};b.TilemapLayer.prototype=Object.create(b.Sprite.prototype);b.TilemapLayer.prototype.constructor=b.TilemapLayer;b.TilemapLayer.prototype.preUpdateCore=b.Component.Core.preUpdate;b.TilemapLayer.sharedCopyCanvas=
null;b.TilemapLayer.ensureSharedCopyCanvas=function(){this.sharedCopyCanvas||(this.sharedCopyCanvas=PIXI.CanvasPool.create(this,2,2));return this.sharedCopyCanvas};b.TilemapLayer.prototype.preUpdate=function(){return this.preUpdateCore()};b.TilemapLayer.prototype.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);this._scrollX=this.game.camera.view.x*
this.scrollFactorX/this.scale.x;this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y};b.TilemapLayer.prototype._renderCanvas=function(a){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x;this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y;this.render();
PIXI.Sprite.prototype._renderCanvas.call(this,a)};b.TilemapLayer.prototype._renderWebGL=function(a){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x;this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y;this.render();PIXI.Sprite.prototype._renderWebGL.call(this,a)};b.TilemapLayer.prototype.destroy=
function(){PIXI.CanvasPool.remove(this);b.Component.Destroy.prototype.destroy.call(this)};b.TilemapLayer.prototype.resize=function(a,b){this.canvas.width=a;this.canvas.height=b;this.texture.frame.resize(a,b);this.texture.width=a;this.texture.height=b;this.texture.crop.width=a;this.texture.crop.height=b;this.texture.baseTexture.width=a;this.texture.baseTexture.height=b;this.texture.baseTexture.dirty();this.texture.requiresUpdate=!0;this.texture._updateUvs();this.dirty=!0};b.TilemapLayer.prototype.resizeWorld=
function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)};b.TilemapLayer.prototype._fixX=function(a){return 1===this.scrollFactorX||0===this.scrollFactorX&&0===this.position.x?a:0===this.scrollFactorX&&0!==this.position.x?a-this.position.x:this._scrollX+(a-this._scrollX/this.scrollFactorX)};b.TilemapLayer.prototype._unfixX=function(a){return 1===this.scrollFactorX?a:this._scrollX/this.scrollFactorX+(a-this._scrollX)};b.TilemapLayer.prototype._fixY=
function(a){return 1===this.scrollFactorY||0===this.scrollFactorY&&0===this.position.y?a:0===this.scrollFactorY&&0!==this.position.y?a-this.position.y:this._scrollY+(a-this._scrollY/this.scrollFactorY)};b.TilemapLayer.prototype._unfixY=function(a){return 1===this.scrollFactorY?a:this._scrollY/this.scrollFactorY+(a-this._scrollY)};b.TilemapLayer.prototype.getTileX=function(a){return Math.floor(this._fixX(a)/this._mc.tileWidth)};b.TilemapLayer.prototype.getTileY=function(a){return Math.floor(this._fixY(a)/
this._mc.tileHeight)};b.TilemapLayer.prototype.getTileXY=function(a,b,d){d.x=this.getTileX(a);d.y=this.getTileY(b);return d};b.TilemapLayer.prototype.getRayCastTiles=function(a,b,d,e){b||(b=this.rayStepRate);void 0===d&&(d=!1);void 0===e&&(e=!1);d=this.getTiles(a.x,a.y,a.width,a.height,d,e);if(0===d.length)return[];a=a.coordinatesOnLine(b);b=[];for(e=0;e<d.length;e++)for(var c=0;c<a.length;c++){var f=d[e],g=a[c];if(f.containsPoint(g[0],g[1])){b.push(f);break}}return b};b.TilemapLayer.prototype.getTiles=
function(a,b,d,e,f,g){void 0===f&&(f=!1);void 0===g&&(g=!1);var c=!(f||g);a=this._fixX(a);b=this._fixY(b);var h=Math.floor(a/(this._mc.cw*this.scale.x)),k=Math.floor(b/(this._mc.ch*this.scale.y));a=Math.ceil((a+d)/(this._mc.cw*this.scale.x))-h;for(b=Math.ceil((b+e)/(this._mc.ch*this.scale.y))-k;this._results.length;)this._results.pop();for(e=k;e<k+b;e++)for(d=h;d<h+a;d++){var l=this.layer.data[e];l&&l[d]&&(c||l[d].isInteresting(f,g))&&this._results.push(l[d])}return this._results.slice()};b.TilemapLayer.prototype.resolveTileset=
function(a){var b=this._mc.tilesets;if(2E3>a)for(;b.length<a;)b.push(void 0);var d=this.map.tiles[a]&&this.map.tiles[a][2];return null!==d&&(d=this.map.tilesets[d])&&d.containsTileIndex(a)?b[a]=d:b[a]=null};b.TilemapLayer.prototype.resetTilesetCache=function(){for(var a=this._mc.tilesets;a.length;)a.pop()};b.TilemapLayer.prototype.setScale=function(a,b){a=a||1;b=b||a;for(var c=0;c<this.layer.data.length;c++)for(var e=this.layer.data[c],f=0;f<e.length;f++){var g=e[f];g.width=this.map.tileWidth*a;g.height=
this.map.tileHeight*b;g.worldX=g.x*g.width;g.worldY=g.y*g.height}this.scale.setTo(a,b)};b.TilemapLayer.prototype.shiftCanvas=function(a,b,d){var c=a.canvas,f=c.width-Math.abs(b),g=c.height-Math.abs(d),k=0,m=0,n=b,p=d;0>b&&(k=-b,n=0);0>d&&(m=-d,p=0);if(b=this.renderSettings.copyCanvas){if(b.width<f||b.height<g)b.width=f,b.height=g;d=b.getContext("2d");d.clearRect(0,0,f,g);d.drawImage(c,k,m,f,g,0,0,f,g);a.clearRect(n,p,f,g);a.drawImage(b,0,0,f,g,n,p,f,g)}else a.save(),a.globalCompositeOperation="copy",
a.drawImage(c,k,m,f,g,n,p,f,g),a.restore()};b.TilemapLayer.prototype.renderRegion=function(a,b,d,e,f,g){var c=this.context,h=this.layer.width,k=this.layer.height,l=this._mc.tileWidth,m=this._mc.tileHeight,n=this._mc.tilesets,p=NaN;this._wrap||(d<=f&&(d=Math.max(0,d),f=Math.min(h-1,f)),e<=g&&(e=Math.max(0,e),g=Math.min(k-1,g)));a=d*l-a;var x=(d+1048576*h)%h,z,D,A;D=(e+1048576*k)%k;g-=e;for(e=e*m-b;0<=g;D++,g--,e+=m){D>=k&&(D-=k);var E=this.layer.data[D];z=x;A=f-d;for(b=a;0<=A;z++,A--,b+=l){z>=h&&(z-=
h);var C=E[z];if(C&&!(0>C.index)){var F=C.index,I=n[F];void 0===I&&(I=this.resolveTileset(F));C.alpha===p||this.debug||(p=c.globalAlpha=C.alpha);I?C.rotation||C.flipped?(c.save(),c.translate(b+C.centerX,e+C.centerY),c.rotate(C.rotation),C.flipped&&c.scale(-1,1),I.draw(c,-C.centerX,-C.centerY,F),c.restore()):I.draw(c,b,e,F):this.debugSettings.missingImageFill&&(c.fillStyle=this.debugSettings.missingImageFill,c.fillRect(b,e,l,m));C.debug&&this.debugSettings.debuggedTileOverfill&&(c.fillStyle=this.debugSettings.debuggedTileOverfill,
c.fillRect(b,e,l,m))}}}};b.TilemapLayer.prototype.renderDeltaScroll=function(a,b){var c=this._mc.scrollX,e=this._mc.scrollY,f=this.canvas.width,g=this.canvas.height,k=this._mc.tileWidth,m=this._mc.tileHeight,n=0,p=-k,y=0,w=-m;0>a?(n=f+a,p=f-1):0<a&&(p=a);0>b?(y=g+b,w=g-1):0<b&&(w=b);this.shiftCanvas(this.context,a,b);n=Math.floor((n+c)/k);p=Math.floor((p+c)/k);y=Math.floor((y+e)/m);w=Math.floor((w+e)/m);n<=p&&(this.context.clearRect(n*k-c,0,(p-n+1)*k,g),this.renderRegion(c,e,n,Math.floor((0+e)/m),
p,Math.floor((g-1+e)/m)));y<=w&&(this.context.clearRect(0,y*m-e,f,(w-y+1)*m),this.renderRegion(c,e,Math.floor((0+c)/k),y,Math.floor((f-1+c)/k),w))};b.TilemapLayer.prototype.renderFull=function(){var a=this._mc.scrollX,b=this._mc.scrollY,d=this.canvas.width,e=this.canvas.height,f=this._mc.tileWidth,g=this._mc.tileHeight,k=Math.floor(a/f),f=Math.floor((d-1+a)/f),m=Math.floor(b/g),g=Math.floor((e-1+b)/g);this.context.clearRect(0,0,d,e);this.renderRegion(a,b,k,m,f,g)};b.TilemapLayer.prototype.render=
function(){var a=!1;if(this.visible){if(this.dirty||this.layer.dirty)this.layer.dirty=!1,a=!0;var b=this.canvas.width,d=this.canvas.height,e=this._scrollX|0,f=this._scrollY|0,g=this._mc,k=g.scrollX-e,m=g.scrollY-f;if(a||0!==k||0!==m||g.renderWidth!==b||g.renderHeight!==d){this.context.save();g.scrollX=e;g.scrollY=f;if(g.renderWidth!==b||g.renderHeight!==d)g.renderWidth=b,g.renderHeight=d;this.debug&&(this.context.globalAlpha=this.debugSettings.debugAlpha,this.debugSettings.forceFullRedraw&&(a=!0));
!a&&this.renderSettings.enableScrollDelta&&Math.abs(k)+Math.abs(m)<Math.min(b,d)?this.renderDeltaScroll(k,m):this.renderFull();this.debug&&(this.context.globalAlpha=1,this.renderDebug());this.texture.baseTexture.dirty();this.dirty=!1;this.context.restore();return!0}}};b.TilemapLayer.prototype.renderDebug=function(){var a=this._mc.scrollX,b=this._mc.scrollY,d=this.context,e=this.layer.width,f=this.layer.height,g=this._mc.tileWidth,k=this._mc.tileHeight,m=Math.floor(a/g),n=Math.floor((this.canvas.width-
1+a)/g),p=Math.floor(b/k),y=Math.floor((this.canvas.height-1+b)/k),a=m*g-a,w=(m+1048576*e)%e,u,x,z;d.strokeStyle=this.debugSettings.facingEdgeStroke;x=(p+1048576*f)%f;y-=p;for(p=p*k-b;0<=y;x++,y--,p+=k){x>=f&&(x-=f);var D=this.layer.data[x];u=w;z=n-m;for(b=a;0<=z;u++,z--,b+=g){u>=e&&(u-=e);var A=D[u];!A||0>A.index||!A.collides||(this.debugSettings.collidingTileOverfill&&(d.fillStyle=this.debugSettings.collidingTileOverfill,d.fillRect(b,p,this._mc.cw,this._mc.ch)),this.debugSettings.facingEdgeStroke&&
(d.beginPath(),A.faceTop&&(d.moveTo(b,p),d.lineTo(b+this._mc.cw,p)),A.faceBottom&&(d.moveTo(b,p+this._mc.ch),d.lineTo(b+this._mc.cw,p+this._mc.ch)),A.faceLeft&&(d.moveTo(b,p),d.lineTo(b,p+this._mc.ch)),A.faceRight&&(d.moveTo(b+this._mc.cw,p),d.lineTo(b+this._mc.cw,p+this._mc.ch)),d.closePath(),d.stroke()))}}};Object.defineProperty(b.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(a){this._wrap=a;this.dirty=!0}});Object.defineProperty(b.TilemapLayer.prototype,"scrollX",
{get:function(){return this._scrollX},set:function(a){this._scrollX=a}});Object.defineProperty(b.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(a){this._scrollY=a}});Object.defineProperty(b.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(a){this._mc.cw=a|0;this.dirty=!0}});Object.defineProperty(b.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(a){this._mc.ch=a|0;this.dirty=!0}});
b.TilemapParser={INSERT_NULL:!1,parse:function(a,c,d,e,f,g){void 0===d&&(d=32);void 0===e&&(e=32);void 0===f&&(f=10);void 0===g&&(g=10);if(void 0===c)return this.getEmptyData();if(null===c)return this.getEmptyData(d,e,f,g);if(a=a.cache.getTilemapData(c)){if(a.format===b.Tilemap.CSV)return this.parseCSV(c,a.data,d,e);if(!a.format||a.format===b.Tilemap.TILED_JSON)return this.parseTiledJSON(a.data)}else console.warn("Phaser.TilemapParser.parse - No map data found for key "+c)},parseCSV:function(a,c,
d,e){var f=this.getEmptyData();c=c.trim();var g=[];c=c.split("\n");for(var k=c.length,m=0,n=0;n<c.length;n++){g[n]=[];for(var p=c[n].split(","),y=0;y<p.length;y++)g[n][y]=new b.Tile(f.layers[0],parseInt(p[y],10),y,n,d,e);0===m&&(m=p.length)}f.format=b.Tilemap.CSV;f.name=a;f.width=m;f.height=k;f.tileWidth=d;f.tileHeight=e;f.widthInPixels=m*d;f.heightInPixels=k*e;f.layers[0].width=m;f.layers[0].height=k;f.layers[0].widthInPixels=f.widthInPixels;f.layers[0].heightInPixels=f.heightInPixels;f.layers[0].data=
g;return f},getEmptyData:function(a,b,d,e){return{width:void 0!==d&&null!==d?d:0,height:void 0!==e&&null!==e?e:0,tileWidth:void 0!==a&&null!==a?a:0,tileHeight:void 0!==b&&null!==b?b:0,orientation:"orthogonal",version:"1",properties:{},widthInPixels:0,heightInPixels:0,layers:[{name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:[]}],images:[],objects:{},collision:{},tilesets:[],tiles:[]}},parseTiledJSON:function(a){function c(a,
b){var c={},d;for(d in b){var e=b[d];"undefined"!==typeof a[e]&&(c[e]=a[e])}return c}if("orthogonal"!==a.orientation)return console.warn("TilemapParser.parseTiledJSON - Only orthogonal map types are supported in this version of Phaser"),null;for(var d={width:a.width,height:a.height,tileWidth:a.tilewidth,tileHeight:a.tileheight,orientation:a.orientation,format:b.Tilemap.TILED_JSON,version:a.version,properties:a.properties,widthInPixels:a.width*a.tilewidth,heightInPixels:a.height*a.tileheight},e=[],
f=0;f<a.layers.length;f++)if("tilelayer"===a.layers[f].type){var g=a.layers[f];if(!g.compression&&g.encoding&&"base64"===g.encoding){for(var k=window.atob(g.data),m=k.length,n=Array(m),p=0;p<m;p+=4)n[p/4]=(k.charCodeAt(p)|k.charCodeAt(p+1)<<8|k.charCodeAt(p+2)<<16|k.charCodeAt(p+3)<<24)>>>0;g.data=n;delete g.encoding}else if(g.compression){console.warn("TilemapParser.parseTiledJSON - Layer compression is unsupported, skipping layer '"+g.name+"'");continue}var y={name:g.name,x:g.x,y:g.y,width:g.width,
height:g.height,widthInPixels:g.width*a.tilewidth,heightInPixels:g.height*a.tileheight,alpha:g.opacity,visible:g.visible,properties:{},indexes:[],callbacks:[],bodies:[]};g.properties&&(y.properties=g.properties);for(var p=0,w=[],u=[],x,z,D,n=0,m=g.data.length;n<m;n++){x=0;z=!1;k=g.data[n];D=0;if(536870912<k)switch(2147483648<k&&(k-=2147483648,D+=4),1073741824<k&&(k-=1073741824,D+=2),536870912<k&&(k-=536870912,D+=1),D){case 5:x=Math.PI/2;break;case 6:x=Math.PI;break;case 3:x=3*Math.PI/2;break;case 4:x=
0;z=!0;break;case 7:x=Math.PI/2;z=!0;break;case 2:x=Math.PI;z=!0;break;case 1:x=3*Math.PI/2,z=!0}0<k?(k=new b.Tile(y,k,p,u.length,a.tilewidth,a.tileheight),k.rotation=x,k.flipped=z,0!==D&&(k.flippedVal=D),w.push(k)):b.TilemapParser.INSERT_NULL?w.push(null):w.push(new b.Tile(y,-1,p,u.length,a.tilewidth,a.tileheight));p++;p===g.width&&(u.push(w),p=0,w=[])}y.data=u;e.push(y)}d.layers=e;m=[];for(f=0;f<a.layers.length;f++)"imagelayer"===a.layers[f].type&&(k=a.layers[f],p={name:k.name,image:k.image,x:k.x,
y:k.y,alpha:k.opacity,visible:k.visible,properties:{}},k.properties&&(p.properties=k.properties),m.push(p));d.images=m;n=[];y=[];w=null;for(f=0;f<a.tilesets.length;f++){m=a.tilesets[f];if(m.image)p=new b.Tileset(m.name,m.firstgid,m.tilewidth,m.tileheight,m.margin,m.spacing,m.properties),m.tileproperties&&(p.tileProperties=m.tileproperties),p.updateTileData(m.imagewidth,m.imageheight),n.push(p);else{var e=new b.ImageCollection(m.name,m.firstgid,m.tilewidth,m.tileheight,m.margin,m.spacing,m.properties),
A;for(A in m.tiles)p=m.tiles[A].image,k=m.firstgid+parseInt(A,10),e.addImage(k,p);y.push(e)}w&&(w.lastgid=m.firstgid-1);w=m}d.tilesets=n;d.imagecollections=y;A={};p={};for(f=0;f<a.layers.length;f++)if("objectgroup"===a.layers[f].type)for(k=a.layers[f],A[k.name]=[],p[k.name]=[],n=0,m=k.objects.length;n<m;n++){if(k.objects[n].gid)y={gid:k.objects[n].gid,name:k.objects[n].name,type:k.objects[n].hasOwnProperty("type")?k.objects[n].type:"",x:k.objects[n].x,y:k.objects[n].y,visible:k.objects[n].visible,
properties:k.objects[n].properties},k.objects[n].rotation&&(y.rotation=k.objects[n].rotation);else if(k.objects[n].polyline){y={name:k.objects[n].name,type:k.objects[n].type,x:k.objects[n].x,y:k.objects[n].y,width:k.objects[n].width,height:k.objects[n].height,visible:k.objects[n].visible,properties:k.objects[n].properties};k.objects[n].rotation&&(y.rotation=k.objects[n].rotation);y.polyline=[];for(w=0;w<k.objects[n].polyline.length;w++)y.polyline.push([k.objects[n].polyline[w].x,k.objects[n].polyline[w].y]);
p[k.name].push(y)}else if(k.objects[n].polygon)for(y=c(k.objects[n],"name type x y visible rotation properties".split(" ")),y.polygon=[],w=0;w<k.objects[n].polygon.length;w++)y.polygon.push([k.objects[n].polygon[w].x,k.objects[n].polygon[w].y]);else k.objects[n].ellipse?y=c(k.objects[n],"name type ellipse x y width height visible rotation properties".split(" ")):(y=c(k.objects[n],"name type x y width height visible rotation properties".split(" ")),y.rectangle=!0);A[k.name].push(y)}d.objects=A;d.collision=
p;d.tiles=[];for(f=0;f<d.tilesets.length;f++)for(m=d.tilesets[f],a=p=m.tileMargin,y=k=A=0,n=m.firstgid;n<m.firstgid+m.total;n++){d.tiles[n]=[p,a,f];p+=m.tileWidth+m.tileSpacing;A++;if(A===m.total)break;k++;if(k===m.columns&&(p=m.tileMargin,a+=m.tileHeight+m.tileSpacing,k=0,y++,y===m.rows))break}for(f=0;f<d.layers.length;f++)for(y=d.layers[f],m=null,p=0;p<y.data.length;p++)for(w=y.data[p],a=0;a<w.length;a++)k=w[a],null===k||0>k.index||(A=d.tiles[k.index][2],m=d.tilesets[A],m.tileProperties&&m.tileProperties[k.index-
m.firstgid]&&(k.properties=b.Utils.mixin(m.tileProperties[k.index-m.firstgid],k.properties)));return d}};b.Tileset=function(a,b,d,e,f,g,k){if(void 0===d||0>=d)d=32;if(void 0===e||0>=e)e=32;void 0===f&&(f=0);void 0===g&&(g=0);this.name=a;this.firstgid=b|0;this.tileWidth=d|0;this.tileHeight=e|0;this.tileMargin=f|0;this.tileSpacing=g|0;this.properties=k||{};this.image=null;this.total=this.columns=this.rows=0;this.drawCoords=[]};b.Tileset.prototype={draw:function(a,b,d,e){e=e-this.firstgid<<1;0<=e&&e+
1<this.drawCoords.length&&a.drawImage(this.image,this.drawCoords[e],this.drawCoords[e+1],this.tileWidth,this.tileHeight,b,d,this.tileWidth,this.tileHeight)},containsTileIndex:function(a){return a>=this.firstgid&&a<this.firstgid+this.total},setImage:function(a){this.image=a;this.updateTileData(a.width,a.height)},setSpacing:function(a,b){this.tileMargin=a|0;this.tileSpacing=b|0;this.image&&this.updateTileData(this.image.width,this.image.height)},updateTileData:function(a,b){var c=(b-2*this.tileMargin+
this.tileSpacing)/(this.tileHeight+this.tileSpacing),e=(a-2*this.tileMargin+this.tileSpacing)/(this.tileWidth+this.tileSpacing);0===c%1&&0===e%1||console.warn("Phaser.Tileset - "+this.name+" image tile area is not an even multiple of tile size");c=Math.floor(c);e=Math.floor(e);(this.rows&&this.rows!==c||this.columns&&this.columns!==e)&&console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ");this.rows=c;this.columns=e;this.total=c*e;this.drawCoords.length=0;for(var e=
c=this.tileMargin,f=0;f<this.rows;f++){for(var g=0;g<this.columns;g++)this.drawCoords.push(c),this.drawCoords.push(e),c+=this.tileWidth+this.tileSpacing;c=this.tileMargin;e+=this.tileHeight+this.tileSpacing}}};b.Tileset.prototype.constructor=b.Tileset;b.Particle=function(a,c,d,e,f){b.Sprite.call(this,a,c,d,e,f);this.autoScale=!1;this.scaleData=null;this._s=0;this.autoAlpha=!1;this.alphaData=null;this._a=0};b.Particle.prototype=Object.create(b.Sprite.prototype);b.Particle.prototype.constructor=b.Particle;
b.Particle.prototype.update=function(){this.autoScale&&(this._s--,this._s?this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y):this.autoScale=!1);this.autoAlpha&&(this._a--,this._a?this.alpha=this.alphaData[this._a].v:this.autoAlpha=!1)};b.Particle.prototype.onEmit=function(){};b.Particle.prototype.setAlphaData=function(a){this.alphaData=a;this._a=a.length-1;this.alpha=this.alphaData[this._a].v;this.autoAlpha=!0};b.Particle.prototype.setScaleData=function(a){this.scaleData=a;this._s=
a.length-1;this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y);this.autoScale=!0};b.Particle.prototype.reset=function(a,c,d){b.Component.Reset.prototype.reset.call(this,a,c,d);this.alpha=1;this.scale.set(1);this.autoAlpha=this.autoScale=!1;return this};b.Particles=function(a){this.game=a;this.emitters={};this.ID=0};b.Particles.prototype={add:function(a){return this.emitters[a.name]=a},remove:function(a){delete this.emitters[a.name]},update:function(){for(var a in this.emitters)this.emitters[a].exists&&
this.emitters[a].update()}};b.Particles.prototype.constructor=b.Particles;b.Particles.Arcade={};b.Particles.Arcade.Emitter=function(a,c,d,e){this.maxParticles=e||50;b.Group.call(this,a);this.name="emitter"+this.game.particles.ID++;this.type=b.EMITTER;this.physicsType=b.GROUP;this.area=new b.Rectangle(c,d,1,1);this.minParticleSpeed=new b.Point(-100,-100);this.maxParticleSpeed=new b.Point(100,100);this.maxParticleScale=this.minParticleScale=1;this.scaleData=null;this.minRotation=-360;this.maxRotation=
360;this.maxParticleAlpha=this.minParticleAlpha=1;this.alphaData=null;this.gravity=100;this.particleClass=b.Particle;this.particleDrag=new b.Point;this.angularDrag=0;this.frequency=100;this.lifespan=2E3;this.bounce=new b.Point;this.on=!1;this.particleAnchor=new b.Point(.5,.5);this.blendMode=b.blendModes.NORMAL;this.emitX=c;this.emitY=d;this.particleSendToBack=this.particleBringToTop=this.autoAlpha=this.autoScale=!1;this._minParticleScale=new b.Point(1,1);this._maxParticleScale=new b.Point(1,1);this._flowTotal=
this._flowQuantity=this._counter=this._timer=this._quantity=0;this._explode=!0;this._frames=null};b.Particles.Arcade.Emitter.prototype=Object.create(b.Group.prototype);b.Particles.Arcade.Emitter.prototype.constructor=b.Particles.Arcade.Emitter;b.Particles.Arcade.Emitter.prototype.update=function(){if(this.on&&this.game.time.time>=this._timer)if(this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion,0!==this._flowTotal)if(0<this._flowQuantity)for(var a=0;a<this._flowQuantity;a++){if(this.emitParticle()&&
(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal)){this.on=!1;break}}else this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal&&(this.on=!1));else this.emitParticle()&&(this._counter++,0<this._quantity&&this._counter>=this._quantity&&(this.on=!1));for(a=this.children.length;a--;)this.children[a].exists&&this.children[a].update()};b.Particles.Arcade.Emitter.prototype.makeParticles=function(a,b,d,e,f){void 0===b&&(b=0);void 0===d&&(d=this.maxParticles);
void 0===e&&(e=!1);void 0===f&&(f=!1);var c,g=0,h=a,k=b;this._frames=b;d>this.maxParticles&&(this.maxParticles=d);for(;g<d;)Array.isArray(a)&&(h=this.game.rnd.pick(a)),Array.isArray(b)&&(k=this.game.rnd.pick(b)),c=new this.particleClass(this.game,0,0,h,k),this.game.physics.arcade.enable(c,!1),e?(c.body.checkCollision.any=!0,c.body.checkCollision.none=!1):c.body.checkCollision.none=!0,c.body.collideWorldBounds=f,c.body.skipQuadTree=!0,c.exists=!1,c.visible=!1,c.anchor.copyFrom(this.particleAnchor),
this.add(c),g++;return this};b.Particles.Arcade.Emitter.prototype.kill=function(){this.exists=this.alive=this.on=!1;return this};b.Particles.Arcade.Emitter.prototype.revive=function(){this.exists=this.alive=!0;return this};b.Particles.Arcade.Emitter.prototype.explode=function(a,b){this._flowTotal=0;this.start(!0,a,0,b,!1);return this};b.Particles.Arcade.Emitter.prototype.flow=function(a,b,d,e,f){if(void 0===d||0===d)d=1;void 0===e&&(e=-1);void 0===f&&(f=!0);d>this.maxParticles&&(d=this.maxParticles);
this._counter=0;this._flowQuantity=d;this._flowTotal=e;f?(this.start(!0,a,b,d),this._counter+=d,this.on=!0,this._timer=this.game.time.time+b*this.game.time.slowMotion):this.start(!1,a,b,d);return this};b.Particles.Arcade.Emitter.prototype.start=function(a,b,d,e,f){void 0===a&&(a=!0);void 0===b&&(b=0);if(void 0===d||null===d)d=250;void 0===e&&(e=0);void 0===f&&(f=!1);e>this.maxParticles&&(e=this.maxParticles);this.revive();this.visible=!0;this.lifespan=b;this.frequency=d;if(a||f)for(a=0;a<e;a++)this.emitParticle();
else this.on=!0,this._quantity=e,this._counter=0,this._timer=this.game.time.time+d*this.game.time.slowMotion;return this};b.Particles.Arcade.Emitter.prototype.emitParticle=function(a,b,d,e){void 0===a&&(a=null);void 0===b&&(b=null);var c=this.getFirstExists(!1);if(null===c)return!1;var f=this.game.rnd;void 0!==d&&void 0!==e?c.loadTexture(d,e):void 0!==d&&c.loadTexture(d);d=this.emitX;var g=this.emitY;null!==a?d=a:1<this.width&&(d=f.between(this.left,this.right));null!==b?g=b:1<this.height&&(g=f.between(this.top,
this.bottom));c.reset(d,g);c.angle=0;c.lifespan=this.lifespan;this.particleBringToTop?this.bringToTop(c):this.particleSendToBack&&this.sendToBack(c);this.autoScale?c.setScaleData(this.scaleData):1!==this.minParticleScale||1!==this.maxParticleScale?c.scale.set(f.realInRange(this.minParticleScale,this.maxParticleScale)):this._minParticleScale.x===this._maxParticleScale.x&&this._minParticleScale.y===this._maxParticleScale.y||c.scale.set(f.realInRange(this._minParticleScale.x,this._maxParticleScale.x),
f.realInRange(this._minParticleScale.y,this._maxParticleScale.y));void 0===e&&(Array.isArray(this._frames)?c.frame=this.game.rnd.pick(this._frames):c.frame=this._frames);this.autoAlpha?c.setAlphaData(this.alphaData):c.alpha=f.realInRange(this.minParticleAlpha,this.maxParticleAlpha);c.blendMode=this.blendMode;a=c.body;a.updateBounds();a.bounce.copyFrom(this.bounce);a.drag.copyFrom(this.particleDrag);a.velocity.x=f.between(this.minParticleSpeed.x,this.maxParticleSpeed.x);a.velocity.y=f.between(this.minParticleSpeed.y,
this.maxParticleSpeed.y);a.angularVelocity=f.between(this.minRotation,this.maxRotation);a.gravity.y=this.gravity;a.angularDrag=this.angularDrag;c.onEmit();return!0};b.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this);b.Group.prototype.destroy.call(this,!0,!1)};b.Particles.Arcade.Emitter.prototype.setSize=function(a,b){this.area.width=a;this.area.height=b;return this};b.Particles.Arcade.Emitter.prototype.setXSpeed=function(a,b){this.minParticleSpeed.x=a||0;this.maxParticleSpeed.x=
b||0;return this};b.Particles.Arcade.Emitter.prototype.setYSpeed=function(a,b){this.minParticleSpeed.y=a||0;this.maxParticleSpeed.y=b||0;return this};b.Particles.Arcade.Emitter.prototype.setRotation=function(a,b){this.minRotation=a||0;this.maxRotation=b||0;return this};b.Particles.Arcade.Emitter.prototype.setAlpha=function(a,c,d,e,f){void 0===a&&(a=1);void 0===c&&(c=1);void 0===d&&(d=0);void 0===e&&(e=b.Easing.Linear.None);void 0===f&&(f=!1);this.minParticleAlpha=a;this.maxParticleAlpha=c;this.autoAlpha=
!1;0<d&&a!==c&&(a=this.game.make.tween({v:a}).to({v:c},d,e),a.yoyo(f),this.alphaData=a.generateData(60),this.alphaData.reverse(),this.autoAlpha=!0);return this};b.Particles.Arcade.Emitter.prototype.setScale=function(a,c,d,e,f,g,k){void 0===a&&(a=1);void 0===c&&(c=1);void 0===d&&(d=1);void 0===e&&(e=1);void 0===f&&(f=0);void 0===g&&(g=b.Easing.Linear.None);void 0===k&&(k=!1);this.maxParticleScale=this.minParticleScale=1;this._minParticleScale.set(a,d);this._maxParticleScale.set(c,e);this.autoScale=
!1;0<f&&(a!==c||d!==e)&&(a=this.game.make.tween({x:a,y:d}).to({x:c,y:e},f,g),a.yoyo(k),this.scaleData=a.generateData(60),this.scaleData.reverse(),this.autoScale=!0);return this};b.Particles.Arcade.Emitter.prototype.at=function(a){a.center?(this.emitX=a.center.x,this.emitY=a.center.y):(this.emitX=a.world.x+a.anchor.x*a.width,this.emitY=a.world.y+a.anchor.y*a.height);return this};Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(a){this.area.width=
a}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(a){this.area.height=a}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(a){this.emitX=a}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(a){this.emitY=a}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-
this.area.width/2)}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.area.width/2)}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.area.height/2)}});b.Weapon=function(a,c){b.Plugin.call(this,a,c);this.bullets=null;this.autofire=this.autoExpandBulletsGroup=
!1;this.fireLimit=this.shots=0;this.fireRate=100;this.fireRateVariance=0;this.fireFrom=new b.Rectangle(0,0,1,1);this.fireAngle=b.ANGLE_UP;this.bulletInheritSpriteSpeed=!1;this.bulletAnimation="";this.bulletWorldWrap=this.bulletFrameCycle=this.bulletFrameRandom=!1;this.bulletAngleVariance=this.bulletAngleOffset=this.bulletWorldWrapPadding=0;this.bulletSpeed=200;this.bulletKillDistance=this.bulletLifespan=this.bulletSpeedVariance=0;this.bulletGravity=new b.Point(0,0);this.bulletRotateToVelocity=!1;
this.bulletFrame=this.bulletKey="";this._bulletClass=b.Bullet;this._bulletCollideWorldBounds=!1;this._bulletKillType=b.Weapon.KILL_WORLD_BOUNDS;this._data={customBody:!1,width:0,height:0,offsetX:0,offsetY:0};this.bounds=new b.Rectangle;this.bulletBounds=a.world.bounds;this.bulletFrames=[];this.bulletFrameIndex=0;this.anims={};this.onFire=new b.Signal;this.onKill=new b.Signal;this.onFireLimit=new b.Signal;this.trackedPointer=this.trackedSprite=null;this.trackRotation=!1;this.trackOffset=new b.Point;
this._nextFire=0;this._rotatedPoint=new b.Point};b.Weapon.prototype=Object.create(b.Plugin.prototype);b.Weapon.prototype.constructor=b.Weapon;b.Weapon.KILL_NEVER=0;b.Weapon.KILL_LIFESPAN=1;b.Weapon.KILL_DISTANCE=2;b.Weapon.KILL_WEAPON_BOUNDS=3;b.Weapon.KILL_CAMERA_BOUNDS=4;b.Weapon.KILL_WORLD_BOUNDS=5;b.Weapon.KILL_STATIC_BOUNDS=6;b.Weapon.prototype.createBullets=function(a,c,d,e){void 0===a&&(a=1);void 0===e&&(e=this.game.world);this.bullets||(this.bullets=this.game.add.physicsGroup(b.Physics.ARCADE,
e),this.bullets.classType=this._bulletClass);0!==a&&(-1===a&&(this.autoExpandBulletsGroup=!0,a=1),this.bullets.createMultiple(a,c,d),this.bullets.setAll("data.bulletManager",this),this.bulletKey=c,this.bulletFrame=d);return this};b.Weapon.prototype.forEach=function(a,b){this.bullets.forEachExists(a,b,arguments);return this};b.Weapon.prototype.pauseAll=function(){this.bullets.setAll("body.enable",!1);return this};b.Weapon.prototype.resumeAll=function(){this.bullets.setAll("body.enable",!0);return this};
b.Weapon.prototype.killAll=function(){this.bullets.callAllExists("kill",!0);this.bullets.setAll("body.enable",!0);return this};b.Weapon.prototype.resetShots=function(a){this.shots=0;void 0!==a&&(this.fireLimit=a);return this};b.Weapon.prototype.destroy=function(){this.parent.remove(this,!1);this.bullets.destroy();this.parent=this.game=null;this.visible=this.active=!1};b.Weapon.prototype.update=function(){this._bulletKillType===b.Weapon.KILL_WEAPON_BOUNDS&&(this.trackedSprite?(this.trackedSprite.updateTransform(),
this.bounds.centerOn(this.trackedSprite.worldPosition.x,this.trackedSprite.worldPosition.y)):this.trackedPointer&&this.bounds.centerOn(this.trackedPointer.worldX,this.trackedPointer.worldY));this.autofire&&this.fire()};b.Weapon.prototype.trackSprite=function(a,b,d,e){void 0===b&&(b=0);void 0===d&&(d=0);void 0===e&&(e=!1);this.trackedPointer=null;this.trackedSprite=a;this.trackRotation=e;this.trackOffset.set(b,d);return this};b.Weapon.prototype.trackPointer=function(a,b,d){void 0===a&&(a=this.game.input.activePointer);
void 0===b&&(b=0);void 0===d&&(d=0);this.trackedPointer=a;this.trackedSprite=null;this.trackRotation=!1;this.trackOffset.set(b,d);return this};b.Weapon.prototype.fire=function(a,c,d){if(this.game.time.now<this._nextFire||0<this.fireLimit&&this.shots===this.fireLimit)return!1;var e=this.bulletSpeed;0!==this.bulletSpeedVariance&&(e+=b.Math.between(-this.bulletSpeedVariance,this.bulletSpeedVariance));a?1<this.fireFrom.width?this.fireFrom.centerOn(a.x,a.y):(this.fireFrom.x=a.x,this.fireFrom.y=a.y):this.trackedSprite?
(this.trackRotation?(this._rotatedPoint.set(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y),this._rotatedPoint.rotate(this.trackedSprite.world.x,this.trackedSprite.world.y,this.trackedSprite.rotation),1<this.fireFrom.width?this.fireFrom.centerOn(this._rotatedPoint.x,this._rotatedPoint.y):(this.fireFrom.x=this._rotatedPoint.x,this.fireFrom.y=this._rotatedPoint.y)):1<this.fireFrom.width?this.fireFrom.centerOn(this.trackedSprite.world.x+this.trackOffset.x,
this.trackedSprite.world.y+this.trackOffset.y):(this.fireFrom.x=this.trackedSprite.world.x+this.trackOffset.x,this.fireFrom.y=this.trackedSprite.world.y+this.trackOffset.y),this.bulletInheritSpriteSpeed&&(e+=this.trackedSprite.body.speed)):this.trackedPointer&&(1<this.fireFrom.width?this.fireFrom.centerOn(this.trackedPointer.world.x+this.trackOffset.x,this.trackedPointer.world.y+this.trackOffset.y):(this.fireFrom.x=this.trackedPointer.world.x+this.trackOffset.x,this.fireFrom.y=this.trackedPointer.world.y+
this.trackOffset.y));a=1<this.fireFrom.width?this.fireFrom.randomX:this.fireFrom.x;var f=1<this.fireFrom.height?this.fireFrom.randomY:this.fireFrom.y,g=this.trackRotation?this.trackedSprite.angle:this.fireAngle;void 0!==c&&void 0!==d&&(g=this.game.math.radToDeg(Math.atan2(d-f,c-a)));0!==this.bulletAngleVariance&&(g+=b.Math.between(-this.bulletAngleVariance,this.bulletAngleVariance));var k=d=0;0===g||180===g?d=Math.cos(this.game.math.degToRad(g))*e:(90!==g&&270!==g&&(d=Math.cos(this.game.math.degToRad(g))*
e),k=Math.sin(this.game.math.degToRad(g))*e);this.autoExpandBulletsGroup?(c=this.bullets.getFirstExists(!1,!0,a,f,this.bulletKey,this.bulletFrame),c.data.bulletManager=this):c=this.bullets.getFirstExists(!1);c&&(c.reset(a,f),c.data.fromX=a,c.data.fromY=f,c.data.killType=this.bulletKillType,c.data.killDistance=this.bulletKillDistance,c.data.rotateToVelocity=this.bulletRotateToVelocity,this.bulletKillType===b.Weapon.KILL_LIFESPAN&&(c.lifespan=this.bulletLifespan),c.angle=g+this.bulletAngleOffset,""!==
this.bulletAnimation?(null===c.animations.getAnimation(this.bulletAnimation)&&(a=this.anims[this.bulletAnimation],c.animations.add(a.name,a.frames,a.frameRate,a.loop,a.useNumericIndex)),c.animations.play(this.bulletAnimation)):this.bulletFrameCycle?(c.frame=this.bulletFrames[this.bulletFrameIndex],this.bulletFrameIndex++,this.bulletFrameIndex>=this.bulletFrames.length&&(this.bulletFrameIndex=0)):this.bulletFrameRandom&&(c.frame=this.bulletFrames[Math.floor(Math.random()*this.bulletFrames.length)]),
c.data.bodyDirty&&(this._data.customBody&&c.body.setSize(this._data.width,this._data.height,this._data.offsetX,this._data.offsetY),c.body.collideWorldBounds=this.bulletCollideWorldBounds,c.data.bodyDirty=!1),c.body.velocity.set(d,k),c.body.gravity.set(this.bulletGravity.x,this.bulletGravity.y),0!==this.bulletSpeedVariance?(a=this.fireRate,a+=b.Math.between(-this.fireRateVariance,this.fireRateVariance),0>a&&(a=0),this._nextFire=this.game.time.now+a):this._nextFire=this.game.time.now+this.fireRate,
this.shots++,this.onFire.dispatch(c,this,e),0<this.fireLimit&&this.shots===this.fireLimit&&this.onFireLimit.dispatch(this,this.fireLimit));return c};b.Weapon.prototype.fireAtPointer=function(a){void 0===a&&(a=this.game.input.activePointer);return this.fire(null,a.worldX,a.worldY)};b.Weapon.prototype.fireAtSprite=function(a){return this.fire(null,a.world.x,a.world.y)};b.Weapon.prototype.fireAtXY=function(a,b){return this.fire(null,a,b)};b.Weapon.prototype.setBulletBodyOffset=function(a,b,d,e){void 0===
d&&(d=0);void 0===e&&(e=0);this._data.customBody=!0;this._data.width=a;this._data.height=b;this._data.offsetX=d;this._data.offsetY=e;this.bullets.callAll("body.setSize","body",a,b,d,e);this.bullets.setAll("data.bodyDirty",!1);return this};b.Weapon.prototype.setBulletFrames=function(a,c,d,e){void 0===d&&(d=!0);void 0===e&&(e=!1);this.bulletFrames=b.ArrayUtils.numberArray(a,c);this.bulletFrameIndex=0;this.bulletFrameCycle=d;this.bulletFrameRandom=e;return this};b.Weapon.prototype.addBulletAnimation=
function(a,b,d,e,f){this.anims[a]={name:a,frames:b,frameRate:d,loop:e,useNumericIndex:f};this.bullets.callAll("animations.add","animations",a,b,d,e,f);this.bulletAnimation=a;return this};b.Weapon.prototype.debug=function(a,b,d){void 0===a&&(a=16);void 0===b&&(b=32);void 0===d&&(d=!1);this.game.debug.text("Weapon Plugin",a,b);this.game.debug.text("Bullets Alive: "+this.bullets.total+" - Total: "+this.bullets.length,a,b+24);d&&this.bullets.forEachExists(this.game.debug.body,this.game.debug,"rgba(255, 0, 255, 0.8)")};
Object.defineProperty(b.Weapon.prototype,"bulletClass",{get:function(){return this._bulletClass},set:function(a){this._bulletClass=a;this.bullets.classType=this._bulletClass}});Object.defineProperty(b.Weapon.prototype,"bulletKillType",{get:function(){return this._bulletKillType},set:function(a){switch(a){case b.Weapon.KILL_STATIC_BOUNDS:case b.Weapon.KILL_WEAPON_BOUNDS:this.bulletBounds=this.bounds;break;case b.Weapon.KILL_CAMERA_BOUNDS:this.bulletBounds=this.game.camera.view;break;case b.Weapon.KILL_WORLD_BOUNDS:this.bulletBounds=
this.game.world.bounds}this._bulletKillType=a}});Object.defineProperty(b.Weapon.prototype,"bulletCollideWorldBounds",{get:function(){return this._bulletCollideWorldBounds},set:function(a){this._bulletCollideWorldBounds=a;this.bullets.setAll("body.collideWorldBounds",a);this.bullets.setAll("data.bodyDirty",!1)}});Object.defineProperty(b.Weapon.prototype,"x",{get:function(){return this.fireFrom.x},set:function(a){this.fireFrom.x=a}});Object.defineProperty(b.Weapon.prototype,"y",{get:function(){return this.fireFrom.y},
set:function(a){this.fireFrom.y=a}});b.Bullet=function(a,c,d,e,f){b.Sprite.call(this,a,c,d,e,f);this.anchor.set(.5);this.data={bulletManager:null,fromX:0,fromY:0,bodyDirty:!0,rotateToVelocity:!1,killType:0,killDistance:0}};b.Bullet.prototype=Object.create(b.Sprite.prototype);b.Bullet.prototype.constructor=b.Bullet;b.Bullet.prototype.kill=function(){this.visible=this.exists=this.alive=!1;this.data.bulletManager.onKill.dispatch(this);return this};b.Bullet.prototype.update=function(){this.exists&&(this.data.killType>
b.Weapon.KILL_LIFESPAN&&(this.data.killType===b.Weapon.KILL_DISTANCE?this.game.physics.arcade.distanceToXY(this,this.data.fromX,this.data.fromY,!0)>this.data.killDistance&&this.kill():this.data.bulletManager.bulletBounds.intersects(this)||this.kill()),this.data.rotateToVelocity&&(this.rotation=Math.atan2(this.body.velocity.y,this.body.velocity.x)),this.data.bulletManager.bulletWorldWrap&&this.game.world.wrap(this,this.data.bulletManager.bulletWorldWrapPadding))};b.Video=function(a,c,d){void 0===c&&
(c=null);void 0===d&&(d=null);this.game=a;this.key=c;this.height=this.width=0;this.type=b.VIDEO;this.touchLocked=this.disableTextureUpload=!1;this.onPlay=new b.Signal;this.onChangeSource=new b.Signal;this.onComplete=new b.Signal;this.onAccess=new b.Signal;this.onError=new b.Signal;this.onTimeout=new b.Signal;this.timeout=15E3;this.videoStream=this.video=this._timeOutID=null;this.isStreaming=!1;this.retryLimit=20;this.retry=0;this.retryInterval=500;this._retryID=null;this._autoplay=this._pending=this._paused=
this._codePaused=this._muted=this._codeMuted=!1;this._playCallback=this._endCallback=null;if(c&&this.game.cache.checkVideoKey(c)){var e=this.game.cache.getVideo(c);e.isBlob?this.createVideoFromBlob(e.data):this.video=e.data;this.width=this.video.videoWidth;this.height=this.video.videoHeight}else d&&this.createVideoFromURL(d,!1);this.baseTexture=this.video&&!d?new PIXI.BaseTexture(this.video):new PIXI.BaseTexture(b.Cache.DEFAULT.baseTexture.source);this.baseTexture.forceLoaded(this.width,this.height);
this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new b.Frame(0,0,0,this.width,this.height,"video");this.texture.setFrame(this.textureFrame);this.texture.valid=!1;null!==c&&this.video&&(this.texture.valid=this.video.canplay);this.snapshot=null;b.BitmapData&&(this.snapshot=new b.BitmapData(this.game,"",this.width,this.height));!this.game.device.cocoonJS&&(this.game.device.iOS||this.game.device.android)||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock?this.setTouchLock():e&&
(e.locked=!1)};b.Video.prototype={connectToMediaStream:function(a,b){a&&b&&(this.video=a,this.videoStream=b,this.isStreaming=!0,this.baseTexture.source=this.video,this.updateTexture(null,this.video.videoWidth,this.video.videoHeight),this.onAccess.dispatch(this));return this},startMediaStream:function(a,b,d){void 0===a&&(a=!1);void 0===b&&(b=null);void 0===d&&(d=null);if(!this.game.device.getUserMedia)return this.onError.dispatch(this,"No getUserMedia"),!1;null!==this.videoStream&&(this.videoStream.active?
this.videoStream.active=!1:this.videoStream.stop());this.removeVideoElement();this.video=document.createElement("video");this.video.setAttribute("autoplay","autoplay");null!==b&&(this.video.width=b);null!==d&&(this.video.height=d);this._timeOutID=window.setTimeout(this.getUserMediaTimeout.bind(this),this.timeout);try{navigator.getUserMedia({audio:a,video:!0},this.getUserMediaSuccess.bind(this),this.getUserMediaError.bind(this))}catch(e){this.getUserMediaError(e)}return this},getUserMediaTimeout:function(){clearTimeout(this._timeOutID);
this.onTimeout.dispatch(this)},getUserMediaError:function(a){clearTimeout(this._timeOutID);this.onError.dispatch(this,a)},getUserMediaSuccess:function(a){clearTimeout(this._timeOutID);this.videoStream=a;void 0!==this.video.mozSrcObject?this.video.mozSrcObject=a:this.video.src=window.URL&&window.URL.createObjectURL(a)||a;var b=this;this.video.onloadeddata=function(){function a(){if(0<c)if(0<b.video.videoWidth){var d=b.video.videoWidth,e=b.video.videoHeight;isNaN(b.video.videoHeight)&&(e=d/(4/3));b.video.play();
b.isStreaming=!0;b.baseTexture.source=b.video;b.updateTexture(null,d,e);b.onAccess.dispatch(b)}else window.setTimeout(a,500);else console.warn("Unable to connect to video stream. Webcam error?");c--}var c=10;a()}},createVideoFromBlob:function(a){var b=this;this.video=document.createElement("video");this.video.controls=!1;this.video.setAttribute("autoplay","autoplay");this.video.addEventListener("loadeddata",function(a){b.updateTexture(a)},!0);this.video.src=window.URL.createObjectURL(a);this.video.canplay=
!0;return this},createVideoFromURL:function(a,b){void 0===b&&(b=!1);this.texture&&(this.texture.valid=!1);this.video=document.createElement("video");this.video.controls=!1;b&&this.video.setAttribute("autoplay","autoplay");this.video.src=a;this.video.canplay=!0;this.video.load();this.retry=this.retryLimit;this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval);this.key=a;return this},updateTexture:function(a,b,d){a=!1;if(void 0===b||null===b)b=this.video.videoWidth,a=
!0;if(void 0===d||null===d)d=this.video.videoHeight;this.width=b;this.height=d;this.baseTexture.source!==this.video&&(this.baseTexture.source=this.video);this.baseTexture.forceLoaded(b,d);this.texture.frame.resize(b,d);this.texture.width=b;this.texture.height=d;this.texture.valid=!0;this.snapshot&&this.snapshot.resize(b,d);a&&null!==this.key&&(this.onChangeSource.dispatch(this,b,d),this._autoplay&&(this.video.play(),this.onPlay.dispatch(this,this.loop,this.playbackRate)))},complete:function(){this.onComplete.dispatch(this)},
play:function(a,b){void 0===a&&(a=!1);void 0===b&&(b=1);this.game.sound.onMute&&(this.game.sound.onMute.add(this.setMute,this),this.game.sound.onUnMute.add(this.unsetMute,this),this.game.sound.mute&&this.setMute());this.game.onPause.add(this.setPause,this);this.game.onResume.add(this.setResume,this);this._endCallback=this.complete.bind(this);this.video.addEventListener("ended",this._endCallback,!0);this.video.addEventListener("webkitendfullscreen",this._endCallback,!0);this.video.loop=a?"loop":"";
this.video.playbackRate=b;this.touchLocked?this._pending=!0:(this._pending=!1,null!==this.key&&(4!==this.video.readyState?(this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval)):(this._playCallback=this.playHandler.bind(this),this.video.addEventListener("playing",this._playCallback,!0))),this.video.play(),this.onPlay.dispatch(this,a,b));return this},playHandler:function(){this.video.removeEventListener("playing",this._playCallback,!0);this.updateTexture()},
stop:function(){this.game.sound.onMute&&(this.game.sound.onMute.remove(this.setMute,this),this.game.sound.onUnMute.remove(this.unsetMute,this));this.game.onPause.remove(this.setPause,this);this.game.onResume.remove(this.setResume,this);this.isStreaming?(this.video.mozSrcObject?(this.video.mozSrcObject.stop(),this.video.src=null):(this.video.src="",this.videoStream.active?this.videoStream.active=!1:this.videoStream.getTracks?this.videoStream.getTracks().forEach(function(a){a.stop()}):this.videoStream.stop()),
this.videoStream=null,this.isStreaming=!1):(this.video.removeEventListener("ended",this._endCallback,!0),this.video.removeEventListener("webkitendfullscreen",this._endCallback,!0),this.video.removeEventListener("playing",this._playCallback,!0),this.touchLocked?this._pending=!1:this.video.pause());return this},add:function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)a[b].loadTexture&&a[b].loadTexture(this);else a.loadTexture(this);return this},addToWorld:function(a,b,d,e,f,g){f=f||1;g=g||1;a=
this.game.add.image(a,b,this);a.anchor.set(d,e);a.scale.set(f,g);return a},render:function(){!this.disableTextureUpload&&this.playing&&this.baseTexture.dirty()},setMute:function(){this._muted||(this._muted=!0,this.video.muted=!0)},unsetMute:function(){this._muted&&!this._codeMuted&&(this._muted=!1,this.video.muted=!1)},setPause:function(){this._paused||this.touchLocked||(this._paused=!0,this.video.pause())},setResume:function(){!this._paused||this._codePaused||this.touchLocked||(this._paused=!1,this.video.ended||
this.video.play())},changeSource:function(a,b){void 0===b&&(b=!0);this.texture.valid=!1;this.video.pause();this.retry=this.retryLimit;this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval);this.video.src=a;this.video.load();this._autoplay=b;b||(this.paused=!0);return this},checkVideoProgress:function(){4===this.video.readyState?this.updateTexture():(this.retry--,0<this.retry?this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval):console.warn("Phaser.Video: Unable to start downloading video in time",
this.isStreaming))},setTouchLock:function(){this.game.input.touch.addTouchLockCallback(this.unlock,this);this.touchLocked=!0},unlock:function(){this.touchLocked=!1;this.video.play();this.onPlay.dispatch(this,this.loop,this.playbackRate);if(this.key){var a=this.game.cache.getVideo(this.key);a&&!a.isBlob&&(a.locked=!1)}return!0},grab:function(a,b,d){void 0===a&&(a=!1);void 0===b&&(b=1);void 0===d&&(d=null);if(null===this.snapshot)console.warn("Video.grab cannot run because Phaser.BitmapData is unavailable");
else return a&&this.snapshot.cls(),this.snapshot.copy(this.video,0,0,this.width,this.height,0,0,this.width,this.height,0,0,0,1,1,b,d),this.snapshot},removeVideoElement:function(){if(this.video){for(this.video.parentNode&&this.video.parentNode.removeChild(this.video);this.video.hasChildNodes();)this.video.removeChild(this.video.firstChild);this.video.removeAttribute("autoplay");this.video.removeAttribute("src");this.video=null}},destroy:function(){this.stop();this.removeVideoElement();this.touchLocked&&
this.game.input.touch.removeTouchLockCallback(this.unlock,this);this._retryID&&window.clearTimeout(this._retryID)}};Object.defineProperty(b.Video.prototype,"currentTime",{get:function(){return this.video?this.video.currentTime:0},set:function(a){this.video.currentTime=a}});Object.defineProperty(b.Video.prototype,"duration",{get:function(){return this.video?this.video.duration:0}});Object.defineProperty(b.Video.prototype,"progress",{get:function(){return this.video?this.video.currentTime/this.video.duration:
0}});Object.defineProperty(b.Video.prototype,"mute",{get:function(){return this._muted},set:function(a){a?this._muted||(this._codeMuted=!0,this.setMute()):this._muted&&(this._codeMuted=!1,this.unsetMute())}});Object.defineProperty(b.Video.prototype,"paused",{get:function(){return this._paused},set:function(a){this.touchLocked||(a?this._paused||(this._codePaused=!0,this.setPause()):this._paused&&(this._codePaused=!1,this.setResume()))}});Object.defineProperty(b.Video.prototype,"volume",{get:function(){return this.video?
this.video.volume:1},set:function(a){0>a?a=0:1<a&&(a=1);this.video&&(this.video.volume=a)}});Object.defineProperty(b.Video.prototype,"playbackRate",{get:function(){return this.video?this.video.playbackRate:1},set:function(a){this.video&&(this.video.playbackRate=a)}});Object.defineProperty(b.Video.prototype,"loop",{get:function(){return this.video?this.video.loop:!1},set:function(a){a&&this.video?this.video.loop="loop":this.video&&(this.video.loop="")}});Object.defineProperty(b.Video.prototype,"playing",
{get:function(){return!(this.video.paused&&this.video.ended)}});b.Video.prototype.constructor=b.Video;void 0===PIXI.blendModes&&(PIXI.blendModes=b.blendModes);void 0===PIXI.scaleModes&&(PIXI.scaleModes=b.scaleModes);void 0===PIXI.Texture.emptyTexture&&(PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture));void 0===PIXI.DisplayObject._tempMatrix&&(PIXI.DisplayObject._tempMatrix=new PIXI.Matrix);void 0===PIXI.RenderTexture.tempMatrix&&(PIXI.RenderTexture.tempMatrix=new PIXI.Matrix);PIXI.Graphics&&
void 0===PIXI.Graphics.POLY&&(PIXI.Graphics.POLY=b.POLYGON,PIXI.Graphics.RECT=b.RECTANGLE,PIXI.Graphics.CIRC=b.CIRCLE,PIXI.Graphics.ELIP=b.ELLIPSE,PIXI.Graphics.RREC=b.ROUNDEDRECTANGLE);PIXI.TextureSilentFail=!0;"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=b),exports.Phaser=b):"undefined"!==typeof define&&define.amd?define("Phaser",this.Phaser=b):this.Phaser=b;return b}).call(this);